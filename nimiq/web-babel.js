require=function(){return function r(e,t,n){function o(i,s){if(!t[i]){if(!e[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[i]={exports:{}};e[i][0].call(l.exports,function(t){return o(e[i][1][t]||t)},l,l.exports,r,e,t,n)}return t[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}}()({1:[function(e,t,n){e("../../modules/es6.string.iterator");e("../../modules/es6.array.from");t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":21,"../../modules/es6.array.from":85,"../../modules/es6.string.iterator":97}],2:[function(e,t,n){e("../modules/web.dom.iterable");e("../modules/es6.string.iterator");t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":84,"../modules/es6.string.iterator":97,"../modules/web.dom.iterable":101}],3:[function(e,t,n){var r=e("../../modules/_core"),a=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function stringify(e){return a.stringify.apply(a,arguments)}},{"../../modules/_core":21}],4:[function(e,t,n){e("../../modules/es6.math.clz32");t.exports=e("../../modules/_core").Math.clz32},{"../../modules/_core":21,"../../modules/es6.math.clz32":87}],5:[function(e,t,n){e("../../modules/es6.math.fround");t.exports=e("../../modules/_core").Math.fround},{"../../modules/_core":21,"../../modules/es6.math.fround":88}],6:[function(e,t,n){e("../../modules/es6.math.imul");t.exports=e("../../modules/_core").Math.imul},{"../../modules/_core":21,"../../modules/es6.math.imul":89}],7:[function(e,t,n){e("../../modules/es6.math.trunc");t.exports=e("../../modules/_core").Math.trunc},{"../../modules/_core":21,"../../modules/es6.math.trunc":90}],8:[function(e,t,n){e("../../modules/es6.number.is-integer");t.exports=e("../../modules/_core").Number.isInteger},{"../../modules/_core":21,"../../modules/es6.number.is-integer":91}],9:[function(e,t,n){e("../../modules/es6.number.max-safe-integer");t.exports=9007199254740991},{"../../modules/es6.number.max-safe-integer":92}],10:[function(e,t,n){e("../../modules/es6.object.freeze");t.exports=e("../../modules/_core").Object.freeze},{"../../modules/_core":21,"../../modules/es6.object.freeze":93}],11:[function(e,t,n){e("../../modules/es6.object.keys");t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":21,"../../modules/es6.object.keys":94}],12:[function(e,t,n){e("../../modules/es7.object.values");t.exports=e("../../modules/_core").Object.values},{"../../modules/_core":21,"../../modules/es7.object.values":98}],13:[function(e,t,n){e("../modules/es6.object.to-string");e("../modules/es6.string.iterator");e("../modules/web.dom.iterable");e("../modules/es6.promise");e("../modules/es7.promise.finally");e("../modules/es7.promise.try");t.exports=e("../modules/_core").Promise},{"../modules/_core":21,"../modules/es6.object.to-string":95,"../modules/es6.promise":96,"../modules/es6.string.iterator":97,"../modules/es7.promise.finally":99,"../modules/es7.promise.try":100,"../modules/web.dom.iterable":101}],14:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],15:[function(e,t,n){t.exports=function(){}},{}],16:[function(e,t,n){t.exports=function(e,t,n,r){if(!(e instanceof t)||r!==undefined&&r in e)throw TypeError(n+": incorrect invocation!");return e}},{}],17:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":40}],18:[function(e,t,n){var r=e("./_to-iobject"),a=e("./_to-length"),i=e("./_to-absolute-index");t.exports=function(e){return function(t,n,s){var o,u=r(t),c=a(u.length),l=i(s,c);if(e&&n!=n){for(;c>l;)if((o=u[l++])!=o)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},{"./_to-absolute-index":74,"./_to-iobject":76,"./_to-length":77}],19:[function(e,t,n){var r=e("./_cof"),a=e("./_wks")("toStringTag"),i="Arguments"==r(function(){return arguments}());t.exports=function(e){var t,n,s;return e===undefined?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=Object(e),a))?n:i?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},{"./_cof":20,"./_wks":82}],20:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],21:[function(e,t,n){var r=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=r)},{}],22:[function(e,t,n){"use strict";var r=e("./_object-dp"),a=e("./_property-desc");t.exports=function(e,t,n){t in e?r.f(e,t,a(0,n)):e[t]=n}},{"./_object-dp":54,"./_property-desc":64}],23:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){r(e);if(t===undefined)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":14}],24:[function(e,t,n){t.exports=function(e){if(e==undefined)throw TypeError("Can't call method on  "+e);return e}},{}],25:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":29}],26:[function(e,t,n){var r=e("./_is-object"),a=e("./_global").document,i=r(a)&&r(a.createElement);t.exports=function(e){return i?a.createElement(e):{}}},{"./_global":31,"./_is-object":40}],27:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],28:[function(e,t,n){var r=e("./_global"),a=e("./_core"),i=e("./_ctx"),s=e("./_hide"),o=e("./_has"),u=function(e,t,n){var c,l,h,f=e&u.F,d=e&u.G,A=e&u.S,_=e&u.P,p=e&u.B,g=e&u.W,y=d?a:a[t]||(a[t]={}),v=y.prototype,k=d?r:A?r[t]:(r[t]||{}).prototype;d&&(n=t);for(c in n)if(!(l=!f&&k&&k[c]!==undefined)||!o(y,c)){h=l?k[c]:n[c];y[c]=d&&"function"!=typeof k[c]?n[c]:p&&l?i(h,r):g&&k[c]==h?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};t.prototype=e.prototype;return t}(h):_&&"function"==typeof h?i(Function.call,h):h;if(_){(y.virtual||(y.virtual={}))[c]=h;e&u.R&&v&&!v[c]&&s(v,c,h)}}};u.F=1;u.G=2;u.S=4;u.P=8;u.B=16;u.W=32;u.U=64;u.R=128;t.exports=u},{"./_core":21,"./_ctx":23,"./_global":31,"./_has":32,"./_hide":33}],29:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(t){return!0}}},{}],30:[function(e,t,n){var r=e("./_ctx"),a=e("./_iter-call"),i=e("./_is-array-iter"),s=e("./_an-object"),o=e("./_to-length"),u=e("./core.get-iterator-method"),c={},l={};(n=t.exports=function(e,t,n,h,f){var d,A,_,p,g=f?function(){return e}:u(e),y=r(n,h,t?2:1),v=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(i(g)){for(d=o(e.length);d>v;v++)if((p=t?y(s(A=e[v])[0],A[1]):y(e[v]))===c||p===l)return p}else for(_=g.call(e);!(A=_.next()).done;)if((p=a(_,y,A.value,t))===c||p===l)return p}).BREAK=c;n.RETURN=l},{"./_an-object":17,"./_ctx":23,"./_is-array-iter":38,"./_iter-call":41,"./_to-length":77,"./core.get-iterator-method":83}],31:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],32:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],33:[function(e,t,n){var r=e("./_object-dp"),a=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,a(1,n))}:function(e,t,n){e[t]=n;return e}},{"./_descriptors":25,"./_object-dp":54,"./_property-desc":64}],34:[function(e,t,n){var r=e("./_global").document;t.exports=r&&r.documentElement},{"./_global":31}],35:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":25,"./_dom-create":26,"./_fails":29}],36:[function(e,t,n){t.exports=function(e,t,n){var r=n===undefined;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],37:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":20}],38:[function(e,t,n){var r=e("./_iterators"),a=e("./_wks")("iterator"),i=Array.prototype;t.exports=function(e){return e!==undefined&&(r.Array===e||i[a]===e)}},{"./_iterators":46,"./_wks":82}],39:[function(e,t,n){var r=e("./_is-object"),a=Math.floor;t.exports=function isInteger(e){return!r(e)&&isFinite(e)&&a(e)===e}},{"./_is-object":40}],40:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],41:[function(e,t,n){var r=e("./_an-object");t.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(s){var i=e["return"];i!==undefined&&r(i.call(e));throw s}}},{"./_an-object":17}],42:[function(e,t,n){"use strict";var r=e("./_object-create"),a=e("./_property-desc"),i=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this});t.exports=function(e,t,n){e.prototype=r(s,{next:a(1,n)});i(e,t+" Iterator")}},{"./_hide":33,"./_object-create":53,"./_property-desc":64,"./_set-to-string-tag":68,"./_wks":82}],43:[function(e,t,n){"use strict";var r=e("./_library"),a=e("./_export"),i=e("./_redefine"),s=e("./_hide"),o=e("./_iterators"),u=e("./_iter-create"),c=e("./_set-to-string-tag"),l=e("./_object-gpo"),h=e("./_wks")("iterator"),f=!([].keys&&"next"in[].keys()),d=function(){return this};t.exports=function(e,t,n,A,_,p,g){u(n,t,A);var y,v,k,m=function(e){if(!f&&e in S)return S[e];switch(e){case"keys":return function keys(){return new n(this,e)};case"values":return function values(){return new n(this,e)}}return function entries(){return new n(this,e)}},b=t+" Iterator",w="values"==_,C=!1,S=e.prototype,T=S[h]||S["@@iterator"]||_&&S[_],E=T||m(_),x=_?w?m("entries"):E:undefined,I="Array"==t&&S.entries||T;if(I&&(k=l(I.call(new e)))!==Object.prototype&&k.next){c(k,b,!0);r||"function"==typeof k[h]||s(k,h,d)}if(w&&T&&"values"!==T.name){C=!0;E=function values(){return T.call(this)}}r&&!g||!f&&!C&&S[h]||s(S,h,E);o[t]=E;o[b]=d;if(_){y={values:w?E:m("values"),keys:p?E:m("keys"),entries:x};if(g)for(v in y)v in S||i(S,v,y[v]);else a(a.P+a.F*(f||C),t,y)}return y}},{"./_export":28,"./_hide":33,"./_iter-create":42,"./_iterators":46,"./_library":47,"./_object-gpo":56,"./_redefine":66,"./_set-to-string-tag":68,"./_wks":82}],44:[function(e,t,n){var r=e("./_wks")("iterator"),a=!1;try{var i=[7][r]();i["return"]=function(){a=!0};Array.from(i,function(){throw 2})}catch(s){}t.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var i=[7],o=i[r]();o.next=function(){return{done:n=!0}};i[r]=function(){return o};e(i)}catch(s){}return n}},{"./_wks":82}],45:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],46:[function(e,t,n){t.exports={}},{}],47:[function(e,t,n){t.exports=!0},{}],48:[function(e,t,n){var r=e("./_math-sign"),a=Math.pow,i=a(2,-52),s=a(2,-23),o=a(2,127)*(2-s),u=a(2,-126);t.exports=Math.fround||function fround(e){var t,n,a=Math.abs(e),c=r(e);return a<u?c*(a/u/s+1/i-1/i)*u*s:(n=(t=(1+s/i)*a)-(t-a))>o||n!=n?c*Infinity:c*n}},{"./_math-sign":49}],49:[function(e,t,n){t.exports=Math.sign||function sign(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},{}],50:[function(e,t,n){var r=e("./_uid")("meta"),a=e("./_is-object"),i=e("./_has"),s=e("./_object-dp").f,o=0,u=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),l=function(e){s(e,r,{value:{i:"O"+ ++o,w:{}}})},h=t.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!i(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){c&&h.NEED&&u(e)&&!i(e,r)&&l(e);return e}}},{"./_fails":29,"./_has":32,"./_is-object":40,"./_object-dp":54,"./_uid":80}],51:[function(e,t,n){var r=e("./_global"),a=e("./_task").set,i=r.MutationObserver||r.WebKitMutationObserver,s=r.process,o=r.Promise,u="process"==e("./_cof")(s);t.exports=function(){var e,t,n,c=function(){var r,a;u&&(r=s.domain)&&r.exit();for(;e;){a=e.fn;e=e.next;try{a()}catch(i){e?n():t=undefined;throw i}}t=undefined;r&&r.enter()};if(u)n=function(){s.nextTick(c)};else if(!i||r.navigator&&r.navigator.standalone)if(o&&o.resolve){var l=o.resolve(undefined);n=function(){l.then(c)}}else n=function(){a.call(r,c)};else{var h=!0,f=document.createTextNode("");new i(c).observe(f,{characterData:!0});n=function(){f.data=h=!h}}return function(r){var a={fn:r,next:undefined};t&&(t.next=a);if(!e){e=a;n()}t=a}}},{"./_cof":20,"./_global":31,"./_task":73}],52:[function(e,t,n){"use strict";var r=e("./_a-function");function PromiseCapability(e){var t,n;this.promise=new e(function(e,r){if(t!==undefined||n!==undefined)throw TypeError("Bad Promise constructor");t=e;n=r});this.resolve=r(t);this.reject=r(n)}t.exports.f=function(e){return new PromiseCapability(e)}},{"./_a-function":14}],53:[function(e,t,n){var r=e("./_an-object"),a=e("./_object-dps"),i=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),o=function(){},u=function(){var t,n=e("./_dom-create")("iframe"),r=i.length;n.style.display="none";e("./_html").appendChild(n);n.src="javascript:";(t=n.contentWindow.document).open();t.write("<script>document.F=Object<\/script>");t.close();u=t.F;for(;r--;)delete u.prototype[i[r]];return u()};t.exports=Object.create||function create(e,t){var n;if(null!==e){o.prototype=r(e);n=new o;o.prototype=null;n[s]=e}else n=u();return t===undefined?n:a(n,t)}},{"./_an-object":17,"./_dom-create":26,"./_enum-bug-keys":27,"./_html":34,"./_object-dps":55,"./_shared-key":69}],54:[function(e,t,n){var r=e("./_an-object"),a=e("./_ie8-dom-define"),i=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function defineProperty(e,t,n){r(e);t=i(t,!0);r(n);if(a)try{return s(e,t,n)}catch(o){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");"value"in n&&(e[t]=n.value);return e}},{"./_an-object":17,"./_descriptors":25,"./_ie8-dom-define":35,"./_to-primitive":79}],55:[function(e,t,n){var r=e("./_object-dp"),a=e("./_an-object"),i=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function defineProperties(e,t){a(e);for(var n,s=i(t),o=s.length,u=0;o>u;)r.f(e,n=s[u++],t[n]);return e}},{"./_an-object":17,"./_descriptors":25,"./_object-dp":54,"./_object-keys":58}],56:[function(e,t,n){var r=e("./_has"),a=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){e=a(e);return r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":32,"./_shared-key":69,"./_to-object":78}],57:[function(e,t,n){var r=e("./_has"),a=e("./_to-iobject"),i=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,o=a(e),u=0,c=[];for(n in o)n!=s&&r(o,n)&&c.push(n);for(;t.length>u;)r(o,n=t[u++])&&(~i(c,n)||c.push(n));return c}},{"./_array-includes":18,"./_has":32,"./_shared-key":69,"./_to-iobject":76}],58:[function(e,t,n){var r=e("./_object-keys-internal"),a=e("./_enum-bug-keys");t.exports=Object.keys||function keys(e){return r(e,a)}},{"./_enum-bug-keys":27,"./_object-keys-internal":57}],59:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],60:[function(e,t,n){var r=e("./_export"),a=e("./_core"),i=e("./_fails");t.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],s={};s[e]=t(n);r(r.S+r.F*i(function(){n(1)}),"Object",s)}},{"./_core":21,"./_export":28,"./_fails":29}],61:[function(e,t,n){var r=e("./_descriptors"),a=e("./_object-keys"),i=e("./_to-iobject"),s=e("./_object-pie").f;t.exports=function(e){return function(t){for(var n,o=i(t),u=a(o),c=u.length,l=0,h=[];c>l;){n=u[l++];r&&!s.call(o,n)||h.push(e?[n,o[n]]:o[n])}return h}}},{"./_descriptors":25,"./_object-keys":58,"./_object-pie":59,"./_to-iobject":76}],62:[function(e,t,n){t.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},{}],63:[function(e,t,n){var r=e("./_an-object"),a=e("./_is-object"),i=e("./_new-promise-capability");t.exports=function(e,t){r(e);if(a(t)&&t.constructor===e)return t;var n=i.f(e);(0,n.resolve)(t);return n.promise}},{"./_an-object":17,"./_is-object":40,"./_new-promise-capability":52}],64:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],65:[function(e,t,n){var r=e("./_hide");t.exports=function(e,t,n){for(var a in t)n&&e[a]?e[a]=t[a]:r(e,a,t[a]);return e}},{"./_hide":33}],66:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":33}],67:[function(e,t,n){"use strict";var r=e("./_global"),a=e("./_core"),i=e("./_object-dp"),s=e("./_descriptors"),o=e("./_wks")("species");t.exports=function(e){var t="function"==typeof a[e]?a[e]:r[e];s&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},{"./_core":21,"./_descriptors":25,"./_global":31,"./_object-dp":54,"./_wks":82}],68:[function(e,t,n){var r=e("./_object-dp").f,a=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},{"./_has":32,"./_object-dp":54,"./_wks":82}],69:[function(e,t,n){var r=e("./_shared")("keys"),a=e("./_uid");t.exports=function(e){return r[e]||(r[e]=a(e))}},{"./_shared":70,"./_uid":80}],70:[function(e,t,n){var r=e("./_core"),a=e("./_global"),i=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(t.exports=function(e,t){return i[e]||(i[e]=t!==undefined?t:{})})("versions",[]).push({version:r.version,mode:e("./_library")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},{"./_core":21,"./_global":31,"./_library":47}],71:[function(e,t,n){var r=e("./_an-object"),a=e("./_a-function"),i=e("./_wks")("species");t.exports=function(e,t){var n,s=r(e).constructor;return s===undefined||(n=r(s)[i])==undefined?t:a(n)}},{"./_a-function":14,"./_an-object":17,"./_wks":82}],72:[function(e,t,n){var r=e("./_to-integer"),a=e("./_defined");t.exports=function(e){return function(t,n){var i,s,o=String(a(t)),u=r(n),c=o.length;return u<0||u>=c?e?"":undefined:(i=o.charCodeAt(u))<55296||i>56319||u+1===c||(s=o.charCodeAt(u+1))<56320||s>57343?e?o.charAt(u):i:e?o.slice(u,u+2):s-56320+(i-55296<<10)+65536}}},{"./_defined":24,"./_to-integer":75}],73:[function(e,t,n){var r,a,i,s=e("./_ctx"),o=e("./_invoke"),u=e("./_html"),c=e("./_dom-create"),l=e("./_global"),h=l.process,f=l.setImmediate,d=l.clearImmediate,A=l.MessageChannel,_=l.Dispatch,p=0,g={},y=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e];t()}},v=function(e){y.call(e.data)};if(!f||!d){f=function setImmediate(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);g[++p]=function(){o("function"==typeof e?e:Function(e),t)};r(p);return p};d=function clearImmediate(e){delete g[e]};if("process"==e("./_cof")(h))r=function(e){h.nextTick(s(y,e,1))};else if(_&&_.now)r=function(e){_.now(s(y,e,1))};else if(A){i=(a=new A).port2;a.port1.onmessage=v;r=s(i.postMessage,i,1)}else if(l.addEventListener&&"function"==typeof postMessage&&!l.importScripts){r=function(e){l.postMessage(e+"","*")};l.addEventListener("message",v,!1)}else r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this);y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}}t.exports={set:f,clear:d}},{"./_cof":20,"./_ctx":23,"./_dom-create":26,"./_global":31,"./_html":34,"./_invoke":36}],74:[function(e,t,n){var r=e("./_to-integer"),a=Math.max,i=Math.min;t.exports=function(e,t){return(e=r(e))<0?a(e+t,0):i(e,t)}},{"./_to-integer":75}],75:[function(e,t,n){var r=Math.ceil,a=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?a:r)(e)}},{}],76:[function(e,t,n){var r=e("./_iobject"),a=e("./_defined");t.exports=function(e){return r(a(e))}},{"./_defined":24,"./_iobject":37}],77:[function(e,t,n){var r=e("./_to-integer"),a=Math.min;t.exports=function(e){return e>0?a(r(e),9007199254740991):0}},{"./_to-integer":75}],78:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":24}],79:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,a;if(t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;if("function"==typeof(n=e.valueOf)&&!r(a=n.call(e)))return a;if(!t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":40}],80:[function(e,t,n){var r=0,a=Math.random();t.exports=function(e){return"Symbol(".concat(e===undefined?"":e,")_",(++r+a).toString(36))}},{}],81:[function(e,t,n){var r=e("./_global").navigator;t.exports=r&&r.userAgent||""},{"./_global":31}],82:[function(e,t,n){var r=e("./_shared")("wks"),a=e("./_uid"),i=e("./_global").Symbol,s="function"==typeof i;(t.exports=function(e){return r[e]||(r[e]=s&&i[e]||(s?i:a)("Symbol."+e))}).store=r},{"./_global":31,"./_shared":70,"./_uid":80}],83:[function(e,t,n){var r=e("./_classof"),a=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(e!=undefined)return e[a]||e["@@iterator"]||i[r(e)]}},{"./_classof":19,"./_core":21,"./_iterators":46,"./_wks":82}],84:[function(e,t,n){var r=e("./_an-object"),a=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./_an-object":17,"./_core":21,"./core.get-iterator-method":83}],85:[function(e,t,n){"use strict";var r=e("./_ctx"),a=e("./_export"),i=e("./_to-object"),s=e("./_iter-call"),o=e("./_is-array-iter"),u=e("./_to-length"),c=e("./_create-property"),l=e("./core.get-iterator-method");a(a.S+a.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function from(e){var t,n,a,h,f=i(e),d="function"==typeof this?this:Array,A=arguments.length,_=A>1?arguments[1]:undefined,p=_!==undefined,g=0,y=l(f);p&&(_=r(_,A>2?arguments[2]:undefined,2));if(y==undefined||d==Array&&o(y))for(n=new d(t=u(f.length));t>g;g++)c(n,g,p?_(f[g],g):f[g]);else for(h=y.call(f),n=new d;!(a=h.next()).done;g++)c(n,g,p?s(h,_,[a.value,g],!0):a.value);n.length=g;return n}})},{"./_create-property":22,"./_ctx":23,"./_export":28,"./_is-array-iter":38,"./_iter-call":41,"./_iter-detect":44,"./_to-length":77,"./_to-object":78,"./core.get-iterator-method":83}],86:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),a=e("./_iter-step"),i=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e);this._i=0;this._k=t},function(){var e=this._t,t=this._k,n=this._i++;if(!e||n>=e.length){this._t=undefined;return a(1)}return a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values");i.Arguments=i.Array;r("keys");r("values");r("entries")},{"./_add-to-unscopables":15,"./_iter-define":43,"./_iter-step":45,"./_iterators":46,"./_to-iobject":76}],87:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{clz32:function clz32(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},{"./_export":28}],88:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{fround:e("./_math-fround")})},{"./_export":28,"./_math-fround":48}],89:[function(e,t,n){var r=e("./_export"),a=Math.imul;r(r.S+r.F*e("./_fails")(function(){return-5!=a(4294967295,5)||2!=a.length}),"Math",{imul:function imul(e,t){var n=+e,r=+t,a=65535&n,i=65535&r;return 0|a*i+((65535&n>>>16)*i+a*(65535&r>>>16)<<16>>>0)}})},{"./_export":28,"./_fails":29}],90:[function(e,t,n){var r=e("./_export");r(r.S,"Math",{trunc:function trunc(e){return(e>0?Math.floor:Math.ceil)(e)}})},{"./_export":28}],91:[function(e,t,n){var r=e("./_export");r(r.S,"Number",{isInteger:e("./_is-integer")})},{"./_export":28,"./_is-integer":39}],92:[function(e,t,n){var r=e("./_export");r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{"./_export":28}],93:[function(e,t,n){var r=e("./_is-object"),a=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(e){return function freeze(t){return e&&r(t)?e(a(t)):t}})},{"./_is-object":40,"./_meta":50,"./_object-sap":60}],94:[function(e,t,n){var r=e("./_to-object"),a=e("./_object-keys");e("./_object-sap")("keys",function(){return function keys(e){return a(r(e))}})},{"./_object-keys":58,"./_object-sap":60,"./_to-object":78}],95:[function(e,t,n){},{}],96:[function(e,t,n){"use strict";var r,a,i,s,o=e("./_library"),u=e("./_global"),c=e("./_ctx"),l=e("./_classof"),h=e("./_export"),f=e("./_is-object"),d=e("./_a-function"),A=e("./_an-instance"),_=e("./_for-of"),p=e("./_species-constructor"),g=e("./_task").set,y=e("./_microtask")(),v=e("./_new-promise-capability"),k=e("./_perform"),m=e("./_user-agent"),b=e("./_promise-resolve"),w=u.TypeError,C=u.process,S=C&&C.versions,T=S&&S.v8||"",E=u.Promise,x="process"==l(C),I=function(){},B=a=v.f,P=!!function(){try{var t=E.resolve(1),n=(t.constructor={})[e("./_wks")("species")]=function(e){e(I,I)};return(x||"function"==typeof PromiseRejectionEvent)&&t.then(I)instanceof n&&0!==T.indexOf("6.6")&&-1===m.indexOf("Chrome/66")}catch(r){}}(),N=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var n=e._c;y(function(){for(var r=e._v,a=1==e._s,i=0,s=function(t){var n,i,s,o=a?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{if(o){if(!a){2==e._h&&L(e);e._h=1}if(!0===o)n=r;else{l&&l.enter();n=o(r);if(l){l.exit();s=!0}}n===t.promise?c(w("Promise-chain cycle")):(i=N(n))?i.call(n,u,c):u(n)}else c(r)}catch(h){l&&!s&&l.exit();c(h)}};n.length>i;)s(n[i++]);e._c=[];e._n=!1;t&&!e._h&&R(e)})}},R=function(e){g.call(u,function(){var t,n,r,a=e._v,i=M(e);if(i){t=k(function(){x?C.emit("unhandledRejection",a,e):(n=u.onunhandledrejection)?n({promise:e,reason:a}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",a)});e._h=x||M(e)?2:1}e._a=undefined;if(i&&t.e)throw t.v})},M=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){g.call(u,function(){var t;x?C.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},D=function(e){var t=this;if(!t._d){t._d=!0;(t=t._w||t)._v=e;t._s=2;t._a||(t._a=t._c.slice());O(t,!0)}},U=function(e){var t,n=this;if(!n._d){n._d=!0;n=n._w||n;try{if(n===e)throw w("Promise can't be resolved itself");if(t=N(e))y(function(){var r={_w:n,_d:!1};try{t.call(e,c(U,r,1),c(D,r,1))}catch(a){D.call(r,a)}});else{n._v=e;n._s=1;O(n,!1)}}catch(r){D.call({_w:n,_d:!1},r)}}};if(!P){E=function Promise(e){A(this,E,"Promise","_h");d(e);r.call(this);try{e(c(U,this,1),c(D,this,1))}catch(t){D.call(this,t)}};(r=function Promise(e){this._c=[];this._a=undefined;this._s=0;this._d=!1;this._v=undefined;this._h=0;this._n=!1}).prototype=e("./_redefine-all")(E.prototype,{then:function then(e,t){var n=B(p(this,E));n.ok="function"!=typeof e||e;n.fail="function"==typeof t&&t;n.domain=x?C.domain:undefined;this._c.push(n);this._a&&this._a.push(n);this._s&&O(this,!1);return n.promise},"catch":function(e){return this.then(undefined,e)}});i=function(){var e=new r;this.promise=e;this.resolve=c(U,e,1);this.reject=c(D,e,1)};v.f=B=function(e){return e===E||e===s?new i(e):a(e)}}h(h.G+h.W+h.F*!P,{Promise:E});e("./_set-to-string-tag")(E,"Promise");e("./_set-species")("Promise");s=e("./_core").Promise;h(h.S+h.F*!P,"Promise",{reject:function reject(e){var t=B(this);(0,t.reject)(e);return t.promise}});h(h.S+h.F*(o||!P),"Promise",{resolve:function resolve(e){return b(o&&this===s?E:this,e)}});h(h.S+h.F*!(P&&e("./_iter-detect")(function(e){E.all(e)["catch"](I)})),"Promise",{all:function all(e){var t=this,n=B(t),r=n.resolve,a=n.reject,i=k(function(){var n=[],i=0,s=1;_(e,!1,function(e){var o=i++,u=!1;n.push(undefined);s++;t.resolve(e).then(function(e){if(!u){u=!0;n[o]=e;--s||r(n)}},a)});--s||r(n)});i.e&&a(i.v);return n.promise},race:function race(e){var t=this,n=B(t),r=n.reject,a=k(function(){_(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});a.e&&r(a.v);return n.promise}})},{"./_a-function":14,"./_an-instance":16,"./_classof":19,"./_core":21,"./_ctx":23,"./_export":28,"./_for-of":30,"./_global":31,"./_is-object":40,"./_iter-detect":44,"./_library":47,"./_microtask":51,"./_new-promise-capability":52,"./_perform":62,"./_promise-resolve":63,"./_redefine-all":65,"./_set-species":67,"./_set-to-string-tag":68,"./_species-constructor":71,"./_task":73,"./_user-agent":81,"./_wks":82}],97:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e);this._i=0},function(){var e,t=this._t,n=this._i;if(n>=t.length)return{value:undefined,done:!0};e=r(t,n);this._i+=e.length;return{value:e,done:!1}})},{"./_iter-define":43,"./_string-at":72}],98:[function(e,t,n){var r=e("./_export"),a=e("./_object-to-array")(!1);r(r.S,"Object",{values:function values(e){return a(e)}})},{"./_export":28,"./_object-to-array":61}],99:[function(e,t,n){"use strict";var r=e("./_export"),a=e("./_core"),i=e("./_global"),s=e("./_species-constructor"),o=e("./_promise-resolve");r(r.P+r.R,"Promise",{"finally":function(e){var t=s(this,a.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return o(t,e()).then(function(){return n})}:e,n?function(n){return o(t,e()).then(function(){throw n})}:e)}})},{"./_core":21,"./_export":28,"./_global":31,"./_promise-resolve":63,"./_species-constructor":71}],100:[function(e,t,n){"use strict";var r=e("./_export"),a=e("./_new-promise-capability"),i=e("./_perform");r(r.S,"Promise",{"try":function(e){var t=a.f(this),n=i(e);(n.e?t.reject:t.resolve)(n.v);return t.promise}})},{"./_export":28,"./_new-promise-capability":52,"./_perform":62}],101:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),a=e("./_hide"),i=e("./_iterators"),s=e("./_wks")("toStringTag"),o="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<o.length;u++){var c=o[u],l=r[c],h=l&&l.prototype;h&&!h[s]&&a(h,s,c);i[c]=i.Array}},{"./_global":31,"./_hide":33,"./_iterators":46,"./_wks":82,"./es6.array.iterator":86}],102:[function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function wrap(e,t,n,r){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),s=new Context(r||[]);i._invoke=function makeInvokeMethod(e,t,n){var r=u;return function invoke(a,i){if(r===l)throw new Error("Generator is already running");if(r===h){if("throw"===a)throw i;return doneResult()}n.method=a;n.arg=i;for(;;){var s=n.delegate;if(s){var o=maybeInvokeDelegate(s,n);if(o){if(o===f)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===u){r=h;throw n.arg}n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=l;var d=tryCatch(e,t,n);if("normal"===d.type){r=n.done?h:c;if(d.arg===f)continue;return{value:d.arg,done:n.done}}if("throw"===d.type){r=h;n.method="throw";n.arg=d.arg}}}}(e,n,s);return i}e.wrap=wrap;function tryCatch(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}var u="suspendedStart",c="suspendedYield",l="executing",h="completed",f={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};d[i]=function(){return this};var A=Object.getPrototypeOf,_=A&&A(A(values([])));_&&_!==n&&r.call(_,i)&&(d=_);var p=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);GeneratorFunction.prototype=p.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunctionPrototype[o]=GeneratorFunction.displayName="GeneratorFunction";function defineIteratorMethods(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))};e.mark=function(e){if(Object.setPrototypeOf)Object.setPrototypeOf(e,GeneratorFunctionPrototype);else{e.__proto__=GeneratorFunctionPrototype;o in e||(e[o]="GeneratorFunction")}e.prototype=Object.create(p);return e};e.awrap=function(e){return{__await:e}};function AsyncIterator(e,t){var n;this._invoke=function enqueue(a,i){function callInvokeWithMethodAndArg(){return new t(function(n,s){!function invoke(n,a,i,s){var o=tryCatch(e[n],e,a);if("throw"!==o.type){var u=o.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then(function(e){invoke("next",e,i,s)},function(e){invoke("throw",e,i,s)}):t.resolve(c).then(function(e){u.value=e;i(u)},function(e){return invoke("throw",e,i,s)})}s(o.arg)}(a,i,n,s)})}return n=n?n.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[s]=function(){return this};e.AsyncIterator=AsyncIterator;e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var s=new AsyncIterator(wrap(t,n,r,a),i);return e.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})};function maybeInvokeDelegate(e,n){var r=e.iterator[n.method];if(r===t){n.delegate=null;if("throw"===n.method){if(e.iterator["return"]){n.method="return";n.arg=t;maybeInvokeDelegate(e,n);if("throw"===n.method)return f}n.method="throw";n.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var a=tryCatch(r,e.iterator,n.arg);if("throw"===a.type){n.method="throw";n.arg=a.arg;n.delegate=null;return f}var i=a.arg;if(!i){n.method="throw";n.arg=new TypeError("iterator result is not an object");n.delegate=null;return f}if(!i.done)return i;n[e.resultName]=i.value;n.next=e.nextLoc;if("return"!==n.method){n.method="next";n.arg=t}n.delegate=null;return f}defineIteratorMethods(p);p[o]="Generator";p[i]=function(){return this};p.toString=function(){return"[object Generator]"};function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]);if(2 in e){t.finallyLoc=e[2];t.afterLoc=e[3]}this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal";delete t.arg;e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(pushTryEntry,this);this.reset(!0)}e.keys=function(e){var t=[];for(var n in e)t.push(n);t.reverse();return function next(){for(;t.length;){var n=t.pop();if(n in e){next.value=n;next.done=!1;return next}}next.done=!0;return next}};function values(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,s=function next(){for(;++a<e.length;)if(r.call(e,a)){next.value=e[a];next.done=!1;return next}next.value=t;next.done=!0;return next};return s.next=s}}return{next:doneResult}}e.values=values;function doneResult(){return{value:t,done:!0}}Context.prototype={constructor:Context,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=t;this.done=!1;this.delegate=null;this.method="next";this.arg=t;this.tryEntries.forEach(resetTryEntry);if(!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function handle(r,a){s.type="throw";s.arg=e;n.next=r;if(a){n.method="next";n.arg=t}return!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var o=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(o&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};s.type=e;s.arg=t;if(i){this.method="next";this.next=i.finallyLoc;return f}return this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;if("break"===e.type||"continue"===e.type)this.next=e.arg;else if("return"===e.type){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else"normal"===e.type&&t&&(this.next=t);return f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e){this.complete(n.completion,n.afterLoc);resetTryEntry(n);return f}}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;resetTryEntry(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){this.delegate={iterator:values(e),resultName:n,nextLoc:r};"next"===this.method&&(this.arg=t);return f}};return e}("object"==typeof t?t.exports:{});try{regeneratorRuntime=r}catch(a){Function("r","regeneratorRuntime = r")(r)}},{}],"@babel/runtime-corejs2/core-js/array/from":[function(e,t,n){t.exports=e("core-js/library/fn/array/from")},{"core-js/library/fn/array/from":1}],"@babel/runtime-corejs2/core-js/get-iterator":[function(e,t,n){t.exports=e("core-js/library/fn/get-iterator")},{"core-js/library/fn/get-iterator":2}],"@babel/runtime-corejs2/core-js/json/stringify":[function(e,t,n){t.exports=e("core-js/library/fn/json/stringify")},{"core-js/library/fn/json/stringify":3}],"@babel/runtime-corejs2/core-js/math/clz32":[function(e,t,n){t.exports=e("core-js/library/fn/math/clz32")},{"core-js/library/fn/math/clz32":4}],"@babel/runtime-corejs2/core-js/math/fround":[function(e,t,n){t.exports=e("core-js/library/fn/math/fround")},{"core-js/library/fn/math/fround":5}],"@babel/runtime-corejs2/core-js/math/imul":[function(e,t,n){t.exports=e("core-js/library/fn/math/imul")},{"core-js/library/fn/math/imul":6}],"@babel/runtime-corejs2/core-js/math/trunc":[function(e,t,n){t.exports=e("core-js/library/fn/math/trunc")},{"core-js/library/fn/math/trunc":7}],"@babel/runtime-corejs2/core-js/number/is-integer":[function(e,t,n){t.exports=e("core-js/library/fn/number/is-integer")},{"core-js/library/fn/number/is-integer":8}],"@babel/runtime-corejs2/core-js/number/max-safe-integer":[function(e,t,n){t.exports=e("core-js/library/fn/number/max-safe-integer")},{"core-js/library/fn/number/max-safe-integer":9}],"@babel/runtime-corejs2/core-js/object/freeze":[function(e,t,n){t.exports=e("core-js/library/fn/object/freeze")},{"core-js/library/fn/object/freeze":10}],"@babel/runtime-corejs2/core-js/object/keys":[function(e,t,n){t.exports=e("core-js/library/fn/object/keys")},{"core-js/library/fn/object/keys":11}],"@babel/runtime-corejs2/core-js/object/values":[function(e,t,n){t.exports=e("core-js/library/fn/object/values")},{"core-js/library/fn/object/values":12}],"@babel/runtime-corejs2/core-js/promise":[function(e,t,n){t.exports=e("core-js/library/fn/promise")},{"core-js/library/fn/promise":13}],"@babel/runtime-corejs2/helpers/asyncToGenerator":[function(e,t,n){var r=e("../core-js/promise");function asyncGeneratorStep(e,t,n,a,i,s,o){try{var u=e[s](o),c=u.value}catch(l){n(l);return}u.done?t(c):r.resolve(c).then(a,i)}t.exports=function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new r(function(r,a){var i=e.apply(t,n);function _next(e){asyncGeneratorStep(i,r,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,r,a,_next,_throw,"throw",e)}_next(undefined)})}}},{"../core-js/promise":"@babel/runtime-corejs2/core-js/promise"}],"@babel/runtime-corejs2/regenerator":[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":102}]},{},[]);var Proxy,_interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault"),_construct2=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/reflect/construct")),_set4=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/set")),_isFinite=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/number/is-finite")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/toConsumableArray")),_is=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/object/is")),_freeze=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/object/freeze")),_maxSafeInteger=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/number/max-safe-integer")),_getOwnPropertyNames=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/object/get-own-property-names")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/assertThisInitialized")),_wrapNativeSuper2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/wrapNativeSuper")),_defineProperty2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/defineProperty")),_create=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/object/create")),_keys6=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/object/keys")),_parseInt2=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/parse-int")),_now=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/date/now")),_isInteger=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/number/is-integer")),_get10=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/get")),_iterator276=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/symbol/iterator")),_from=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/array/from")),_inherits2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/getPrototypeOf")),_defineProperty3=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/object/define-property")),_construct3=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/construct")),_set5=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/set")),_regenerator=_interopRequireDefault(require("@babel/runtime-corejs2/regenerator")),_promise=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/promise")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/asyncToGenerator")),_isArray=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/array/is-array")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/slicedToArray")),_getIterator2=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/get-iterator")),_map2=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/map")),_stringify=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/json/stringify")),_typeof2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/typeof")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/createClass"));function _createSuper(e){return function(){var t,n=(0,_getPrototypeOf2["default"])(e);if(function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!_construct2["default"])return!1;if(_construct2["default"].sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call((0,_construct2["default"])(Date,[],function(){}));return!0}catch(e){return!1}}()){var r=(0,_getPrototypeOf2["default"])(this).constructor;t=(0,_construct2["default"])(n,arguments,r)}else t=n.apply(this,arguments);return(0,_possibleConstructorReturn2["default"])(this,t)}}if("undefined"==typeof JDB)var JDB={};!function(e){e="undefined"!=typeof e?e:{};var t=function(){function Class(){(0,_classCallCheck2["default"])(this,Class)}(0,_createClass2["default"])(Class,null,[{key:"register",value:function register(t){"undefined"!=typeof e&&(e[t.name]=t)}}]);return Class}();t.register(t);var n=function(){function LogNative(){(0,_classCallCheck2["default"])(this,LogNative);this._global_level=y.TRACE;this._tag_levels={};try{if(window.localStorage)try{var e=window.localStorage.getItem("log_tag_levels");e&&"string"==typeof e&&(e=JSON.parse(e));e&&"object"===(0,_typeof2["default"])(e)&&(this._tag_levels=e)}catch(t){console.warn("Failed to load log configuration from local storage.")}}catch(t){}}(0,_createClass2["default"])(LogNative,[{key:"isLoggable",value:function isLoggable(e,t){return e&&this._tag_levels[e]?this._tag_levels[e]<=t:this._tag_levels["*"]?this._tag_levels["*"]<=t:this._global_level<=t}},{key:"setLoggable",value:function setLoggable(e,t){e&&e.name&&(e=e.name);this._tag_levels[e]=t;window.localStorage&&window.localStorage.setItem("log_tag_levels",(0,_stringify["default"])(this._tag_levels))}},{key:"msg",value:function msg(e,t,n){t&&t.name&&(t=t.name);if(this.isLoggable(t,e)){t&&n.unshift(t+":");n.unshift("[".concat(y.Level.toStringTag(e)," ").concat((new Date).toTimeString().substr(0,8),"]"));console.error&&e>=y.ERROR?console.error.apply(console,n):console.warn&&e>=y.WARNING?console.warn.apply(console,n):console.info&&e>=y.INFO?console.info.apply(console,n):console.debug&&e>=y.DEBUG?console.debug.apply(console,n):console.trace&&e<=y.TRACE?console.trace.apply(console,n):console.log.apply(console,n)}}}]);return LogNative}();t.register(n);var r=function(){function IDBTools(){(0,_classCallCheck2["default"])(this,IDBTools)}(0,_createClass2["default"])(IDBTools,null,[{key:"convertKeyRange",value:function convertKeyRange(e){return e instanceof B?e.exactMatch?IDBKeyRange.only(e.lower):e.lower!==undefined&&e.upper===undefined?IDBKeyRange.lowerBound(e.lower,e.lowerOpen):e.upper!==undefined&&e.lower===undefined?IDBKeyRange.upperBound(e.upper,e.upperOpen):IDBKeyRange.bound(e.lower,e.upper,e.lowerOpen,e.upperOpen):e}}]);return IDBTools}();t.register(r);var a=function(){function IDBBackend(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;(0,_classCallCheck2["default"])(this,IDBBackend);this._db=e;this._tableName=t;this._indices=new _map2["default"];this._indicesToCreate=new _map2["default"];this._indicesToDelete=[];this._codec=n}(0,_createClass2["default"])(IDBBackend,[{key:"init",value:function init(e,t,n){var r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(this._indicesToDelete);!(r=(s=o.next()).done);r=!0){var u=s.value,c=u.indexName,l=u.upgradeCondition;e.indexNames.contains(c)&&(null===l||!0===l||"function"==typeof l&&l(t,n))&&e.deleteIndex(c)}}catch(b){a=!0;i=b}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}this._indicesToDelete=[];var h=!0,f=!1,d=undefined;try{for(var A,_=(0,_getIterator2["default"])(this._indicesToCreate);!(h=(A=_.next()).done);h=!0){var p=(0,_slicedToArray2["default"])(A.value,2),g=p[0],y=p[1],v=y.index,k=y.upgradeCondition;if(!e.indexNames.contains(g)&&(null===k||!0===k||"function"==typeof k&&k(t,n))){var m=(0,_isArray["default"])(v.keyPath)?v.keyPath.join("."):v.keyPath;e.createIndex(g,m,{unique:v.unique,multiEntry:v.multiEntry})}}}catch(b){f=!0;d=b}finally{try{h||null==_["return"]||_["return"]()}finally{if(f)throw d}}this._indicesToCreate.clear()}},{key:"decode",value:function decode(e,t){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.decode(e,t):e}},{key:"encode",value:function encode(e){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.encode(e):e}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(e){var t,n,r=this,a=arguments;return _regenerator["default"].wrap(function _callee$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined?a[1]:{};n=this._backend;return i.abrupt("return",new _promise["default"](function(a,i){var s=n.transaction([r._tableName]).objectStore(r._tableName).get(e);s.onsuccess=function(n){try{a(t&&t.raw?n.target.result:r.decode(n.target.result,e))}catch(s){i(s)}};s.onerror=i}));case 3:case"end":return i.stop()}},_callee,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(){var e,t,n,a=this,i=arguments;return _regenerator["default"].wrap(function _callee2$(s){for(;;)switch(s.prev=s.next){case 0:e=i.length>0&&i[0]!==undefined?i[0]:null;t=i.length>1&&i[1]!==undefined?i[1]:null;if(!(null!==e&&e instanceof O)){s.next=4;break}return s.abrupt("return",e.values(this,t));case 4:e=r.convertKeyRange(e);n=this._backend;return s.abrupt("return",new _promise["default"](function(r,i){var s=[],o=n.transaction([a._tableName],"readonly").objectStore(a._tableName).openCursor(e);o.onsuccess=function(e){var n=e.target.result;if(n){if(null!==t&&s.length>=t){r(s);return}try{s.push(a.decode(n.value,n.primaryKey))}catch(o){i(o)}n["continue"]()}else r(s)};o.onerror=function(){return i(o.error)}}));case 7:case"end":return s.stop()}},_callee2,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(){var e,t,n,a=this,i=arguments;return _regenerator["default"].wrap(function _callee3$(s){for(;;)switch(s.prev=s.next){case 0:e=i.length>0&&i[0]!==undefined?i[0]:null;t=i.length>1&&i[1]!==undefined?i[1]:null;if(!(null!==e&&e instanceof O)){s.next=4;break}return s.abrupt("return",e.keys(this,t));case 4:e=r.convertKeyRange(e);n=this._backend;return s.abrupt("return",new _promise["default"](function(r,i){var s=new _set5["default"],o=n.transaction([a._tableName],"readonly").objectStore(a._tableName),u=o.openKeyCursor?o.openKeyCursor(e):o.openCursor(e);u.onsuccess=function(e){var n=e.target.result;if(n){if(null!==t&&s.size>=t){r(s);return}s.add(n.primaryKey);n["continue"]()}else r(s)};u.onerror=function(){return i(u.error)}}));case 7:case"end":return s.stop()}},_callee3,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"keyStream",value:function keyStream(e){var t=this,n=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;a=r.convertKeyRange(a);var i=this._backend;return new _promise["default"](function(r,s){var o=i.transaction([t._tableName],"readonly").objectStore(t._tableName),u=o.openKeyCursor?o.openKeyCursor(a,n?"next":"prev"):o.openCursor(a,n?"next":"prev");u.onsuccess=function(t){var n=t.target.result;if(n)try{e(n.primaryKey)?n["continue"]():r()}catch(a){s(a)}else r()};u.onerror=function(){return s(u.error)}})}},{key:"valueStream",value:function valueStream(e){var t=this,n=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;a=r.convertKeyRange(a);var i=this._backend;return new _promise["default"](function(r,s){var o=i.transaction([t._tableName],"readonly").objectStore(t._tableName).openCursor(a,n?"next":"prev");o.onsuccess=function(n){var a=n.target.result;if(a)try{e(t.decode(a.value,a.primaryKey),a.primaryKey)?a["continue"]():r()}catch(i){s(i)}else r()};o.onerror=function(){return s(o.error)}})}},{key:"maxValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new _promise["default"](function(r,a){var i=t.transaction([n._tableName],"readonly").objectStore(n._tableName).openCursor(e,"prev");i.onsuccess=function(e){try{var t=e.target.result;r(t?n.decode(t.value,t.primaryKey):undefined)}catch(i){a(i)}};i.onerror=function(){return a(i.error)}}));case 4:case"end":return i.stop()}},_callee4,this)}));return function maxValue(){return e.apply(this,arguments)}}()},{key:"maxKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee5(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new _promise["default"](function(r,a){var i=t.transaction([n._tableName],"readonly").objectStore(n._tableName),s=i.openKeyCursor?i.openKeyCursor(e,"prev"):i.openCursor(e,"prev");s.onsuccess=function(){return r(s.result?s.result.primaryKey:undefined)};s.onerror=function(){return a(s.error)}}));case 4:case"end":return i.stop()}},_callee5,this)}));return function maxKey(){return e.apply(this,arguments)}}()},{key:"minValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee6(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new _promise["default"](function(r,a){var i=t.transaction([n._tableName],"readonly").objectStore(n._tableName).openCursor(e,"next");i.onsuccess=function(e){try{var t=e.target.result;r(t?n.decode(t.value,t.primaryKey):undefined)}catch(i){a(i)}};i.onerror=function(){return a(i.error)}}));case 4:case"end":return i.stop()}},_callee6,this)}));return function minValue(){return e.apply(this,arguments)}}()},{key:"minKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee7(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee7$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new _promise["default"](function(r,a){var i=t.transaction([n._tableName],"readonly").objectStore(n._tableName),s=i.openKeyCursor?i.openKeyCursor(e,"next"):i.openCursor(e,"next");s.onsuccess=function(){return r(s.result?s.result.primaryKey:undefined)};s.onerror=function(){return a(s.error)}}));case 4:case"end":return i.stop()}},_callee7,this)}));return function minKey(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee8(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee8$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);t=this._backend;return i.abrupt("return",new _promise["default"](function(r,a){var i;(i=e?t.transaction([n._tableName],"readonly").objectStore(n._tableName).count(e):t.transaction([n._tableName],"readonly").objectStore(n._tableName).count()).onsuccess=function(){return r(i.result)};i.onerror=function(){return a(i.error)}}));case 4:case"end":return i.stop()}},_callee8,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){return this._indices.get(e)}},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee9(e){var t,n=this;return _regenerator["default"].wrap(function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:t=this._backend;return r.abrupt("return",new _promise["default"](function(r,a){var i=t.transaction([n._tableName],"readwrite"),s=i.objectStore(n._tableName);e._truncated&&s.clear();var o=!0,u=!1,c=undefined;try{for(var l,h=(0,_getIterator2["default"])(e._removed);!(o=(l=h.next()).done);o=!0){var f=l.value;s["delete"](f)}}catch(m){u=!0;c=m}finally{try{o||null==h["return"]||h["return"]()}finally{if(u)throw c}}var d=!0,A=!1,_=undefined;try{for(var p,g=(0,_getIterator2["default"])(e._modified);!(d=(p=g.next()).done);d=!0){var y=(0,_slicedToArray2["default"])(p.value,2),v=y[0],k=y[1];s.put(n.encode(k),v)}}catch(m){A=!0;_=m}finally{try{d||null==g["return"]||g["return"]()}finally{if(A)throw _}}i.oncomplete=function(){return r(!0)};i.onerror=a;i.onabort=a}));case 2:case"end":return r.stop()}},_callee9,this)}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee10(){var e,t=this;return _regenerator["default"].wrap(function _callee10$(n){for(;;)switch(n.prev=n.next){case 0:e=this._backend;return n.abrupt("return",new _promise["default"](function(n,r){var a=e.transaction([t._tableName],"readonly").objectStore(t._tableName).clear();a.onsuccess=n;a.onerror=function(){return r(a.error)}}));case 2:case"end":return n.stop()}},_callee10,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"createIndex",value:function createIndex(e,t){var n=(arguments.length>2&&arguments[2]!==undefined?arguments[2]:{})||{},r=n.multiEntry,a=void 0!==r&&r,i=n.upgradeCondition,o=void 0===i?null:i,u=n.unique,c=void 0!==u&&u;if(this._db.connected)throw new Error("Cannot create index while connected");var l=new s(this,e,t=t||e,a,c);this._indices.set(e,l);this._indicesToCreate.set(e,{index:l,upgradeCondition:o})}},{key:"deleteIndex",value:function deleteIndex(e){var t=((arguments.length>1&&arguments[1]!==undefined?arguments[1]:{})||{}).upgradeCondition,n=void 0===t?null:t;if(this._db.connected)throw new Error("Cannot delete index while connected");this._indicesToDelete.push({indexName:e,upgradeCondition:n})}},{key:"close",value:function close(){return this._db.close()}},{key:"applyCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee11(e){var t,n,r,a,i,s,o,u,c,l,h,f,d,A,_;return _regenerator["default"].wrap(function _callee11$(p){for(;;)switch(p.prev=p.next){case 0:t=new S(this._tableName);e._truncated&&t.truncate();n=!0;r=!1;a=undefined;p.prev=5;for(i=(0,_getIterator2["default"])(e._removed);!(n=(s=i.next()).done);n=!0){o=s.value;t.remove(o)}p.next=13;break;case 9:p.prev=9;p.t0=p["catch"](5);r=!0;a=p.t0;case 13:p.prev=13;p.prev=14;n||null==i["return"]||i["return"]();case 16:p.prev=16;if(!r){p.next=19;break}throw a;case 19:return p.finish(16);case 20:return p.finish(13);case 21:u=!0;c=!1;l=undefined;p.prev=24;for(h=(0,_getIterator2["default"])(e._modified);!(u=(f=h.next()).done);u=!0){d=(0,_slicedToArray2["default"])(f.value,2),A=d[0],_=d[1];t.put(A,this.encode(_))}p.next=32;break;case 28:p.prev=28;p.t1=p["catch"](24);c=!0;l=p.t1;case 32:p.prev=32;p.prev=33;u||null==h["return"]||h["return"]();case 35:p.prev=35;if(!c){p.next=38;break}throw l;case 38:return p.finish(35);case 39:return p.finish(32);case 40:return p.abrupt("return",t);case 41:case"end":return p.stop()}},_callee11,this,[[5,9,13,21],[14,,16,20],[24,28,32,40],[33,,35,39]])}));return function applyCombined(t){return e.apply(this,arguments)}}()},{key:"isSynchronous",value:function isSynchronous(){return!1}},{key:"connected",get:function get(){return this._db.connected}},{key:"_backend",get:function get(){if(!this.connected)throw new Error("Requires a connected database");return this._db.backend}},{key:"indices",get:function get(){return this._indices}},{key:"backend",get:function get(){return this._db.backend}},{key:"tableName",get:function get(){return this._tableName}}]);return IDBBackend}();t.register(a);var i=function(){function JungleDB(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};(0,_classCallCheck2["default"])(this,JungleDB);if(t<=0)throw new Error("The version provided must not be less or equal to 0");this._databaseDir=e;this._dbVersion=t;this._oldDbVersion=null;this._onUpgradeNeeded=n.onUpgradeNeeded;this._connected=!1;this._objectStores=new _map2["default"];this._objectStoreBackends=new _map2["default"];this._objectStoresToDelete=[]}(0,_createClass2["default"])(JungleDB,[{key:"connect",value:function connect(){if(this._db)return _promise["default"].resolve(this._db);var e=this._indexedDB.open(this._databaseDir,this._dbVersion),t=this;return new _promise["default"](function(n,r){e.onsuccess=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee12(){return _regenerator["default"].wrap(function _callee12$(r){for(;;)switch(r.prev=r.next){case 0:t._connected=!0;t._db=e.result;if(null===t._oldDbVersion||!t._onUpgradeNeeded){r.next=5;break}r.next=5;return t._onUpgradeNeeded(t._oldDbVersion,t._dbVersion,t);case 5:n(e.result);case 6:case"end":return r.stop()}},_callee12)}));e.onerror=r;e.onupgradeneeded=function(n){return t._initDB(n,e)}})}},{key:"_initDB",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee13(e,t){var n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m;return _regenerator["default"].wrap(function _callee13$(b){for(;;)switch(b.prev=b.next){case 0:n=e.target.result;r=!0;a=!1;i=undefined;b.prev=4;for(s=(0,_getIterator2["default"])(this._objectStoresToDelete);!(r=(o=s.next()).done);r=!0){u=o.value,c=u.tableName,l=u.upgradeCondition;n.objectStoreNames.contains(c)&&(null===l||!0===l||"function"==typeof l&&l(e.oldVersion,e.newVersion))&&n.deleteObjectStore(c)}b.next=12;break;case 8:b.prev=8;b.t0=b["catch"](4);a=!0;i=b.t0;case 12:b.prev=12;b.prev=13;r||null==s["return"]||s["return"]();case 15:b.prev=15;if(!a){b.next=18;break}throw i;case 18:return b.finish(15);case 19:return b.finish(12);case 20:this._objectStoresToDelete=[];h=!0;f=!1;d=undefined;b.prev=24;for(A=(0,_getIterator2["default"])(this._objectStoreBackends);!(h=(_=A.next()).done);h=!0){p=(0,_slicedToArray2["default"])(_.value,2),g=p[0],y=p[1],v=y.backend,k=y.upgradeCondition;m=void 0;m=!n.objectStoreNames.contains(g)&&(null===k||!0===k||"function"==typeof k&&k(e.oldVersion,e.newVersion))?n.createObjectStore(g):t.transaction.objectStore(g);v.init(m,e.oldVersion,e.newVersion)}b.next=32;break;case 28:b.prev=28;b.t1=b["catch"](24);f=!0;d=b.t1;case 32:b.prev=32;b.prev=33;h||null==A["return"]||A["return"]();case 35:b.prev=35;if(!f){b.next=38;break}throw d;case 38:return b.finish(35);case 39:return b.finish(32);case 40:this._oldDbVersion=e.oldVersion;this._objectStoreBackends.clear();case 42:case"end":return b.stop()}},_callee13,this,[[4,8,12,20],[13,,15,19],[24,28,32,40],[33,,35,39]])}));return function _initDB(t,n){return e.apply(this,arguments)}}()},{key:"getObjectStore",value:function getObjectStore(e){return this._objectStores.get(e)}},{key:"createObjectStore",value:function createObjectStore(e){var t=(arguments.length>1&&arguments[1]!==undefined?arguments[1]:{})||{},n=t.codec,r=void 0===n?null:n,i=t.persistent,s=void 0===i||i,o=t.upgradeCondition,u=void 0===o?null:o,c=t.enableLruCache,l=void 0===c||c,h=t.lruCacheSize,f=void 0===h?E.MAX_CACHE_SIZE:h,d=t.rawLruCacheSize,A=void 0===d?0:d;if(this._connected)throw new Error("Cannot create ObjectStore while connected");if(this._objectStores.has(e))return this._objectStores.get(e);var _=null,p=_=s?new a(this,e,r):new I(e,r);s&&l&&(p=new E(_,f,A));var g=new P(p,this,e);this._objectStores.set(e,g);this._objectStoreBackends.set(e,{backend:_,upgradeCondition:u});return g}},{key:"deleteObjectStore",value:function deleteObjectStore(e){var t=((arguments.length>1&&arguments[1]!==undefined?arguments[1]:{})||{}).upgradeCondition,n=void 0===t?null:t;if(this._connected)throw new Error("Cannot delete ObjectStore while connected");this._objectStoresToDelete.push({tableName:e,upgradeCondition:n})}},{key:"close",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee14(){return _regenerator["default"].wrap(function _callee14$(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){this._connected=!1;this.backend.close()}case 1:case"end":return e.stop()}},_callee14,this)}));return function close(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee15(){var e=this;return _regenerator["default"].wrap(function _callee15$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this.close();case 2:return t.abrupt("return",new _promise["default"](function(t,n){var r=e._indexedDB.deleteDatabase(e._databaseDir);r.onsuccess=t;r.onerror=n}));case 3:case"end":return t.stop()}},_callee15,this)}));return function destroy(){return e.apply(this,arguments)}}()},{key:"toString",value:function toString(){return"JungleDB{name=".concat(this._databaseDir,"}")}},{key:"_indexedDB",get:function get(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB}},{key:"backend",get:function get(){return this._db}},{key:"connected",get:function get(){return this._connected}}],[{key:"createVolatileObjectStore",value:function createVolatileObjectStore(){var e=((arguments.length>0&&arguments[0]!==undefined?arguments[0]:{})||{}).codec;return new P(new I("",void 0===e?null:e),null)}},{key:"commitCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee16(e,t){var n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,b,w,C=arguments;return _regenerator["default"].wrap(function _callee16$(S){for(;;)switch(S.prev=S.next){case 0:if(!(e instanceof z)){S.next=54;break}n=[];r=[];a=[];S.next=6;return _promise["default"].all(e.transactions.map(function(e){return e.objectStore._backend.applyCombined(e)}));case 6:i=S.sent;s=!0;o=!1;u=undefined;S.prev=10;c=(0,_getIterator2["default"])(i);case 12:if(s=(l=c.next()).done){S.next=38;break}h=l.value;f=h;(0,_isArray["default"])(h)||(f=[h]);d=!0;A=!1;_=undefined;S.prev=19;for(p=(0,_getIterator2["default"])(f);!(d=(g=p.next()).done);d=!0)if("function"==typeof(y=g.value))n.push(y);else{r.push(y);a.push(y.tableName)}S.next=27;break;case 23:S.prev=23;S.t0=S["catch"](19);A=!0;_=S.t0;case 27:S.prev=27;S.prev=28;d||null==p["return"]||p["return"]();case 30:S.prev=30;if(!A){S.next=33;break}throw _;case 33:return S.finish(30);case 34:return S.finish(27);case 35:s=!0;S.next=12;break;case 38:S.next=44;break;case 40:S.prev=40;S.t1=S["catch"](10);o=!0;u=S.t1;case 44:S.prev=44;S.prev=45;s||null==c["return"]||c["return"]();case 47:S.prev=47;if(!o){S.next=50;break}throw u;case 50:return S.finish(47);case 51:return S.finish(44);case 52:v=null!==e.backend?e.backend.backend:null;return S.abrupt("return",new _promise["default"](function(e,t){if(a.length>0){var i=v.transaction(a,"readwrite"),s=!0,o=!1,u=undefined;try{for(var c,l=(0,_getIterator2["default"])(r);!(s=(c=l.next()).done);s=!0){var h=c.value,f=i.objectStore(h.tableName);h.truncated&&f.clear();var d=!0,A=!1,_=undefined;try{for(var p,g=(0,_getIterator2["default"])(h.removed);!(d=(p=g.next()).done);d=!0){var y=p.value;f["delete"](y)}}catch(x){A=!0;_=x}finally{try{d||null==g["return"]||g["return"]()}finally{if(A)throw _}}var k=!0,m=!1,b=undefined;try{for(var w,C=(0,_getIterator2["default"])(h.modified);!(k=(w=C.next()).done);k=!0){var S=(0,_slicedToArray2["default"])(w.value,2),T=S[0],E=S[1];f.put(E,T)}}catch(x){m=!0;b=x}finally{try{k||null==C["return"]||C["return"]()}finally{if(m)throw b}}}}catch(x){o=!0;u=x}finally{try{s||null==l["return"]||l["return"]()}finally{if(o)throw u}}i.oncomplete=function(){_promise["default"].all(n.map(function(e){return e()})).then(function(){e(!0)})};i.onerror=t;i.onabort=t}else _promise["default"].all(n.map(function(e){return e()})).then(function(){e(!0)})}));case 54:for(k=C.length,m=new Array(k>2?k-2:0),b=2;b<k;b++)m[b-2]=C[b];m.push(e);m.push(t);if(m.every(function(e){return e instanceof M})){S.next=59;break}throw new Error("Invalid arguments supplied");case 59:w=(0,_construct3["default"])(z,m);return S.abrupt("return",w.commit());case 61:case"end":return S.stop()}},_callee16,null,[[10,40,44,52],[19,23,27,35],[28,,30,34],[45,,47,51]])}));return function commitCombined(t,n){return e.apply(this,arguments)}}()}]);return JungleDB}();i.JSON_ENCODING={};i.BINARY_ENCODING={};i.STRING_ENCODING={};i.NUMBER_ENCODING={};i.GENERIC_ENCODING={};t.register(i);var s=function(){function PersistentIndex(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined&&arguments[3],a=arguments.length>4&&arguments[4]!==undefined&&arguments[4];(0,_classCallCheck2["default"])(this,PersistentIndex);this._objectStore=e;this._indexName=t;this._keyPath=n;this._multiEntry=r;this._unique=a}(0,_createClass2["default"])(PersistentIndex,[{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee17(){return _regenerator["default"].wrap(function _callee17$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee17)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"_index",value:function _index(e){return e.transaction([this._objectStore.tableName],"readonly").objectStore(this._objectStore.tableName).index(this._indexName)}},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee18(){var e,t,n,a=this,i=arguments;return _regenerator["default"].wrap(function _callee18$(s){for(;;)switch(s.prev=s.next){case 0:e=i.length>0&&i[0]!==undefined?i[0]:null;t=i.length>1&&i[1]!==undefined?i[1]:null;e=r.convertKeyRange(e);s.next=5;return this._objectStore.backend;case 5:n=s.sent;return s.abrupt("return",new _promise["default"](function(r,i){var s=[],o=a._index(n).openCursor(e);o.onsuccess=function(e){var n=e.target.result;if(n){if(null!==t&&s.length>=t){r(s);return}try{s.push(a._objectStore.decode(n.value,n.primaryKey))}catch(o){i(o)}n["continue"]()}else r(s)};o.onerror=function(){return i(o.error)}}));case 7:case"end":return s.stop()}},_callee18,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee19(){var e,t,n,a=this,i=arguments;return _regenerator["default"].wrap(function _callee19$(s){for(;;)switch(s.prev=s.next){case 0:e=i.length>0&&i[0]!==undefined?i[0]:null;t=i.length>1&&i[1]!==undefined?i[1]:null;e=r.convertKeyRange(e);s.next=5;return this._objectStore.backend;case 5:n=s.sent;return s.abrupt("return",new _promise["default"](function(r,i){var s=new _set5["default"],o=a._index(n),u=o.openKeyCursor?o.openKeyCursor(e):o.openCursor(e);u.onsuccess=function(e){var n=e.target.result;if(n){if(null!==t&&s.size>=t){r(s);return}s.add(n.primaryKey);n["continue"]()}else r(s)};u.onerror=function(){return i(u.error)}}));case 7:case"end":return s.stop()}},_callee19,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"maxValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee20(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee20$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new _promise["default"](function(r,a){var i=[],s=null,o=n._index(t).openCursor(e,"prev");o.onsuccess=function(e){var t=e.target.result;t&&null===s&&(s=t.key);if(t&&p.equals(s,t.key)){try{i.push(n._objectStore.decode(t.value,t.primaryKey))}catch(o){a(o)}t["continue"]()}else r(i)};o.onerror=function(){return a(o.error)}}));case 6:case"end":return i.stop()}},_callee20,this)}));return function maxValues(){return e.apply(this,arguments)}}()},{key:"maxKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee21(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee21$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new _promise["default"](function(r,a){var i=new _set5["default"],s=null,o=n._index(t),u=o.openKeyCursor?o.openKeyCursor(e,"prev"):o.openCursor(e,"prev");u.onsuccess=function(e){var t=e.target.result;t&&null===s&&(s=t.key);if(t&&p.equals(s,t.key)){i.add(t.primaryKey);t["continue"]()}else r(i)};u.onerror=function(){return a(u.error)}}));case 6:case"end":return i.stop()}},_callee21,this)}));return function maxKeys(){return e.apply(this,arguments)}}()},{key:"minValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee22(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee22$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new _promise["default"](function(r,a){var i=[],s=null,o=n._index(t).openCursor(e,"next");o.onsuccess=function(e){var t=e.target.result;t&&null===s&&(s=t.key);if(t&&p.equals(s,t.key)){try{i.push(n._objectStore.decode(t.value,t.primaryKey))}catch(o){a(o)}t["continue"]()}else r(i)};o.onerror=function(){return a(o.error)}}));case 6:case"end":return i.stop()}},_callee22,this)}));return function minValues(){return e.apply(this,arguments)}}()},{key:"minKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee23(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee23$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new _promise["default"](function(r,a){var i=new _set5["default"],s=null,o=n._index(t),u=o.openKeyCursor?o.openKeyCursor(e,"next"):o.openCursor(e,"next");u.onsuccess=function(e){var t=e.target.result;t&&null===s&&(s=t.key);if(t&&p.equals(s,t.key)){i.add(t.primaryKey);t["continue"]()}else r(i)};u.onerror=function(){return a(u.error)}}));case 6:case"end":return i.stop()}},_callee23,this)}));return function minKeys(){return e.apply(this,arguments)}}()},{key:"keyStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee24(e){var t,n,a,i=this,s=arguments;return _regenerator["default"].wrap(function _callee24$(o){for(;;)switch(o.prev=o.next){case 0:t=!(s.length>1&&s[1]!==undefined)||s[1];n=s.length>2&&s[2]!==undefined?s[2]:null;n=r.convertKeyRange(n);o.next=5;return this._objectStore.backend;case 5:a=o.sent;return o.abrupt("return",new _promise["default"](function(r,s){var o=i._index(a),u=o.openKeyCursor?o.openKeyCursor(n,t?"next":"prev"):o.openCursor(n,t?"next":"prev");u.onsuccess=function(t){var n=t.target.result;if(n)try{e(n.primaryKey)?n["continue"]():r()}catch(a){s(a)}else r()};u.onerror=function(){return s(u.error)}}));case 7:case"end":return o.stop()}},_callee24,this)}));return function keyStream(t){return e.apply(this,arguments)}}()},{key:"valueStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee25(e){var t,n,a,i=this,s=arguments;return _regenerator["default"].wrap(function _callee25$(o){for(;;)switch(o.prev=o.next){case 0:t=!(s.length>1&&s[1]!==undefined)||s[1];n=s.length>2&&s[2]!==undefined?s[2]:null;n=r.convertKeyRange(n);o.next=5;return this._objectStore.backend;case 5:a=o.sent;return o.abrupt("return",new _promise["default"](function(r,s){var o=i._index(a).openCursor(n,t?"next":"prev");o.onsuccess=function(t){var n=t.target.result;if(n)try{e(i._objectStore.decode(n.value,n.primaryKey),n.primaryKey)?n["continue"]():r()}catch(a){s(a)}else r()};o.onerror=function(){return s(o.error)}}));case 7:case"end":return o.stop()}},_callee25,this)}));return function valueStream(t){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee26(){var e,t,n=this,a=arguments;return _regenerator["default"].wrap(function _callee26$(i){for(;;)switch(i.prev=i.next){case 0:e=a.length>0&&a[0]!==undefined?a[0]:null;e=r.convertKeyRange(e);i.next=4;return this._objectStore.backend;case 4:t=i.sent;return i.abrupt("return",new _promise["default"](function(r,a){var i;(i=e?n._index(t).count(e):n._index(t).count()).onsuccess=function(){return r(i.result)};i.onerror=function(){return a(i.error)}}));case 6:case"end":return i.stop()}},_callee26,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"keyPath",get:function get(){return this._keyPath}},{key:"multiEntry",get:function get(){return this._multiEntry}},{key:"unique",get:function get(){return this._unique}}]);return PersistentIndex}();t.register(s);(0,_defineProperty3["default"])(Array.prototype,"iterator",{value:function value(){var e=this,t=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0],n=t?0:this.length-1;return{next:function next(){return n>=0&&n<e.length?e[t?n++:n--]:undefined},hasNext:function hasNext(){return n>=0&&n<e.length},peek:function peek(){return n>=0&&n<e.length?e[n]:undefined}}}});var o=function(){function Node(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];(0,_classCallCheck2["default"])(this,Node);this._keys=e}(0,_createClass2["default"])(Node,[{key:"keys",get:function get(){return this._keys}}]);return Node}();t.register(o);var u=function(e){(0,_inherits2["default"])(LeafNode,e);var t=_createSuper(LeafNode);function LeafNode(){var e,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];(0,_classCallCheck2["default"])(this,LeafNode);if(n.length!==r.length)throw new Error("Keys and records must have the same length");(e=t.call(this,n))._records=r;e.prevLeaf=null;e.nextLeaf=null;return e}(0,_createClass2["default"])(LeafNode,[{key:"isLeaf",value:function isLeaf(){return!0}},{key:"getItem",value:function getItem(e,t){var n=this._keys;if(t===l.NEAR_MODE.GE){for(var r=0,a=n.length;r<a;++r)if(p.compare(e,n[r])<=0)return r}else if(t===l.NEAR_MODE.LE){for(var i=n.length-1;i>=0;--i)if(p.compare(e,n[i])>=0)return i}else for(var s=0,o=n.length;s<o;++s)if(p.equals(e,n[s]))return s;return-1}},{key:"addKey",value:function addKey(e,t){for(var n=this._keys.length,r=0,a=n;r<a;++r){if(p.equals(e,this._keys[r]))return-1;if(p.compare(e,this._keys[r])<=0){n=r;break}}this._keys.splice(n,0,e);this._records.splice(n,0,t);return n}},{key:"split",value:function split(){for(var e=Math.floor(this._keys.length/2),t=[],n=[],r=0;r<e;++r){t.unshift(this._keys.pop());n.unshift(this._records.pop())}var a=new LeafNode(t,n);a.prevLeaf=this;a.nextLeaf=this.nextLeaf;null!==this.nextLeaf&&(this.nextLeaf.prevLeaf=a);this.nextLeaf=a;return a}},{key:"merge",value:function merge(e,t,n){for(var r=0,a=e.keys.length;r<a;++r){this._keys.push(e.keys[r]);this._records.push(e.records[r])}this.nextLeaf=e.nextLeaf;null!==e.nextLeaf&&(e.nextLeaf.prevLeaf=this);e.prevLeaf=null;e.nextLeaf=null;for(var i=t.keys.length-1,s=i;s>=0;--s)if(p.equals(t.keys[s],n)){i=s;break}t.keys.splice(i,1);t.nodePointers.splice(i+1,1)}},{key:"records",get:function get(){return this._records}}]);return LeafNode}(o);t.register(u);var c=function(e){(0,_inherits2["default"])(InnerNode,e);var t=_createSuper(InnerNode);function InnerNode(){var e,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];(0,_classCallCheck2["default"])(this,InnerNode);(e=t.call(this,n))._nodePointers=r;return e}(0,_createClass2["default"])(InnerNode,[{key:"isLeaf",value:function isLeaf(){return!1}},{key:"getItem",value:function getItem(e){for(var t=this._keys.length,n=0;n<t;++n)if(e<this._keys[n])return n;return this._keys.length}},{key:"addKey",value:function addKey(e,t,n){for(var r=this._keys.length,a=r,i=0;i<r;++i)if(p.compare(e,this._keys[i])<=0){a=i;break}this._keys.splice(a,0,e);this._nodePointers.splice(a,0,t);this._nodePointers[a+1]=n}},{key:"split",value:function split(){for(var e=Math.ceil(this._keys.length/2)-1,t=[this._nodePointers.pop()],n=[],r=e-1;r>=0;--r){n.unshift(this._keys.pop());t.unshift(this._nodePointers.pop())}return new InnerNode(n,t)}},{key:"merge",value:function merge(e,t,n){var r=t.keys[n];this._keys.push(r);for(var a=0,i=e.keys.length;a<i;++a){this._keys.push(e.keys[a]);this._nodePointers.push(e.nodePointers[a])}this._nodePointers.push(e.nodePointers[e.nodePointers.length-1]);t.keys.splice(n,1);t.nodePointers.splice(n+1,1);return r}},{key:"nodePointers",get:function get(){return this._nodePointers}}]);return InnerNode}(o);t.register(c);var l=function(){function BTree(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:7;(0,_classCallCheck2["default"])(this,BTree);this._root=new u;this._maxkey=e-1;this._minkyl=Math.floor(e/2);this._minkyn=Math.floor(this._maxkey/2);this._leaf=null;this._item=-1;this._key=null;this._record=null;this._length=0;this._eof=!0;this._found=!1}(0,_createClass2["default"])(BTree,[{key:"insert",value:function insert(e,t){var n=[];this._leaf=this._root;for(;!this._leaf.isLeaf();){n.push(this._leaf);this._item=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[this._item]}this._item=this._leaf.addKey(e,t);this._key=e;this._eof=!1;if(-1===this._item){this._found=!0;this._item=this._leaf.getItem(e,!1);this._record=this._leaf.records[this._item]}else{this._found=!1;this._record=t;this._length++;if(this._leaf.keys.length>this._maxkey){var r=this._leaf,a=this._leaf.split(),i=a.keys[0];this._item=this._leaf.getItem(e,!1);if(-1===this._item){this._leaf=this._leaf.nextLeaf;this._item=this._leaf.getItem(e,!1)}for(;;){if(0===n.length){var s=new c;s.keys[0]=i;s.nodePointers[0]=r;s.nodePointers[1]=a;this._root=s;break}var o=n.pop();o.addKey(i,r,a);if(o.keys.length<=this._maxkey)break;r=o;a=o.split();i=o.keys.pop()}}}return!this._found}},{key:"remove",value:function remove(e){if("undefined"==typeof e){if(-1===this._item){this._eof=!0;this._found=!1;return!1}e=this._leaf.keys[this._item]}this._del(e);if(this._found){this.seek(e,BTree.NEAR_MODE.GE);this._found=!0}else{this._item=-1;this._eof=!0;this._key=null;this._record=null}return this._found}},{key:"seek",value:function seek(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:BTree.NEAR_MODE.NONE;this._leaf=this._root;for(;!this._leaf.isLeaf();){this._item=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[this._item]}this._item=this._leaf.getItem(e,t);if(t===BTree.NEAR_MODE.GE&&-1===this._item&&null!==this._leaf.nextLeaf){this._leaf=this._leaf.nextLeaf;this._item=0}if(t===BTree.NEAR_MODE.LE&&-1===this._item&&null!==this._leaf.prevLeaf){this._leaf=this._leaf.prevLeaf;this._item=this._leaf.records.length-1}if(-1===this._item){this._eof=!0;this._key=null;this._found=!1;this._record=null}else{this._eof=!1;this._found=this._leaf.keys[this._item]===e;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return!this._eof}},{key:"skip",value:function skip(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;"number"!=typeof e&&(e=1);-1!==this._item&&null!==this._leaf||(this._eof=!0);if(e>0){for(;!this._eof&&this._leaf.keys.length-this._item-1<e;){e=e-this._leaf.keys.length+this._item;this._leaf=this._leaf.nextLeaf;null===this._leaf?this._eof=!0:this._item=0}this._eof||(this._item=this._item+e)}else{e=-e;for(;!this._eof&&this._item<e;){e=e-this._item-1;this._leaf=this._leaf.prevLeaf;null===this._leaf?this._eof=!0:this._item=this._leaf.keys.length-1}this._eof||(this._item=this._item-e)}if(this._eof){this._item=-1;this._found=!1;this._key=null;this._record=null}else{this._found=!0;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return this._found}},{key:"goto",value:function goto(e){if(e<0){this.goBottom();this._eof||this.skip(e+1)}else{this.goTop();this._eof||this.skip(e-1)}return this._found}},{key:"keynum",value:function keynum(){if(null===this._leaf||-1===this._item)return-1;for(var e=this._item+1,t=this._leaf;null!==t.prevLeaf;)e+=(t=t.prevLeaf).keys.length;return e}},{key:"goTop",value:function goTop(){this._leaf=this._root;for(;!this._leaf.isLeaf();)this._leaf=this._leaf.nodePointers[0];if(0===this._leaf.keys.length){this._item=-1;this._eof=!0;this._found=!1;this._key=null;this._record=null}else{this._item=0;this._eof=!1;this._found=!0;this._key=this._leaf.keys[0];this._record=this._leaf.records[0]}return this._found}},{key:"goBottom",value:function goBottom(){this._leaf=this._root;for(;!this._leaf.isLeaf();)this._leaf=this._leaf.nodePointers[this._leaf.nodePointers.length-1];if(0===this._leaf.keys.length){this._item=-1;this._eof=!0;this._found=!1;this._key=null;this._record=null}else{this._item=this._leaf.keys.length-1;this._eof=!1;this._found=!0;this._key=this._leaf.keys[this._item];this._record=this._leaf.records[this._item]}return this._found}},{key:"pack",value:function pack(){var e,t;this.goTop(0);if(this._leaf===this._root)return!1;for(var n=new u,r=0,a=this._leaf,i=0,s=[],o=[];;){n.keys[r]=a.keys[i];n.records[r]=a.records[i];0===r&&o.push(n);if(i===a.keys.length-1){if(null===a.nextLeaf)break;a=a.nextLeaf;i=0}else i++;if(r===this._maxkey-1){var l=new u;n.nextLeaf=l;l.prevLeaf=n;n=l;r=0}else r++}var h,f,d=this._minkyl-n.keys.length;a=n.prevLeaf;if(d>0&&null!==a)for(t=d-1;t>=0;--t){n.keys.unshift(a.keys.pop());n.records.unshift(a.records.pop())}for(t=1,e=o.length;t<e;++t)s.push(o[t].keys[0]);s[s.length]=null;for(;null!==s[0];){h=s;f=o;s=[];o=[];r=this._maxkey+1;t=0;e=h.length;for(;t<e;t++){if(r>this._maxkey){n=new c;r=0;o.push(n)}n.keys[r]=h[t];n.nodePointers[r]=f[t];r++}if((d=this._minkyn-n.keys.length+1)>0&&o.length>1){a=o[o.length-2];for(t=d-1;t>=0;--t){n.keys.unshift(a.keys.pop());n.nodePointers.unshift(a.nodePointers.pop())}}t=0;e=o.length;for(;t<e;++t)s.push(o[t].keys.pop())}this._root=o[0];this.goTop();return this._found}},{key:"_del",value:function _del(e){var t=[],n=null,r=-1;this._leaf=this._root;for(;!this._leaf.isLeaf();){t.push(this._leaf);n=this._leaf;r=this._leaf.getItem(e);this._leaf=this._leaf.nodePointers[r]}this._item=this._leaf.getItem(e,!1);if(-1!==this._item){this._found=!0;this._leaf.keys.splice(this._item,1);this._leaf.records.splice(this._item,1);this._length--;if(this._leaf!==this._root)if(this._leaf.keys.length>=this._minkyl)0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0]);else{var a,i=0===r?null:n.nodePointers[r-1];if(null!==i&&i.keys.length>this._minkyl){a=0===this._item?e:this._leaf.keys[0];this._leaf.keys.unshift(i.keys.pop());this._leaf.records.unshift(i.records.pop());BTree._fixNodes(t,a,this._leaf.keys[0])}else{var s=r===n.keys.length?null:n.nodePointers[r+1];if(null!==s&&s.keys.length>this._minkyl){this._leaf.keys.push(s.keys.shift());this._leaf.records.push(s.records.shift());0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0]);BTree._fixNodes(t,this._leaf.keys[this._leaf.keys.length-1],s.keys[0])}else{if(null!==i){a=0===this._item?e:this._leaf.keys[0];i.merge(this._leaf,n,a);this._leaf=i}else{a=s.keys[0];this._leaf.merge(s,n,a);0===this._item&&BTree._fixNodes(t,e,this._leaf.keys[0])}if(1!==t.length||0!==n.keys.length)for(var o,u=t.pop();u.keys.length<this._minkyn&&t.length>0;){if(null!==(s=(o=(n=t.pop()).getItem(a))===n.keys.length?null:n.nodePointers[o+1])&&s.keys.length>this._minkyn){u.keys.push(n.keys[o]);n.keys[o]=s.keys.shift();u.nodePointers.push(s.nodePointers.shift());break}if(null!==(i=0===o?null:n.nodePointers[o-1])&&i.keys.length>this._minkyn){u.keys.unshift(n.keys[o-1]);n.keys[o-1]=i.keys.pop();u.nodePointers.unshift(i.nodePointers.pop());break}if(null!==i){a=i.merge(u,n,o-1);u=i}else null!==s&&(a=u.merge(s,n,o));if(0===t.length&&0===n.keys.length){this._root=u;break}u=n}else this._root=this._leaf}}}}else this._found=!1}},{key:"goToLowerBound",value:function goToLowerBound(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];if(e!==undefined){var n=this.seek(e,BTree.NEAR_MODE.GE);n&&t&&p.equals(e,this.currentKey)&&(n=this.skip());return n}return this.goTop()}},{key:"goToUpperBound",value:function goToUpperBound(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];if(e!==undefined){var n=this.seek(e,BTree.NEAR_MODE.LE);n&&t&&p.equals(e,this.currentKey)&&(n=this.skip(-1));return n}return this.goBottom()}},{key:"length",get:function get(){return this._length}},{key:"currentKey",get:function get(){return this._key}},{key:"currentRecord",get:function get(){return this._record}}],[{key:"_fixNodes",value:function _fixNodes(e,t,n){var r,a=e.length,i=!0;do{for(var s=(r=e[--a].keys).length-1;s>=0;--s)if(r[s]===t){r[s]=n;i=!1;break}}while(i&&a>0)}}]);return BTree}();l.NEAR_MODE={NONE:0,LE:1,GE:2};t.register(l);var h=function(){function BufferUtils(){(0,_classCallCheck2["default"])(this,BufferUtils)}(0,_createClass2["default"])(BufferUtils,null,[{key:"_codePointTextDecoder",value:function _codePointTextDecoder(e){if("undefined"==typeof TextDecoder)throw new Error("TextDecoder not supported");if(null===BufferUtils._ISO_8859_15_DECODER)throw new Error("TextDecoder does not supprot iso-8859-15");if(BufferUtils._ISO_8859_15_DECODER===undefined)try{BufferUtils._ISO_8859_15_DECODER=new TextDecoder("iso-8859-15")}finally{BufferUtils._ISO_8859_15_DECODER=null}return BufferUtils._ISO_8859_15_DECODER.decode(e).replace("€","¤").replace("Š","¦").replace("š","¨").replace("Ž","´").replace("ž","¸").replace("Œ","¼").replace("œ","½").replace("Ÿ","¾")}},{key:"_tripletToBase64",value:function _tripletToBase64(e){return BufferUtils._BASE64_LOOKUP[e>>18&63]+BufferUtils._BASE64_LOOKUP[e>>12&63]+BufferUtils._BASE64_LOOKUP[e>>6&63]+BufferUtils._BASE64_LOOKUP[63&e]}},{key:"_base64encodeChunk",value:function _base64encodeChunk(e,t,n){for(var r,a=[],i=t;i<n;i+=3){r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]);a.push(BufferUtils._tripletToBase64(r))}return a.join("")}},{key:"_base64fromByteArray",value:function _base64fromByteArray(e){for(var t,n=e.length,r=n%3,a="",i=[],s=0,o=n-r;s<o;s+=16383)i.push(BufferUtils._base64encodeChunk(e,s,s+16383>o?o:s+16383));if(1===r){t=e[n-1];a+=BufferUtils._BASE64_LOOKUP[t>>2];a+=BufferUtils._BASE64_LOOKUP[t<<4&63];a+="=="}else if(2===r){t=(e[n-2]<<8)+e[n-1];a+=BufferUtils._BASE64_LOOKUP[t>>10];a+=BufferUtils._BASE64_LOOKUP[t>>4&63];a+=BufferUtils._BASE64_LOOKUP[t<<2&63];a+="="}i.push(a);return i.join("")}},{key:"toBase64",value:function toBase64(e){if("undefined"!=typeof Buffer&&"undefined"==typeof window)return Buffer.from(e).toString("base64");if("undefined"!=typeof TextDecoder&&null!==BufferUtils._ISO_8859_15_DECODER)try{return btoa(BufferUtils._codePointTextDecoder(new Uint8Array(e)))}catch(t){}return BufferUtils._base64fromByteArray(new Uint8Array(e))}},{key:"fromBase64",value:function fromBase64(e){if(!/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e))throw new Error("Invalid base64");return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})}},{key:"toBase64lex",value:function toBase64lex(e){for(var t=BufferUtils.toBase64(e),n="",r=0;r<t.length;r++)n+=BufferUtils.BASE64_TO_BASE64_LEX[t[r]];return n}},{key:"fromBase64lex",value:function fromBase64lex(e){for(var t="",n=0;n<e.length;n++)t+=BufferUtils.BASE64_LEX_TO_BASE64[e[n]];return BufferUtils.fromBase64(t)}},{key:"equals",value:function equals(e,t){if(e.length!==t.length)return!1;for(var n=new Uint8Array(e),r=new Uint8Array(t),a=0;a<e.length;a++)if(n[a]!==r[a])return!1;return!0}},{key:"compare",value:function compare(e,t){if(e.length<t.length)return-1;if(e.length>t.length)return 1;for(var n=0;n<e.length;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0}}]);return BufferUtils}();h.BASE64_ALPHABET="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";h._BASE64_LOOKUP=[];for(var f=0,d=h.BASE64_ALPHABET.length;f<d;++f)h._BASE64_LOOKUP[f]=h.BASE64_ALPHABET[f];h.BASE64_LEX_ALPHABET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~";h.BASE64_TO_BASE64_LEX={"=":"-"};h.BASE64_LEX_TO_BASE64={"-":"="};for(var A=0,_=h.BASE64_ALPHABET.length;A<_;++A){h.BASE64_TO_BASE64_LEX[h.BASE64_ALPHABET[A]]=h.BASE64_LEX_ALPHABET[A];h.BASE64_LEX_TO_BASE64[h.BASE64_LEX_ALPHABET[A]]=h.BASE64_ALPHABET[A]}t.register(h);var p=function(){function ComparisonUtils(){(0,_classCallCheck2["default"])(this,ComparisonUtils)}(0,_createClass2["default"])(ComparisonUtils,null,[{key:"equals",value:function equals(e,t){return e===t||(e instanceof _set5["default"]&&t instanceof _set5["default"]?e.equals(t):!(!ComparisonUtils.isUint8Array(e)||!ComparisonUtils.isUint8Array(t))&&h.equals(new Uint8Array(e),new Uint8Array(t)))}},{key:"compare",value:function compare(e,t){return ComparisonUtils.isUint8Array(e)&&ComparisonUtils.isUint8Array(t)?h.compare(new Uint8Array(e),new Uint8Array(t)):e<t?-1:e>t?1:0}},{key:"isUint8Array",value:function isUint8Array(e){return"undefined"!=typeof Buffer&&"undefined"==typeof window&&e instanceof Buffer||(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)}}]);return ComparisonUtils}();t.register(p);var g=function(){function JSONUtils(){(0,_classCallCheck2["default"])(this,JSONUtils)}(0,_createClass2["default"])(JSONUtils,null,[{key:"stringify",value:function stringify(e){return(0,_stringify["default"])(e,JSONUtils.jsonifyType)}},{key:"parse",value:function parse(e){return JSON.parse(e,JSONUtils.parseType)}},{key:"parseType",value:function parseType(e,t){if(t&&t[JSONUtils.TYPE_SYMBOL])switch(t[JSONUtils.TYPE_SYMBOL]){case"Uint8Array":return h.fromBase64(t[JSONUtils.VALUE_SYMBOL]);case"Set":return _set5["default"].from(t[JSONUtils.VALUE_SYMBOL])}return t}},{key:"jsonifyType",value:function jsonifyType(e,t){return t instanceof Uint8Array?JSONUtils.typedObject("Uint8Array",h.toBase64(t)):t instanceof _set5["default"]?JSONUtils.typedObject("Set",(0,_from["default"])(t)):t}},{key:"typedObject",value:function typedObject(e,t){var n={};n[JSONUtils.TYPE_SYMBOL]=e;n[JSONUtils.VALUE_SYMBOL]=t;return n}}]);return JSONUtils}();g.TYPE_SYMBOL="__";g.VALUE_SYMBOL="value";t.register(g);var y=function(){(0,_createClass2["default"])(Log,null,[{key:"instance",get:function get(){Log._instance||(Log._instance=new Log(new n));return Log._instance}}]);function Log(e){(0,_classCallCheck2["default"])(this,Log);this._native=e}(0,_createClass2["default"])(Log,[{key:"setLoggable",value:function setLoggable(e,t){this._native.setLoggable(e,t)}},{key:"msg",value:function msg(e,t,n){if(this._native.isLoggable(t,e)){for(var r=0;r<n.length;++r){"function"==typeof n[r]&&(n[r]=n[r]());"object"===(0,_typeof2["default"])(n[r])&&("function"==typeof n[r].toString?n[r]=n[r].toString():n[r].constructor&&n[r].constructor.name?n[r]="{Object: ".concat(n[r].constructor.name,"}"):n[r]="{Object}")}this._native.msg(e,t,n)}}},{key:"level",get:function get(){return this._native._global_level},set:function set(e){this._native._global_level=e}}],[{key:"d",value:function d(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.DEBUG,e,r)}},{key:"e",value:function e(t,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(arguments.length>=2){t=arguments[0];a=Array.prototype.slice.call(arguments,1)}else{t=undefined;a=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.ERROR,t,a)}},{key:"i",value:function i(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.INFO,e,r)}},{key:"v",value:function v(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.VERBOSE,e,r)}},{key:"w",value:function w(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.WARNING,e,r)}},{key:"t",value:function t(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(arguments.length>=2){e=arguments[0];a=Array.prototype.slice.call(arguments,1)}else{e=undefined;a=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.TRACE,e,a)}}]);return Log}();y.Level={TRACE:1,VERBOSE:2,DEBUG:3,INFO:4,WARNING:5,ERROR:6,ASSERT:7,toStringTag:function toStringTag(e){switch(e){case y.TRACE:return"T";case y.VERBOSE:return"V";case y.DEBUG:return"D";case y.INFO:return"I";case y.WARNING:return"W";case y.ERROR:return"E";case y.ASSERT:return"A";default:return"*"}}};y.TRACE=y.Level.TRACE;y.VERBOSE=y.Level.VERBOSE;y.DEBUG=y.Level.DEBUG;y.INFO=y.Level.INFO;y.WARNING=y.Level.WARNING;y.ERROR=y.Level.ERROR;y.ASSERT=y.Level.ASSERT;y._instance=null;y.d.tag=function(e){return y.d.bind(null,e)};y.e.tag=function(e){return y.e.bind(null,e)};y.i.tag=function(e){return y.i.bind(null,e)};y.v.tag=function(e){return y.v.bind(null,e)};y.w.tag=function(e){return y.w.bind(null,e)};y.t.tag=function(e){return y.t.bind(null,e)};t.register(y);var v=function(){function LinkedList(){(0,_classCallCheck2["default"])(this,LinkedList);this._length=0;this._head=null;this._tail=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=1===t.length&&(0,_isArray["default"])(t[0])?t[0]:t,a=!0,i=!1,s=undefined;try{for(var o,u=(0,_getIterator2["default"])(r);!(a=(o=u.next()).done);a=!0){var c=o.value;this.push(c)}}catch(l){i=!0;s=l}finally{try{a||null==u["return"]||u["return"]()}finally{if(i)throw s}}}(0,_createClass2["default"])(LinkedList,[{key:"push",value:function push(e){var t={next:null,prev:this._head,value:e};this._push(t)}},{key:"_push",value:function _push(e){this._length++;if(this._head){this._head.next=e;this._head=e}else{this._head=e;this._tail=e}}},{key:"unshift",value:function unshift(e){var t={next:this._tail,prev:null,value:e};this._unshift(t)}},{key:"_unshift",value:function _unshift(e){this._length++;if(this._head){this._tail.prev=e;this._tail=e}else{this._head=e;this._tail=e}}},{key:"pop",value:function pop(){if(!this._head)return null;this._length--;var e=this._head,t=e.prev;if(!t){this._head=null;this._tail=null;return e.value}t.next=null;this._head=t;return e.value}},{key:"shift",value:function shift(){if(!this._head)return null;this._length--;var e=this._tail,t=e.next;if(!t){this._head=null;this._tail=null;return e.value}t.prev=null;this._tail=t;return e.value}},{key:"_remove",value:function _remove(e){if(e===this._head)this.pop();else if(e===this._tail)this.shift();else{this._length--;e.prev.next=e.next;e.next.prev=e.prev}}},{key:"clear",value:function clear(){this._length=0;this._head=null;this._tail=null}},{key:_iterator276["default"],value:function value(){return this.iterator()}},{key:"iterator",value:_regenerator["default"].mark(function iterator(){var e;return _regenerator["default"].wrap(function iterator$(t){for(;;)switch(t.prev=t.next){case 0:e=this._tail;case 1:if(!e){t.next=7;break}t.next=4;return e.value;case 4:e=e.next;t.next=1;break;case 7:case"end":return t.stop()}},iterator,this)})},{key:"isEmpty",value:function isEmpty(){return 0===this._length}},{key:"first",get:function get(){return this._tail?this._tail.value:null}},{key:"last",get:function get(){return this._head?this._head.value:null}},{key:"length",get:function get(){return this._length}}]);return LinkedList}();t.register(v);var k=function(e){(0,_inherits2["default"])(UniqueLinkedList,e);var t=_createSuper(UniqueLinkedList);function UniqueLinkedList(){var e;(0,_classCallCheck2["default"])(this,UniqueLinkedList);(e=t.call(this))._map=new _map2["default"];return e}(0,_createClass2["default"])(UniqueLinkedList,[{key:"push",value:function push(e){this._map.has(e)||(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"push",this).call(this,e)}},{key:"_push",value:function _push(e){(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_push",this).call(this,e);this._map.set(e.value,e)}},{key:"unshift",value:function unshift(e){this._map.has(e)||(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"unshift",this).call(this,e)}},{key:"_unshift",value:function _unshift(e){(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_unshift",this).call(this,e);this._map.set(e.value,e)}},{key:"pop",value:function pop(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"pop",this).call(this);this._map["delete"](e);return e}},{key:"shift",value:function shift(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"shift",this).call(this);this._map["delete"](e);return e}},{key:"clear",value:function clear(){(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"clear",this).call(this);this._map.clear()}},{key:"contains",value:function contains(e){return this._map.has(e)}},{key:"remove",value:function remove(e){var t=this._map.get(e);if(t){(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_remove",this).call(this,t);this._map["delete"](e)}}},{key:"moveBack",value:function moveBack(e){var t=this._map.get(e);if(t){if(t===this._head)return;if(t===this._tail){t.next.prev=null;this._tail=t.next}else{t.prev.next=t.next;t.next.prev=t.prev}t.next=null;t.prev=this._head;this._head.next=t;this._head=t}else(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"push",this).call(this,e)}}]);return UniqueLinkedList}(v);t.register(k);var m=function(){function LRUMap(e){(0,_classCallCheck2["default"])(this,LRUMap);this._maxSize=e;this._map=new _map2["default"];this._accessQueue=new k}(0,_createClass2["default"])(LRUMap,[{key:"clear",value:function clear(){this._accessQueue.clear();return this._map.clear()}},{key:"delete",value:function _delete(e){this._accessQueue.remove(e);return this._map["delete"](e)}},{key:"entries",value:function entries(){return this._map.entries()}},{key:"forEach",value:function forEach(e,t){return this._map.forEach(e,t)}},{key:"get",value:function get(e){this._access(e);return this._map.get(e)}},{key:"has",value:function has(e){return this._map.has(e)}},{key:"keys",value:function keys(){return this._map.keys()}},{key:"evict",value:function evict(){for(var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;e>0&&this._accessQueue.length>0;){var t=this._accessQueue.shift();this._map["delete"](t);--e}}},{key:"_access",value:function _access(e){this._accessQueue.moveBack(e)}},{key:"set",value:function set(e,t){this.size>=this._maxSize&&this.evict();if(this.size<this._maxSize){this._map.set(e,t);this._access(e)}}},{key:"values",value:function values(){return this._map.values()}},{key:_iterator276["default"],value:function value(){return this._map.entries()}},{key:"size",get:function get(){return this._map.size}}]);return LRUMap}();t.register(m);var b=function(){function ObjectUtils(){(0,_classCallCheck2["default"])(this,ObjectUtils)}(0,_createClass2["default"])(ObjectUtils,null,[{key:"byKeyPath",value:function byKeyPath(e,t){if(!(0,_isArray["default"])(t))return e[t];var n=e,r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(t);!(r=(s=o.next()).done);r=!0){var u=s.value;if(n===undefined)return undefined;n=n[u]}}catch(c){a=!0;i=c}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}return n}}]);return ObjectUtils}();t.register(b);_set5["default"].prototype.union=function(e){var t=new _set5["default"](this),n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(e);!(n=(i=s.next()).done);n=!0){var o=i.value;t.add(o)}}catch(u){r=!0;a=u}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}return t};_set5["default"].prototype.intersection=function(e){var t=new _set5["default"],n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(e);!(n=(i=s.next()).done);n=!0){var o=i.value;this.has(o)&&t.add(o)}}catch(u){r=!0;a=u}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}return t};_set5["default"].prototype.difference=function(e){var t=new _set5["default"](this),n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(e);!(n=(i=s.next()).done);n=!0){var o=i.value;t["delete"](o)}}catch(u){r=!0;a=u}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}return t};_set5["default"].prototype.equals=function(e){if(this.size!==e.size)return!1;var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;if(!this.has(s))return!1}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return!0};_set5["default"].prototype.limit=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(null===e)return this;var t=new _set5["default"],n=0,r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(this);!(r=(s=o.next()).done);r=!0){var u=s.value;if(null!==e&&n>=e)break;t.add(u);n++}}catch(c){a=!0;i=c}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}return t};Set.from=function(e){return e&&"function"==typeof e[_iterator276["default"]]&&"string"!=typeof e?new _set5["default"](e):new _set5["default"]([e])};Set.sampleElement=function(e){return e.size>0?e.values().next().value:undefined};var w=function(){function SortedList(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],t=arguments.length>1?arguments[1]:undefined;(0,_classCallCheck2["default"])(this,SortedList);this._list=e;this._compare=t||SortedList._compare}(0,_createClass2["default"])(SortedList,[{key:"indexOf",value:function indexOf(e){for(var t=0,n=this._list.length-1,r=null,a=null;t<=n;){r=Math.round((t+n)/2);a=this._list[r];if(this._compare(a,e)<0)t=r+1;else{if(!(this._compare(a,e)>0))return r;n=r-1}}return-1}},{key:"_insertionIndex",value:function _insertionIndex(e){for(var t=0,n=this._list.length-1,r=null,a=null;t<=n;){r=Math.round((t+n)/2);a=this._list[r];if(this._compare(a,e)<0)t=r+1;else{if(!(this._compare(a,e)>0))break;n=r-1}}return t}},{key:"add",value:function add(e){this._list.splice(this._insertionIndex(e),0,e)}},{key:"has",value:function has(e){return this.indexOf(e)>=0}},{key:"shift",value:function shift(){return this._list.shift()}},{key:"pop",value:function pop(){return this._list.pop()}},{key:"peekFirst",value:function peekFirst(){return this._list[0]}},{key:"peekLast",value:function peekLast(){return this._list[this._list.length-1]}},{key:"remove",value:function remove(e){var t=this.indexOf(e);t>-1&&this._list.splice(t,1)}},{key:"clear",value:function clear(){this._list=[]}},{key:"values",value:function values(){return this._list}},{key:_iterator276["default"],value:function value(){return(0,_getIterator2["default"])(this._list)}},{key:"copy",value:function copy(){return new SortedList(this._list.slice(),this._compare)}},{key:"length",get:function get(){return this._list.length}}],[{key:"_compare",value:function _compare(e,t){return e.compare?e.compare(t):e>t?1:e<t?-1:0}}]);return SortedList}();t.register(w);var C=function(){function Synchronizer(){(0,_classCallCheck2["default"])(this,Synchronizer);this._queue=[];this._working=!1}(0,_createClass2["default"])(Synchronizer,[{key:"push",value:function push(e){var t=this;return new _promise["default"](function(n,r){t._queue.push({fn:e,resolve:n,error:r});t._working||t._doWork()["catch"](y.w.tag(Synchronizer))})}},{key:"_doWork",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee27(){var e,t;return _regenerator["default"].wrap(function _callee27$(n){for(;;)switch(n.prev=n.next){case 0:this._working=!0;case 1:if(!this._queue.length){n.next=15;break}e=this._queue.shift();n.prev=3;n.next=6;return e.fn();case 6:t=n.sent;e.resolve(t);n.next=13;break;case 10:n.prev=10;n.t0=n["catch"](3);e.error&&e.error(n.t0);case 13:n.next=1;break;case 15:this._working=!1;case 16:case"end":return n.stop()}},_callee27,this,[[3,10]])}));return function _doWork(){return e.apply(this,arguments)}}()},{key:"working",get:function get(){return this._working}}]);return Synchronizer}();t.register(C);var S=function(){function EncodedTransaction(e){(0,_classCallCheck2["default"])(this,EncodedTransaction);this._tableName=e;this._modified=new _map2["default"];this._removed=new _set5["default"];this._truncated=!1}(0,_createClass2["default"])(EncodedTransaction,[{key:"truncate",value:function truncate(){this._truncated=!0;this._modified.clear();this._removed.clear()}},{key:"put",value:function put(e,t){this._removed["delete"](e);this._modified.set(e,t)}},{key:"get",value:function get(e){return this._modified.get(e)}},{key:"remove",value:function remove(e){this._removed.add(e);this._modified["delete"](e)}},{key:"tableName",get:function get(){return this._tableName}},{key:"modified",get:function get(){return this._modified}},{key:"removed",get:function get(){return this._removed}},{key:"truncated",get:function get(){return this._truncated}}]);return EncodedTransaction}();t.register(S);var T=function(){function GenericValueEncoding(){(0,_classCallCheck2["default"])(this,GenericValueEncoding)}(0,_createClass2["default"])(GenericValueEncoding,null,[{key:"_encodeInteger",value:function _encodeInteger(e){var t=new Uint8Array(9),n=new DataView(t.buffer);n.setUint8(0,GenericValueEncoding.Type.INTEGER);n.setUint32(1,Math.floor(e/Math.pow(2,32)));n.setUint32(5,e);return t}},{key:"_decodeInteger",value:function _decodeInteger(e){var t=new DataView(e.buffer);return t.getUint32(1)*Math.pow(2,32)+t.getUint32(5)}},{key:"_encodeString",value:function _encodeString(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:GenericValueEncoding.Type.STRING,n=new Uint8Array(e.length+1);n[0]=t;for(var r=0;r<e.length;++r)n[r+1]=e.charCodeAt(r);return n}},{key:"_decodeString",value:function _decodeString(e){return String.fromCharCode.apply(null,e.subarray(1))}},{key:"_encodeOther",value:function _encodeOther(e){return GenericValueEncoding._encodeString(g.stringify(e),GenericValueEncoding.Type.JSON)}},{key:"_decodeOther",value:function _decodeOther(e){var t=GenericValueEncoding._decodeString(e);return g.parse(t)}},{key:"_encodeBuffer",value:function _encodeBuffer(e){var t=new Uint8Array(e.byteLength+1);t[0]=GenericValueEncoding.Type.BUFFER;t.set(e,1);return t}},{key:"_decodeBuffer",value:function _decodeBuffer(e){return e.subarray(1)}},{key:"encode",value:function encode(e){return(0,_isInteger["default"])(e)?GenericValueEncoding._encodeInteger(e):"string"==typeof e?this._encodeString(e):e instanceof Uint8Array?GenericValueEncoding._encodeBuffer(e):GenericValueEncoding._encodeOther(e)}},{key:"decode",value:function decode(e){switch((e=new Uint8Array(e))[0]){case GenericValueEncoding.Type.INTEGER:return GenericValueEncoding._decodeInteger(e);case GenericValueEncoding.Type.STRING:return GenericValueEncoding._decodeString(e);case GenericValueEncoding.Type.BUFFER:return GenericValueEncoding._decodeBuffer(e);default:return GenericValueEncoding._decodeOther(e)}}},{key:"encoding",get:function get(){return i.Encoding.BINARY}}]);return GenericValueEncoding}();T.Type={INTEGER:0,STRING:1,JSON:2,BUFFER:3};t.register(T);var E=function(){function CachedBackend(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:CachedBackend.MAX_CACHE_SIZE,n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;(0,_classCallCheck2["default"])(this,CachedBackend);this._backend=e;this._cache=new m(t);this._rawCache=new m(n)}(0,_createClass2["default"])(CachedBackend,[{key:"_retrieveValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee28(e){var t,n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee28$(u){for(;;)switch(u.prev=u.next){case 0:t=[];n=!0;r=!1;a=undefined;u.prev=4;for(i=(0,_getIterator2["default"])(e);!(n=(s=i.next()).done);n=!0){o=s.value;t.push(this.get(o))}u.next=12;break;case 8:u.prev=8;u.t0=u["catch"](4);r=!0;a=u.t0;case 12:u.prev=12;u.prev=13;n||null==i["return"]||i["return"]();case 15:u.prev=15;if(!r){u.next=18;break}throw a;case 18:return u.finish(15);case 19:return u.finish(12);case 20:return u.abrupt("return",_promise["default"].all(t));case 21:case"end":return u.stop()}},_callee28,this,[[4,8,12,20],[13,,15,19]])}));return function _retrieveValues(t){return e.apply(this,arguments)}}()},{key:"_has",value:function _has(e){return this._cache.has(e)||this._rawCache.has(e)}},{key:"_get",value:function _get(e,t){if(t&&t.raw){if(this._rawCache.has(e))return this._rawCache.get(e);var n=this.encode(this._cache.get(e));this._rawCache.set(e,n);return n}if(this._cache.has(e))return this._cache.get(e);var r=this.decode(this._rawCache.get(e),e);this._cache.set(e,r);return r}},{key:"getSync",value:function getSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this._has(e))return this._get(e,t);if(this._backend.isSynchronous()){var n=this._backend.getSync(e,t);t&&t.raw?this._rawCache.set(e,n):this._cache.set(e,n);return n}if(t&&t.expectPresence)throw new Error("Missing key in cached backend: ".concat(e));return undefined}},{key:"isCached",value:function isCached(e){return!1}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee29(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:t=r.length>1&&r[1]!==undefined?r[1]:{};if(!this._has(e)){a.next=3;break}return a.abrupt("return",this._get(e,t));case 3:a.next=5;return this._backend.get(e,t);case 5:n=a.sent;t&&t.raw?this._rawCache.set(e,n):this._cache.set(e,n);return a.abrupt("return",n);case 8:case"end":return a.stop()}},_callee29,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"keys",value:function keys(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._backend.keys(e,t)}},{key:"values",value:function values(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._backend.values(e,t)}},{key:"keyStream",value:function keyStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._backend.keyStream(e,t,n)}},{key:"valueStream",value:function valueStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._backend.valueStream(e,t,n)}},{key:"maxValue",value:function maxValue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.maxValue(e)}},{key:"maxKey",value:function maxKey(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.maxKey(e)}},{key:"minKey",value:function minKey(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.minKey(e)}},{key:"minValue",value:function minValue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.minValue(e)}},{key:"count",value:function count(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return this._backend.count(e)}},{key:"_apply",value:function _apply(e){this._applyLocally(e);return this._backend._apply(e)}},{key:"_applyLocally",value:function _applyLocally(e){e._truncated&&this._cache.clear();var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e._removed);!(t=(a=i.next()).done);t=!0){var s=a.value;this._cache["delete"](s)}}catch(_){n=!0;r=_}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}var o=!0,u=!1,c=undefined;try{for(var l,h=(0,_getIterator2["default"])(e._modified);!(o=(l=h.next()).done);o=!0){var f=(0,_slicedToArray2["default"])(l.value,2),d=f[0],A=f[1];this._cache.set(d,A)}}catch(_){u=!0;c=_}finally{try{o||null==h["return"]||h["return"]()}finally{if(u)throw c}}}},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee30(){return _regenerator["default"].wrap(function _callee30$(e){for(;;)switch(e.prev=e.next){case 0:this._cache.clear();return e.abrupt("return",this._backend.truncate());case 2:case"end":return e.stop()}},_callee30,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){return this._backend.index(e)}},{key:"createIndex",value:function createIndex(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this._backend.createIndex(e,t,n)}},{key:"deleteIndex",value:function deleteIndex(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this._backend.deleteIndex(e,t)}},{key:"close",value:function close(){return this._backend.close()}},{key:"applyCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee31(e){var t=this;return _regenerator["default"].wrap(function _callee31$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this._backend.applyCombined(e);case 2:n.t0=n.sent;n.t1=function(){return t._applyLocally(e)};return n.abrupt("return",[n.t0,n.t1]);case 5:case"end":return n.stop()}},_callee31,this)}));return function applyCombined(t){return e.apply(this,arguments)}}()},{key:"isSynchronous",value:function isSynchronous(){return!0}},{key:"decode",value:function decode(e,t){return this._backend.decode(e,t)}},{key:"encode",value:function encode(e){return this._backend.encode(e)}},{key:"connected",get:function get(){return this._backend.connected}},{key:"indices",get:function get(){return this._backend.indices}}]);return CachedBackend}();E.MAX_CACHE_SIZE=5e3;t.register(E);var x=function(){function InMemoryIndex(e,t){var n=arguments.length>2&&arguments[2]!==undefined&&arguments[2],r=arguments.length>3&&arguments[3]!==undefined&&arguments[3];(0,_classCallCheck2["default"])(this,InMemoryIndex);this._objectStore=e;this._keyPath=t;this._multiEntry=n;this._unique=r;this._tree=new l}(0,_createClass2["default"])(InMemoryIndex,[{key:"truncate",value:function truncate(){this._tree=new l}},{key:"_indexKey",value:function _indexKey(e,t){return t===undefined?undefined:this.keyPath?b.byKeyPath(t,this.keyPath):e}},{key:"_insert",value:function _insert(e,t){var n=this._tree;this._multiEntry&&(0,_isArray["default"])(t)||(t=[t]);var r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(t);!(r=(s=o.next()).done);r=!0){var u=s.value;if(n.seek(u)){if(this._unique)throw new Error("Uniqueness constraint violated for key ".concat(e," on path ").concat(this._keyPath));n.currentRecord.add(e)}else n.insert(u,this._unique?e:new w([e],p.compare))}}catch(c){a=!0;i=c}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}}},{key:"put",value:function put(e,t,n){var r=this._indexKey(e,n),a=this._indexKey(e,t);if(!p.equals(r,a)){r!==undefined&&this._remove(e,r);a!==undefined&&this._insert(e,a)}}},{key:"remove",value:function remove(e,t){var n=this._indexKey(e,t);n!==undefined&&this._remove(e,n)}},{key:"_remove",value:function _remove(e,t){var n=this._tree;this._multiEntry&&(0,_isArray["default"])(t)||(t=[t]);var r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(t);!(r=(s=o.next()).done);r=!0){var u=s.value;n.seek(u)&&(!this._unique&&n.currentRecord.length>1?n.currentRecord.remove(e):n.remove(u))}}catch(c){a=!0;i=c}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}}},{key:"_retrieveValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee32(e){var t,n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee32$(u){for(;;)switch(u.prev=u.next){case 0:t=[];n=!0;r=!1;a=undefined;u.prev=4;for(i=(0,_getIterator2["default"])(e);!(n=(s=i.next()).done);n=!0){o=s.value;t.push(this._objectStore.get(o))}u.next=12;break;case 8:u.prev=8;u.t0=u["catch"](4);r=!0;a=u.t0;case 12:u.prev=12;u.prev=13;n||null==i["return"]||i["return"]();case 15:u.prev=15;if(!r){u.next=18;break}throw a;case 18:return u.finish(15);case 19:return u.finish(12);case 20:return u.abrupt("return",_promise["default"].all(t));case 21:case"end":return u.stop()}},_callee32,this,[[4,8,12,20],[13,,15,19]])}));return function _retrieveValues(t){return e.apply(this,arguments)}}()},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee33(){var e,t,n,r=arguments;return _regenerator["default"].wrap(function _callee33$(a){for(;;)switch(a.prev=a.next){case 0:e=r.length>0&&r[0]!==undefined?r[0]:null;t=r.length>1&&r[1]!==undefined?r[1]:null;a.next=4;return this.keys(e,t);case 4:n=a.sent;return a.abrupt("return",this._retrieveValues(n));case 6:case"end":return a.stop()}},_callee33,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee34(){var e,t,n,r=arguments;return _regenerator["default"].wrap(function _callee34$(a){for(;;)switch(a.prev=a.next){case 0:e=r.length>0&&r[0]!==undefined?r[0]:null;t=r.length>1&&r[1]!==undefined?r[1]:null;n=new _set5["default"];if(!(e instanceof B&&e.exactMatch)){a.next=6;break}this._tree.seek(e.lower)&&(n=_set5["default"].from(this._tree.currentRecord));return a.abrupt("return",n.limit(t));case 6:if(e instanceof B){a.next=11;break}if(this._tree.goTop()){a.next=9;break}return a.abrupt("return",n);case 9:a.next=13;break;case 11:if(this._tree.goToLowerBound(e.lower,e.lowerOpen)){a.next=13;break}return a.abrupt("return",n);case 13:if(e instanceof B&&!e.includes(this._tree.currentKey)){a.next=21;break}if(!(null!==t&&n.size>=t)){a.next=16;break}return a.abrupt("break",21);case 16:n=n.union(_set5["default"].from(this._tree.currentRecord));if(this._tree.skip()){a.next=19;break}return a.abrupt("break",21);case 19:a.next=13;break;case 21:return a.abrupt("return",n.limit(t));case 22:case"end":return a.stop()}},_callee34,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"keyStream",value:function keyStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(n instanceof B){if(t){if(!this._tree.goToLowerBound(n.lower,n.lowerOpen))return _promise["default"].resolve()}else if(!this._tree.goToUpperBound(n.upper,n.upperOpen))return _promise["default"].resolve()}else if(t){if(!this._tree.goTop())return _promise["default"].resolve()}else if(!this._tree.goBottom())return _promise["default"].resolve();e:for(;!(n instanceof B)||n.includes(this._tree.currentKey);){if(this._unique){if(!e(this._tree.currentRecord))break}else{var r=this._tree.currentRecord.values();if(t){for(var a=0;a<r.length;a++)if(!e(r[a]))break e}else for(var i=r.length-1;i>=0;i--)if(!e(r[i]))break e}if(!this._tree.skip(t?1:-1))break}return _promise["default"].resolve()}},{key:"valueStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee35(e){var t,n,r,a,i,s=arguments;return _regenerator["default"].wrap(function _callee35$(o){for(;;)switch(o.prev=o.next){case 0:t=!(s.length>1&&s[1]!==undefined)||s[1];if((n=s.length>2&&s[2]!==undefined?s[2]:null)instanceof B){o.next=12;break}if(!t){o.next=8;break}if(this._tree.goTop()){o.next=6;break}return o.abrupt("return");case 6:o.next=10;break;case 8:if(this._tree.goBottom()){o.next=10;break}return o.abrupt("return");case 10:o.next=19;break;case 12:if(!t){o.next=17;break}if(this._tree.goToLowerBound(n.lower,n.lowerOpen)){o.next=15;break}return o.abrupt("return");case 15:o.next=19;break;case 17:if(this._tree.goToUpperBound(n.upper,n.upperOpen)){o.next=19;break}return o.abrupt("return");case 19:if(n instanceof B&&!n.includes(this._tree.currentKey)){o.next=62;break}if(!this._unique){o.next=30;break}o.t0=e;o.next=24;return this._objectStore.get(this._tree.currentRecord);case 24:o.t1=o.sent;o.t2=this._tree.currentRecord;if((0,o.t0)(o.t1,o.t2)){o.next=28;break}return o.abrupt("break",62);case 28:o.next=58;break;case 30:r=this._tree.currentRecord.values();if(!t){o.next=46;break}a=0;case 33:if(!(a<r.length)){o.next=44;break}o.t3=e;o.next=37;return this._objectStore.get(r[a]);case 37:o.t4=o.sent;o.t5=r[a];if((0,o.t3)(o.t4,o.t5)){o.next=41;break}return o.abrupt("break",62);case 41:a++;o.next=33;break;case 44:o.next=58;break;case 46:i=r.length-1;case 47:if(!(i>=0)){o.next=58;break}o.t6=e;o.next=51;return this._objectStore.get(r[i]);case 51:o.t7=o.sent;o.t8=r[i];if((0,o.t6)(o.t7,o.t8)){o.next=55;break}return o.abrupt("break",62);case 55:i--;o.next=47;break;case 58:if(this._tree.skip(t?1:-1)){o.next=60;break}return o.abrupt("break",62);case 60:o.next=19;break;case 62:case"end":return o.stop()}},_callee35,this)}));return function valueStream(t){return e.apply(this,arguments)}}()},{key:"maxValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee36(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee36$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.maxKeys(e);case 3:t=r.sent;return r.abrupt("return",this._retrieveValues(t));case 5:case"end":return r.stop()}},_callee36,this)}));return function maxValues(){return e.apply(this,arguments)}}()},{key:"maxKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee37(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee37$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;t=e instanceof B;if(this._tree.goToUpperBound(t?e.upper:undefined,!!t&&e.upperOpen)){r.next=4;break}return r.abrupt("return",new _set5["default"]);case 4:return r.abrupt("return",_set5["default"].from(this._tree.currentRecord));case 5:case"end":return r.stop()}},_callee37,this)}));return function maxKeys(){return e.apply(this,arguments)}}()},{key:"minValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee38(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee38$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.minKeys(e);case 3:t=r.sent;return r.abrupt("return",this._retrieveValues(t));case 5:case"end":return r.stop()}},_callee38,this)}));return function minValues(){return e.apply(this,arguments)}}()},{key:"minKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee39(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee39$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;t=e instanceof B;if(this._tree.goToLowerBound(t?e.lower:undefined,!!t&&e.lowerOpen)){r.next=4;break}return r.abrupt("return",new _set5["default"]);case 4:return r.abrupt("return",_set5["default"].from(this._tree.currentRecord));case 5:case"end":return r.stop()}},_callee39,this)}));return function minKeys(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee40(){var e,t=arguments;return _regenerator["default"].wrap(function _callee40$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:null;n.next=3;return this.keys(e);case 3:return n.abrupt("return",n.sent.size);case 4:case"end":return n.stop()}},_callee40,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"keyPath",get:function get(){return this._keyPath}},{key:"multiEntry",get:function get(){return this._multiEntry}},{key:"unique",get:function get(){return this._unique}}]);return InMemoryIndex}();t.register(x);var I=function(){function InMemoryBackend(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;(0,_classCallCheck2["default"])(this,InMemoryBackend);this._cache=new _map2["default"];this._indices=new _map2["default"];this._primaryIndex=new x(this,undefined,!1,!0);this._tableName=e;this._codec=t}(0,_createClass2["default"])(InMemoryBackend,[{key:"getSync",value:function getSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},n=this._cache.get(e);return t&&t.raw?n:this.decode(n,e)}},{key:"get",value:function get(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};try{return _promise["default"].resolve(this.getSync(e,t))}catch(n){return _promise["default"].reject(n)}}},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee41(){var e,t,n,r,a,i,s,o,u,c=arguments;return _regenerator["default"].wrap(function _callee41$(l){for(;;)switch(l.prev=l.next){case 0:e=c.length>0&&c[0]!==undefined?c[0]:null;t=c.length>1&&c[1]!==undefined?c[1]:null;if(!(null!==e&&e instanceof O)){l.next=4;break}return l.abrupt("return",e.values(this,t));case 4:n=[];r=!0;a=!1;i=undefined;l.prev=8;l.t0=_getIterator2["default"];l.next=12;return this.keys(e,t);case 12:l.t1=l.sent;s=(0,l.t0)(l.t1);case 14:if(r=(o=s.next()).done){l.next=24;break}u=o.value;l.t2=n;l.next=19;return this.get(u);case 19:l.t3=l.sent;l.t2.push.call(l.t2,l.t3);case 21:r=!0;l.next=14;break;case 24:l.next=30;break;case 26:l.prev=26;l.t4=l["catch"](8);a=!0;i=l.t4;case 30:l.prev=30;l.prev=31;r||null==s["return"]||s["return"]();case 33:l.prev=33;if(!a){l.next=36;break}throw i;case 36:return l.finish(33);case 37:return l.finish(30);case 38:return l.abrupt("return",_promise["default"].resolve(n));case 39:case"end":return l.stop()}},_callee41,this,[[8,26,30,38],[31,,33,37]])}));return function values(){return e.apply(this,arguments)}}()},{key:"keys",value:function keys(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return null!==e&&e instanceof O?e.keys(this,t):this._primaryIndex.keys(e,t)}},{key:"keyStream",value:function keyStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._primaryIndex.keyStream(e,t,n)}},{key:"valueStream",value:function valueStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._primaryIndex.valueStream(e,t,n)}},{key:"maxValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee42(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee42$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.maxKey(e);case 3:t=r.sent;return r.abrupt("return",this.get(t));case 5:case"end":return r.stop()}},_callee42,this)}));return function maxValue(){return e.apply(this,arguments)}}()},{key:"maxKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee43(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee43$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this._primaryIndex.maxKeys(e);case 3:t=r.sent;return r.abrupt("return",_set5["default"].sampleElement(t));case 5:case"end":return r.stop()}},_callee43,this)}));return function maxKey(){return e.apply(this,arguments)}}()},{key:"minValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee44(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee44$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.minKey(e);case 3:t=r.sent;return r.abrupt("return",this.get(t));case 5:case"end":return r.stop()}},_callee44,this)}));return function minValue(){return e.apply(this,arguments)}}()},{key:"minKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee45(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee45$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this._primaryIndex.minKeys(e);case 3:t=r.sent;return r.abrupt("return",_set5["default"].sampleElement(t));case 5:case"end":return r.stop()}},_callee45,this)}));return function minKey(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee46(){var e,t=arguments;return _regenerator["default"].wrap(function _callee46$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:null;n.next=3;return this.keys(e);case 3:return n.abrupt("return",n.sent.size);case 4:case"end":return n.stop()}},_callee46,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){return this._indices.get(e)}},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee47(e){var t,n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,b,w;return _regenerator["default"].wrap(function _callee47$(C){for(;;)switch(C.prev=C.next){case 0:e._truncated&&this.truncateSync();t=new _map2["default"];n=!0;r=!1;a=undefined;C.prev=5;for(i=(0,_getIterator2["default"])(e._removed);!(n=(s=i.next()).done);n=!0){o=s.value;(u=this.getSync(o))&&t.set(o,u);this._cache["delete"](o)}C.next=13;break;case 9:C.prev=9;C.t0=C["catch"](5);r=!0;a=C.t0;case 13:C.prev=13;C.prev=14;n||null==i["return"]||i["return"]();case 16:C.prev=16;if(!r){C.next=19;break}throw a;case 19:return C.finish(16);case 20:return C.finish(13);case 21:c=!0;l=!1;h=undefined;C.prev=24;for(f=(0,_getIterator2["default"])(e._modified);!(c=(d=f.next()).done);c=!0){A=(0,_slicedToArray2["default"])(d.value,2),_=A[0],p=A[1];(g=this.getSync(_))&&t.set(_,g);this._cache.set(_,this.encode(p))}C.next=32;break;case 28:C.prev=28;C.t1=C["catch"](24);l=!0;h=C.t1;case 32:C.prev=32;C.prev=33;c||null==f["return"]||f["return"]();case 35:C.prev=35;if(!l){C.next=38;break}throw h;case 38:return C.finish(35);case 39:return C.finish(32);case 40:InMemoryBackend._indexApply(this._primaryIndex,e,t);y=!0;v=!1;k=undefined;C.prev=44;for(m=(0,_getIterator2["default"])(this._indices.values());!(y=(b=m.next()).done);y=!0){w=b.value;InMemoryBackend._indexApply(w,e,t)}C.next=52;break;case 48:C.prev=48;C.t2=C["catch"](44);v=!0;k=C.t2;case 52:C.prev=52;C.prev=53;y||null==m["return"]||m["return"]();case 55:C.prev=55;if(!v){C.next=58;break}throw k;case 58:return C.finish(55);case 59:return C.finish(52);case 60:case"end":return C.stop()}},_callee47,this,[[5,9,13,21],[14,,16,20],[24,28,32,40],[33,,35,39],[44,48,52,60],[53,,55,59]])}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee48(){return _regenerator["default"].wrap(function _callee48$(e){for(;;)switch(e.prev=e.next){case 0:this.truncateSync();case 1:case"end":return e.stop()}},_callee48,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"truncateSync",value:function truncateSync(){this._cache.clear();this._primaryIndex.truncate();var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._indices.values());!(e=(r=a.next()).done);e=!0){r.value.truncate()}}catch(i){t=!0;n=i}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}}},{key:"map",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee49(e){var t,n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee49$(c){for(;;)switch(c.prev=c.next){case 0:t=!0;n=!1;r=undefined;c.prev=3;for(a=(0,_getIterator2["default"])(this._cache);!(t=(i=a.next()).done);t=!0){s=(0,_slicedToArray2["default"])(i.value,2),o=s[0],u=s[1];e(o,u)}c.next=11;break;case 7:c.prev=7;c.t0=c["catch"](3);n=!0;r=c.t0;case 11:c.prev=11;c.prev=12;t||null==a["return"]||a["return"]();case 14:c.prev=14;if(!n){c.next=17;break}throw r;case 17:return c.finish(14);case 18:return c.finish(11);case 19:case"end":return c.stop()}},_callee49,this,[[3,7,11,19],[12,,14,18]])}));return function map(t){return e.apply(this,arguments)}}()},{key:"createIndex",value:function createIndex(e,t){var n=(arguments.length>2&&arguments[2]!==undefined?arguments[2]:{})||{},r=n.multiEntry,a=void 0!==r&&r,i=n.unique,s=void 0!==i&&i,o=(n.upgradeCondition,new x(this,t=t||e,a,s));this._indices.set(e,o)}},{key:"deleteIndex",value:function deleteIndex(e){((arguments.length>1&&arguments[1]!==undefined?arguments[1]:{})||{}).upgradeCondition;this._indices["delete"](e)}},{key:"decode",value:function decode(e,t){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.decode(e,t):e}},{key:"encode",value:function encode(e){return e===undefined?undefined:null!==this._codec&&this._codec!==undefined?this._codec.encode(e):e}},{key:"applyCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee50(e){var t=this;return _regenerator["default"].wrap(function _callee50$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",function(){return t._apply(e)});case 1:case"end":return n.stop()}},_callee50)}));return function applyCombined(t){return e.apply(this,arguments)}}()},{key:"isSynchronous",value:function isSynchronous(){return!0}},{key:"isCached",value:function isCached(e){return!0}},{key:"connected",get:function get(){return!0}},{key:"indices",get:function get(){return this._indices}},{key:"tableName",get:function get(){return this._tableName}}],[{key:"_indexApply",value:function _indexApply(e,t,n){t._truncated&&e.truncate();var r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(t._removed);!(r=(s=o.next()).done);r=!0){var u=s.value;e.remove(u,n.get(u))}}catch(g){a=!0;i=g}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}var c=!0,l=!1,h=undefined;try{for(var f,d=(0,_getIterator2["default"])(t._modified);!(c=(f=d.next()).done);c=!0){var A=(0,_slicedToArray2["default"])(f.value,2),_=A[0],p=A[1];e.put(_,p,n.get(_))}}catch(g){l=!0;h=g}finally{try{c||null==d["return"]||d["return"]()}finally{if(l)throw h}}}}]);return InMemoryBackend}();t.register(I);var B=function(){function KeyRange(e,t,n,r){(0,_classCallCheck2["default"])(this,KeyRange);this._lower=e;this._upper=t;this._lowerOpen=n;this._upperOpen=r}(0,_createClass2["default"])(KeyRange,[{key:"includes",value:function includes(e){return(this._lower===undefined||p.compare(this._lower,e)<0||!this._lowerOpen&&p.equals(this._lower,e))&&(this._upper===undefined||p.compare(this._upper,e)>0||!this._upperOpen&&p.equals(this._upper,e))}},{key:"lower",get:function get(){return this._lower}},{key:"upper",get:function get(){return this._upper}},{key:"lowerOpen",get:function get(){return this._lowerOpen}},{key:"upperOpen",get:function get(){return this._upperOpen}},{key:"exactMatch",get:function get(){return this._lower===this._upper&&!this._lowerOpen&&!this.upperOpen}}],[{key:"upperBound",value:function upperBound(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return new KeyRange(undefined,e,!1,t)}},{key:"lowerBound",value:function lowerBound(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return new KeyRange(e,undefined,t,!1)}},{key:"bound",value:function bound(e,t){return new KeyRange(e,t,arguments.length>2&&arguments[2]!==undefined&&arguments[2],arguments.length>3&&arguments[3]!==undefined&&arguments[3])}},{key:"only",value:function only(e){return new KeyRange(e,e,!1,!1)}}]);return KeyRange}();t.register(B);var P=function(){function ObjectStore(e,t,n){(0,_classCallCheck2["default"])(this,ObjectStore);this._backend=e;this._db=t;this._name=n;this._stateStack=[];this._backendInfo=new N(this._backend,null);this._transactions=new _map2["default"];this._transactions.set(ObjectStore.BACKEND_ID,this._backendInfo);this._snapshotManager=new U;this._synchronizer=new C}(0,_createClass2["default"])(ObjectStore,[{key:"get",value:function get(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.get(e,t)}},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee51(e,t){var n;return _regenerator["default"].wrap(function _callee51$(r){for(;;)switch(r.prev=r.next){case 0:if(this._backend.connected){r.next=2;break}throw new Error("JungleDB is not connected");case 2:n=this.transaction();r.prev=3;r.next=6;return n.put(e,t);case 6:r.next=13;break;case 8:r.prev=8;r.t0=r["catch"](3);r.next=12;return n.abort();case 12:throw r.t0;case 13:return r.abrupt("return",n.commit());case 14:case"end":return r.stop()}},_callee51,this,[[3,8]])}));return function put(t,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee52(e){var t;return _regenerator["default"].wrap(function _callee52$(n){for(;;)switch(n.prev=n.next){case 0:if(this._backend.connected){n.next=2;break}throw new Error("JungleDB is not connected");case 2:t=this.transaction();n.prev=3;n.next=6;return t.remove(e);case 6:n.next=13;break;case 8:n.prev=8;n.t0=n["catch"](3);n.next=12;return t.abort();case 12:throw n.t0;case 13:return n.abrupt("return",t.commit());case 14:case"end":return n.stop()}},_callee52,this,[[3,8]])}));return function remove(t){return e.apply(this,arguments)}}()},{key:"getSync",value:function getSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!this._currentState.isSynchronous())throw new Error("Only works on synchronous backends");return this._currentState.getSync(e,t)}},{key:"isCached",value:function isCached(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!this._currentState.isSynchronous())throw new Error("Only works on synchronous backends");return this._currentState.isCached(e)}},{key:"keys",value:function keys(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return null!==e&&e instanceof O?e.keys(this._currentState,t):this._currentState.keys(e,t)}},{key:"values",value:function values(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return null!==e&&e instanceof O?e.values(this._currentState,t):this._currentState.values(e,t)}},{key:"keyStream",value:function keyStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._currentState.keyStream(e,t,n)}},{key:"valueStream",value:function valueStream(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this._currentState.valueStream(e,t,n)}},{key:"maxValue",value:function maxValue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.maxValue(e)}},{key:"maxKey",value:function maxKey(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.maxKey(e)}},{key:"minKey",value:function minKey(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.minKey(e)}},{key:"minValue",value:function minValue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.minValue(e)}},{key:"count",value:function count(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.count(e)}},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee53(e){return _regenerator["default"].wrap(function _callee53$(t){for(;;)switch(t.prev=t.next){case 0:if(this._isCommittable(e)){t.next=4;break}t.next=3;return this.abort(e);case 3:return t.abrupt("return",!1);case 4:t.next=6;return this._commitInternal(e);case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}},_callee53,this)}));return function commit(t){return e.apply(this,arguments)}}()},{key:"_isCommittable",value:function _isCommittable(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");if(!(e instanceof M&&e.state===M.STATE.OPEN&&this._transactions.has(e.id)))throw new Error("Can only commit open transactions");return this._transactions.get(e.id).isCommittable()}},{key:"_commitBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee54(){return _regenerator["default"].wrap(function _callee54$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit object stores");case 1:case"end":return e.stop()}},_callee54)}));return function _commitBackend(){return e.apply(this,arguments)}}()},{key:"_commitInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee55(e){var t;return _regenerator["default"].wrap(function _callee55$(n){for(;;)switch(n.prev=n.next){case 0:t=this._transactions.get(e.id);if(!(this._stateStack.length>=ObjectStore.MAX_STACK_SIZE)){n.next=4;break}y.e(ObjectStore,"Transaction stack size exceeded ".concat(this.toStringFull()));throw new Error("Transaction stack size exceeded");case 4:this._stateStack.push(t);t.close();if(!t.isFlushable()){n.next=9;break}n.next=9;return this._flattenState(e);case 9:case"end":return n.stop()}},_callee55,this)}));return function _commitInternal(t){return e.apply(this,arguments)}}()},{key:"_setParent",value:function _setParent(e){throw new Error("Unsupported operation")}},{key:"abort",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee56(e){var t;return _regenerator["default"].wrap(function _callee56$(n){for(;;)switch(n.prev=n.next){case 0:if(this._backend.connected){n.next=2;break}throw new Error("JungleDB is not connected");case 2:if(!(e instanceof D)){n.next=4;break}return n.abrupt("return",this._snapshotManager.abortSnapshot(e));case 4:if(e instanceof M&&e.state===M.STATE.OPEN&&this._transactions.has(e.id)){n.next=6;break}throw new Error("Can only abort open transactions");case 6:(t=this._transactions.get(e.id)).abort();if(!t.parent||0!==t.parent.numOpenChildren){n.next=11;break}n.next=11;return this._flattenState();case 11:this._transactions["delete"](e.id);return n.abrupt("return",!0);case 13:case"end":return n.stop()}},_callee56,this)}));return function abort(t){return e.apply(this,arguments)}}()},{key:"_flattenState",value:function _flattenState(e){var t=this;return this._synchronizer.push(function(){return t._flattenStateInternal(e)})}},{key:"_flattenStateInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee57(e){var t,n,r,a,i=this;return _regenerator["default"].wrap(function _callee57$(s){for(;;)switch(s.prev=s.next){case 0:if(!(e&&e instanceof M)){s.next=32;break}if((t=this._transactions.get(e.id)).isFlushable()){s.next=4;break}return s.abrupt("return",!1);case 4:n=t.parent.transaction;r=function cleanup(){t.flush();i._transactions["delete"](e.id);var n=i._stateStack.indexOf(t);n>=0&&i._stateStack.splice(n,1);i._flattenState()["catch"](y.w.tag(ObjectStore))};if(null!==e.dependency){s.next=27;break}if(!t.parent.isBackend()){s.next=10;break}s.next=10;return this._snapshotManager.applyTx(e,n);case 10:s.prev=10;s.next=13;return n._apply(e);case 13:s.next=23;break;case 15:s.prev=15;s.t0=s["catch"](10);t.abort();this._transactions["delete"](e.id);(a=this._stateStack.indexOf(t))>=0&&this._stateStack.splice(a,1);e._setAborted();y.e(ObjectStore,"Error while applying transaction",s.t0);case 23:r();return s.abrupt("return",!0);case 27:s.next=29;return e.dependency.onFlushable(e,r,function(){return i._snapshotManager.applyTx(e,n)});case 29:return s.abrupt("return",s.sent);case 30:s.next=47;break;case 32:if(!(this._stateStack.length>0)){s.next=39;break}s.next=35;return this._flattenStateInternal(this._currentState);case 35:if(s.sent){s.next=37;break}return s.abrupt("break",39);case 37:s.next=32;break;case 39:if(!(this._stateStack.length>0)){s.next=46;break}s.next=42;return this._flattenStateInternal(this._stateStack[0].transaction);case 42:if(s.sent){s.next=44;break}return s.abrupt("break",46);case 44:s.next=39;break;case 46:return s.abrupt("return",!1);case 47:case"end":return s.stop()}},_callee57,this,[[10,15]])}));return function _flattenStateInternal(t){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.index(e)}},{key:"createIndex",value:function createIndex(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this._backend.createIndex(e,t,n)}},{key:"deleteIndex",value:function deleteIndex(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this._backend.deleteIndex(e,t)}},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(!this._backend.connected)throw new Error("JungleDB is not connected");if(this._backend.isSynchronous())return this.synchronousTransaction(e);var t=new M(this,this._currentState,this,e);this._transactions.set(t.id,new N(t,this._currentStateInfo));return t}},{key:"synchronousTransaction",value:function synchronousTransaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(!this._backend.connected)throw new Error("JungleDB is not connected");var t=new L(this,this._currentState,this,e);this._transactions.set(t.id,new N(t,this._currentStateInfo));return t}},{key:"isSynchronous",value:function isSynchronous(){return this._backend.isSynchronous()}},{key:"snapshot",value:function snapshot(){return this._currentStateId!==ObjectStore.BACKEND_ID?this._currentState.snapshot():this._snapshotManager.createSnapshot(this,this._currentState)}},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee58(e){return _regenerator["default"].wrap(function _callee58$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unsupported operation");case 1:case"end":return e.stop()}},_callee58)}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee59(){var e;return _regenerator["default"].wrap(function _callee59$(t){for(;;)switch(t.prev=t.next){case 0:if(this._backend.connected){t.next=2;break}throw new Error("JungleDB is not connected");case 2:e=this.transaction();t.next=5;return e.truncate();case 5:return t.abrupt("return",e.commit());case 6:case"end":return t.stop()}},_callee59,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"close",value:function close(){if(this._stateStack.length>0)throw new Error("Cannot close database while transactions are active");return this._backend.close()}},{key:"decode",value:function decode(e,t){return this._backend.decode(e,t)}},{key:"encode",value:function encode(e){return this._backend.encode(e)}},{key:"toStringFull",value:function toStringFull(){return"ObjectStore{\n    stack=[".concat(this._stateStack.map(function(e){return"{tx=".concat(e,", open=").concat(e.numOpenChildren,"}")}),"],\n    db=").concat(this._db,"/").concat(this._name?this._name:"unnamed","\n}")}},{key:"toString",value:function toString(){return"ObjectStore{stackSize=".concat(this._stateStack.length,", db=").concat(this._db,"/").concat(this._name?this._name:"unnamed","}")}},{key:"jungleDB",get:function get(){return this._db}},{key:"connected",get:function get(){return this._backend.connected}},{key:"_currentState",get:function get(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].transaction:this._backend}},{key:"_currentStateInfo",get:function get(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1]:this._backendInfo}},{key:"_currentStateId",get:function get(){return this._stateStack.length>0?this._stateStack[this._stateStack.length-1].id:ObjectStore.BACKEND_ID}},{key:"indices",get:function get(){if(!this._backend.connected)throw new Error("JungleDB is not connected");return this._currentState.indices}}]);return ObjectStore}();P.MAX_STACK_SIZE=10;P.BACKEND_ID="backend";t.register(P);var N=function(){function TransactionInfo(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];(0,_classCallCheck2["default"])(this,TransactionInfo);this.transaction=e;this.children=n;this._parentInfo=t;this._open=!0;this._parentInfo&&this._parentInfo.addChild(this)}(0,_createClass2["default"])(TransactionInfo,[{key:"addChild",value:function addChild(e){this.children.push(e)}},{key:"removeChild",value:function removeChild(e){var t=this.children.indexOf(e);t>=0&&this.children.splice(t,1)}},{key:"flush",value:function flush(){if(!this.isBackend()){var e=this.parent;this.parent.removeChild(this);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this.children.slice());!(t=(a=i.next()).done);t=!0){a.value.parent=e}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}this.children=[];this._parentInfo=null}}},{key:"abort",value:function abort(){this.isBackend()||this.parent.removeChild(this)}},{key:"close",value:function close(){this._open=!1}},{key:"isBackend",value:function isBackend(){return null===this._parentInfo}},{key:"isOpen",value:function isOpen(){return this._open}},{key:"isCommittable",value:function isCommittable(){return this._parentInfo&&this._parentInfo.children.every(function(e){return e.isOpen()})}},{key:"isFlushable",value:function isFlushable(){return this.parent&&0===this.parent.numOpenChildren&&(null===this.transaction.dependency||this.parent.isBackend())}},{key:"toString",value:function toString(){return this.transaction.toStringShort()}},{key:"parent",get:function get(){return this._parentInfo},set:function set(e){this.parent.removeChild(this);this._parentInfo=e;this.parent.addChild(this);this.transaction._setParent(e.transaction)}},{key:"id",get:function get(){return this.isBackend()?P.BACKEND_ID:this.transaction.id}},{key:"numOpenChildren",get:function get(){return this.children.filter(function(e){return e.isOpen()}).length}}]);return TransactionInfo}(),O=function(){(0,_createClass2["default"])(Query,null,[{key:"_parseKeyRange",value:function _parseKeyRange(e,t,n){switch(e){case Query.OPERATORS.GT:return B.lowerBound(t,!0);case Query.OPERATORS.GE:return B.lowerBound(t,!1);case Query.OPERATORS.LT:return B.upperBound(t,!0);case Query.OPERATORS.LE:return B.upperBound(t,!1);case Query.OPERATORS.EQ:return B.only(t);case Query.OPERATORS.BETWEEN:return B.bound(t,n,!0,!0);case Query.OPERATORS.WITHIN:return B.bound(t,n,!1,!1)}y.e("Unknown operator: ".concat(e));throw new Error("Unknown operator")}},{key:"and",value:function and(e){return new Query((0,_from["default"])(arguments),Query.OPERATORS.AND)}},{key:"or",value:function or(e){return new Query((0,_from["default"])(arguments),Query.OPERATORS.OR)}},{key:"max",value:function max(e){return new Query(e,Query.OPERATORS.MAX)}},{key:"min",value:function min(e){return new Query(e,Query.OPERATORS.MIN)}},{key:"lt",value:function lt(e,t){return new Query(e,Query.OPERATORS.LT,t)}},{key:"le",value:function le(e,t){return new Query(e,Query.OPERATORS.LE,t)}},{key:"gt",value:function gt(e,t){return new Query(e,Query.OPERATORS.GT,t)}},{key:"ge",value:function ge(e,t){return new Query(e,Query.OPERATORS.GE,t)}},{key:"eq",value:function eq(e,t){return new Query(e,Query.OPERATORS.EQ,t)}},{key:"between",value:function between(e,t,n){return new Query(e,Query.OPERATORS.BETWEEN,t,n)}},{key:"within",value:function within(e,t,n){return new Query(e,Query.OPERATORS.WITHIN,t,n)}}]);function Query(e,t,n,r){(0,_classCallCheck2["default"])(this,Query);if((0,_isArray["default"])(e)){if(e.some(function(e){return!(e instanceof Query)}))throw new Error("Invalid query");if(Query.COMBINED_OPERATORS.indexOf(t)<0)throw new Error("Unknown operator");this._queryType=Query.Type.COMBINED;this._queries=e;this._op=t}else{if(Query.RANGE_OPERATORS.indexOf(t)>=0){this._queryType=Query.Type.RANGE;this._keyRange=Query._parseKeyRange(t,n,r)}else{if(!(Query.ADVANCED_OPERATORS.indexOf(t)>=0))throw new Error("Unknown operator");this._queryType=Query.Type.ADVANCED;this._op=t}this._indexName=e}}(0,_createClass2["default"])(Query,[{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee60(e){var t,n,r,a,i,s,o,u,c,l=arguments;return _regenerator["default"].wrap(function _callee60$(h){for(;;)switch(h.prev=h.next){case 0:t=l.length>1&&l[1]!==undefined?l[1]:null;h.next=3;return this._execute(e,t);case 3:n=h.sent;r=[];a=!0;i=!1;s=undefined;h.prev=8;for(o=(0,_getIterator2["default"])(n);!(a=(u=o.next()).done);a=!0){c=u.value;r.push(e.get(c))}h.next=16;break;case 12:h.prev=12;h.t0=h["catch"](8);i=!0;s=h.t0;case 16:h.prev=16;h.prev=17;a||null==o["return"]||o["return"]();case 19:h.prev=19;if(!i){h.next=22;break}throw s;case 22:return h.finish(19);case 23:return h.finish(16);case 24:return h.abrupt("return",_promise["default"].all(r));case 25:case"end":return h.stop()}},_callee60,this,[[8,12,16,24],[17,,19,23]])}));return function values(t){return e.apply(this,arguments)}}()},{key:"keys",value:function keys(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._execute(e,t)}},{key:"_execute",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee61(e){var t,n=arguments;return _regenerator["default"].wrap(function _callee61$(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&n[1]!==undefined?n[1]:null;r.t0=this._queryType;r.next=r.t0===Query.Type.COMBINED?4:r.t0===Query.Type.ADVANCED?5:r.t0===Query.Type.RANGE?6:7;break;case 4:return r.abrupt("return",_promise["default"].resolve(this._executeCombined(e,t)));case 5:return r.abrupt("return",_promise["default"].resolve(this._executeAdvanced(e,t)));case 6:return r.abrupt("return",this._executeRange(e,t));case 7:return r.abrupt("return",_promise["default"].resolve(new _set5["default"]));case 8:case"end":return r.stop()}},_callee61,this)}));return function _execute(t){return e.apply(this,arguments)}}()},{key:"_executeCombined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee62(e){var t,n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,b,w,C,S,T,E,x,I,B,P,N,O=arguments;return _regenerator["default"].wrap(function _callee62$(R){for(;;)switch(R.prev=R.next){case 0:t=O.length>1&&O[1]!==undefined?O[1]:null;n=[];r=!0;a=!1;i=undefined;R.prev=5;for(s=(0,_getIterator2["default"])(this._queries);!(r=(o=s.next()).done);r=!0){u=o.value;n.push(u._execute(e,t))}R.next=13;break;case 9:R.prev=9;R.t0=R["catch"](5);a=!0;i=R.t0;case 13:R.prev=13;R.prev=14;r||null==s["return"]||s["return"]();case 16:R.prev=16;if(!a){R.next=19;break}throw i;case 19:return R.finish(16);case 20:return R.finish(13);case 21:R.next=23;return _promise["default"].all(n);case 23:c=R.sent;if(this._op!==Query.OPERATORS.AND){R.next=66;break}if(0!==c.length){R.next=29;break}return R.abrupt("return",new _set5["default"]);case 29:if(1!==c.length){R.next=33;break}if(!(null===t||t>=1)){R.next=32;break}return R.abrupt("return",c[0]);case 32:return R.abrupt("return",new _set5["default"]);case 33:l=c.shift();h=new _set5["default"];f=0;d=!0;A=!1;_=undefined;R.prev=39;p=function _loop(){var e=y.value;if(c.every(function(t){return t.has(e)})){if(null!==t&&f>=t)return"break";h.add(e);f++}};g=(0,_getIterator2["default"])(l);case 42:if(d=(y=g.next()).done){R.next=49;break}if("break"!==p()){R.next=46;break}return R.abrupt("break",49);case 46:d=!0;R.next=42;break;case 49:R.next=55;break;case 51:R.prev=51;R.t1=R["catch"](39);A=!0;_=R.t1;case 55:R.prev=55;R.prev=56;d||null==g["return"]||g["return"]();case 58:R.prev=58;if(!A){R.next=61;break}throw _;case 61:return R.finish(58);case 62:return R.finish(55);case 63:return R.abrupt("return",h);case 66:if(this._op!==Query.OPERATORS.OR){R.next=124;break}v=new _set5["default"];k=0;m=!0;b=!1;w=undefined;R.prev=72;C=(0,_getIterator2["default"])(c);case 74:if(m=(S=C.next()).done){R.next=109;break}T=S.value;E=!0;x=!1;I=undefined;R.prev=79;B=(0,_getIterator2["default"])(T);case 81:if(E=(P=B.next()).done){R.next=90;break}N=P.value;if(!(null!==t&&k>=t)){R.next=85;break}return R.abrupt("break",90);case 85:v.add(N);k++;case 87:E=!0;R.next=81;break;case 90:R.next=96;break;case 92:R.prev=92;R.t2=R["catch"](79);x=!0;I=R.t2;case 96:R.prev=96;R.prev=97;E||null==B["return"]||B["return"]();case 99:R.prev=99;if(!x){R.next=102;break}throw I;case 102:return R.finish(99);case 103:return R.finish(96);case 104:if(!(null!==t&&k>=t)){R.next=106;break}return R.abrupt("break",109);case 106:m=!0;R.next=74;break;case 109:R.next=115;break;case 111:R.prev=111;R.t3=R["catch"](72);b=!0;w=R.t3;case 115:R.prev=115;R.prev=116;m||null==C["return"]||C["return"]();case 118:R.prev=118;if(!b){R.next=121;break}throw w;case 121:return R.finish(118);case 122:return R.finish(115);case 123:return R.abrupt("return",v);case 124:return R.abrupt("return",new _set5["default"]);case 125:case"end":return R.stop()}},_callee62,this,[[5,9,13,21],[14,,16,20],[39,51,55,63],[56,,58,62],[72,111,115,123],[79,92,96,104],[97,,99,103],[116,,118,122]])}));return function _executeCombined(t){return e.apply(this,arguments)}}()},{key:"_executeAdvanced",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee63(e){var t,n,r,a=arguments;return _regenerator["default"].wrap(function _callee63$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined?a[1]:null;n=e.index(this._indexName);r=new _set5["default"];i.t0=this._op;i.next=i.t0===Query.OPERATORS.MAX?6:i.t0===Query.OPERATORS.MIN?10:14;break;case 6:i.next=8;return n.maxKeys();case 8:r=i.sent;return i.abrupt("break",14);case 10:i.next=12;return n.minKeys();case 12:r=i.sent;return i.abrupt("break",14);case 14:return i.abrupt("return",new _set5["default"](r.limit(t)));case 15:case"end":return i.stop()}},_callee63,this)}));return function _executeAdvanced(t){return e.apply(this,arguments)}}()},{key:"_executeRange",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee64(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee64$(a){for(;;)switch(a.prev=a.next){case 0:t=r.length>1&&r[1]!==undefined?r[1]:null;n=e.index(this._indexName);a.t0=_set5["default"];a.next=5;return n.keys(this._keyRange,t);case 5:a.t1=a.sent;return a.abrupt("return",new a.t0(a.t1));case 7:case"end":return a.stop()}},_callee64,this)}));return function _executeRange(t){return e.apply(this,arguments)}}()}]);return Query}();O.OPERATORS={GT:0,GE:1,LT:2,LE:3,EQ:4,BETWEEN:7,WITHIN:8,MAX:9,MIN:10,AND:11,OR:12};O.RANGE_OPERATORS=[O.OPERATORS.GT,O.OPERATORS.GE,O.OPERATORS.LT,O.OPERATORS.LE,O.OPERATORS.EQ,O.OPERATORS.BETWEEN,O.OPERATORS.WITHIN];O.ADVANCED_OPERATORS=[O.OPERATORS.MAX,O.OPERATORS.MIN];O.COMBINED_OPERATORS=[O.OPERATORS.AND,O.OPERATORS.OR];O.Type={RANGE:0,ADVANCED:1,COMBINED:2};t.register(O);var R=function(e){(0,_inherits2["default"])(TransactionIndex,e);var t=_createSuper(TransactionIndex);(0,_createClass2["default"])(TransactionIndex,[{key:"_index",get:function get(){return this._backend.index(this._databaseDir)}}],[{key:"derive",value:function derive(e,t){var n=new _map2["default"],r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(t.indices);!(r=(s=o.next()).done);r=!0){var u=(0,_slicedToArray2["default"])(s.value,2),c=u[0],l=u[1];n.set(c,new TransactionIndex(e,t,c,l.keyPath,l.multiEntry,l.unique))}}catch(h){a=!0;i=h}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}return n}}]);function TransactionIndex(e,n,r,a){var i,s=arguments.length>4&&arguments[4]!==undefined&&arguments[4],o=arguments.length>5&&arguments[5]!==undefined&&arguments[5];(0,_classCallCheck2["default"])(this,TransactionIndex);(i=t.call(this,e,a,s,o))._backend=n;i._databaseDir=r;return i}(0,_createClass2["default"])(TransactionIndex,[{key:"checkUniqueConstraint",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee65(e,t){var n,r,a,i,s,o,u,c,l=arguments;return _regenerator["default"].wrap(function _callee65$(h){for(;;)switch(h.prev=h.next){case 0:n=!(l.length>2&&l[2]!==undefined)||l[2];if(this.unique){h.next=3;break}return h.abrupt("return");case 3:if((r=this._indexKey(e,t))===undefined){h.next=35;break}this.multiEntry&&(0,_isArray["default"])(r)||(r=[r]);a=!0;i=!1;s=undefined;h.prev=9;o=(0,_getIterator2["default"])(r);case 11:if(a=(u=o.next()).done){h.next=21;break}c=u.value;h.next=15;return this.count(B.only(c));case 15:if(!(h.sent>(n?1:0))){h.next=18;break}throw new Error("Uniqueness constraint violated for key ".concat(c," on path ").concat(this._keyPath));case 18:a=!0;h.next=11;break;case 21:h.next=27;break;case 23:h.prev=23;h.t0=h["catch"](9);i=!0;s=h.t0;case 27:h.prev=27;h.prev=28;a||null==o["return"]||o["return"]();case 30:h.prev=30;if(!i){h.next=33;break}throw s;case 33:return h.finish(30);case 34:return h.finish(27);case 35:case"end":return h.stop()}},_callee65,this,[[9,23,27,35],[28,,30,34]])}));return function checkUniqueConstraint(t,n){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee66(){var e,t,n,r,a,i,s,o=arguments;return _regenerator["default"].wrap(function _callee66$(u){for(;;)switch(u.prev=u.next){case 0:e=o.length>0&&o[0]!==undefined?o[0]:null;t=o.length>1&&o[1]!==undefined?o[1]:null;n=[];this._objectStore._truncated?n.push(new _set5["default"]):n.push(this._index.keys(e,t));n.push(x.prototype.keys.call(this,e,t));u.next=7;return _promise["default"].all(n);case 7:r=u.sent;a=(0,_slicedToArray2["default"])(r,2);i=a[0];s=a[1];i=(i=i.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());return u.abrupt("return",i.union(s).limit(t));case 14:case"end":return u.stop()}},_callee66,this)}));return function keys(){return e.apply(this,arguments)}}()},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee67(){var e,t,n,r=arguments;return _regenerator["default"].wrap(function _callee67$(a){for(;;)switch(a.prev=a.next){case 0:e=r.length>0&&r[0]!==undefined?r[0]:null;t=r.length>1&&r[1]!==undefined?r[1]:null;a.next=4;return this.keys(e,t);case 4:n=a.sent;return a.abrupt("return",x.prototype._retrieveValues.call(this,n));case 6:case"end":return a.stop()}},_callee67,this)}));return function values(){return e.apply(this,arguments)}}()},{key:"maxValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee68(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee68$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.maxKeys(e);case 3:t=r.sent;return r.abrupt("return",x.prototype._retrieveValues.call(this,t));case 5:case"end":return r.stop()}},_callee68,this)}));return function maxValues(){return e.apply(this,arguments)}}()},{key:"maxKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee69(){var e,t,n,r,a,i,s,o,u,c,l=arguments;return _regenerator["default"].wrap(function _callee69$(h){for(;;)switch(h.prev=h.next){case 0:e=l.length>0&&l[0]!==undefined?l[0]:null;if(!this._objectStore._truncated){h.next=5;break}t=new _set5["default"];h.next=8;break;case 5:h.next=7;return this._index.maxKeys(e);case 7:t=h.sent;case 8:n=_set5["default"].sampleElement(t);r=undefined,a=undefined;if(n===undefined){h.next=15;break}h.next=13;return this._backend.get(n);case 13:r=h.sent;a=b.byKeyPath(r,this.keyPath);case 15:t=(t=t.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());case 17:if(n===undefined||0!==t.size){h.next=35;break}i=B.upperBound(a,!0);h.next=21;return this._index.maxKeys(i);case 21:t=h.sent;if((n=_set5["default"].sampleElement(t))===undefined){h.next=28;break}h.next=26;return this._backend.get(n);case 26:r=h.sent;a=b.byKeyPath(r,this.keyPath);case 28:t=(t=t.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());if(!a||null===e||e.includes(a)){h.next=33;break}t=new _set5["default"];return h.abrupt("break",35);case 33:h.next=17;break;case 35:h.next=37;return x.prototype.maxKeys.call(this,e);case 37:s=h.sent;if(0!==t.size){h.next=42;break}return h.abrupt("return",s);case 42:if(0!==s.size){h.next=44;break}return h.abrupt("return",t);case 44:h.next=46;return this._objectStore.get(_set5["default"].sampleElement(s));case 46:o=h.sent;u=a;c=b.byKeyPath(o,this.keyPath);if(!(p.compare(u,c)>0)){h.next=53;break}return h.abrupt("return",t);case 53:if(!(p.compare(u,c)<0)){h.next=55;break}return h.abrupt("return",s);case 55:return h.abrupt("return",t.union(s));case 56:case"end":return h.stop()}},_callee69,this)}));return function maxKeys(){return e.apply(this,arguments)}}()},{key:"minValues",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee70(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee70$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.minKeys(e);case 3:t=r.sent;return r.abrupt("return",x.prototype._retrieveValues.call(this,t));case 5:case"end":return r.stop()}},_callee70,this)}));return function minValues(){return e.apply(this,arguments)}}()},{key:"minKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee71(){var e,t,n,r,a,i,s,o,u,c,l=arguments;return _regenerator["default"].wrap(function _callee71$(h){for(;;)switch(h.prev=h.next){case 0:e=l.length>0&&l[0]!==undefined?l[0]:null;if(!this._objectStore._truncated){h.next=5;break}t=new _set5["default"];h.next=8;break;case 5:h.next=7;return this._index.minKeys(e);case 7:t=h.sent;case 8:n=_set5["default"].sampleElement(t);r=undefined,a=undefined;if(n===undefined){h.next=15;break}h.next=13;return this._backend.get(n);case 13:r=h.sent;a=b.byKeyPath(r,this.keyPath);case 15:t=(t=t.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());case 17:if(n===undefined||0!==t.size){h.next=35;break}i=B.lowerBound(a,!0);h.next=21;return this._index.minKeys(i);case 21:t=h.sent;if((n=_set5["default"].sampleElement(t))===undefined){h.next=28;break}h.next=26;return this._backend.get(n);case 26:r=h.sent;a=b.byKeyPath(r,this.keyPath);case 28:t=(t=t.difference(this._objectStore._removed)).difference(this._objectStore._modified.keys());if(!a||null===e||e.includes(a)){h.next=33;break}t=new _set5["default"];return h.abrupt("break",35);case 33:h.next=17;break;case 35:h.next=37;return x.prototype.minKeys.call(this,e);case 37:s=h.sent;if(0!==t.size){h.next=42;break}return h.abrupt("return",s);case 42:if(0!==s.size){h.next=44;break}return h.abrupt("return",t);case 44:h.next=46;return this._objectStore.get(_set5["default"].sampleElement(s));case 46:o=h.sent;u=a;c=b.byKeyPath(o,this.keyPath);if(!(p.compare(u,c)<0)){h.next=53;break}return h.abrupt("return",t);case 53:if(!(p.compare(u,c)>0)){h.next=55;break}return h.abrupt("return",s);case 55:return h.abrupt("return",t.union(s));case 56:case"end":return h.stop()}},_callee71,this)}));return function minKeys(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee72(){var e,t=arguments;return _regenerator["default"].wrap(function _callee72$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:null;n.next=3;return this.keys(e);case 3:return n.abrupt("return",n.sent.size);case 4:case"end":return n.stop()}},_callee72,this)}));return function count(){return e.apply(this,arguments)}}()}]);return TransactionIndex}(x);t.register(R);var M=function(){function Transaction(e,t,n){var r=this,a=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];(0,_classCallCheck2["default"])(this,Transaction);this._id=Transaction._instanceCount++;this._objectStore=e;this._parent=t;this._managingBackend=n||t;this._modified=new _map2["default"];this._removed=new _set5["default"];this._truncated=!1;this._indices=R.derive(this,t);this._state=Transaction.STATE.OPEN;this._nested=new _set5["default"];this._nestedCommitted=!1;this._dependency=null;this._snapshotManager=new U;this._startTime=(0,_now["default"])();this._enableWatchdog=a;this._enableWatchdog&&(this._watchdog=setTimeout(function(){y.w(Transaction,"Violation: tx id ".concat(r._id," took longer than expected (still open after ").concat(Transaction.WATCHDOG_TIMER/1e3,"s), ").concat(r.toString(),"."))},Transaction.WATCHDOG_TIMER))}(0,_createClass2["default"])(Transaction,[{key:"_applySync",value:function _applySync(e){e._truncated&&this.truncateSync();var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e._modified);!(t=(a=i.next()).done);t=!0){var s=(0,_slicedToArray2["default"])(a.value,2),o=s[0],u=s[1];this._put(o,u)}}catch(_){n=!0;r=_}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}var c=!0,l=!1,h=undefined;try{for(var f,d=(0,_getIterator2["default"])(e._removed);!(c=(f=d.next()).done);c=!0){var A=f.value;this._remove(A)}}catch(_){l=!0;h=_}finally{try{c||null==d["return"]||d["return"]()}finally{if(l)throw h}}}},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee73(){return _regenerator["default"].wrap(function _callee73$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.truncateSync());case 1:case"end":return e.stop()}},_callee73,this)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"truncateSync",value:function truncateSync(){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._truncated=!0;this._modified.clear();this._removed.clear();var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._indices.values());!(e=(r=a.next()).done);e=!0){r.value.truncate()}}catch(i){t=!0;n=i}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee74(e){var t,n=arguments;return _regenerator["default"].wrap(function _callee74$(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&n[1]!==undefined?n[1]:{};if(!this._removed.has(e)){r.next=3;break}return r.abrupt("return",undefined);case 3:if(!this._modified.has(e)){r.next=7;break}if(!t||!t.raw){r.next=6;break}return r.abrupt("return",this.encode(this._modified.get(e)));case 6:return r.abrupt("return",this._modified.get(e));case 7:if(!this._truncated){r.next=9;break}return r.abrupt("return",undefined);case 9:return r.abrupt("return",this._parent.get(e,t));case 10:case"end":return r.stop()}},_callee74,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee75(e,t){var n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee75$(c){for(;;)switch(c.prev=c.next){case 0:if(this._state===Transaction.STATE.OPEN){c.next=2;break}throw new Error("Transaction already closed");case 2:n=[];r=!0;a=!1;i=undefined;c.prev=6;for(s=(0,_getIterator2["default"])(this._indices.values());!(r=(o=s.next()).done);r=!0){u=o.value;n.push(u.checkUniqueConstraint(e,t,!1))}c.next=14;break;case 10:c.prev=10;c.t0=c["catch"](6);a=!0;i=c.t0;case 14:c.prev=14;c.prev=15;r||null==s["return"]||s["return"]();case 17:c.prev=17;if(!a){c.next=20;break}throw i;case 20:return c.finish(17);case 21:return c.finish(14);case 22:c.next=24;return _promise["default"].all(n);case 24:this._put(e,t);case 25:case"end":return c.stop()}},_callee75,this,[[6,10,14,22],[15,,17,21]])}));return function put(t,n){return e.apply(this,arguments)}}()},{key:"putSync",value:function putSync(e,t){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._put(e,t)}},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee76(e){return _regenerator["default"].wrap(function _callee76$(t){for(;;)switch(t.prev=t.next){case 0:if(this._state===Transaction.STATE.OPEN){t.next=2;break}throw new Error("Transaction already closed");case 2:this._remove(e);case 3:case"end":return t.stop()}},_callee76,this)}));return function remove(t){return e.apply(this,arguments)}}()},{key:"removeSync",value:function removeSync(e){if(this._state!==Transaction.STATE.OPEN)throw new Error("Transaction already closed");this._remove(e)}},{key:"keys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee77(){var e,t,n,r,a,i,s,o,u=arguments;return _regenerator["default"].wrap(function _callee77$(c){for(;;)switch(c.prev=c.next){case 0:if(!(null!==(e=u.length>0&&u[0]!==undefined?u[0]:null)&&e instanceof O)){c.next=3;break}return c.abrupt("return",e.keys(this));case 3:t=new _set5["default"];if(this._truncated){c.next=8;break}c.next=7;return this._parent.keys(e);case 7:t=c.sent;case 8:t=t.difference(this._removed);n=!0;r=!1;a=undefined;c.prev=12;for(i=(0,_getIterator2["default"])(this._modified.keys());!(n=(s=i.next()).done);n=!0){o=s.value;(null===e||e.includes(o))&&t.add(o)}c.next=20;break;case 16:c.prev=16;c.t0=c["catch"](12);r=!0;a=c.t0;case 20:c.prev=20;c.prev=21;n||null==i["return"]||i["return"]();case 23:c.prev=23;if(!r){c.next=26;break}throw a;case 26:return c.finish(23);case 27:return c.finish(20);case 28:return c.abrupt("return",t);case 29:case"end":return c.stop()}},_callee77,this,[[12,16,20,28],[21,,23,27]])}));return function keys(){return e.apply(this,arguments)}}()},{key:"values",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee78(){var e,t,n,r,a,i,s,o,u,c=arguments;return _regenerator["default"].wrap(function _callee78$(l){for(;;)switch(l.prev=l.next){case 0:if(!(null!==(e=c.length>0&&c[0]!==undefined?c[0]:null)&&e instanceof O)){l.next=3;break}return l.abrupt("return",e.values(this));case 3:l.next=5;return this.keys(e);case 5:t=l.sent;n=[];r=!0;a=!1;i=undefined;l.prev=10;for(s=(0,_getIterator2["default"])(t);!(r=(o=s.next()).done);r=!0){u=o.value;n.push(this.get(u))}l.next=18;break;case 14:l.prev=14;l.t0=l["catch"](10);a=!0;i=l.t0;case 18:l.prev=18;l.prev=19;r||null==s["return"]||s["return"]();case 21:l.prev=21;if(!a){l.next=24;break}throw i;case 24:return l.finish(21);case 25:return l.finish(18);case 26:return l.abrupt("return",_promise["default"].all(n));case 27:case"end":return l.stop()}},_callee78,this,[[10,14,18,26],[19,,21,25]])}));return function values(){return e.apply(this,arguments)}}()},{key:"keyStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee79(e){var t,n,r,a,i,s=this,o=arguments;return _regenerator["default"].wrap(function _callee79$(u){for(;;)switch(u.prev=u.next){case 0:t=!(o.length>1&&o[1]!==undefined)||o[1];n=o.length>2&&o[2]!==undefined?o[2]:null;r=(0,_from["default"])(this._modified.keys());n instanceof B&&(r=r.filter(function(e){return n.includes(e)}));r=r.sort();a=r.iterator(t);if(this._truncated){u.next=12;break}i=!1;u.next=10;return this._parent.keyStream(function(n){for(;a.hasNext()&&(t&&p.compare(a.peek(),n)<0||!t&&p.compare(a.peek(),n)>0);){var r=a.next();if(!e(r)){i=!0;return!1}}if(a.hasNext()&&p.equals(a.peek(),n)){var o=a.next();if(!e(o)){i=!0;return!1}return!0}if(!s._removed.has(n)&&!e(n)){i=!0;return!1}return!0},t,n);case 10:if(!i){u.next=12;break}return u.abrupt("return");case 12:if(!a.hasNext()){u.next=17;break}if(e(a.next())){u.next=15;break}return u.abrupt("break",17);case 15:u.next=12;break;case 17:case"end":return u.stop()}},_callee79,this)}));return function keyStream(t){return e.apply(this,arguments)}}()},{key:"valueStream",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee80(e){var t,n,r,a,i,s,o,u=this,c=arguments;return _regenerator["default"].wrap(function _callee80$(l){for(;;)switch(l.prev=l.next){case 0:t=!(c.length>1&&c[1]!==undefined)||c[1];n=c.length>2&&c[2]!==undefined?c[2]:null;r=(0,_from["default"])(this._modified.keys());n instanceof B&&(r=r.filter(function(e){return n.includes(e)}));r=r.sort();a=r.iterator(t);if(this._truncated){l.next=12;break}i=!1;l.next=10;return this._parent.valueStream(function(n,r){for(;a.hasNext()&&(t&&p.compare(a.peek(),r)<0||!t&&p.compare(a.peek(),r)>0);){var s=a.next(),o=u._modified.get(s);if(!e(o,s)){i=!0;return!1}}if(a.hasNext()&&p.equals(a.peek(),r)){var c=a.next(),l=u._modified.get(c);if(!e(l,c)){i=!0;return!1}return!0}if(!u._removed.has(r)&&!e(n,r)){i=!0;return!1}return!0},t,n);case 10:if(!i){l.next=12;break}return l.abrupt("return");case 12:if(!a.hasNext()){l.next=21;break}s=a.next();l.next=16;return this.get(s);case 16:o=l.sent;if(e(o,s)){l.next=19;break}return l.abrupt("break",21);case 19:l.next=12;break;case 21:case"end":return l.stop()}},_callee80,this)}));return function valueStream(t){return e.apply(this,arguments)}}()},{key:"maxValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee81(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee81$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.maxKey(e);case 3:t=r.sent;return r.abrupt("return",this.get(t));case 5:case"end":return r.stop()}},_callee81,this)}));return function maxValue(){return e.apply(this,arguments)}}()},{key:"maxKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee82(){var e,t,n,r,a,i,s,o,u,c=arguments;return _regenerator["default"].wrap(function _callee82$(l){for(;;)switch(l.prev=l.next){case 0:e=c.length>0&&c[0]!==undefined?c[0]:null;t=undefined;if(this._truncated){l.next=6;break}l.next=5;return this._parent.maxKey(e);case 5:t=l.sent;case 6:if(t===undefined||!this._removed.has(t)){l.next=16;break}n=B.upperBound(t,!0);l.next=10;return this._parent.maxKey(n);case 10:t=l.sent;if(null===e||e.includes(t)){l.next=14;break}t=undefined;return l.abrupt("break",16);case 14:l.next=6;break;case 16:r=!0;a=!1;i=undefined;l.prev=19;for(s=(0,_getIterator2["default"])(this._modified.keys());!(r=(o=s.next()).done);r=!0){u=o.value;(null===e||e.includes(u))&&(t===undefined||p.compare(u,t)>0)&&(t=u)}l.next=27;break;case 23:l.prev=23;l.t0=l["catch"](19);a=!0;i=l.t0;case 27:l.prev=27;l.prev=28;r||null==s["return"]||s["return"]();case 30:l.prev=30;if(!a){l.next=33;break}throw i;case 33:return l.finish(30);case 34:return l.finish(27);case 35:return l.abrupt("return",t);case 36:case"end":return l.stop()}},_callee82,this,[[19,23,27,35],[28,,30,34]])}));return function maxKey(){return e.apply(this,arguments)}}()},{key:"minValue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee83(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee83$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:null;r.next=3;return this.minKey(e);case 3:t=r.sent;return r.abrupt("return",this.get(t));case 5:case"end":return r.stop()}},_callee83,this)}));return function minValue(){return e.apply(this,arguments)}}()},{key:"minKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee84(){var e,t,n,r,a,i,s,o,u,c=arguments;return _regenerator["default"].wrap(function _callee84$(l){for(;;)switch(l.prev=l.next){case 0:e=c.length>0&&c[0]!==undefined?c[0]:null;t=undefined;if(this._truncated){l.next=6;break}l.next=5;return this._parent.minKey(e);case 5:t=l.sent;case 6:if(t===undefined||!this._removed.has(t)){l.next=16;break}n=B.lowerBound(t,!0);l.next=10;return this._parent.minKey(n);case 10:t=l.sent;if(null===e||e.includes(t)){l.next=14;break}t=undefined;return l.abrupt("break",16);case 14:l.next=6;break;case 16:r=!0;a=!1;i=undefined;l.prev=19;for(s=(0,_getIterator2["default"])(this._modified.keys());!(r=(o=s.next()).done);r=!0){u=o.value;(null===e||e.includes(u))&&(t===undefined||u<t)&&(t=u)}l.next=27;break;case 23:l.prev=23;l.t0=l["catch"](19);a=!0;i=l.t0;case 27:l.prev=27;l.prev=28;r||null==s["return"]||s["return"]();case 30:l.prev=30;if(!a){l.next=33;break}throw i;case 33:return l.finish(30);case 34:return l.finish(27);case 35:return l.abrupt("return",t);case 36:case"end":return l.stop()}},_callee84,this,[[19,23,27,35],[28,,30,34]])}));return function minKey(){return e.apply(this,arguments)}}()},{key:"count",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee85(){var e,t=arguments;return _regenerator["default"].wrap(function _callee85$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:null;n.next=3;return this.keys(e);case 3:return n.abrupt("return",n.sent.size);case 4:case"end":return n.stop()}},_callee85,this)}));return function count(){return e.apply(this,arguments)}}()},{key:"index",value:function index(e){return this._indices.get(e)}},{key:"close",value:function close(){return this.abort()}},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(this._state!==Transaction.STATE.OPEN&&this._state!==Transaction.STATE.NESTED)throw new Error("Transaction already closed");var t=new Transaction(this._objectStore,this,this,e);this._nested.add(t);this._state=Transaction.STATE.NESTED;return t}},{key:"synchronousTransaction",value:function synchronousTransaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(this._state!==Transaction.STATE.OPEN&&this._state!==Transaction.STATE.NESTED)throw new Error("Transaction already closed");var t=new L(this._objectStore,this,this,e);this._nested.add(t);this._state=Transaction.STATE.NESTED;return t}},{key:"isSynchronous",value:function isSynchronous(){return!1}},{key:"snapshot",value:function snapshot(){if(this.state!==Transaction.STATE.COMMITTED){var snapshot=this._managingBackend.snapshot();snapshot.inherit(this);return snapshot}return this._snapshotManager.createSnapshot(this._objectStore,this)}},{key:"toString",value:function toString(){return"Transaction{id=".concat(this._id,", changes=±").concat(this._modified.size+this._removed.size,", truncated=").concat(this._truncated,", objectStore=").concat(this._objectStore,", state=").concat(this._state,", dependency=").concat(this._dependency,"}")}},{key:"toStringShort",value:function toStringShort(){return"Transaction{id=".concat(this._id,", changes=±").concat(this._modified.size+this._removed.size,", truncated=").concat(this._truncated,", state=").concat(this._state,", dependency=").concat(this._dependency,"}")}},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee86(e){return _regenerator["default"].wrap(function _callee86$(t){for(;;)switch(t.prev=t.next){case 0:if(e===undefined){t.next=8;break}if(this._isCommittable(e)){t.next=5;break}t.next=4;return this.abort(e);case 4:return t.abrupt("return",!1);case 5:t.next=7;return this._commitInternal(e);case 7:return t.abrupt("return",!0);case 8:if(null===this._dependency){t.next=10;break}return t.abrupt("return",this._dependency.commit());case 10:t.next=12;return this._checkConstraints();case 12:return t.abrupt("return",this._commitBackend());case 13:case"end":return t.stop()}},_callee86,this)}));return function commit(t){return e.apply(this,arguments)}}()},{key:"abort",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee87(e){return _regenerator["default"].wrap(function _callee87$(t){for(;;)switch(t.prev=t.next){case 0:if(e===undefined){t.next=8;break}if(!(e instanceof D)){t.next=3;break}return t.abrupt("return",this._snapshotManager.abortSnapshot(e));case 3:if(this._nested.has(e)&&e.state===Transaction.STATE.OPEN){t.next=5;break}throw new Error("Can only abort open, nested transactions");case 5:this._nested["delete"](e);if(0===this._nested.size){this._state=Transaction.STATE.OPEN;this._nestedCommitted=!1}return t.abrupt("return",!0);case 8:if(null===this._dependency){t.next=10;break}return t.abrupt("return",this._dependency.abort());case 10:return t.abrupt("return",this._abortBackend());case 11:case"end":return t.stop()}},_callee87,this)}));return function abort(t){return e.apply(this,arguments)}}()},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee88(e){return _regenerator["default"].wrap(function _callee88$(t){for(;;)switch(t.prev=t.next){case 0:if(e instanceof Transaction){t.next=2;break}throw new Error("Can only apply transactions");case 2:t.next=4;return this._snapshotManager.applyTx(e,this);case 4:this._applySync(e);case 5:case"end":return t.stop()}},_callee88,this)}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"_commitBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee89(){var e;return _regenerator["default"].wrap(function _callee89$(t){for(;;)switch(t.prev=t.next){case 0:if(this._state===Transaction.STATE.OPEN){t.next=2;break}throw new Error("Transaction already closed or in nested state");case 2:this._enableWatchdog&&clearTimeout(this._watchdog);e=(0,_now["default"])();t.next=6;return this._managingBackend.commit(this);case 6:if(!t.sent){t.next=13;break}this._state=Transaction.STATE.COMMITTED;this._performanceCheck(e,"commit");this._performanceCheck();return t.abrupt("return",!0);case 13:this._state=Transaction.STATE.CONFLICTED;this._performanceCheck(e,"commit");this._performanceCheck();return t.abrupt("return",!1);case 17:case"end":return t.stop()}},_callee89,this)}));return function _commitBackend(){return e.apply(this,arguments)}}()},{key:"_performanceCheck",value:function _performanceCheck(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._startTime,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null,n=(0,_now["default"])()-e;t=t?" function '".concat(t,"'"):"";n>Transaction.WATCHDOG_TIMER&&y.w(Transaction,"Violation: tx id ".concat(this._id).concat(t," took ").concat((n/1e3).toFixed(2),"s (").concat(this.toString(),")."))}},{key:"_isCommittable",value:function _isCommittable(e){if(e!==undefined){if(!this._nested.has(e)||e.state!==Transaction.STATE.OPEN)throw new Error("Can only commit open, nested transactions");return!this._nestedCommitted}return this._managingBackend._isCommittable(this)}},{key:"_commitInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee90(e){return _regenerator["default"].wrap(function _callee90$(t){for(;;)switch(t.prev=t.next){case 0:this._nested["delete"](e);this._nestedCommitted=!0;t.next=4;return this._apply(e);case 4:if(0===this._nested.size){this._state=Transaction.STATE.OPEN;this._nestedCommitted=!1}case 5:case"end":return t.stop()}},_callee90,this)}));return function _commitInternal(t){return e.apply(this,arguments)}}()},{key:"_setParent",value:function _setParent(e){this._parent=e}},{key:"_abortBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee91(){var e;return _regenerator["default"].wrap(function _callee91$(t){for(;;)switch(t.prev=t.next){case 0:if(this._state!==Transaction.STATE.ABORTED&&this._state!==Transaction.STATE.CONFLICTED){t.next=2;break}return t.abrupt("return",!0);case 2:if(this._state===Transaction.STATE.OPEN||this._state===Transaction.STATE.NESTED){t.next=4;break}throw new Error("Transaction already closed");case 4:if(this._state!==Transaction.STATE.NESTED){t.next=7;break}t.next=7;return _promise["default"].all((0,_from["default"])(this._nested).map(function(e){return e.abort()}));case 7:this._enableWatchdog&&clearTimeout(this._watchdog);e=(0,_now["default"])();t.next=11;return this._managingBackend.abort(this);case 11:this._setAborted();this._performanceCheck(e,"abort");this._performanceCheck();return t.abrupt("return",!0);case 15:case"end":return t.stop()}},_callee91,this)}));return function _abortBackend(){return e.apply(this,arguments)}}()},{key:"_setAborted",value:function _setAborted(){this._state=Transaction.STATE.ABORTED}},{key:"_put",value:function _put(e,t){this._removed["delete"](e);var n=this._modified.get(e);this._modified.set(e,t);var r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(this._indices.values());!(r=(s=o.next()).done);r=!0){s.value.put(e,t,n)}}catch(u){a=!0;i=u}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}}},{key:"_remove",value:function _remove(e){this._removed.add(e);var t=this._modified.get(e);this._modified["delete"](e);var n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(this._indices.values());!(n=(i=s.next()).done);n=!0){i.value.remove(e,t)}}catch(o){r=!0;a=o}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}}},{key:"_checkConstraints",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee92(){var e,t,n,r,a,i,s,o,u,c,l,h,f,d,A;return _regenerator["default"].wrap(function _callee92$(_){for(;;)switch(_.prev=_.next){case 0:e=[];t=!0;n=!1;r=undefined;_.prev=4;a=(0,_getIterator2["default"])(this._indices.values());case 6:if(t=(i=a.next()).done){_.next=32;break}if((s=i.value).unique){_.next=10;break}return _.abrupt("continue",29);case 10:o=!0;u=!1;c=undefined;_.prev=13;for(l=(0,_getIterator2["default"])(this._modified);!(o=(h=l.next()).done);o=!0){f=(0,_slicedToArray2["default"])(h.value,2),d=f[0],A=f[1];e.push(s.checkUniqueConstraint(d,A))}_.next=21;break;case 17:_.prev=17;_.t0=_["catch"](13);u=!0;c=_.t0;case 21:_.prev=21;_.prev=22;o||null==l["return"]||l["return"]();case 24:_.prev=24;if(!u){_.next=27;break}throw c;case 27:return _.finish(24);case 28:return _.finish(21);case 29:t=!0;_.next=6;break;case 32:_.next=38;break;case 34:_.prev=34;_.t1=_["catch"](4);n=!0;r=_.t1;case 38:_.prev=38;_.prev=39;t||null==a["return"]||a["return"]();case 41:_.prev=41;if(!n){_.next=44;break}throw r;case 44:return _.finish(41);case 45:return _.finish(38);case 46:if(!(e.length>0)){_.next=57;break}_.prev=47;_.next=50;return _promise["default"].all(e);case 50:_.next=57;break;case 52:_.prev=52;_.t2=_["catch"](47);_.next=56;return this.abort();case 56:throw _.t2;case 57:case"end":return _.stop()}},_callee92,this,[[4,34,38,46],[13,17,21,29],[22,,24,28],[39,,41,45],[47,52]])}));return function _checkConstraints(){return e.apply(this,arguments)}}()},{key:"decode",value:function decode(e,t){return this._objectStore.decode(e,t)}},{key:"encode",value:function encode(e){return this._objectStore.encode(e)}},{key:"objectStore",get:function get(){return this._objectStore}},{key:"nested",get:function get(){return this._managingBackend instanceof Transaction}},{key:"dependency",get:function get(){return this._dependency}},{key:"connected",get:function get(){return this._managingBackend.connected}},{key:"id",get:function get(){return this._id}},{key:"indices",get:function get(){return this._indices}},{key:"state",get:function get(){return this._state}}]);return Transaction}();M.WATCHDOG_TIMER=5e3;M.STATE={OPEN:0,COMMITTED:1,ABORTED:2,CONFLICTED:3,NESTED:4};M._instanceCount=0;t.register(M);var L=function(e){(0,_inherits2["default"])(SynchronousTransaction,e);var t=_createSuper(SynchronousTransaction);function SynchronousTransaction(e,n,r){var a,i=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];(0,_classCallCheck2["default"])(this,SynchronousTransaction);(a=t.call(this,e,n,r,i))._cache=new _map2["default"];return a}(0,_createClass2["default"])(SynchronousTransaction,[{key:"preload",value:function preload(e){var t=this;e=e.filter(function(e){return!t.isCached(e)});return _promise["default"].all(e.map(function(e){return t.get(e)}))}},{key:"isCached",value:function isCached(e){return this._cache.has(e)||!!this._parent.isSynchronous()&&this._parent.isCached(e)}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee93(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee93$(a){for(;;)switch(a.prev=a.next){case 0:(t=r.length>1&&r[1]!==undefined?r[1]:{}).expectPresence=!1;if(!this.isCached(e)){a.next=6;break}n=this.getSync(e,t);a.next=10;break;case 6:a.next=8;return M.prototype.get.call(this,e,t);case 8:n=a.sent;t&&t.raw?this._cache.set(e,this.decode(n,e)):this._cache.set(e,n);case 10:return a.abrupt("return",n);case 11:case"end":return a.stop()}},_callee93,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"_getCached",value:function _getCached(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},n=(t||{}).expectPresence,r=void 0===n||n,a=this._cache.get(e);if(!a&&this._parent.isSynchronous())return this._parent.getSync(e,t);if(r&&!a)throw new Error("Missing key in cache: ".concat(e));t&&t.raw&&(a=this.encode(a));return a}},{key:"getSync",value:function getSync(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this._removed.has(e)?undefined:this._modified.has(e)?t&&t.raw?this.encode(this._modified.get(e)):this._modified.get(e):this._truncated?undefined:this._getCached(e,t)}},{key:"isSynchronous",value:function isSynchronous(){return!0}}]);return SynchronousTransaction}(M);t.register(L);var D=function(e){(0,_inherits2["default"])(Snapshot,e);var t=_createSuper(Snapshot);function Snapshot(e,n){(0,_classCallCheck2["default"])(this,Snapshot);return t.call(this,e,n,e,!1)}(0,_createClass2["default"])(Snapshot,[{key:"inherit",value:function inherit(e){if(!(e instanceof M))throw new Error("Can only inherit transactions");return(0,_get10["default"])((0,_getPrototypeOf2["default"])(Snapshot.prototype),"_applySync",this).call(this,e)}},{key:"_apply",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee94(e){var t,n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g=this;return _regenerator["default"].wrap(function _callee94$(y){for(;;)switch(y.prev=y.next){case 0:if(e instanceof M){y.next=2;break}throw new Error("Can only apply transactions");case 2:if(!e._truncated){y.next=5;break}y.next=5;return this.valueStream(function(e,t){g._modified.has(t)||g._put(t,e);return!0});case 5:t=!0;n=!1;r=undefined;y.prev=8;a=(0,_getIterator2["default"])(e._modified);case 10:if(t=(i=a.next()).done){y.next=21;break}s=(0,_slicedToArray2["default"])(i.value,2),o=s[0],u=s[1];if(!this._modified.has(o)){y.next=14;break}return y.abrupt("continue",18);case 14:y.next=16;return this.get(o);case 16:(c=y.sent)?this._put(o,c,u):this._remove(o,u);case 18:t=!0;y.next=10;break;case 21:y.next=27;break;case 23:y.prev=23;y.t0=y["catch"](8);n=!0;r=y.t0;case 27:y.prev=27;y.prev=28;t||null==a["return"]||a["return"]();case 30:y.prev=30;if(!n){y.next=33;break}throw r;case 33:return y.finish(30);case 34:return y.finish(27);case 35:l=!0;h=!1;f=undefined;y.prev=38;d=(0,_getIterator2["default"])(e._removed);case 40:if(l=(A=d.next()).done){y.next=51;break}_=A.value;if(!this._modified.has(_)){y.next=44;break}return y.abrupt("continue",48);case 44:y.next=46;return this.get(_);case 46:p=y.sent;this._put(_,p);case 48:l=!0;y.next=40;break;case 51:y.next=57;break;case 53:y.prev=53;y.t1=y["catch"](38);h=!0;f=y.t1;case 57:y.prev=57;y.prev=58;l||null==d["return"]||d["return"]();case 60:y.prev=60;if(!h){y.next=63;break}throw f;case 63:return y.finish(60);case 64:return y.finish(57);case 65:case"end":return y.stop()}},_callee94,this,[[8,23,27,35],[28,,30,34],[38,53,57,65],[58,,60,64]])}));return function _apply(t){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee95(){return _regenerator["default"].wrap(function _callee95$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unsupported operation on snapshots: truncate");case 1:case"end":return e.stop()}},_callee95)}));return function truncate(){return e.apply(this,arguments)}}()},{key:"truncateSync",value:function truncateSync(){throw new Error("Unsupported operation on snapshots: truncateSync")}},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee96(e){return _regenerator["default"].wrap(function _callee96$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit snapshots: commit");case 1:case"end":return e.stop()}},_callee96)}));return function commit(t){return e.apply(this,arguments)}}()},{key:"_isCommittable",value:function _isCommittable(e){return!1}},{key:"_commitInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee97(e){return _regenerator["default"].wrap(function _callee97$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit snapshots");case 1:case"end":return e.stop()}},_callee97)}));return function _commitInternal(t){return e.apply(this,arguments)}}()},{key:"_commitBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee98(){return _regenerator["default"].wrap(function _callee98$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit snapshots");case 1:case"end":return e.stop()}},_callee98)}));return function _commitBackend(){return e.apply(this,arguments)}}()},{key:"abort",value:function abort(e){return this._abortBackend()}},{key:"_abortBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee99(){var e,t,n,r,a;return _regenerator["default"].wrap(function _callee99$(i){for(;;)switch(i.prev=i.next){case 0:if(this._state===M.STATE.OPEN){i.next=2;break}throw new Error("Snapshot already closed");case 2:i.next=4;return this._managingBackend.abort(this);case 4:if(i.sent){i.next=7;break}return i.abrupt("return",!1);case 7:this._state=M.STATE.ABORTED;this._truncated=!0;this._modified.clear();this._removed.clear();e=!0;t=!1;n=undefined;i.prev=14;for(r=(0,_getIterator2["default"])(this._indices.values());!(e=(a=r.next()).done);e=!0)a.value.truncate();i.next=22;break;case 18:i.prev=18;i.t0=i["catch"](14);t=!0;n=i.t0;case 22:i.prev=22;i.prev=23;e||null==r["return"]||r["return"]();case 25:i.prev=25;if(!t){i.next=28;break}throw n;case 28:return i.finish(25);case 29:return i.finish(22);case 30:return i.abrupt("return",!0);case 31:case"end":return i.stop()}},_callee99,this,[[14,18,22,30],[23,,25,29]])}));return function _abortBackend(){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee100(e,t){return _regenerator["default"].wrap(function _callee100$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unsupported operation on snapshots: put");case 1:case"end":return e.stop()}},_callee100)}));return function put(t,n){return e.apply(this,arguments)}}()},{key:"putSync",value:function putSync(e,t){throw new Error("Unsupported operation on snapshots: putSync")}},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee101(e){return _regenerator["default"].wrap(function _callee101$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unsupported operation on snapshots: remove");case 1:case"end":return e.stop()}},_callee101)}));return function remove(t){return e.apply(this,arguments)}}()},{key:"removeSync",value:function removeSync(e){throw new Error("Unsupported operation on snapshots: removeSync")}},{key:"close",value:function close(){return this.abort()}},{key:"transaction",value:function transaction(){throw new Error("Unsupported operation on snapshots: transaction")}},{key:"synchronousTransaction",value:function synchronousTransaction(){throw new Error("Unsupported operation on snapshots: synchronousTransaction")}},{key:"snapshot",value:function snapshot(){throw new Error("Unsupported operation on snapshots: snapshot")}}]);return Snapshot}(M);t.register(D);var U=function(){function SnapshotManager(){(0,_classCallCheck2["default"])(this,SnapshotManager);this._snapshots=new _set5["default"]}(0,_createClass2["default"])(SnapshotManager,[{key:"createSnapshot",value:function createSnapshot(e,t){var n=new D(e,t);this._snapshots.add(n);return n}},{key:"abortSnapshot",value:function abortSnapshot(e){return this._snapshots["delete"](e)}},{key:"applyTx",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee102(e,t){var n,r,a,i,s,o,u,c,l,h,f,d,A;return _regenerator["default"].wrap(function _callee102$(_){for(;;)switch(_.prev=_.next){case 0:if(e instanceof M){_.next=2;break}throw new Error("Can only apply transactions");case 2:n=[];r=!0;a=!1;i=undefined;_.prev=6;for(s=(0,_getIterator2["default"])(this._snapshots);!(r=(o=s.next()).done);r=!0){u=o.value;n.push(u._apply(e))}_.next=14;break;case 10:_.prev=10;_.t0=_["catch"](6);a=!0;i=_.t0;case 14:_.prev=14;_.prev=15;r||null==s["return"]||s["return"]();case 17:_.prev=17;if(!a){_.next=20;break}throw i;case 20:return _.finish(17);case 21:return _.finish(14);case 22:c=!0;l=!1;h=undefined;_.prev=25;for(f=(0,_getIterator2["default"])(e._snapshotManager);!(c=(d=f.next()).done);c=!0){(A=d.value)._backend=t;this._snapshots.add(A)}_.next=33;break;case 29:_.prev=29;_.t1=_["catch"](25);l=!0;h=_.t1;case 33:_.prev=33;_.prev=34;c||null==f["return"]||f["return"]();case 36:_.prev=36;if(!l){_.next=39;break}throw h;case 39:return _.finish(36);case 40:return _.finish(33);case 41:return _.abrupt("return",_promise["default"].all(n));case 42:case"end":return _.stop()}},_callee102,this,[[6,10,14,22],[15,,17,21],[25,29,33,41],[34,,36,40]])}));return function applyTx(t,n){return e.apply(this,arguments)}}()},{key:_iterator276["default"],value:function value(){return this._snapshots.values()}}]);return SnapshotManager}();t.register(U);var z=function(){function CombinedTransaction(){(0,_classCallCheck2["default"])(this,CombinedTransaction);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!this.isConsistent(t))throw new Error("Given set of transactions violates rules for combined transactions");this._transactions=t;this._flushable=new _map2["default"];this._preprocessing=[];this._dependency=this}(0,_createClass2["default"])(CombinedTransaction,[{key:"isConsistent",value:function isConsistent(e){var t=new _set5["default"];this._jdb=null;var n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(e);!(n=(i=s.next()).done);n=!0){var o=i.value;if(o.state!==M.STATE.OPEN)return!1;if(o.nested)return!1;if(t.has(o._objectStore))return!1;if(null===this._jdb)this._jdb=o._objectStore.jungleDB;else if(this._jdb!==o._objectStore.jungleDB&&null!==o._objectStore.jungleDB)return!1;t.add(o._objectStore)}}catch(u){r=!0;a=u}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}return!0}},{key:"onFlushable",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee103(e){var t,n,r,a,s,o,u,c,l,h,f,d,A,_,p=this,g=arguments;return _regenerator["default"].wrap(function _callee103$(y){for(;;)switch(y.prev=y.next){case 0:t=g.length>1&&g[1]!==undefined?g[1]:null;n=g.length>2&&g[2]!==undefined?g[2]:null;this._flushable.set(e,t);null!==n&&this._preprocessing.push(n);if(!this._transactions.every(function(e){return p._flushable.has(e)})){y.next=49;break}r=[];a=!0;s=!1;o=undefined;y.prev=9;for(u=(0,_getIterator2["default"])(this._preprocessing);!(a=(c=u.next()).done);a=!0){l=c.value;r.push(l())}y.next=17;break;case 13:y.prev=13;y.t0=y["catch"](9);s=!0;o=y.t0;case 17:y.prev=17;y.prev=18;a||null==u["return"]||u["return"]();case 20:y.prev=20;if(!s){y.next=23;break}throw o;case 23:return y.finish(20);case 24:return y.finish(17);case 25:y.next=27;return _promise["default"].all(r);case 27:y.next=29;return i.commitCombined(this);case 29:h=!0;f=!1;d=undefined;y.prev=32;for(A=(0,_getIterator2["default"])(this._flushable.values());!(h=(_=A.next()).done);h=!0)(0,_.value)();y.next=40;break;case 36:y.prev=36;y.t1=y["catch"](32);f=!0;d=y.t1;case 40:y.prev=40;y.prev=41;h||null==A["return"]||A["return"]();case 43:y.prev=43;if(!f){y.next=46;break}throw d;case 46:return y.finish(43);case 47:return y.finish(40);case 48:return y.abrupt("return",!0);case 49:return y.abrupt("return",!1);case 50:case"end":return y.stop()}},_callee103,this,[[9,13,17,25],[18,,20,24],[32,36,40,48],[41,,43,47]])}));return function onFlushable(t){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee104(){return _regenerator["default"].wrap(function _callee104$(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isCommittable()){e.next=6;break}e.next=3;return this._checkConstraints();case 3:e.next=5;return this._commitBackend();case 5:return e.abrupt("return",!0);case 6:e.next=8;return this.abort();case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}},_callee104,this)}));return function commit(){return e.apply(this,arguments)}}()},{key:"abort",value:function abort(){return this._abortBackend()}},{key:"_abortBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee105(){return _regenerator["default"].wrap(function _callee105$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return _promise["default"].all(this._transactions.map(function(e){return e._abortBackend()}));case 2:return e.abrupt("return",e.sent.every(function(e){return e}));case 3:case"end":return e.stop()}},_callee105,this)}));return function _abortBackend(){return e.apply(this,arguments)}}()},{key:"transaction",value:function transaction(e){throw new Error("Unsupported operation")}},{key:"snapshot",value:function snapshot(){throw new Error("Unsupported operation")}},{key:"_isCommittable",value:function _isCommittable(){return this._transactions.every(function(e){return e._isCommittable()})}},{key:"_checkConstraints",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee106(){return _regenerator["default"].wrap(function _callee106$(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;e.next=3;return _promise["default"].all(this._transactions.map(function(e){return e._checkConstraints()}));case 3:e.next=10;break;case 5:e.prev=5;e.t0=e["catch"](0);e.next=9;return this.abort();case 9:throw e.t0;case 10:case"end":return e.stop()}},_callee106,this,[[0,5]])}));return function _checkConstraints(){return e.apply(this,arguments)}}()},{key:"_commitBackend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee107(){return _regenerator["default"].wrap(function _callee107$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return _promise["default"].all(this._transactions.map(function(e){return e._commitBackend()}));case 2:return e.abrupt("return",e.sent.every(function(e){return e}));case 3:case"end":return e.stop()}},_callee107,this)}));return function _commitBackend(){return e.apply(this,arguments)}}()},{key:"_commitInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee108(e){return _regenerator["default"].wrap(function _callee108$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot commit transactions to a combined transaction");case 1:case"end":return e.stop()}},_callee108)}));return function _commitInternal(t){return e.apply(this,arguments)}}()},{key:"_setParent",value:function _setParent(e){throw new Error("Unsupported operation")}},{key:"toString",value:function toString(){return"CombinedTransaction{size=".concat(this._transactions.length,", states=[").concat(this._transactions.map(function(e){return e.state}),"]}")}},{key:"backend",get:function get(){return this._jdb}},{key:"transactions",get:function get(){return this._transactions}},{key:"_dependency",set:function set(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._transactions);!(t=(a=i.next()).done);t=!0){a.value._dependency=e}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"dependency",get:function get(){return this}},{key:"objectStore",get:function get(){throw new Error("Unsupported operation")}}]);return CombinedTransaction}();t.register(z);e._loaded=!0;"function"==typeof e._onload&&e._onload()}(JDB);if("undefined"==typeof Nimiq)var Nimiq="undefined"!=typeof window?window:{};!function(e){(Nimiq=e="undefined"!=typeof e?e:{})._currentScript||(Nimiq._currentScript=document.currentScript);if(!Nimiq._currentScript){var t=document.getElementsByTagName("script");Nimiq._currentScript=t[t.length-1]}Nimiq._path||(Nimiq._currentScript&&-1!==Nimiq._currentScript.src.indexOf("/")?Nimiq._path=Nimiq._currentScript.src.substring(0,Nimiq._currentScript.src.lastIndexOf("/")+1):Nimiq._path="./");var n=function(){function Class(){(0,_classCallCheck2["default"])(this,Class)}(0,_createClass2["default"])(Class,null,[{key:"register",value:function register(t){"undefined"!=typeof e&&(e[t.name]=t)}},{key:"scope",get:function get(){return"undefined"!=typeof e?e:"undefined"!=typeof self?self:window}}]);return Class}();n.register(n);var r=function(){function LogNative(){(0,_classCallCheck2["default"])(this,LogNative);this._global_level=a.INFO;this._tag_levels={};try{if(window.localStorage)try{var e=window.localStorage.getItem("log_tag_levels");e&&"string"==typeof e&&(e=JSON.parse(e));e&&"object"===(0,_typeof2["default"])(e)&&(this._tag_levels=e)}catch(t){console.warn("Failed to load log configuration from local storage.")}}catch(t){}}(0,_createClass2["default"])(LogNative,[{key:"isLoggable",value:function isLoggable(e,t){return e&&this._tag_levels[e]?this._tag_levels[e]<=t:this._tag_levels["*"]?this._tag_levels["*"]<=t:this._global_level<=t}},{key:"setLoggable",value:function setLoggable(e,t){e&&e.name&&(e=e.name);this._tag_levels[e]=t;window.localStorage&&window.localStorage.setItem("log_tag_levels",(0,_stringify["default"])(this._tag_levels))}},{key:"msg",value:function msg(e,t,n){t&&t.name&&(t=t.name);if(this.isLoggable(t,e)){t&&n.unshift(t+":");n.unshift("[".concat(a.Level.toStringTag(e)," ").concat((new Date).toTimeString().substr(0,8),"]"));console.error&&e>=a.ERROR?console.error.apply(console,n):console.warn&&e>=a.WARNING?console.warn.apply(console,n):console.info&&e>=a.INFO?console.info.apply(console,n):console.debug&&e>=a.DEBUG?console.debug.apply(console,n):console.trace&&e<=a.TRACE?console.trace.apply(console,n):console.log.apply(console,n)}}}]);return LogNative}();n.register(r);var a=function(){(0,_createClass2["default"])(Log,null,[{key:"instance",get:function get(){Log._instance||(Log._instance=new Log(new r));return Log._instance}}]);function Log(e){(0,_classCallCheck2["default"])(this,Log);this._native=e}(0,_createClass2["default"])(Log,[{key:"setLoggable",value:function setLoggable(e,t){this._native.setLoggable(e,Log.Level.get(t))}},{key:"msg",value:function msg(e,t,n){if(this._native.isLoggable(t,e)){for(var r=0;r<n.length;++r){"function"==typeof n[r]&&(n[r]=n[r]());"object"===(0,_typeof2["default"])(n[r])&&("function"==typeof n[r].toString?n[r]=n[r].toString():n[r].constructor&&n[r].constructor.name?n[r]="{Object: ".concat(n[r].constructor.name,"}"):n[r]="{Object}")}this._native.msg(e,t,n)}}},{key:"level",get:function get(){return this._native._global_level},set:function set(e){this._native._global_level=Log.Level.get(e)}}],[{key:"d",value:function d(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.DEBUG,e,r)}},{key:"e",value:function e(t,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(arguments.length>=2){t=arguments[0];a=Array.prototype.slice.call(arguments,1)}else{t=undefined;a=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.ERROR,t,a)}},{key:"i",value:function i(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.INFO,e,r)}},{key:"v",value:function v(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.VERBOSE,e,r)}},{key:"w",value:function w(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(arguments.length>=2){e=arguments[0];r=Array.prototype.slice.call(arguments,1)}else{e=undefined;r=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.WARNING,e,r)}},{key:"t",value:function t(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];if(arguments.length>=2){e=arguments[0];a=Array.prototype.slice.call(arguments,1)}else{e=undefined;a=Array.prototype.slice.call(arguments,0)}Log.instance.msg(Log.TRACE,e,a)}}]);return Log}();a.Level={TRACE:1,VERBOSE:2,DEBUG:3,INFO:4,WARNING:5,ERROR:6,ASSERT:7,toStringTag:function toStringTag(e){switch(e){case a.Level.TRACE:return"T";case a.Level.VERBOSE:return"V";case a.Level.DEBUG:return"D";case a.Level.INFO:return"I";case a.Level.WARNING:return"W";case a.Level.ERROR:return"E";case a.Level.ASSERT:return"A";default:return"*"}},toString:function toString(e){switch(e){case a.Level.TRACE:return"trace";case a.Level.VERBOSE:return"verbose";case a.Level.DEBUG:return"debug";case a.Level.INFO:return"info";case a.Level.WARNING:return"warn";case a.Level.ERROR:return"error";case a.Level.ASSERT:return"assert";default:return"unknown"}},get:function get(e){if("number"==typeof e)return e;if(!isNaN((0,_parseInt2["default"])(e)))return(0,_parseInt2["default"])(e);switch(e.toLowerCase()){case"t":case"trace":return a.Level.TRACE;case"v":case"verbose":return a.Level.VERBOSE;case"d":case"debug":return a.Level.DEBUG;case"i":case"info":return a.Level.INFO;case"w":case"warn":case"warning":return a.Level.WARNING;case"e":case"error":case"exception":return a.Level.ERROR;case"a":case"assert":case"assertion":return a.Level.ASSERT}return 0}};a.TRACE=a.Level.TRACE;a.VERBOSE=a.Level.VERBOSE;a.DEBUG=a.Level.DEBUG;a.INFO=a.Level.INFO;a.WARNING=a.Level.WARNING;a.ERROR=a.Level.ERROR;a.ASSERT=a.Level.ASSERT;a._instance=null;a.d.tag=function(e){return a.d.bind(null,e)};a.e.tag=function(e){return a.e.bind(null,e)};a.i.tag=function(e){return a.i.bind(null,e)};a.v.tag=function(e){return a.v.bind(null,e)};a.w.tag=function(e){return a.w.bind(null,e)};a.t.tag=function(e){return a.t.bind(null,e)};n.register(a);var i=function(){(0,_createClass2["default"])(Observable,null,[{key:"WILDCARD",get:function get(){return"*"}}]);function Observable(){(0,_classCallCheck2["default"])(this,Observable);this._listeners=new _map2["default"]}(0,_createClass2["default"])(Observable,[{key:"_offAll",value:function _offAll(){this._listeners.clear()}},{key:"on",value:function on(e,t){if(this._listeners.has(e))return this._listeners.get(e).push(t)-1;this._listeners.set(e,[t]);return 0}},{key:"off",value:function off(e,t){this._listeners.has(e)&&this._listeners.get(e)[t]&&delete this._listeners.get(e)[t]}},{key:"fire",value:function fire(e){for(var t=this,n=arguments,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=[];if(this._listeners.has(e)){var u=this._listeners.get(e),c=function _loop2(n){if(!u.hasOwnProperty(n))return"continue";try{var r=u[n].apply(null,i);r instanceof _promise["default"]&&o.push(r["catch"](function(r){return a.e(t.constructor.name,"Exception thrown by '".concat(e,"' listener #").concat(n,": ").concat(r.message||r),r)}))}catch(s){a.e(t.constructor.name,"Exception thrown by '".concat(e,"' listener #").concat(n,": ").concat(s.message||s),s)}};for(var l in u)c(l)}if(this._listeners.has(Observable.WILDCARD)){var h=this._listeners.get(Observable.WILDCARD),f=function _loop3(r){if(!h.hasOwnProperty(r))return"continue";try{var i=h[r].apply(null,n);i instanceof _promise["default"]&&o.push(i["catch"](function(n){return a.e(t.constructor.name,"Exception thrown by '".concat(e,"' wildcard listener #").concat(r,": ").concat(n.message||n),n)}))}catch(s){a.e(t.constructor.name,"Exception thrown by '".concat(e,"' wildcard listener #").concat(r,": ").concat(s.message||s),s)}};for(var d in h)f(d)}return o.length>0?_promise["default"].all(o):null}},{key:"bubble",value:function bubble(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var i=function _loop4(){var n=o[s],r=void 0;r=n===Observable.WILDCARD?function callback(){this.fire.apply(this,arguments)}:function callback(){this.fire.apply(this,[n].concat(Array.prototype.slice.call(arguments)))};e.on(n,r.bind(t))},s=0,o=r;s<o.length;s++)i()}}]);return Observable}();n.register(i);var s=function(e){(0,_inherits2["default"])(DataChannel,e);var t=_createSuper(DataChannel);function DataChannel(){var e;(0,_classCallCheck2["default"])(this,DataChannel);(e=t.call(this))._buffer=null;e._currentMessageLength=0;e._msgType=0;e._receivingTag=-1;e._sendingTag=0;e._expectedMessagesByType=new _map2["default"];e._timers=new p;e._lastChunkReceivedAt=0;e._closed=!1;return e}(0,_createClass2["default"])(DataChannel,[{key:"isExpectingMessage",value:function isExpectingMessage(e){return this._expectedMessagesByType.has(e)}},{key:"confirmExpectedMessage",value:function confirmExpectedMessage(e,t){var n=this._expectedMessagesByType.get(e);if(n){this._timers.clearTimeout("chunk-".concat(n.id));this._timers.clearTimeout("msg-".concat(n.id));var r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(n.types);!(r=(s=o.next()).done);r=!0){var u=s.value;this._expectedMessagesByType["delete"](u)}}catch(c){a=!0;i=c}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}t||n.onErrorOrTimeout()}}},{key:"expectMessage",value:function expectMessage(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:DataChannel.MESSAGE_TIMEOUT,r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:DataChannel.CHUNK_TIMEOUT;(0,_isArray["default"])(e)||(e=[e]);if(0!==e.length){var a=new o(e,t,n,r),i=!0,s=!1,u=undefined;try{for(var c,l=(0,_getIterator2["default"])(e);!(i=(c=l.next()).done);i=!0){var h=c.value;this._expectedMessagesByType.set(h,a)}}catch(f){s=!0;u=f}finally{try{i||null==l["return"]||l["return"]()}finally{if(s)throw u}}this._timers.resetTimeout("chunk-".concat(a.id),this._onTimeout.bind(this,a),r);this._timers.resetTimeout("msg-".concat(a.id),this._onTimeout.bind(this,a),n)}}},{key:"close",value:function close(){if(!this._closed){this._closed=!0;this._timers.clearAll();var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._expectedMessagesByType.values());!(e=(r=a.next()).done);e=!0){r.value.onErrorOrTimeout()}}catch(i){t=!0;n=i}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}this._close();this.fire("close",this);this._offAll()}}},{key:"_close",value:function _close(){throw new Error("Not implemented")}},{key:"_error",value:function _error(e){this.fire("error",e,this);a.e(DataChannel,e);this.close()}},{key:"_onMessage",value:function _onMessage(e){try{if(this.readyState!==DataChannel.ReadyState.OPEN)return;var t=new U(e);if(0===t.byteLength)return;if(t.byteLength>DataChannel.CHUNK_SIZE_MAX){this._error("Received chunk larger than maximum chunk size, discarding");return}var n=t.readUint8(),r=t.byteLength-t.readPos,i=t.read(r);if(null===this._buffer&&n===(this._receivingTag+1)%Y.UINT8_MAX){var s=new U(i),o=Rt.peekLength(s);if(o>DataChannel.MESSAGE_SIZE_MAX){this._error("Received message with excessive message size ".concat(o," > ").concat(DataChannel.MESSAGE_SIZE_MAX));return}this._buffer=new U(Math.min(o,DataChannel.CHUNK_SIZE_MAX));this._currentMessageLength=o;this._receivingTag=n;this._msgType=Rt.peekType(s)}if(null===this._buffer){a.e(DataChannel,"Message does not start with next tag ".concat(this._receivingTag+1," (got ").concat(n," instead), but buffer is null"));return}if(n!==this._receivingTag){this._error("Received message with wrong message tag ".concat(n,", expected ").concat(this._receivingTag));return}var u=this._currentMessageLength-this._buffer.writePos;if(r>u){this._error("Received chunk larger than remaining bytes to read, discarding");return}if(t.byteLength!==DataChannel.CHUNK_SIZE_MAX&&r!==u){this._error("Received chunk that is neither max chunk size nor the final chunk");return}if(this._buffer.byteLength<this._buffer.writePos+r){var c=new U(Math.min(2*this._buffer.byteLength,this._currentMessageLength));c.set(this._buffer);c.writePos=this._buffer.writePos;this._buffer=c}this._buffer.write(i);u-=r;this._lastChunkReceivedAt=(0,_now["default"])();var l=this._expectedMessagesByType.get(this._msgType);if(0===u){var h=this._buffer.buffer;this._buffer=null;this._currentMessageLength=0;this._timers.clearTimeout("next-chunk");this.fire("message",h,this)}else{l?this._timers.resetTimeout("chunk-".concat(l.id),this._onTimeout.bind(this,l),l.chunkTimeout):this._timers.resetTimeout("next-chunk",this._onTimeout.bind(this),DataChannel.CHUNK_TIMEOUT);this.fire("chunk",this._buffer)}}catch(f){this._error("Error occurred while parsing incoming message: ".concat(f.message||f))}}},{key:"_onTimeout",value:function _onTimeout(e){if(e){this._timers.clearTimeout("chunk-".concat(e.id));this._timers.clearTimeout("msg-".concat(e.id));var t=!0,n=!1,r=undefined;try{for(var i,s=(0,_getIterator2["default"])(e.types);!(t=(i=s.next()).done);t=!0){var o=i.value;this._expectedMessagesByType["delete"](o)}}catch(u){n=!0;r=u}finally{try{t||null==s["return"]||s["return"]()}finally{if(n)throw r}}e.onErrorOrTimeout()}else a.w(DataChannel,"DataChannel receive timeout");this._buffer=null}},{key:"send",value:function send(e){R.that(e.byteLength<=DataChannel.MESSAGE_SIZE_MAX,"DataChannel.send() max message size exceeded");var t=this._sendingTag;this._sendingTag=(this._sendingTag+1)%Y.UINT8_MAX;this._sendChunked(e,t)}},{key:"_sendChunked",value:function _sendChunked(e,t){for(var n=e.byteLength,r=null;n>0;){var a=null;if(n+1>=DataChannel.CHUNK_SIZE_MAX){(a=new U(DataChannel.CHUNK_SIZE_MAX)).writeUint8(t);r=new Uint8Array(e.buffer,e.byteLength-n,DataChannel.CHUNK_SIZE_MAX-1)}else{(a=new U(n+1)).writeUint8(t);r=new Uint8Array(e.buffer,e.byteLength-n,n)}a.write(r);this.sendChunk(a);n-=r.byteLength}}},{key:"sendChunk",value:function sendChunk(e){throw new Error("Not implemented")}},{key:"readyState",get:function get(){throw new Error("Not implemented")}},{key:"lastMessageReceivedAt",get:function get(){return this._lastChunkReceivedAt}}]);return DataChannel}(i);s.CHUNK_SIZE_MAX=16384;s.MESSAGE_SIZE_MAX=10485760;s.CHUNK_TIMEOUT=5e3;s.MESSAGE_TIMEOUT=s.MESSAGE_SIZE_MAX/s.CHUNK_SIZE_MAX*s.CHUNK_TIMEOUT;n.register(s);var o=function(){function ExpectedMessage(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:s.MESSAGE_TIMEOUT,r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:s.CHUNK_TIMEOUT;(0,_classCallCheck2["default"])(this,ExpectedMessage);this.id=e.join(":");this.types=e;this._errorOrTimeoutCallback=t;this._errorOrTimeoutCallbackInvoked=!1;this.msgTimeout=n;this.chunkTimeout=r}(0,_createClass2["default"])(ExpectedMessage,[{key:"onErrorOrTimeout",value:function onErrorOrTimeout(){if(!this._errorOrTimeoutCallbackInvoked){this._errorOrTimeoutCallbackInvoked=!0;this._errorOrTimeoutCallback()}}}]);return ExpectedMessage}();s.ReadyState={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,fromString:function fromString(e){switch(e){case"connecting":return s.ReadyState.CONNECTING;case"open":return s.ReadyState.OPEN;case"closing":return s.ReadyState.CLOSING;case"closed":return s.ReadyState.CLOSED;default:throw new Error("Invalid string")}}};var u=function(){function CryptoLib(){(0,_classCallCheck2["default"])(this,CryptoLib)}(0,_createClass2["default"])(CryptoLib,null,[{key:"instance",get:function get(){if(!CryptoLib._instance){var e={};e.getRandomValues=(window.crypto||window.msCrypto).getRandomValues.bind(window.crypto);CryptoLib._instance=e}return CryptoLib._instance}}]);return CryptoLib}();u._instance=null;n.register(u);var c=function(){function WebRtcFactory(){(0,_classCallCheck2["default"])(this,WebRtcFactory)}(0,_createClass2["default"])(WebRtcFactory,null,[{key:"newPeerConnection",value:function newPeerConnection(e){return new RTCPeerConnection(e)}},{key:"newSessionDescription",value:function newSessionDescription(e){return new RTCSessionDescription(e)}},{key:"newIceCandidate",value:function newIceCandidate(e){return new RTCIceCandidate(e)}}]);return WebRtcFactory}();n.register(c);var l=function(){function WebSocketFactory(){(0,_classCallCheck2["default"])(this,WebSocketFactory)}(0,_createClass2["default"])(WebSocketFactory,null,[{key:"newWebSocketServer",value:function newWebSocketServer(){return new i}},{key:"newWebSocket",value:function newWebSocket(e){return new WebSocket(e)}}]);return WebSocketFactory}();n.register(l);var h=function(){function HttpRequest(){(0,_classCallCheck2["default"])(this,HttpRequest)}(0,_createClass2["default"])(HttpRequest,null,[{key:"get",value:function get(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:5e3;arguments.length>2&&arguments[2]!==undefined&&arguments[2];return new _promise["default"](function(n,r){var a=new XMLHttpRequest;a.open("GET",e,!0);a.responseType="text";a.timeout=t;a.onload=function(){a.readyState===XMLHttpRequest.DONE&&200===a.status?n(a.responseText):r(new Error("Request failed (status ".concat(a.status,")")))};a.onerror=r;a.onabort=r;a.ontimeout=r;a.send();setTimeout(function(){return a.abort()},t)})}}]);return HttpRequest}();n.register(h);var f=function(){function PlatformUtils(){(0,_classCallCheck2["default"])(this,PlatformUtils)}(0,_createClass2["default"])(PlatformUtils,null,[{key:"isBrowser",value:function isBrowser(){return!0}},{key:"isWeb",value:function isWeb(){return"undefined"!=typeof window}},{key:"isNodeJs",value:function isNodeJs(){return!1}},{key:"supportsWebRTC",value:function supportsWebRTC(){var e=PlatformUtils.isBrowser()?window.RTCPeerConnection||window.webkitRTCPeerConnection:null;return!!e&&"function"==typeof e.prototype.createDataChannel}},{key:"supportsWS",value:function supportsWS(){return location&&"http:"===location.protocol}},{key:"isOnline",value:function isOnline(){return!("onLine"in window.navigator)||window.navigator.onLine}},{key:"isWindows",value:function isWindows(){return/^win/.test(window.navigator.platform)}},{key:"userAgentString",get:function get(){try{return window.navigator.platform}catch(e){return"unknown"}}},{key:"hardwareConcurrency",get:function get(){return"object"===("undefined"==typeof navigator?"undefined":(0,_typeof2["default"])(navigator))&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:1}}]);return PlatformUtils}();n.register(f);var d=function(){function WasmHelper(){(0,_classCallCheck2["default"])(this,WasmHelper)}(0,_createClass2["default"])(WasmHelper,null,[{key:"doImport",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee109(){return _regenerator["default"].wrap(function _callee109$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",WasmHelper.doImportBrowser());case 1:case"end":return e.stop()}},_callee109)}));return function doImport(){return e.apply(this,arguments)}}()},{key:"doImportBrowser",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee111(){return _regenerator["default"].wrap(function _callee111$(e){for(;;)switch(e.prev=e.next){case 0:WasmHelper._importBrowserPromise=WasmHelper._importBrowserPromise||(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee110(){return _regenerator["default"].wrap(function _callee110$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return WasmHelper.importWasmBrowser("worker-wasm.wasm");case 2:if(!e.sent){e.next=7;break}e.next=5;return WasmHelper.importScriptBrowser("worker-wasm.js");case 5:e.next=9;break;case 7:e.next=9;return WasmHelper.importScriptBrowser("worker-js.js");case 9:case"end":return e.stop()}},_callee110)}))();e.prev=1;e.next=4;return WasmHelper._importBrowserPromise;case 4:e.next=10;break;case 6:e.prev=6;e.t0=e["catch"](1);WasmHelper._importBrowserPromise=null;throw e.t0;case 10:case"end":return e.stop()}},_callee111,null,[[1,6]])}));return function doImportBrowser(){return e.apply(this,arguments)}}()},{key:"importWasm",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee112(e){var t,n=arguments;return _regenerator["default"].wrap(function _callee112$(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&n[1]!==undefined?n[1]:"Module";return r.abrupt("return",WasmHelper.importWasmBrowser(e,t));case 2:case"end":return r.stop()}},_callee112)}));return function importWasm(t){return e.apply(this,arguments)}}()},{key:"importWasmBrowser",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee113(e){var t,n=arguments;return _regenerator["default"].wrap(function _callee113$(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&n[1]!==undefined?n[1]:"Module";e=WasmHelper._adjustWasmPath(e);if(WasmHelper._global.WebAssembly){r.next=5;break}a.w(WasmHelper,"No support for WebAssembly available.");return r.abrupt("return",_promise["default"].resolve(!1));case 5:return r.abrupt("return",new _promise["default"](function(n){try{var r=new XMLHttpRequest;r.open("GET",e,!0);r.responseType="arraybuffer";r.onload=function(){WasmHelper._global[t]=WasmHelper._global[t]||{};WasmHelper._global[t].wasmBinary=r.response;n(!0)};r.onerror=function(){a.w(WasmHelper,"Failed to access WebAssembly module ".concat(e));n(!1)};r.send(null)}catch(i){a.w(WasmHelper,"Failed to access WebAssembly module ".concat(e));n(!1)}}));case 6:case"end":return r.stop()}},_callee113)}));return function importWasmBrowser(t){return e.apply(this,arguments)}}()},{key:"importScript",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee114(e){var t,n=arguments;return _regenerator["default"].wrap(function _callee114$(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&n[1]!==undefined?n[1]:"Module";return r.abrupt("return",WasmHelper.importScriptBrowser(e,t));case 2:case"end":return r.stop()}},_callee114)}));return function importScript(t){return e.apply(this,arguments)}}()},{key:"importScriptBrowser",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee116(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee116$(a){for(;;)switch(a.prev=a.next){case 0:if(!((t=r.length>1&&r[1]!==undefined?r[1]:"Module")&&WasmHelper._global[t]&&WasmHelper._global[t].asm)){a.next=3;break}return a.abrupt("return",!1);case 3:e=WasmHelper._adjustScriptPath(e);n=WasmHelper._global[t]||{};return a.abrupt("return",new _promise["default"](function(){var r=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee115(r,a){var i;return _regenerator["default"].wrap(function _callee115$(s){for(;;)switch(s.prev=s.next){case 0:i=new _promise["default"](function(e){n.onRuntimeInitialized=function(){return e(!0)}});if("function"!=typeof importScripts){s.next=7;break}s.next=4;return new _promise["default"](function(n){WasmHelper._moduleLoadedCallbacks[t]=n;importScripts(e)});case 4:WasmHelper._global[t]=WasmHelper._global[t](n);s.next=19;break;case 7:if("object"!==("undefined"==typeof window?"undefined":(0,_typeof2["default"])(window))){s.next=13;break}s.next=10;return new _promise["default"](function(n){WasmHelper._moduleLoadedCallbacks[t]=n;WasmHelper._loadBrowserScript(e)});case 10:WasmHelper._global[t]=WasmHelper._global[t](n);s.next=19;break;case 13:if("function"!=typeof require){s.next=17;break}WasmHelper._global[t]=require(e)(n);s.next=19;break;case 17:a("No way to load scripts.");return s.abrupt("return");case 19:s.next=21;return i;case 21:n.asm&&!WasmHelper._global[t].asm&&(WasmHelper._global[t]=n);r(!0);case 23:case"end":return s.stop()}},_callee115)}));return function(e,t){return r.apply(this,arguments)}}()));case 6:case"end":return a.stop()}},_callee116)}));return function importScriptBrowser(t){return e.apply(this,arguments)}}()},{key:"fireModuleLoaded",value:function fireModuleLoaded(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"Module";if("function"==typeof WasmHelper._moduleLoadedCallbacks[e]){WasmHelper._moduleLoadedCallbacks[e]();WasmHelper._moduleLoadedCallbacks[e]=null}}},{key:"_loadBrowserScript",value:function _loadBrowserScript(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript";n.src=e;t.appendChild(n)}},{key:"_adjustWasmPath",value:function _adjustWasmPath(e){"undefined"!=typeof Nimiq&&Nimiq._path&&(e="".concat(Nimiq._path).concat(e));"string"==typeof __dirname&&-1===e.indexOf("/")&&(e="".concat(__dirname,"/").concat(e));return e}},{key:"_adjustScriptPath",value:function _adjustScriptPath(e){"undefined"!=typeof Nimiq&&Nimiq._path&&(e="".concat(Nimiq._path).concat(e));"string"==typeof __dirname&&-1===e.indexOf("/")&&(e="".concat(__dirname,"/").concat(e));return e}},{key:"_global",get:function get(){return"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:null}}]);return WasmHelper}();d._moduleLoadedCallbacks={};n.register(d);var A=function(){function ConstantHelper(){(0,_classCallCheck2["default"])(this,ConstantHelper);this._originalValues=new _map2["default"]}(0,_createClass2["default"])(ConstantHelper,[{key:"isConstant",value:function isConstant(e){if(e.indexOf(".")<1)return!1;var t=e.split(".",2)[0];return!(e=e.split(".",2)[1]).startsWith("_")&&(e.toUpperCase()===e&&(t in n.scope&&(!!n.scope[t]&&(!!n.scope[t].hasOwnProperty&&(!!n.scope[t].hasOwnProperty(e)&&(!!(0,_keys6["default"])(n.scope[t]).includes(e)&&"number"==typeof n.scope[t][e]))))))}},{key:"_ensureIsConstant",value:function _ensureIsConstant(e){if(!this.isConstant(e))throw new Error("".concat(e," is not a numerical constant."))}},{key:"get",value:function get(e){this._ensureIsConstant(e);var t=e.split(".",2)[0];e=e.split(".",2)[1];return n.scope[t][e]}},{key:"set",value:function set(e,t){this._ensureIsConstant(e);this._originalValues.has(e)||this._originalValues.set(e,this.get(e));var r=e.split(".",2)[0];e=e.split(".",2)[1];n.scope[r][e]=t}},{key:"reset",value:function reset(e){this._ensureIsConstant(e);if(this._originalValues.has(e)){this.set(e,this._originalValues.get(e));this._originalValues["delete"](e)}}},{key:"resetAll",value:function resetAll(){var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._originalValues.keys());!(e=(r=a.next()).done);e=!0){var i=r.value;this.set(i,this._originalValues.get(i))}}catch(s){t=!0;n=s}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}this._originalValues.clear()}}],[{key:"instance",get:function get(){ConstantHelper._instance||(ConstantHelper._instance=new ConstantHelper);return ConstantHelper._instance}}]);return ConstantHelper}();n.register(A);var _=function(){function Services(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Services.NONE,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Services.NONE;(0,_classCallCheck2["default"])(this,Services);this._provided=e;this._accepted=t}(0,_createClass2["default"])(Services,[{key:"provided",get:function get(){return this._provided},set:function set(e){this._provided=e}},{key:"accepted",get:function get(){return this._accepted},set:function set(e){this._accepted=e}}],[{key:"isFullNode",value:function isFullNode(e){return 0!=(e&Services.FLAG_FULL)}},{key:"isLightNode",value:function isLightNode(e){return 0!=(e&Services.FLAG_LIGHT)}},{key:"isNanoNode",value:function isNanoNode(e){return e===Services.FLAG_NANO}},{key:"providesServices",value:function providesServices(e){e=Services.legacyProvideToCurrent(e);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.reduce(function(e,t){return e|t})&Services.ALL_CURRENT;return(e&a)===a}},{key:"legacyProvideToCurrent",value:function legacyProvideToCurrent(e){e===Services.FLAG_NANO&&(e=Services.PROVIDES_NANO);e===Services.FLAG_LIGHT&&(e=Services.PROVIDES_LIGHT);e===Services.FLAG_FULL&&(e=Services.PROVIDES_FULL);return e}},{key:"toNameArray",value:function toNameArray(e){var t=[],n=1;do{(e&n)===n&&Services.NAMES[n]&&t.push(Services.NAMES[n]);n<<=1}while(n<Services.ALL_CURRENT);return t}}]);return Services}();_.NONE=0;_.FLAG_NANO=1;_.FLAG_LIGHT=2;_.FLAG_FULL=4;_.ALL_LEGACY=7;_.FULL_BLOCKS=8;_.BLOCK_HISTORY=16;_.BLOCK_PROOF=32;_.CHAIN_PROOF=64;_.ACCOUNTS_PROOF=128;_.ACCOUNTS_CHUNKS=256;_.MEMPOOL=512;_.TRANSACTION_INDEX=1024;_.BODY_PROOF=2048;_.ALL_CURRENT=4095-_.ALL_LEGACY;_.NAMES={};_.NAMES[_.FULL_BLOCKS]="FULL_BLOCKS";_.NAMES[_.BLOCK_HISTORY]="BLOCK_HISTORY";_.NAMES[_.BLOCK_PROOF]="BLOCK_PROOF";_.NAMES[_.CHAIN_PROOF]="CHAIN_PROOF";_.NAMES[_.ACCOUNTS_PROOF]="ACCOUNTS_PROOF";_.NAMES[_.ACCOUNTS_CHUNKS]="ACCOUNTS_CHUNKS";_.NAMES[_.MEMPOOL]="MEMPOOL";_.NAMES[_.TRANSACTION_INDEX]="TRANSACTION_INDEX";_.NAMES[_.BODY_PROOF]="BODY_PROOF";_.PROVIDES_FULL=_.FLAG_FULL|_.ALL_CURRENT;_.PROVIDES_LIGHT=_.FLAG_LIGHT|_.FULL_BLOCKS|_.BLOCK_PROOF|_.CHAIN_PROOF|_.ACCOUNTS_PROOF|_.ACCOUNTS_CHUNKS|_.MEMPOOL|_.BODY_PROOF;_.PROVIDES_NANO=_.FLAG_NANO|_.CHAIN_PROOF;_.PROVIDES_PICO=_.NONE;_.ACCEPTS_FULL=_.FLAG_FULL|_.FULL_BLOCKS|_.BLOCK_HISTORY;_.ACCEPTS_LIGHT=_.FLAG_LIGHT|_.FLAG_FULL|_.FULL_BLOCKS|_.CHAIN_PROOF|_.ACCOUNTS_CHUNKS;_.ACCEPTS_NANO=_.FLAG_NANO|_.FLAG_LIGHT|_.FLAG_FULL|_.CHAIN_PROOF;_.ACCEPTS_PICO=_.FLAG_NANO|_.FLAG_LIGHT|_.FLAG_FULL;_.ACCEPTS_SPV=_.BLOCK_PROOF|_.ACCOUNTS_PROOF|_.MEMPOOL|_.TRANSACTION_INDEX|_.BODY_PROOF;n.register(_);var p=function(){function Timers(){(0,_classCallCheck2["default"])(this,Timers);this._timeouts=(0,_create["default"])(null);this._intervals=(0,_create["default"])(null)}(0,_createClass2["default"])(Timers,[{key:"setTimeout",value:function(e){function setTimeout(t,n,r){return e.apply(this,arguments)}setTimeout.toString=function(){return e.toString()};return setTimeout}(function(e,t,n){if(this._timeouts[e])throw new Error("Duplicate timeout for key ".concat(e));this._timeouts[e]=setTimeout(t,n)})},{key:"clearTimeout",value:function(e){function clearTimeout(t){return e.apply(this,arguments)}clearTimeout.toString=function(){return e.toString()};return clearTimeout}(function(e){clearTimeout(this._timeouts[e]);delete this._timeouts[e]})},{key:"resetTimeout",value:function resetTimeout(e,t,n){clearTimeout(this._timeouts[e]);this._timeouts[e]=setTimeout(t,n)}},{key:"timeoutExists",value:function timeoutExists(e){return this._timeouts[e]!==undefined}},{key:"setInterval",value:function(e){function setInterval(t,n,r){return e.apply(this,arguments)}setInterval.toString=function(){return e.toString()};return setInterval}(function(e,t,n){if(this._intervals[e])throw new Error("Duplicate interval for key ".concat(e));this._intervals[e]=setInterval(t,n)})},{key:"clearInterval",value:function(e){function clearInterval(t){return e.apply(this,arguments)}clearInterval.toString=function(){return e.toString()};return clearInterval}(function(e){clearInterval(this._intervals[e]);delete this._intervals[e]})},{key:"resetInterval",value:function resetInterval(e,t,n){clearInterval(this._intervals[e]);this._intervals[e]=setInterval(t,n)}},{key:"intervalExists",value:function intervalExists(e){return this._intervals[e]!==undefined}},{key:"clearAll",value:function clearAll(){for(var e in this._timeouts)this.clearTimeout(e);for(var t in this._intervals)this.clearInterval(t)}}]);return Timers}();n.register(p);var g=function(){function Version(){(0,_classCallCheck2["default"])(this,Version)}(0,_createClass2["default"])(Version,null,[{key:"isCompatible",value:function isCompatible(e){return e>=1}},{key:"createUserAgent",value:function createUserAgent(e){(e=e?e.trim():"").length>0&&(e=" ".concat(e));var t=f.isBrowser()?"browser; ":f.isNodeJs()?"nodejs; ":"";return"core-js/".concat(Version.CORE_JS_VERSION," (").concat(t).concat(f.userAgentString,")").concat(e)}}]);return Version}();g.CODE=2;g.CORE_JS_VERSION="<filled-by-build-system>";n.register(g);g.CORE_JS_VERSION="1.5.8";var y=function(){function Time(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;(0,_classCallCheck2["default"])(this,Time);this._offset=e}(0,_createClass2["default"])(Time,[{key:"now",value:function now(){return(0,_now["default"])()+this._offset}},{key:"offset",get:function get(){return this._offset},set:function set(e){this._offset=e}}]);return Time}();n.register(y);var v=function(){function EventLoopHelper(){(0,_classCallCheck2["default"])(this,EventLoopHelper)}(0,_createClass2["default"])(EventLoopHelper,null,[{key:"webYield",value:function webYield(){return f.isWeb()?EventLoopHelper.yield():_promise["default"].resolve()}},{key:"yield",value:function _yield(){return new _promise["default"](function(e){return setTimeout(e)})}}]);return EventLoopHelper}();n.register(v);var k=function(){function IteratorUtils(){(0,_classCallCheck2["default"])(this,IteratorUtils)}(0,_createClass2["default"])(IteratorUtils,null,[{key:"alternate",value:function alternate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.length,a=0,i=!1,s=function it(){if(!i)for(var e=0;e<r;e++){var n=t[a].next();a=(a+1)%r;if(!n.done)return n}i=!0;return{done:!0}};return(0,_defineProperty2["default"])({next:s},_iterator276["default"],function(){return{next:s}})}}]);return IteratorUtils}();n.register(k);var m=function(){function ArrayUtils(){(0,_classCallCheck2["default"])(this,ArrayUtils)}(0,_createClass2["default"])(ArrayUtils,null,[{key:"randomElement",value:function randomElement(e){return e[Math.floor(Math.random()*e.length)]}},{key:"subarray",value:function subarray(e,t,n){function clamp(e,t,n){return e<t?t:e>n?n:e}t===undefined&&(t=0);n===undefined&&(n=e.byteLength);t=clamp(t,0,e.byteLength);var r=(n=clamp(n,0,e.byteLength))-t;r<0&&(r=0);return new Uint8Array(e.buffer,e.byteOffset+t,r)}},{key:"k_combinations",value:_regenerator["default"].mark(function k_combinations(e,t){var n,r,a,i,s;return _regenerator["default"].wrap(function k_combinations$(o){for(;;)switch(o.prev=o.next){case 0:n=e.length;if(!(t>n)){o.next=3;break}return o.abrupt("return");case 3:r=(0,_from["default"])(new Array(t),function(e,t){return t});o.next=6;return r.map(function(t){return e[t]});case 6:a=(0,_from["default"])(new Array(t),function(e,n){return t-n-1});i=_regenerator["default"].mark(function _loop5(){var i,s,o,u,c,l,h,f,d,A;return _regenerator["default"].wrap(function _loop5$(_){for(;;)switch(_.prev=_.next){case 0:i=t-1,s=!1;o=!0;u=!1;c=undefined;_.prev=4;l=(0,_getIterator2["default"])(a);case 6:if(o=(h=l.next()).done){_.next=14;break}i=h.value;if(r[i]===i+n-t){_.next=11;break}s=!0;return _.abrupt("break",14);case 11:o=!0;_.next=6;break;case 14:_.next=20;break;case 16:_.prev=16;_.t0=_["catch"](4);u=!0;c=_.t0;case 20:_.prev=20;_.prev=21;o||null==l["return"]||l["return"]();case 23:_.prev=23;if(!u){_.next=26;break}throw c;case 26:return _.finish(23);case 27:return _.finish(20);case 28:if(s){_.next=30;break}return _.abrupt("return",{v:void 0});case 30:r[i]+=1;for(f=0,d=(0,_from["default"])(new Array(t-i-1),function(e,t){return i+t+1});f<d.length;f++){A=d[f];r[A]=r[A-1]+1}_.next=34;return r.map(function(t){return e[t]});case 34:case"end":return _.stop()}},_loop5,null,[[4,16,20,28],[21,,23,27]])});case 8:0;return o.delegateYield(i(),"t0",10);case 10:s=o.t0;if("object"!==(0,_typeof2["default"])(s)){o.next=13;break}return o.abrupt("return",s.v);case 13:o.next=8;break;case 15:case"end":return o.stop()}},k_combinations)})}]);return ArrayUtils}();n.register(m);var b=function(){function HashMap(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:HashMap._hash;(0,_classCallCheck2["default"])(this,HashMap);this._map=new _map2["default"];this._fnHash=e}(0,_createClass2["default"])(HashMap,[{key:"get",value:function get(e){return this._map.get(this._fnHash(e))}},{key:"put",value:function put(e,t){this._map.set(this._fnHash(e),t)}},{key:"remove",value:function remove(e){this._map["delete"](this._fnHash(e))}},{key:"clear",value:function clear(){this._map.clear()}},{key:"contains",value:function contains(e){return this._map.has(this._fnHash(e))}},{key:"keys",value:function keys(){return(0,_from["default"])(this._map.keys())}},{key:"keyIterator",value:function keyIterator(){return this._map.keys()}},{key:"values",value:function values(){return(0,_from["default"])(this._map.values())}},{key:"valueIterator",value:function valueIterator(){return this._map.values()}},{key:"entries",value:function entries(){return(0,_from["default"])(this._map.entries())}},{key:"entryIterator",value:function entryIterator(){return this._map.entries()}},{key:"isEmpty",value:function isEmpty(){return 0===this._map.size}},{key:"length",get:function get(){return this._map.size}}],[{key:"_hash",value:function _hash(e){return null===e||e===undefined?e:e.hashCode?e.hashCode():e.toString()}}]);return HashMap}();n.register(b);var w=function(){function HashSet(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:HashSet._hash;(0,_classCallCheck2["default"])(this,HashSet);this._map=new _map2["default"];this._fnHash=e}(0,_createClass2["default"])(HashSet,[{key:"add",value:function add(e){this._map.set(this._fnHash(e),e)}},{key:"addAll",value:function addAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.add(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"get",value:function get(e){return this._map.get(this._fnHash(e))}},{key:"remove",value:function remove(e){this._map["delete"](this._fnHash(e))}},{key:"removeAll",value:function removeAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.remove(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"clear",value:function clear(){this._map.clear()}},{key:"contains",value:function contains(e){return this._map.has(this._fnHash(e))}},{key:"values",value:function values(){return(0,_from["default"])(this._map.values())}},{key:"valueIterator",value:function valueIterator(){return this._map.values()}},{key:_iterator276["default"],value:function value(){return this.valueIterator()}},{key:"isEmpty",value:function isEmpty(){return 0===this._map.size}},{key:"length",get:function get(){return this._map.size}}],[{key:"_hash",value:function _hash(e){return null===e||e===undefined?e:e.hashCode?e.hashCode():e.toString()}}]);return HashSet}();n.register(w);var C=function(){function LimitHashSet(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:LimitHashSet._hash;(0,_classCallCheck2["default"])(this,LimitHashSet);if(e<=0)throw new Error("Invalid limit");this._limit=e;this._fnHash=t;this._list=new I(t)}(0,_createClass2["default"])(LimitHashSet,[{key:"add",value:function add(e){this._list.push(e,!0);this._list.length>this._limit&&this._list.shift()}},{key:"addAll",value:function addAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.add(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"get",value:function get(e){return this._list.get(e)}},{key:"remove",value:function remove(e){this._list.remove(e)}},{key:"removeAll",value:function removeAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.remove(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"clear",value:function clear(){this._list.clear()}},{key:"contains",value:function contains(e){return this._list.contains(e)}},{key:"values",value:function values(){return(0,_from["default"])(this._list.iterator())}},{key:"valueIterator",value:function valueIterator(){return this._list.iterator()}},{key:_iterator276["default"],value:function value(){return this.valueIterator()}},{key:"isEmpty",value:function isEmpty(){return 0===this._list.length}},{key:"length",get:function get(){return this._list.length}}],[{key:"_hash",value:function _hash(e){return null===e||e===undefined?e:e.hashCode?e.hashCode():e.toString()}}]);return LimitHashSet}();n.register(C);var S=function(){function InclusionHashSet(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:InclusionHashSet._hash;(0,_classCallCheck2["default"])(this,InclusionHashSet);this._set=new _set5["default"];this._fnHash=e}(0,_createClass2["default"])(InclusionHashSet,[{key:"add",value:function add(e){this._set.add(this._fnHash(e))}},{key:"addAll",value:function addAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.add(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"remove",value:function remove(e){this._set["delete"](this._fnHash(e))}},{key:"removeAll",value:function removeAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.remove(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"clear",value:function clear(){this._set.clear()}},{key:"contains",value:function contains(e){return this._set.has(this._fnHash(e))}},{key:"values",value:function values(){return(0,_from["default"])(this._set.values())}},{key:"valueIterator",value:function valueIterator(){return this._set.values()}},{key:_iterator276["default"],value:function value(){return this.valueIterator()}},{key:"isEmpty",value:function isEmpty(){return 0===this._set.size}},{key:"_addHashed",value:function _addHashed(e){this._set.add(e)}},{key:"clone",value:function clone(){var e=new InclusionHashSet(this._fnHash),t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this);!(t=(a=i.next()).done);t=!0){var s=a.value;e._addHashed(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"length",get:function get(){return this._set.size}}],[{key:"_hash",value:function _hash(e){return null===e||e===undefined?e:e.hashCode?e.hashCode():e.toString()}}]);return InclusionHashSet}();n.register(S);var T=function(){function LimitInclusionHashSet(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:LimitInclusionHashSet._hash;(0,_classCallCheck2["default"])(this,LimitInclusionHashSet);if(e<=0)throw new Error("Invalid limit");this._limit=e;this._fnHash=t;this._list=new I(function(e){return e})}(0,_createClass2["default"])(LimitInclusionHashSet,[{key:"add",value:function add(e){this.length>=this._limit&&this._list.shift();this._list.push(this._fnHash(e))}},{key:"addAll",value:function addAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.add(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"remove",value:function remove(e){this._list.remove(this._fnHash(e))}},{key:"removeAll",value:function removeAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.remove(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"clear",value:function clear(){this._list.clear()}},{key:"contains",value:function contains(e){return this._list.contains(this._fnHash(e))}},{key:"values",value:function values(){return(0,_from["default"])(this._list)}},{key:"valueIterator",value:function valueIterator(){return this._list.iterator()}},{key:_iterator276["default"],value:function value(){return this.valueIterator()}},{key:"isEmpty",value:function isEmpty(){return 0===this._list.length}},{key:"_addHashed",value:function _addHashed(e){this._list.push(e)}},{key:"clone",value:function clone(){var e=new LimitInclusionHashSet(this._limit,this._fnHash),t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this);!(t=(a=i.next()).done);t=!0){var s=a.value;e._addHashed(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"length",get:function get(){return this._list.length}}],[{key:"_hash",value:function _hash(e){return null===e||e===undefined?e:e.hashCode?e.hashCode():e.toString()}}]);return LimitInclusionHashSet}();n.register(T);var E=function(){function LimitIterable(e,t){(0,_classCallCheck2["default"])(this,LimitIterable);this._iterator=e[_iterator276["default"]]?(0,_getIterator2["default"])(e):e;this._limit=t}(0,_createClass2["default"])(LimitIterable,[{key:_iterator276["default"],value:function value(){return LimitIterable.iterator(this._iterator,this._limit)}}],[{key:"iterator",value:function(e){function iterator(t,n){return e.apply(this,arguments)}iterator.toString=function(){return e.toString()};return iterator}(function(e,t){var n=0;return{next:function next(){var r=n++>=t,next=e.next();return{value:r?undefined:next.value,done:r||next.done}}}})}]);return LimitIterable}();n.register(E);var x=function(){function LinkedList(){(0,_classCallCheck2["default"])(this,LinkedList);this._length=0;this._head=null;this._tail=null;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=1===t.length&&(0,_isArray["default"])(t[0])?t[0]:t,a=!0,i=!1,s=undefined;try{for(var o,u=(0,_getIterator2["default"])(r);!(a=(o=u.next()).done);a=!0){var c=o.value;this.push(c)}}catch(l){i=!0;s=l}finally{try{a||null==u["return"]||u["return"]()}finally{if(i)throw s}}}(0,_createClass2["default"])(LinkedList,[{key:"push",value:function push(e){var t={next:null,prev:this._head,value:e};this._push(t)}},{key:"_push",value:function _push(e){this._length++;if(this._head){this._head.next=e;this._head=e}else{this._head=e;this._tail=e}}},{key:"unshift",value:function unshift(e){var t={next:this._tail,prev:null,value:e};this._unshift(t)}},{key:"_unshift",value:function _unshift(e){this._length++;if(this._head){this._tail.prev=e;this._tail=e}else{this._head=e;this._tail=e}}},{key:"pop",value:function pop(){if(!this._head)return null;this._length--;var e=this._head,t=e.prev;if(!t){this._head=null;this._tail=null;return e.value}t.next=null;this._head=t;return e.value}},{key:"shift",value:function shift(){if(!this._head)return null;this._length--;var e=this._tail,t=e.next;if(!t){this._head=null;this._tail=null;return e.value}t.prev=null;this._tail=t;return e.value}},{key:"_remove",value:function _remove(e){if(e===this._head)this.pop();else if(e===this._tail)this.shift();else{this._length--;e.prev.next=e.next;e.next.prev=e.prev}}},{key:"clear",value:function clear(){this._length=0;this._head=null;this._tail=null}},{key:_iterator276["default"],value:function value(){return this.iterator()}},{key:"iterator",value:_regenerator["default"].mark(function iterator(){var e;return _regenerator["default"].wrap(function iterator$(t){for(;;)switch(t.prev=t.next){case 0:e=this._tail;case 1:if(!e){t.next=7;break}t.next=4;return e.value;case 4:e=e.next;t.next=1;break;case 7:case"end":return t.stop()}},iterator,this)})},{key:"isEmpty",value:function isEmpty(){return 0===this._length}},{key:"first",get:function get(){return this._tail?this._tail.value:null}},{key:"last",get:function get(){return this._head?this._head.value:null}},{key:"length",get:function get(){return this._length}}]);return LinkedList}();n.register(x);var I=function(e){(0,_inherits2["default"])(UniqueLinkedList,e);var t=_createSuper(UniqueLinkedList);function UniqueLinkedList(e){var n;(0,_classCallCheck2["default"])(this,UniqueLinkedList);(n=t.call(this))._map=new b(e);return n}(0,_createClass2["default"])(UniqueLinkedList,[{key:"push",value:function push(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1],n=this._map.get(e);if(n){n.value=e;t&&this._moveBack(n)}else(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"push",this).call(this,e)}},{key:"_push",value:function _push(e){(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_push",this).call(this,e);this._map.put(e.value,e)}},{key:"unshift",value:function unshift(e){this._map.contains(e)||(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"unshift",this).call(this,e)}},{key:"_unshift",value:function _unshift(e){(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_unshift",this).call(this,e);this._map.put(e.value,e)}},{key:"pop",value:function pop(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"pop",this).call(this);this._map.remove(e);return e}},{key:"shift",value:function shift(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"shift",this).call(this);this._map.remove(e);return e}},{key:"clear",value:function clear(){(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"clear",this).call(this);this._map.clear()}},{key:"get",value:function get(e){var t=this._map.get(e);return t&&t.value}},{key:"contains",value:function contains(e){return this._map.contains(e)}},{key:"remove",value:function remove(e){var t=this._map.get(e);if(t){(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"_remove",this).call(this,t);this._map.remove(e)}}},{key:"moveBack",value:function moveBack(e){var t=this._map.get(e);t?this._moveBack(t):(0,_get10["default"])((0,_getPrototypeOf2["default"])(UniqueLinkedList.prototype),"push",this).call(this,e)}},{key:"_moveBack",value:function _moveBack(e){if(e!==this._head){if(e===this._tail){e.next.prev=null;this._tail=e.next}else{e.prev.next=e.next;e.next.prev=e.prev}e.next=null;e.prev=this._head;this._head.next=e;this._head=e}}}]);return UniqueLinkedList}(x);n.register(I);var B=function(){function Queue(){(0,_classCallCheck2["default"])(this,Queue);this._queue=this._newQueue.apply(this,arguments)}(0,_createClass2["default"])(Queue,[{key:"_newQueue",value:function _newQueue(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,_construct3["default"])(x,t)}},{key:"enqueue",value:function enqueue(e){this._queue.push(e)}},{key:"enqueueAll",value:function enqueueAll(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(e);!(t=(a=i.next()).done);t=!0){var s=a.value;this.enqueue(s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"dequeue",value:function dequeue(){return this._queue.shift()}},{key:"dequeueMulti",value:function dequeueMulti(e){e=Math.min(this._queue.length,e);for(var t=[],n=0;n<e;n++)t.push(this.dequeue());return t}},{key:"peek",value:function peek(){return this._queue.first}},{key:"clear",value:function clear(){this._queue.clear()}},{key:"isEmpty",value:function isEmpty(){return this._queue.isEmpty()}},{key:"length",get:function get(){return this._queue.length}}]);return Queue}();n.register(B);var P=function(e){(0,_inherits2["default"])(UniqueQueue,e);var t=_createSuper(UniqueQueue);function UniqueQueue(e){(0,_classCallCheck2["default"])(this,UniqueQueue);return t.call(this,e)}(0,_createClass2["default"])(UniqueQueue,[{key:"_newQueue",value:function _newQueue(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,_construct3["default"])(I,t)}},{key:"contains",value:function contains(e){return this._queue.contains(e)}},{key:"remove",value:function remove(e){this._queue.remove(e)}},{key:"requeue",value:function requeue(e){this._queue.moveBack(e)}}]);return UniqueQueue}(B);n.register(P);var N=function(e){(0,_inherits2["default"])(ThrottledQueue,e);var t=_createSuper(ThrottledQueue);function ThrottledQueue(){var e,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Number.POSITIVE_INFINITY,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:n,a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1e3,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Number.POSITIVE_INFINITY,s=arguments.length>4?arguments[4]:undefined;(0,_classCallCheck2["default"])(this,ThrottledQueue);(e=t.call(this))._maxSize=i;e._maxAtOnce=n;e._availableNow=e._maxAtOnce;e._timers=new p;e._timers.setInterval("allowance",function(){e._availableNow=Math.min(e._maxAtOnce,e._availableNow+r);"function"==typeof s&&e.isAvailable()&&s()},a);return e}(0,_createClass2["default"])(ThrottledQueue,[{key:"stop",value:function stop(){this._timers.clearAll()}},{key:"enqueue",value:function enqueue(e){this.length>=this._maxSize&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(ThrottledQueue.prototype),"dequeue",this).call(this);(0,_get10["default"])((0,_getPrototypeOf2["default"])(ThrottledQueue.prototype),"enqueue",this).call(this,e)}},{key:"dequeue",value:function dequeue(){if(this.available>0){this._availableNow--;return(0,_get10["default"])((0,_getPrototypeOf2["default"])(ThrottledQueue.prototype),"dequeue",this).call(this)}return null}},{key:"dequeueMulti",value:function dequeueMulti(e){e=Math.min(this.available,e);return(0,_get10["default"])((0,_getPrototypeOf2["default"])(ThrottledQueue.prototype),"dequeueMulti",this).call(this,e)}},{key:"isAvailable",value:function isAvailable(){return this.available>0}},{key:"available",get:function get(){return Math.min(this._availableNow,this.length)}}]);return ThrottledQueue}(P);n.register(N);var O=function(){function SortedList(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],t=arguments.length>1?arguments[1]:undefined;(0,_classCallCheck2["default"])(this,SortedList);this._list=e;this._compare=t||SortedList._compare}(0,_createClass2["default"])(SortedList,[{key:"indexOf",value:function indexOf(e){for(var t=0,n=this._list.length-1,r=null,a=null;t<=n;){r=Math.floor((t+n)/2);a=this._list[r];if(this._compare(a,e)<0)t=r+1;else{if(!(this._compare(a,e)>0)){for(;r>0&&0==this._compare(this._list[r-1],e);)r--;return r}n=r-1}}return-1}},{key:"_insertionIndex",value:function _insertionIndex(e){for(var t=0,n=this._list.length-1,r=null,a=null;t<=n;){r=Math.floor((t+n)/2);a=this._list[r];if(this._compare(a,e)<0)t=r+1;else{if(!(this._compare(a,e)>0))return r;n=r-1}}return n+1}},{key:"add",value:function add(e){this._list.splice(this._insertionIndex(e),0,e)}},{key:"shift",value:function shift(){return this._list.shift()}},{key:"pop",value:function pop(){return this._list.pop()}},{key:"peekFirst",value:function peekFirst(){return this._list[0]}},{key:"peekLast",value:function peekLast(){return this._list[this._list.length-1]}},{key:"remove",value:function remove(e){var t=this.indexOf(e);t>-1&&this._list.splice(t,1)}},{key:"clear",value:function clear(){this._list=[]}},{key:"values",value:function values(){return this._list}},{key:_iterator276["default"],value:function value(){return(0,_getIterator2["default"])(this._list)}},{key:"copy",value:function copy(){return new SortedList(this._list.slice(),this._compare)}},{key:"length",get:function get(){return this._list.length}}],[{key:"_compare",value:function _compare(e,t){return e.compare?e.compare(t):e>t?1:e<t?-1:0}}]);return SortedList}();n.register(O);var R=function(){function Assert(){(0,_classCallCheck2["default"])(this,Assert)}(0,_createClass2["default"])(Assert,null,[{key:"that",value:function that(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"Assertion failed";if(!e)throw new Error(t)}}]);return Assert}();n.register(R);var M=function(){function BufferUtils(){(0,_classCallCheck2["default"])(this,BufferUtils)}(0,_createClass2["default"])(BufferUtils,null,[{key:"toAscii",value:function toAscii(e){for(var t=BufferUtils._toUint8View(e),n="",r=0;r<t.length;r+=8192)n+=String.fromCharCode.apply(null,t.subarray(r,r+8192));return n}},{key:"fromAscii",value:function fromAscii(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t}},{key:"_codePointTextDecoder",value:function _codePointTextDecoder(e){if("undefined"==typeof TextDecoder)throw new Error("TextDecoder not supported");if(null===BufferUtils._ISO_8859_15_DECODER)throw new Error("TextDecoder does not support iso-8859-15");if(BufferUtils._ISO_8859_15_DECODER===undefined)try{BufferUtils._ISO_8859_15_DECODER=new TextDecoder("iso-8859-15")}catch(n){BufferUtils._ISO_8859_15_DECODER=null;throw new Error("TextDecoder does not support iso-8859-15")}var t=BufferUtils._toUint8View(e);return BufferUtils._ISO_8859_15_DECODER.decode(t).replace(/\u20ac/g,"¤").replace(/\u0160/g,"¦").replace(/\u0161/g,"¨").replace(/\u017d/g,"´").replace(/\u017e/g,"¸").replace(/\u0152/g,"¼").replace(/\u0153/g,"½").replace(/\u0178/g,"¾")}},{key:"_tripletToBase64",value:function _tripletToBase64(e){return BufferUtils._BASE64_LOOKUP[e>>18&63]+BufferUtils._BASE64_LOOKUP[e>>12&63]+BufferUtils._BASE64_LOOKUP[e>>6&63]+BufferUtils._BASE64_LOOKUP[63&e]}},{key:"_base64encodeChunk",value:function _base64encodeChunk(e,t,n){for(var r,a=[],i=t;i<n;i+=3){r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]);a.push(BufferUtils._tripletToBase64(r))}return a.join("")}},{key:"_base64fromByteArray",value:function _base64fromByteArray(e){for(var t,n=e.length,r=n%3,a="",i=[],s=0,o=n-r;s<o;s+=16383)i.push(BufferUtils._base64encodeChunk(e,s,s+16383>o?o:s+16383));if(1===r){t=e[n-1];a+=BufferUtils._BASE64_LOOKUP[t>>2];a+=BufferUtils._BASE64_LOOKUP[t<<4&63];a+="=="}else if(2===r){t=(e[n-2]<<8)+e[n-1];a+=BufferUtils._BASE64_LOOKUP[t>>10];a+=BufferUtils._BASE64_LOOKUP[t>>4&63];a+=BufferUtils._BASE64_LOOKUP[t<<2&63];a+="="}i.push(a);return i.join("")}},{key:"toBase64",value:function toBase64(e){if(f.isNodeJs())return Buffer.from(e).toString("base64");if("undefined"!=typeof TextDecoder&&null!==BufferUtils._ISO_8859_15_DECODER)try{return btoa(BufferUtils._codePointTextDecoder(e))}catch(t){}return BufferUtils._base64fromByteArray(BufferUtils._toUint8View(e))}},{key:"fromBase64",value:function fromBase64(e,t){var n=new Uint8Array(atob(e).split("").map(function(e){return e.charCodeAt(0)}));if(t!==undefined&&n.length!==t)throw new Error("Decoded length does not match expected length");return new U(n)}},{key:"toBase64Url",value:function toBase64Url(e){return BufferUtils.toBase64(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,".")}},{key:"fromBase64Url",value:function fromBase64Url(e,t){return BufferUtils.fromBase64(e.replace(/_/g,"/").replace(/-/g,"+").replace(/\./g,"="),t)}},{key:"toBase32",value:function toBase32(e){var t,n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:BufferUtils.BASE32_ALPHABET.NIMIQ,a=3,i=0,s="";for(n=0;n<e.length;n++){s+=r[31&(i|(t=e[n])>>a)];a>5&&(s+=r[31&t>>(a-=5)]);i=t<<(a=5-a);a=8-a}3!==a&&(s+=r[31&i]);for(;s.length%8!=0&&33===r.length;)s+=r[32];return s}},{key:"fromBase32",value:function fromBase32(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:BufferUtils.BASE32_ALPHABET.NIMIQ,n=[];t.toUpperCase().split("").forEach(function(e,t){e in n||(n[e]=t)});var r,a=8,i=0,s=[];e.toUpperCase().split("").forEach(function(e){if(33!==t.length||e!==t[32]){r=255&n[e];if((a-=5)>0)i|=r<<a;else if(a<0){s.push(i|r>>-a);i=r<<(a+=8)&255}else{s.push(i|r);a=8;i=0}}});8!==a&&0!==i&&s.push(i);return new Uint8Array(s)}},{key:"toHex",value:function toHex(e){for(var t="",n=0;n<e.length;n++){var r=e[n];t+=BufferUtils.HEX_ALPHABET[r>>>4];t+=BufferUtils.HEX_ALPHABET[15&r]}return t}},{key:"fromHex",value:function fromHex(e,t){e=e.trim();if(!ne.isHexBytes(e,t))throw new Error("String is not an hex string (of matching length)");return new U(new Uint8Array((e.match(/.{2}/g)||[]).map(function(e){return(0,_parseInt2["default"])(e,16)})))}},{key:"toBinary",value:function toBinary(e){for(var t="",n=0;n<e.length;n++){var r=e[n];t+=ne.lpad(r.toString(2),"0",8)}return t}},{key:"_strToUint8Array",value:function _strToUint8Array(e){for(var t=[],n=0,r=0;r<e.length;r++){var a=e.charCodeAt(r);if(a<128)t[n++]=a;else if(a<2048){t[n++]=a>>6|192;t[n++]=63&a|128}else if(55296==(64512&a)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))){a=65536+((1023&a)<<10)+(1023&e.charCodeAt(++r));t[n++]=a>>18|240;t[n++]=a>>12&63|128;t[n++]=a>>6&63|128;t[n++]=63&a|128}else{t[n++]=a>>12|224;t[n++]=a>>6&63|128;t[n++]=63&a|128}}return new Uint8Array(t)}},{key:"_utf8TextEncoder",value:function _utf8TextEncoder(e){if("undefined"==typeof TextEncoder)throw new Error("TextEncoder not supported");if(null===BufferUtils._UTF8_ENCODER)throw new Error("TextEncoder does not support utf8");if(BufferUtils._UTF8_ENCODER===undefined)try{BufferUtils._UTF8_ENCODER=new TextEncoder}catch(t){BufferUtils._UTF8_ENCODER=null;throw new Error("TextEncoder does not support utf8")}return BufferUtils._UTF8_ENCODER.encode(e)}},{key:"fromUtf8",value:function fromUtf8(e){if(f.isNodeJs())return Buffer.from(e);if("undefined"!=typeof TextEncoder&&null!==BufferUtils._UTF8_ENCODER)try{return BufferUtils._utf8TextEncoder(e)}catch(t){}return BufferUtils._strToUint8Array(e)}},{key:"fromAny",value:function fromAny(e,t){if(""===e)return U.EMPTY;if(!e)throw new Error("Invalid buffer format");if(e instanceof Uint8Array)return new U(e);try{return BufferUtils.fromHex(e,t)}catch(n){}try{return BufferUtils.fromBase64(e,t)}catch(n){}throw new Error("Invalid buffer format")}},{key:"concatTypedArrays",value:function concatTypedArrays(e,t){var n=new e.constructor(e.length+t.length);n.set(e,0);n.set(t,e.length);return n}},{key:"equals",value:function equals(e,t){var n=BufferUtils._toUint8View(e),r=BufferUtils._toUint8View(t);if(n.length!==r.length)return!1;for(var a=0;a<n.length;a++)if(n[a]!==r[a])return!1;return!0}},{key:"compare",value:function compare(e,t){if(e.length<t.length)return-1;if(e.length>t.length)return 1;for(var n=0;n<e.length;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0}},{key:"xor",value:function xor(e,t){for(var n=new Uint8Array(e.byteLength),r=0;r<e.byteLength;++r)n[r]=e[r]^t[r];return n}},{key:"_toUint8View",value:function _toUint8View(e){if(e instanceof Uint8Array)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e.buffer instanceof ArrayBuffer)return new Uint8Array(e.buffer);throw new Error("TypedArray or ArrayBuffer required")}}]);return BufferUtils}();M.BASE64_ALPHABET="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";M.BASE32_ALPHABET={RFC4648:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",RFC4648_HEX:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",NIMIQ:"0123456789ABCDEFGHJKLMNPQRSTUVXY"};M.HEX_ALPHABET="0123456789abcdef";M._BASE64_LOOKUP=[];for(var L=0,D=M.BASE64_ALPHABET.length;L<D;++L)M._BASE64_LOOKUP[L]=M.BASE64_ALPHABET[L];n.register(M);var U=function(e){(0,_inherits2["default"])(SerialBuffer,e);var t=_createSuper(SerialBuffer);function SerialBuffer(e){var n;(0,_classCallCheck2["default"])(this,SerialBuffer);(n=t.call(this,e))._view=new DataView(n.buffer);n._readPos=0;n._writePos=0;return n}(0,_createClass2["default"])(SerialBuffer,[{key:"subarray",value:function subarray(e,t){return m.subarray(this,e,t)}},{key:"reset",value:function reset(){this._readPos=0;this._writePos=0}},{key:"read",value:function read(e){var t=this.subarray(this._readPos,this._readPos+e);this._readPos+=e;return new Uint8Array(t)}},{key:"write",value:function write(e){this.set(e,this._writePos);this._writePos+=e.byteLength}},{key:"readUint8",value:function readUint8(){return this._view.getUint8(this._readPos++)}},{key:"writeUint8",value:function writeUint8(e){this._view.setUint8(this._writePos++,e)}},{key:"readUint16",value:function readUint16(){var e=this._view.getUint16(this._readPos);this._readPos+=2;return e}},{key:"writeUint16",value:function writeUint16(e){this._view.setUint16(this._writePos,e);this._writePos+=2}},{key:"readUint32",value:function readUint32(){var e=this._view.getUint32(this._readPos);this._readPos+=4;return e}},{key:"writeUint32",value:function writeUint32(e){this._view.setUint32(this._writePos,e);this._writePos+=4}},{key:"readUint64",value:function readUint64(){var e=this._view.getUint32(this._readPos)*Math.pow(2,32)+this._view.getUint32(this._readPos+4);if(!Y.isUint64(e))throw new Error("Malformed value");this._readPos+=8;return e}},{key:"writeUint64",value:function writeUint64(e){if(!Y.isUint64(e))throw new Error("Malformed value");this._view.setUint32(this._writePos,Math.floor(e/Math.pow(2,32)));this._view.setUint32(this._writePos+4,e);this._writePos+=8}},{key:"readVarUint",value:function readVarUint(){var e=this.readUint8();return e<253?e:253===e?this.readUint16():254===e?this.readUint32():this.readUint64()}},{key:"writeVarUint",value:function writeVarUint(e){if(!Y.isUint64(e))throw new Error("Malformed value");if(e<253)this.writeUint8(e);else if(e<=65535){this.writeUint8(253);this.writeUint16(e)}else if(e<=4294967295){this.writeUint8(254);this.writeUint32(e)}else{this.writeUint8(255);this.writeUint64(e)}}},{key:"readFloat64",value:function readFloat64(){var e=this._view.getFloat64(this._readPos);this._readPos+=8;return e}},{key:"writeFloat64",value:function writeFloat64(e){this._view.setFloat64(this._writePos,e);this._writePos+=8}},{key:"readString",value:function readString(e){var t=this.read(e);return M.toAscii(t)}},{key:"writeString",value:function writeString(e,t){if(ne.isMultibyte(e)||e.length!==t)throw new Error("Malformed value/length");var n=M.fromAscii(e);this.write(n)}},{key:"readPaddedString",value:function readPaddedString(e){for(var t=this.read(e),n=0;n<e&&0!==t[n];)n++;var r=new Uint8Array(t.buffer,t.byteOffset,n);return M.toAscii(r)}},{key:"writePaddedString",value:function writePaddedString(e,t){if(ne.isMultibyte(e)||e.length>t)throw new Error("Malformed value/length");var n=M.fromAscii(e);this.write(n);var r=t-n.byteLength;this.write(new Uint8Array(r))}},{key:"readVarLengthString",value:function readVarLengthString(){var e=this.readUint8();if(this._readPos+e>this.length)throw new Error("Malformed length");var t=this.read(e);return M.toAscii(t)}},{key:"writeVarLengthString",value:function writeVarLengthString(e){if(ne.isMultibyte(e)||!Y.isUint8(e.length))throw new Error("Malformed value");var t=M.fromAscii(e);this.writeUint8(t.byteLength);this.write(t)}},{key:"readPos",get:function get(){return this._readPos},set:function set(e){if(e<0||e>this.byteLength)throw"Invalid readPos ".concat(e);this._readPos=e}},{key:"writePos",get:function get(){return this._writePos},set:function set(e){if(e<0||e>this.byteLength)throw"Invalid writePos ".concat(e);this._writePos=e}}],[{key:"varUintSize",value:function varUintSize(e){if(!Y.isUint64(e))throw new Error("Malformed value");return e<253?1:e<=65535?3:e<=4294967295?5:9}},{key:"varLengthStringSize",value:function varLengthStringSize(e){if(ne.isMultibyte(e)||!Y.isUint8(e.length))throw new Error("Malformed value");return 1+e.length}}]);return SerialBuffer}((0,_wrapNativeSuper2["default"])(Uint8Array));U.EMPTY=new U(0);n.register(U);var z=function(e){(0,_inherits2["default"])(Synchronizer,e);var t=_createSuper(Synchronizer);function Synchronizer(e,n){var r;(0,_classCallCheck2["default"])(this,Synchronizer);(r=t.call(this))._queue=new x;r._working=!1;r._throttleAfter=e;r._throttleWait=n;r._elapsed=0;r._totalElapsed=0;r._totalJobs=0;r._totalThrottles=0;return r}(0,_createClass2["default"])(Synchronizer,[{key:"push",value:function push(e){var t=this;return new _promise["default"](function(n,r){t._queue.push({fn:e,resolve:n,reject:r});if(!t._working){t.fire("work-start",t);t._doWork()["catch"](a.w.tag(Synchronizer))}})}},{key:"clear",value:function clear(){var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._queue);!(e=(r=a.next()).done);e=!0){var i=r.value;i.reject&&i.reject()}}catch(s){t=!0;n=s}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}this._queue.clear()}},{key:"_doWork",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee117(){var e,t,n;return _regenerator["default"].wrap(function _callee117$(r){for(;;)switch(r.prev=r.next){case 0:this._working=!0;case 1:if(!(this._queue.length>0)){r.next=25;break}e=(0,_now["default"])();t=this._queue.shift();r.prev=4;r.next=7;return t.fn();case 7:n=r.sent;t.resolve(n);r.next=14;break;case 11:r.prev=11;r.t0=r["catch"](4);t.reject&&t.reject(r.t0);case 14:this._totalJobs++;if(this._throttleAfter===undefined){r.next=23;break}this._elapsed+=(0,_now["default"])()-e;if(!(this._elapsed>=this._throttleAfter)){r.next=23;break}this._totalElapsed+=this._elapsed;this._totalThrottles++;this._elapsed=0;setTimeout(this._doWork.bind(this),this._throttleWait);return r.abrupt("return");case 23:r.next=1;break;case 25:this._working=!1;this._totalElapsed+=this._elapsed;this._elapsed=0;this.fire("work-end",this);case 29:case"end":return r.stop()}},_callee117,this,[[4,11]])}));return function _doWork(){return e.apply(this,arguments)}}()},{key:"working",get:function get(){return this._working}},{key:"length",get:function get(){return this._queue.length}},{key:"totalElapsed",get:function get(){return this._totalElapsed}},{key:"totalJobs",get:function get(){return this._totalJobs}},{key:"totalThrottles",get:function get(){return this._totalThrottles}}]);return Synchronizer}(i);n.register(z);var H=function(e){(0,_inherits2["default"])(MultiSynchronizer,e);var t=_createSuper(MultiSynchronizer);function MultiSynchronizer(e,n){var r;(0,_classCallCheck2["default"])(this,MultiSynchronizer);(r=t.call(this))._synchronizers=new _map2["default"];r._throttleAfter=e;r._throttleWait=n;return r}(0,_createClass2["default"])(MultiSynchronizer,[{key:"push",value:function push(e,t){var n=this,r=this._synchronizers.get(e);if(!r){(r=new z(this._throttleAfter,this._throttleWait)).on("work-start",function(){return n.fire("work-start",r,e,n)});r.on("work-end",function(){return n.fire("work-end",r,e,n)});this._synchronizers.set(e,r)}return r.push(t)}},{key:"clear",value:function clear(){var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._synchronizers.values());!(e=(r=a.next()).done);e=!0){r.value.clear()}}catch(i){t=!0;n=i}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}this._synchronizers.clear()}},{key:"isWorking",value:function isWorking(e){var t=this._synchronizers.get(e);return!!t&&t.working}}]);return MultiSynchronizer}(i);n.register(H);var G=function(e){(0,_inherits2["default"])(PrioritySynchronizer,e);var t=_createSuper(PrioritySynchronizer);function PrioritySynchronizer(e,n,r){var a;(0,_classCallCheck2["default"])(this,PrioritySynchronizer);(a=t.call(this))._queues=[];for(var i=0;i<e;i++)a._queues[i]=new x;a._working=!1;a._throttleAfter=n;a._throttleWait=r;a._elapsed=0;a._totalElapsed=0;a._totalJobs=0;a._totalThrottles=0;return a}(0,_createClass2["default"])(PrioritySynchronizer,[{key:"push",value:function push(e,t){var n=this;R.that(e>=0&&e<this._queues.length&&(0,_isInteger["default"])(e),"Invalid priority");return new _promise["default"](function(r,i){n._queues[e].push({fn:t,resolve:r,reject:i});if(!n._working){n.fire("work-start",n);n._doWork()["catch"](a.w.tag(PrioritySynchronizer))}})}},{key:"clear",value:function clear(){var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._queues);!(e=(r=a.next()).done);e=!0){var i=r.value,s=!0,o=!1,u=undefined;try{for(var c,l=(0,_getIterator2["default"])(i);!(s=(c=l.next()).done);s=!0){var h=c.value;h.reject&&h.reject()}}catch(f){o=!0;u=f}finally{try{s||null==l["return"]||l["return"]()}finally{if(o)throw u}}i.clear()}}catch(f){t=!0;n=f}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}}},{key:"_doWork",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee118(){var e,t,n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee118$(c){for(;;)switch(c.prev=c.next){case 0:this._working=!0;e=!0;t=!1;n=undefined;c.prev=4;r=(0,_getIterator2["default"])(this._queues);case 6:if(e=(a=r.next()).done){c.next=35;break}i=a.value;case 8:if(!(i.length>0)){c.next=32;break}s=(0,_now["default"])();o=i.shift();c.prev=11;c.next=14;return o.fn();case 14:u=c.sent;o.resolve(u);c.next=21;break;case 18:c.prev=18;c.t0=c["catch"](11);o.reject&&o.reject(c.t0);case 21:this._totalJobs++;if(this._throttleAfter===undefined){c.next=30;break}this._elapsed+=(0,_now["default"])()-s;if(!(this._elapsed>=this._throttleAfter)){c.next=30;break}this._totalElapsed+=this._elapsed;this._totalThrottles++;this._elapsed=0;setTimeout(this._doWork.bind(this),this._throttleWait);return c.abrupt("return");case 30:c.next=8;break;case 32:e=!0;c.next=6;break;case 35:c.next=41;break;case 37:c.prev=37;c.t1=c["catch"](4);t=!0;n=c.t1;case 41:c.prev=41;c.prev=42;e||null==r["return"]||r["return"]();case 44:c.prev=44;if(!t){c.next=47;break}throw n;case 47:return c.finish(44);case 48:return c.finish(41);case 49:this._working=!1;this._totalElapsed+=this._elapsed;this._elapsed=0;this.fire("work-end",this);case 53:case"end":return c.stop()}},_callee118,this,[[4,37,41,49],[11,18],[42,,44,48]])}));return function _doWork(){return e.apply(this,arguments)}}()},{key:"working",get:function get(){return this._working}},{key:"length",get:function get(){return this._queues.reduce(function(e,t){return e+t.length},0)}},{key:"totalElapsed",get:function get(){return this._totalElapsed}},{key:"totalJobs",get:function get(){return this._totalJobs}},{key:"totalThrottles",get:function get(){return this._totalThrottles}}]);return PrioritySynchronizer}(i);n.register(G);var F=function(){function RateLimit(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:6e4;(0,_classCallCheck2["default"])(this,RateLimit);this._allowedOccurrences=e;this._timeRange=t;this._lastReset=0;this._counter=0}(0,_createClass2["default"])(RateLimit,[{key:"note",value:function note(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1,t=(0,_now["default"])();if(this._lastReset<t-this._timeRange){this._lastReset=t;this._counter=0}return(this._counter+=e)<=this._allowedOccurrences}},{key:"lastReset",get:function get(){return this._lastReset}}]);return RateLimit}();n.register(F);var K=function(){function IWorker(){(0,_classCallCheck2["default"])(this,IWorker)}(0,_createClass2["default"])(IWorker,null,[{key:"createProxy",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee119(e,t,n){return _regenerator["default"].wrap(function _callee119$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new(IWorker.Proxy(e))(n,t));case 1:case"end":return r.stop()}},_callee119)}));return function createProxy(t,n,r){return e.apply(this,arguments)}}()},{key:"startWorkerForProxy",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee120(e,t,n){return _regenerator["default"].wrap(function _callee120$(r){for(;;)switch(r.prev=r.next){case 0:if(IWorker._workersSupported){r.next=6;break}r.next=3;return IWorker._workerImplementation[e.name].init(t);case 3:return r.abrupt("return",IWorker._workerImplementation[e.name]);case 6:n||(n="".concat(Nimiq._path,"worker.js"));return r.abrupt("return",IWorker.createProxy(e,t,new Worker(URL.createObjectURL(new Blob(["Nimiq = {_path: '".concat(Nimiq._path,"'}; importScripts('").concat(n.replace(/'/g,""),"');")])))));case 8:case"end":return r.stop()}},_callee120)}));return function startWorkerForProxy(t,n,r){return e.apply(this,arguments)}}()},{key:"startWorkerPoolForProxy",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee121(e,t,n,r){return _regenerator["default"].wrap(function _callee121$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new(IWorker.Pool(e))(function(t){return IWorker.startWorkerForProxy(e,t,r)},t,n).start());case 1:case"end":return a.stop()}},_callee121)}));return function startWorkerPoolForProxy(t,n,r,a){return e.apply(this,arguments)}}()},{key:"stubBaseOnMessage",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee122(e){var t;return _regenerator["default"].wrap(function _callee122$(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0;if("init"!==e.data.command){n.next=12;break}if(!IWorker._workerImplementation[e.data.args[0]]){n.next=9;break}n.next=5;return IWorker._workerImplementation[e.data.args[0]].init(e.data.args[1]);case 5:t=n.sent;self.postMessage({status:"OK",result:t,id:e.data.id});n.next=10;break;case 9:self.postMessage({status:"error",result:"Unknown worker!",id:e.data.id});case 10:n.next=13;break;case 12:self.postMessage({status:"error",result:"Worker not yet initialized!",id:e.data.id});case 13:n.next=18;break;case 15:n.prev=15;n.t0=n["catch"](0);self.postMessage({status:"error",result:n.t0,id:e.data.id});case 18:case"end":return n.stop()}},_callee122,null,[[0,15]])}));return function stubBaseOnMessage(t){return e.apply(this,arguments)}}()},{key:"prepareForWorkerUse",value:function prepareForWorkerUse(e,t){IWorker._insideWebWorker&&(self.onmessage=IWorker.stubBaseOnMessage);IWorker._workerImplementation=IWorker._workerImplementation||{};IWorker._workerImplementation[e.name]=t}},{key:"_loadBrowserScript",value:function _loadBrowserScript(e,t){var n=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript";r.src=e;var a=function ret(){return setTimeout(t,100)};r.onreadystatechange=a;r.onload=a;n.appendChild(r)}},{key:"Proxy",value:function Proxy(e){var t=function(t){(0,_inherits2["default"])(proxyClass,t);var n=_createSuper(proxyClass);function proxyClass(t,r){var a;(0,_classCallCheck2["default"])(this,proxyClass);(a=n.call(this))._name=r;a._messageId=0;a._worker=t;a._worker.onmessage=a._receive.bind((0,_assertThisInitialized2["default"])(a));a._waiting=new _map2["default"];return(0,_possibleConstructorReturn2["default"])(a,a._invoke("init",[e.name,r]).then(function(){return(0,_assertThisInitialized2["default"])(a)}))}(0,_createClass2["default"])(proxyClass,[{key:"_receive",value:function _receive(e){var t=this._waiting.get(e.data.id);if(t){this._waiting["delete"](e.data.id);"OK"===e.data.status?t.resolve(e.data.result):"error"===e.data.status&&t.error(e.data.result)}else a.w(WorkerProxy,"Unknown reply",e)}},{key:"_invoke",value:function _invoke(e){var t=this,n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return new _promise["default"](function(r,a){var i={command:e,args:n,id:t._messageId++};t._waiting.set(i.id,{resolve:r,error:a});t._worker.postMessage(i)})}},{key:"destroy",value:function destroy(){return this._invoke("destroy")}}]);return proxyClass}(e),n=!0,r=!1,i=undefined;try{for(var s,o=function _loop6(){var n=s.value;"function"==typeof e.prototype[n]&&"constructor"!==n&&(t.prototype[n]=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this._invoke(n,t)})},u=(0,_getIterator2["default"])((0,_getOwnPropertyNames["default"])(e.prototype));!(n=(s=u.next()).done);n=!0)o()}catch(c){r=!0;i=c}finally{try{n||null==u["return"]||u["return"]()}finally{if(r)throw i}}return t}},{key:"Stub",value:function Stub(e){var Stub=function(e){(0,_inherits2["default"])(Stub,e);var t=_createSuper(Stub);function Stub(){(0,_classCallCheck2["default"])(this,Stub);return t.call(this)}(0,_createClass2["default"])(Stub,[{key:"_result",value:function _result(e,t,n){self.postMessage({status:t,result:n,id:e.data.id})}},{key:"_onmessage",value:function _onmessage(e){var t=this;try{var n=this._invoke(e.data.command,e.data.args);n instanceof _promise["default"]?n.then(function(n){t._result(e,"OK",n)}):this._result(e,"OK",n)}catch(r){this._result(e,"error",r.message||r)}}},{key:"init",value:function init(e){var t=this;this._name=e;if(IWorker._insideWebWorker){self.name=e;self.onmessage=function(e){return t._onmessage(e)}}}},{key:"_invoke",value:function _invoke(e,t){return this[e].apply(this,t)}},{key:"destroy",value:function destroy(){IWorker._insideWebWorker&&self.close()}}]);return Stub}(e),t=!0,n=!1,r=undefined;try{for(var a,i=function _loop7(){var t=a.value;"function"==typeof e.prototype[t]&&"constructor"!==t&&(Stub.prototype[t]=function(){throw"Not implemented in IWorker Stub: ".concat(t)})},s=(0,_getIterator2["default"])((0,_getOwnPropertyNames["default"])(e.prototype));!(t=(a=s.next()).done);t=!0)i()}catch(o){n=!0;r=o}finally{try{t||null==s["return"]||s["return"]()}finally{if(n)throw r}}return Stub}},{key:"Pool",value:function Pool(e){var t=function(e){(0,_inherits2["default"])(poolClass,e);var t=_createSuper(poolClass);function poolClass(e){var n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"pool",a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;(0,_classCallCheck2["default"])(this,poolClass);(n=t.call(this))._proxyInitializer=e;n._name=r;n._poolSize=a;n._workers=[];n._freeWorkers=[];n._waitingCalls=[];return n}(0,_createClass2["default"])(poolClass,[{key:"start",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee123(){return _regenerator["default"].wrap(function _callee123$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this._updateToSize();case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},_callee123,this)}));return function start(){return e.apply(this,arguments)}}()},{key:"destroy",value:function destroy(){this._poolSize=0;return this._updateToSize()}},{key:"_invoke",value:function _invoke(e,t){var n=this;return IWorker._workersSupported?new _promise["default"](function(r,i){n._waitingCalls.push({name:e,args:t,resolve:r,error:i});var s=n._freeWorkers.shift();s&&n._step(s)["catch"](a.w.tag(IWorker))}):this._workers[0][e].apply(this._workers[0],t)}},{key:"_step",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee124(e){var t;return _regenerator["default"].wrap(function _callee124$(n){for(;;)switch(n.prev=n.next){case 0:t=this._waitingCalls.shift();case 1:if(!t){n.next=19;break}n.prev=2;n.t0=t;n.next=6;return e[t.name].apply(e,t.args);case 6:n.t1=n.sent;n.t0.resolve.call(n.t0,n.t1);n.next=13;break;case 10:n.prev=10;n.t2=n["catch"](2);t.error(n.t2);case 13:if(-1!==this._workers.indexOf(e)){n.next=16;break}e.destroy();return n.abrupt("return");case 16:t=this._waitingCalls.shift();n.next=1;break;case 19:this._freeWorkers.push(e);case 20:case"end":return n.stop()}},_callee124,this,[[2,10]])}));return function _step(t){return e.apply(this,arguments)}}()},{key:"_updateToSize",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee125(){var e,t,n,r,i,s,o,u,c,l;return _regenerator["default"].wrap(function _callee125$(h){for(;;)switch(h.prev=h.next){case 0:if("undefined"==typeof Worker&&this._poolSize>1){a.d(IWorker,"Pool of size larger than 1 requires WebWorker support.");this._poolSize=1}e=[];for(;this._workers.length+e.length<this._poolSize;)e.push(this._proxyInitializer("".concat(this._name,"#").concat(this._workers.length+e.length)));h.next=5;return _promise["default"].all(e);case 5:t=h.sent;n=!0;r=!1;i=undefined;h.prev=9;for(s=(0,_getIterator2["default"])(t);!(n=(o=s.next()).done);n=!0){u=o.value;this._workers.push(u);this._step(u)["catch"](a.w.tag(IWorker))}h.next=17;break;case 13:h.prev=13;h.t0=h["catch"](9);r=!0;i=h.t0;case 17:h.prev=17;h.prev=18;n||null==s["return"]||s["return"]();case 20:h.prev=20;if(!r){h.next=23;break}throw i;case 23:return h.finish(20);case 24:return h.finish(17);case 25:for(;this._workers.length>this._poolSize;){c=this._freeWorkers.shift()||this._workers.pop();if((l=this._workers.indexOf(c))>=0){this._workers.splice(l,1);c.destroy()}}return h.abrupt("return",this);case 27:case"end":return h.stop()}},_callee125,this,[[9,13,17,25],[18,,20,24]])}));return function _updateToSize(){return e.apply(this,arguments)}}()},{key:"poolSize",get:function get(){return this._poolSize},set:function set(e){this._poolSize=e;this._updateToSize()["catch"](a.w.tag(IWorker))}}]);return poolClass}(e),n=!0,r=!1,i=undefined;try{for(var s,o=function _loop8(){var n=s.value;"function"==typeof e.prototype[n]&&"constructor"!==n&&(t.prototype[n]=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this._invoke(n,t)})},u=(0,_getIterator2["default"])((0,_getOwnPropertyNames["default"])(e.prototype));!(n=(s=u.next()).done);n=!0)o()}catch(c){r=!0;i=c}finally{try{n||null==u["return"]||u["return"]()}finally{if(r)throw i}}return t}},{key:"_workersSupported",get:function get(){return"undefined"!=typeof Worker}},{key:"areWorkersAsync",get:function get(){return IWorker._workersSupported}},{key:"_insideWebWorker",get:function get(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}},{key:"_global",get:function get(){return"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:null}}]);return IWorker}();K._moduleLoadedCallbacks={};K._workerImplementation={};n.register(K);var q=function(){function CryptoWorker(){(0,_classCallCheck2["default"])(this,CryptoWorker)}(0,_createClass2["default"])(CryptoWorker,[{key:"computeArgon2d",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee126(e){return _regenerator["default"].wrap(function _callee126$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee126)}));return function computeArgon2d(t){return e.apply(this,arguments)}}()},{key:"computeArgon2dBatch",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee127(e){return _regenerator["default"].wrap(function _callee127$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee127)}));return function computeArgon2dBatch(t){return e.apply(this,arguments)}}()},{key:"kdfLegacy",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee128(e,t,n,r){return _regenerator["default"].wrap(function _callee128$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee128)}));return function kdfLegacy(t,n,r,a){return e.apply(this,arguments)}}()},{key:"kdf",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee129(e,t,n,r){return _regenerator["default"].wrap(function _callee129$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee129)}));return function kdf(t,n,r,a){return e.apply(this,arguments)}}()},{key:"blockVerify",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee130(e,t,n,r,a){return _regenerator["default"].wrap(function _callee130$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee130)}));return function blockVerify(t,n,r,a,i){return e.apply(this,arguments)}}()}],[{key:"getInstanceAsync",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee131(){return _regenerator["default"].wrap(function _callee131$(e){for(;;)switch(e.prev=e.next){case 0:if(CryptoWorker._workerAsync){e.next=4;break}e.next=3;return K.startWorkerPoolForProxy(CryptoWorker,"crypto",4);case 3:CryptoWorker._workerAsync=e.sent;case 4:return e.abrupt("return",CryptoWorker._workerAsync);case 5:case"end":return e.stop()}},_callee131)}));return function getInstanceAsync(){return e.apply(this,arguments)}}()},{key:"lib",get:function get(){return u.instance}}]);return CryptoWorker}();q._workerAsync=null;n.register(q);var W=function(e){(0,_inherits2["default"])(CryptoWorkerImpl,e);var t=_createSuper(CryptoWorkerImpl);function CryptoWorkerImpl(){var e,n;(0,_classCallCheck2["default"])(this,CryptoWorkerImpl);(n=t.call(this))._superInit=(0,_get10["default"])((e=(0,_assertThisInitialized2["default"])(n),(0,_getPrototypeOf2["default"])(CryptoWorkerImpl.prototype)),"init",e);return n}(0,_createClass2["default"])(CryptoWorkerImpl,[{key:"init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee132(e){return _regenerator["default"].wrap(function _callee132$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._superInit.call(this,e);case 2:if(!f.isBrowser()){t.next=5;break}t.next=5;return d.doImportBrowser();case 5:q._workerAsync=this;case 6:case"end":return t.stop()}},_callee132,this)}));return function init(t){return e.apply(this,arguments)}}()},{key:"computeArgon2d",value:function computeArgon2d(e){if(f.isNodeJs()){var t=new Uint8Array(ie.getSize(ie.Algorithm.ARGON2D)),n=NodeNative.node_argon2(t,new Uint8Array(e),512);if(0!==n)throw n;return t}var r;try{r=Module.stackSave();var i=ie.getSize(ie.Algorithm.ARGON2D),s=Module.stackAlloc(i),o=Module.stackAlloc(e.length);new Uint8Array(Module.HEAPU8.buffer,o,e.length).set(e);var u=Module._nimiq_argon2(s,o,e.length,512);if(0!==u)throw u;var c=new Uint8Array(i);c.set(new Uint8Array(Module.HEAPU8.buffer,s,i));return c}catch(l){a.w(CryptoWorkerImpl,l);throw l}finally{r!==undefined&&Module.stackRestore(r)}}},{key:"computeArgon2dBatch",value:function computeArgon2dBatch(e){var t,n=[];if(f.isNodeJs()){var r=!0,i=!1,s=undefined;try{for(var o,u=(0,_getIterator2["default"])(e);!(r=(o=u.next()).done);r=!0){var c=o.value,l=new Uint8Array(ie.getSize(ie.Algorithm.ARGON2D)),h=NodeNative.node_argon2(l,new Uint8Array(c),512);if(0!==h)throw h;n.push(l)}}catch(S){i=!0;s=S}finally{try{r||null==u["return"]||u["return"]()}finally{if(i)throw s}}return n}try{t=Module.stackSave();var d=ie.getSize(ie.Algorithm.ARGON2D),A=Module.stackAlloc(d),_=Module.stackSave(),p=!0,g=!1,y=undefined;try{for(var v,k=(0,_getIterator2["default"])(e);!(p=(v=k.next()).done);p=!0){var m=v.value;Module.stackRestore(_);var b=Module.stackAlloc(m.length);new Uint8Array(Module.HEAPU8.buffer,b,m.length).set(m);var w=Module._nimiq_argon2(A,b,m.length,512);if(0!==w)throw w;var C=new Uint8Array(d);C.set(new Uint8Array(Module.HEAPU8.buffer,A,d));n.push(C)}}catch(S){g=!0;y=S}finally{try{p||null==k["return"]||k["return"]()}finally{if(g)throw y}}return n}catch(T){a.w(CryptoWorkerImpl,T);throw T}finally{t!==undefined&&Module.stackRestore(t)}}},{key:"kdfLegacy",value:function kdfLegacy(e,t,n){var r,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:ie.getSize(ie.Algorithm.ARGON2D);if(f.isNodeJs()){var s=new Uint8Array(i),o=NodeNative.node_kdf_legacy(s,new Uint8Array(e),new Uint8Array(t),512,n);if(0!==o)throw o;return s}try{r=Module.stackSave();var u=Module.stackAlloc(i),c=Module.stackAlloc(e.length);new Uint8Array(Module.HEAPU8.buffer,c,e.length).set(e);var l=Module.stackAlloc(t.length);new Uint8Array(Module.HEAPU8.buffer,l,t.length).set(t);var h=Module._nimiq_kdf_legacy(u,i,c,e.length,l,t.length,512,n);if(0!==h)throw h;var d=new Uint8Array(i);d.set(new Uint8Array(Module.HEAPU8.buffer,u,i));return d}catch(A){a.w(CryptoWorkerImpl,A);throw A}finally{r!==undefined&&Module.stackRestore(r)}}},{key:"kdf",value:function kdf(e,t,n){var r,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:ie.getSize(ie.Algorithm.ARGON2D);if(f.isNodeJs()){var s=new Uint8Array(i),o=NodeNative.node_kdf(s,new Uint8Array(e),new Uint8Array(t),512,n);if(0!==o)throw o;return s}try{r=Module.stackSave();var u=Module.stackAlloc(i),c=Module.stackAlloc(e.length);new Uint8Array(Module.HEAPU8.buffer,c,e.length).set(e);var l=Module.stackAlloc(t.length);new Uint8Array(Module.HEAPU8.buffer,l,t.length).set(t);var h=Module._nimiq_kdf(u,i,c,e.length,l,t.length,512,n);if(0!==h)throw h;var d=new Uint8Array(i);d.set(new Uint8Array(Module.HEAPU8.buffer,u,i));return d}catch(A){a.w(CryptoWorkerImpl,A);throw A}finally{r!==undefined&&Module.stackRestore(r)}}},{key:"blockVerify",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee133(e,t,n,r,a){var i,s,o,u,c,l;return _regenerator["default"].wrap(function _callee133$(h){for(;;)switch(h.prev=h.next){case 0:qn={GENESIS_HASH:ie.unserialize(new U(r)),NETWORK_ID:a};i=Je.unserialize(new U(e));for(s=0;s<t.length;s++)i.body.transactions[s]._valid=t[s];h.next=5;return i._verify(n);case 5:o=h.sent;h.next=8;return i.header.pow();case 8:u=h.sent;c=i.interlink.hash();l=i.body.hash();return h.abrupt("return",{valid:o,pow:u.serialize(),interlinkHash:c.serialize(),bodyHash:l.serialize()});case 12:case"end":return h.stop()}},_callee133)}));return function blockVerify(t,n,r,a,i){return e.apply(this,arguments)}}()}]);return CryptoWorkerImpl}(K.Stub(q));K.prepareForWorkerUse(q,new W);var j=function(){function CryptoUtils(){(0,_classCallCheck2["default"])(this,CryptoUtils)}(0,_createClass2["default"])(CryptoUtils,null,[{key:"computeHmacSha512",value:function computeHmacSha512(e,t){e.length>CryptoUtils.SHA512_BLOCK_SIZE&&(e=new U(ie.computeSha512(e)));for(var n=new U(CryptoUtils.SHA512_BLOCK_SIZE),r=new U(CryptoUtils.SHA512_BLOCK_SIZE),a=0;a<CryptoUtils.SHA512_BLOCK_SIZE;++a){var i=e[a]||0;n[a]=54^i;r[a]=92^i}var s=ie.computeSha512(M.concatTypedArrays(n,t));return ie.computeSha512(M.concatTypedArrays(r,s))}},{key:"computePBKDF2sha512",value:function computePBKDF2sha512(e,t,n,r){var a=ie.SIZE.get(ie.Algorithm.SHA512);if(r>(Math.pow(2,32)-1)*a)throw new Error("Derived key too long");for(var i=Math.ceil(r/a),s=r-(i-1)*a,o=new U(r),u=1;u<=i;u++){var c=new U(t.length+4);c.write(t);c.writeUint32(u);for(var l=c=CryptoUtils.computeHmacSha512(e,c),h=1;h<n;h++){c=CryptoUtils.computeHmacSha512(e,c);for(var f=0;f<l.length;f++)l[f]^=c[f]}u<i?o.write(l):o.write(l.slice(0,s))}return o}},{key:"otpKdfLegacy",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee134(e,t,n,r){var a,i;return _regenerator["default"].wrap(function _callee134$(s){for(;;)switch(s.prev=s.next){case 0:s.next=2;return q.getInstanceAsync();case 2:a=s.sent;s.next=5;return a.kdfLegacy(t,n,r,e.byteLength);case 5:i=s.sent;return s.abrupt("return",M.xor(e,i));case 7:case"end":return s.stop()}},_callee134)}));return function otpKdfLegacy(t,n,r,a){return e.apply(this,arguments)}}()},{key:"otpKdf",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee135(e,t,n,r){var a,i;return _regenerator["default"].wrap(function _callee135$(s){for(;;)switch(s.prev=s.next){case 0:s.next=2;return q.getInstanceAsync();case 2:a=s.sent;s.next=5;return a.kdf(t,n,r,e.byteLength);case 5:i=s.sent;return s.abrupt("return",M.xor(e,i));case 7:case"end":return s.stop()}},_callee135)}));return function otpKdf(t,n,r,a){return e.apply(this,arguments)}}()}]);return CryptoUtils}();j.SHA512_BLOCK_SIZE=128;n.register(j);var V=function(){function CRC8(){(0,_classCallCheck2["default"])(this,CRC8)}(0,_createClass2["default"])(CRC8,null,[{key:"_createTable",value:function _createTable(){for(var e=[],t=0;t<256;++t){for(var n=t,r=0;r<8;++r)n=0!=(128&n)?(n<<1^151)%256:(n<<1)%256;e[t]=n}return e}},{key:"compute",value:function compute(e){CRC8._table||(CRC8._table=CRC8._createTable());for(var t=0,n=0;n<e.length;n++)t=CRC8._table[(t^e[n])%256];return t}}]);return CRC8}();V._table=null;n.register(V);var Q=function(){function CRC32(){(0,_classCallCheck2["default"])(this,CRC32)}(0,_createClass2["default"])(CRC32,null,[{key:"_createTable",value:function _createTable(){for(var e,t=[],n=0;n<256;++n){e=n;for(var r=0;r<8;++r)e=1&e?CRC32._POLYNOMIAL^e>>>1:e>>>1;t[n]=e>>>0}return t}},{key:"compute",value:function compute(e){CRC32._table||(CRC32._table=CRC32._createTable());CRC32._hex_chars||(CRC32._hex_chars="0123456789abcdef".split(""));for(var t=new Uint8Array(e),n=-1,r="",a=0;a<t.length;++a)n=CRC32._table[255&(n^t[a])]^n>>>8;n^=-1;r+=CRC32._hex_chars[n>>28&15]+CRC32._hex_chars[n>>24&15]+CRC32._hex_chars[n>>20&15]+CRC32._hex_chars[n>>16&15]+CRC32._hex_chars[n>>12&15]+CRC32._hex_chars[n>>8&15]+CRC32._hex_chars[n>>4&15]+CRC32._hex_chars[15&n];return(0,_parseInt2["default"])(r,16)}}]);return CRC32}();Q._table=null;Q._hex_chars=null;Q._POLYNOMIAL=3988292384;n.register(Q);!function(e){"use strict";var t,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,a=Math.floor,i="[BigNumber Error] ",s=i+"Number primitive has more than 15 significant digits: ",o=1e14,u=14,c=9007199254740991,l=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,f=1e9;function bitFloor(e){var t=0|e;return e>0||e===t?t:t-1}function coeffToString(e){for(var t,n,r=1,a=e.length,i=e[0]+"";r<a;){t=e[r++]+"";n=u-t.length;for(;n--;t="0"+t);i+=t}for(a=i.length;48===i.charCodeAt(--a););return i.slice(0,a+1||1)}function compare(e,t){var n,r,a=e.c,i=t.c,s=e.s,o=t.s,u=e.e,c=t.e;if(!s||!o)return null;n=a&&!a[0];r=i&&!i[0];if(n||r)return n?r?0:-o:s;if(s!=o)return s;n=s<0;r=u==c;if(!a||!i)return r?0:!a^n?1:-1;if(!r)return u>c^n?1:-1;o=(u=a.length)<(c=i.length)?u:c;for(s=0;s<o;s++)if(a[s]!=i[s])return a[s]>i[s]^n?1:-1;return u==c?0:u>c^n?1:-1}function intCheck(e,t,n,s){if(e<t||e>n||e!==(e<0?r(e):a(e)))throw Error(i+(s||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+e)}function isArray(e){return"[object Array]"==Object.prototype.toString.call(e)}function isOdd(e){var t=e.c.length-1;return bitFloor(e.e/u)==t&&e.c[t]%2!=0}function toExponential(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function toFixedPoint(e,t,n){var r,a;if(t<0){for(a=n+".";++t;a+=n);e=a+e}else if(++t>(r=e.length)){for(a=n,t-=r;--t;a+=n);e+=a}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}(t=function clone(e){var t,d,A,_,p,g,y,v,k,m=BigNumber.prototype={constructor:BigNumber,toString:null,valueOf:null},b=new BigNumber(1),w=20,C=4,S=-7,T=21,E=-1e7,x=1e7,I=!1,B=1,P=0,N={decimalSeparator:".",groupSeparator:",",groupSize:3,secondaryGroupSize:0,fractionGroupSeparator:" ",fractionGroupSize:0},O="0123456789abcdefghijklmnopqrstuvwxyz";function BigNumber(e,t){var r,i,o,l,h,f,_,p=this;if(!(p instanceof BigNumber))return new BigNumber(e,t);if(null==t){if(e instanceof BigNumber){p.s=e.s;p.e=e.e;p.c=(e=e.c)?e.slice():e;return}if((h="number"==typeof e)&&0*e==0){p.s=1/e<0?(e=-e,-1):1;if(e===~~e){for(o=0,l=e;l>=10;l/=10,o++);p.e=o;p.c=[e];return}_=e+""}else{if(!n.test(_=e+""))return A(p,_,h);p.s=45==_.charCodeAt(0)?(_=_.slice(1),-1):1}}else{intCheck(t,2,O.length,"Base");_=e+"";if(10==t)return round(p=new BigNumber(e instanceof BigNumber?e:_),w+p.e+1,C);if(h="number"==typeof e){if(0*e!=0)return A(p,_,h,t);p.s=1/e<0?(_=_.slice(1),-1):1;if(BigNumber.DEBUG&&_.replace(/^0\.0*|\./,"").length>15)throw Error(s+e);h=!1}else{p.s=45===_.charCodeAt(0)?(_=_.slice(1),-1):1;t>10&&t<37&&(_=_.toLowerCase())}r=O.slice(0,t);o=l=0;for(f=_.length;l<f;l++)if(r.indexOf(i=_.charAt(l))<0){if("."==i&&l>o){o=f;continue}return A(p,e+"",h,t)}_=d(_,t,10,p.s)}(o=_.indexOf("."))>-1&&(_=_.replace(".",""));if((l=_.search(/e/i))>0){o<0&&(o=l);o+=+_.slice(l+1);_=_.substring(0,l)}else o<0&&(o=_.length);for(l=0;48===_.charCodeAt(l);l++);for(f=_.length;48===_.charCodeAt(--f););if(_=_.slice(l,++f)){f-=l;if(h&&BigNumber.DEBUG&&f>15&&(e>c||e!==a(e)))throw Error(s+p.s*e);if((o=o-l-1)>x)p.c=p.e=null;else if(o<E)p.c=[p.e=0];else{p.e=o;p.c=[];l=(o+1)%u;o<0&&(l+=u);if(l<f){l&&p.c.push(+_.slice(0,l));for(f-=u;l<f;)p.c.push(+_.slice(l,l+=u));_=_.slice(l);l=u-_.length}else l-=f;for(;l--;_+="0");p.c.push(+_)}}else p.c=[p.e=0]}BigNumber.clone=clone;BigNumber.ROUND_UP=0;BigNumber.ROUND_DOWN=1;BigNumber.ROUND_CEIL=2;BigNumber.ROUND_FLOOR=3;BigNumber.ROUND_HALF_UP=4;BigNumber.ROUND_HALF_DOWN=5;BigNumber.ROUND_HALF_EVEN=6;BigNumber.ROUND_HALF_CEIL=7;BigNumber.ROUND_HALF_FLOOR=8;BigNumber.EUCLID=9;BigNumber.config=BigNumber.set=function(e){var t,n;if(null!=e){if("object"!=(0,_typeof2["default"])(e))throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")){intCheck(n=e[t],0,f,t);w=n}if(e.hasOwnProperty(t="ROUNDING_MODE")){intCheck(n=e[t],0,8,t);C=n}if(e.hasOwnProperty(t="EXPONENTIAL_AT"))if(isArray(n=e[t])){intCheck(n[0],-f,0,t);intCheck(n[1],0,f,t);S=n[0];T=n[1]}else{intCheck(n,-f,f,t);S=-(T=n<0?-n:n)}if(e.hasOwnProperty(t="RANGE"))if(isArray(n=e[t])){intCheck(n[0],-f,-1,t);intCheck(n[1],1,f,t);E=n[0];x=n[1]}else{intCheck(n,-f,f,t);if(!n)throw Error(i+t+" cannot be zero: "+n);E=-(x=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes){I=!n;throw Error(i+"crypto unavailable")}I=n}else I=n}if(e.hasOwnProperty(t="MODULO_MODE")){intCheck(n=e[t],0,9,t);B=n}if(e.hasOwnProperty(t="POW_PRECISION")){intCheck(n=e[t],0,f,t);P=n}if(e.hasOwnProperty(t="FORMAT")){n=e[t];if("object"!=(0,_typeof2["default"])(n))throw Error(i+t+" not an object: "+n);N=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.$|\.|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);O=n}}return{DECIMAL_PLACES:w,ROUNDING_MODE:C,EXPONENTIAL_AT:[S,T],RANGE:[E,x],CRYPTO:I,MODULO_MODE:B,POW_PRECISION:P,FORMAT:N,ALPHABET:O}};BigNumber.isBigNumber=function(e){return e instanceof BigNumber||e&&!0===e._isBigNumber||!1};BigNumber.maximum=BigNumber.max=function(){return maxOrMin(arguments,m.lt)};BigNumber.minimum=BigNumber.min=function(){return maxOrMin(arguments,m.gt)};BigNumber.random=(_=9007199254740992*Math.random()&2097151?function(){return a(9007199254740992*Math.random())}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,s,o,c,h=0,d=[],A=new BigNumber(b);null==e?e=w:intCheck(e,0,f);o=r(e/u);if(I)if(crypto.getRandomValues){t=crypto.getRandomValues(new Uint32Array(o*=2));for(;h<o;)if((c=131072*t[h]+(t[h+1]>>>11))>=9e15){n=crypto.getRandomValues(new Uint32Array(2));t[h]=n[0];t[h+1]=n[1]}else{d.push(c%1e14);h+=2}h=o/2}else{if(!crypto.randomBytes){I=!1;throw Error(i+"crypto unavailable")}t=crypto.randomBytes(o*=7);for(;h<o;)if((c=281474976710656*(31&t[h])+1099511627776*t[h+1]+4294967296*t[h+2]+16777216*t[h+3]+(t[h+4]<<16)+(t[h+5]<<8)+t[h+6])>=9e15)crypto.randomBytes(7).copy(t,h);else{d.push(c%1e14);h+=7}h=o/7}if(!I)for(;h<o;)(c=_())<9e15&&(d[h++]=c%1e14);o=d[--h];e%=u;if(o&&e){c=l[u-e];d[h]=a(o/c)*c}for(;0===d[h];d.pop(),h--);if(h<0)d=[s=0];else{for(s=-1;0===d[0];d.splice(0,1),s-=u);for(h=1,c=d[0];c>=10;c/=10,h++);h<u&&(s-=u-h)}A.e=s;A.c=d;return A});d=function(){function toBaseOut(e,t,n,r){for(var a,i,s=[0],o=0,u=e.length;o<u;){for(i=s.length;i--;s[i]*=t);s[0]+=r.indexOf(e.charAt(o++));for(a=0;a<s.length;a++)if(s[a]>n-1){null==s[a+1]&&(s[a+1]=0);s[a+1]+=s[a]/n|0;s[a]%=n}}return s.reverse()}return function(e,n,r,a,i){var s,o,u,c,l,h,f,d,A=e.indexOf("."),_=w,p=C;if(A>=0){c=P;P=0;e=e.replace(".","");h=(d=new BigNumber(n)).pow(e.length-A);P=c;d.c=toBaseOut(toFixedPoint(coeffToString(h.c),h.e,"0"),10,r,"0123456789");d.e=d.c.length}u=c=(f=toBaseOut(e,n,r,i?(s=O,"0123456789"):(s="0123456789",O))).length;for(;0==f[--c];f.pop());if(!f[0])return s.charAt(0);if(A<0)--u;else{h.c=f;h.e=u;h.s=a;f=(h=t(h,d,_,p,r)).c;l=h.r;u=h.e}A=f[o=u+_+1];c=r/2;l=l||o<0||null!=f[o+1];l=p<4?(null!=A||l)&&(0==p||p==(h.s<0?3:2)):A>c||A==c&&(4==p||l||6==p&&1&f[o-1]||p==(h.s<0?8:7));if(o<1||!f[0])e=l?toFixedPoint(s.charAt(1),-_,s.charAt(0)):s.charAt(0);else{f.length=o;if(l)for(--r;++f[--o]>r;){f[o]=0;if(!o){++u;f=[1].concat(f)}}for(c=f.length;!f[--c];);for(A=0,e="";A<=c;e+=s.charAt(f[A++]));e=toFixedPoint(e,u,s.charAt(0))}return e}}();t=function(){function multiply(e,t,n){var r,a,i,s,o=0,u=e.length,c=t%h,l=t/h|0;for(e=e.slice();u--;){o=((a=c*(i=e[u]%h)+(r=l*i+(s=e[u]/h|0)*c)%h*h+o)/n|0)+(r/h|0)+l*s;e[u]=a%n}o&&(e=[o].concat(e));return e}function compare(e,t,n,r){var a,i;if(n!=r)i=n>r?1:-1;else for(a=i=0;a<n;a++)if(e[a]!=t[a]){i=e[a]>t[a]?1:-1;break}return i}function subtract(e,t,n,r){for(var a=0;n--;){e[n]-=a;a=e[n]<t[n]?1:0;e[n]=a*r+e[n]-t[n]}for(;!e[0]&&e.length>1;e.splice(0,1));}return function(e,t,n,r,i){var s,c,l,h,f,d,A,_,p,g,y,v,k,m,b,w,C,S=e.s==t.s?1:-1,T=e.c,E=t.c;if(!(T&&T[0]&&E&&E[0]))return new BigNumber(e.s&&t.s&&(T?!E||T[0]!=E[0]:E)?T&&0==T[0]||!E?0*S:S/0:NaN);p=(_=new BigNumber(S)).c=[];S=n+(c=e.e-t.e)+1;if(!i){i=o;c=bitFloor(e.e/u)-bitFloor(t.e/u);S=S/u|0}for(l=0;E[l]==(T[l]||0);l++);E[l]>(T[l]||0)&&c--;if(S<0){p.push(1);h=!0}else{m=T.length;w=E.length;l=0;S+=2;if((f=a(i/(E[0]+1)))>1){E=multiply(E,f,i);T=multiply(T,f,i);w=E.length;m=T.length}k=w;y=(g=T.slice(0,w)).length;for(;y<w;g[y++]=0);C=E.slice();C=[0].concat(C);b=E[0];E[1]>=i/2&&b++;do{f=0;if((s=compare(E,g,w,y))<0){v=g[0];w!=y&&(v=v*i+(g[1]||0));if((f=a(v/b))>1){f>=i&&(f=i-1);A=(d=multiply(E,f,i)).length;y=g.length;for(;1==compare(d,g,A,y);){f--;subtract(d,w<A?C:E,A,i);A=d.length;s=1}}else{0==f&&(s=f=1);A=(d=E.slice()).length}A<y&&(d=[0].concat(d));subtract(g,d,y,i);y=g.length;if(-1==s)for(;compare(E,g,w,y)<1;){f++;subtract(g,w<y?C:E,y,i);y=g.length}}else if(0===s){f++;g=[0]}p[l++]=f;if(g[0])g[y++]=T[k]||0;else{g=[T[k]];y=1}}while((k++<m||null!=g[0])&&S--);h=null!=g[0];p[0]||p.splice(0,1)}if(i==o){for(l=1,S=p[0];S>=10;S/=10,l++);round(_,n+(_.e=l+c*u-1)+1,r,h)}else{_.e=c;_.r=+h}return _}}();function format(e,t,n,r){var a,i,s,o,u;null==n?n=C:intCheck(n,0,8);if(!e.c)return e.toString();a=e.c[0];s=e.e;if(null==t){u=coeffToString(e.c);u=1==r||2==r&&s<=S?toExponential(u,s):toFixedPoint(u,s,"0")}else{i=(e=round(new BigNumber(e),t,n)).e;o=(u=coeffToString(e.c)).length;if(1==r||2==r&&(t<=i||i<=S)){for(;o<t;u+="0",o++);u=toExponential(u,i)}else{t-=s;u=toFixedPoint(u,i,"0");if(i+1>o){if(--t>0)for(u+=".";t--;u+="0");}else if((t+=i-o)>0){i+1==o&&(u+=".");for(;t--;u+="0");}}}return e.s<0&&a?"-"+u:u}function maxOrMin(e,t){var n,r,a=0;isArray(e[0])&&(e=e[0]);n=new BigNumber(e[0]);for(;++a<e.length;){if(!(r=new BigNumber(e[a])).s){n=r;break}t.call(n,r)&&(n=r)}return n}function normalise(e,t,n){for(var r=1,a=t.length;!t[--a];t.pop());for(a=t[0];a>=10;a/=10,r++);if((n=r+n*u-1)>x)e.c=e.e=null;else if(n<E)e.c=[e.e=0];else{e.e=n;e.c=t}return e}A=(p=/^(-?)0([xbo])(?=\w[\w.]*$)/i,g=/^([^.]+)\.$/,y=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,k=/^\s*\+(?=[\w.])|^\s+|\s+$/g,function(e,t,n,r){var a,s=n?t:t.replace(k,"");if(v.test(s)){e.s=isNaN(s)?null:s<0?-1:1;e.c=e.e=null}else{if(!n){s=s.replace(p,function(e,t,n){a="x"==(n=n.toLowerCase())?16:"b"==n?2:8;return r&&r!=a?e:t});if(r){a=r;s=s.replace(g,"$1").replace(y,"0.$1")}if(t!=s)return new BigNumber(s,a)}if(BigNumber.DEBUG)throw Error(i+"Not a"+(r?" base "+r:"")+" number: "+t);e.c=e.e=e.s=null}});function round(e,t,n,i){var s,c,h,f,d,A,_,p=e.c,g=l;if(p){e:{for(s=1,f=p[0];f>=10;f/=10,s++);if((c=t-s)<0){c+=u;h=t;_=(d=p[A=0])/g[s-h-1]%10|0}else if((A=r((c+1)/u))>=p.length){if(!i)break e;for(;p.length<=A;p.push(0));d=_=0;s=1;h=(c%=u)-u+1}else{d=f=p[A];for(s=1;f>=10;f/=10,s++);_=(h=(c%=u)-u+s)<0?0:d/g[s-h-1]%10|0}i=i||t<0||null!=p[A+1]||(h<0?d:d%g[s-h-1]);i=n<4?(_||i)&&(0==n||n==(e.s<0?3:2)):_>5||5==_&&(4==n||i||6==n&&(c>0?h>0?d/g[s-h]:0:p[A-1])%10&1||n==(e.s<0?8:7));if(t<1||!p[0]){p.length=0;if(i){t-=e.e+1;p[0]=g[(u-t%u)%u];e.e=-t||0}else p[0]=e.e=0;return e}if(0==c){p.length=A;f=1;A--}else{p.length=A+1;f=g[u-c];p[A]=h>0?a(d/g[s-h]%g[h])*f:0}if(i)for(;;){if(0==A){for(c=1,h=p[0];h>=10;h/=10,c++);h=p[0]+=f;for(f=1;h>=10;h/=10,f++);if(c!=f){e.e++;p[0]==o&&(p[0]=1)}break}p[A]+=f;if(p[A]!=o)break;p[A--]=0;f=1}for(c=p.length;0===p[--c];p.pop());}e.e>x?e.c=e.e=null:e.e<E&&(e.c=[e.e=0])}return e}m.absoluteValue=m.abs=function(){var e=new BigNumber(this);e.s<0&&(e.s=1);return e};m.comparedTo=function(e,t){return compare(this,new BigNumber(e,t))};m.decimalPlaces=m.dp=function(e,t){var n,r,a,i=this;if(null!=e){intCheck(e,0,f);null==t?t=C:intCheck(t,0,8);return round(new BigNumber(i),e+i.e+1,t)}if(!(n=i.c))return null;r=((a=n.length-1)-bitFloor(this.e/u))*u;if(a=n[a])for(;a%10==0;a/=10,r--);r<0&&(r=0);return r};m.dividedBy=m.div=function(e,n){return t(this,new BigNumber(e,n),w,C)};m.dividedToIntegerBy=m.idiv=function(e,n){return t(this,new BigNumber(e,n),0,1)};m.exponentiatedBy=m.pow=function(e,t){var n,s,o,c,l,h,f,d=this;if((e=new BigNumber(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+e);null!=t&&(t=new BigNumber(t));c=e.e>14;if(!d.c||!d.c[0]||1==d.c[0]&&!d.e&&1==d.c.length||!e.c||!e.c[0]){f=new BigNumber(Math.pow(+d.valueOf(),c?2-isOdd(e):+e));return t?f.mod(t):f}l=e.s<0;if(t){if(t.c?!t.c[0]:!t.s)return new BigNumber(NaN);(s=!l&&d.isInteger()&&t.isInteger())&&(d=d.mod(t))}else{if(e.e>9&&(d.e>0||d.e<-1||(0==d.e?d.c[0]>1||c&&d.c[1]>=24e7:d.c[0]<8e13||c&&d.c[0]<=9999975e7))){o=d.s<0&&isOdd(e)?-0:0;d.e>-1&&(o=1/o);return new BigNumber(l?1/o:o)}P&&(o=r(P/u+2))}if(c){n=new BigNumber(.5);h=isOdd(e)}else h=e%2;l&&(e.s=1);f=new BigNumber(b);for(;;){if(h){if(!(f=f.times(d)).c)break;o?f.c.length>o&&(f.c.length=o):s&&(f=f.mod(t))}if(c){round(e=e.times(n),e.e+1,1);if(!e.c[0])break;c=e.e>14;h=isOdd(e)}else{if(!(e=a(e/2)))break;h=e%2}d=d.times(d);o?d.c&&d.c.length>o&&(d.c.length=o):s&&(d=d.mod(t))}if(s)return f;l&&(f=b.div(f));return t?f.mod(t):o?round(f,P,C,void 0):f};m.integerValue=function(e){var t=new BigNumber(this);null==e?e=C:intCheck(e,0,8);return round(t,t.e+1,e)};m.isEqualTo=m.eq=m.equals=function(e,t){return 0===compare(this,new BigNumber(e,t))};m.isFinite=function(){return!!this.c};m.isGreaterThan=m.gt=function(e,t){return compare(this,new BigNumber(e,t))>0};m.isGreaterThanOrEqualTo=m.gte=function(e,t){return 1===(t=compare(this,new BigNumber(e,t)))||0===t};m.isInteger=function(){return!!this.c&&bitFloor(this.e/u)>this.c.length-2};m.isLessThan=m.lt=function(e,t){return compare(this,new BigNumber(e,t))<0};m.isLessThanOrEqualTo=m.lte=function(e,t){return-1===(t=compare(this,new BigNumber(e,t)))||0===t};m.isNaN=function(){return!this.s};m.isNegative=function(){return this.s<0};m.isPositive=function(){return this.s>0};m.isZero=function(){return!!this.c&&0==this.c[0]};m.minus=function(e,t){var n,r,a,i,s=this,c=s.s;t=(e=new BigNumber(e,t)).s;if(!c||!t)return new BigNumber(NaN);if(c!=t){e.s=-t;return s.plus(e)}var l=s.e/u,h=e.e/u,f=s.c,d=e.c;if(!l||!h){if(!f||!d)return f?(e.s=-t,e):new BigNumber(d?s:NaN);if(!f[0]||!d[0])return d[0]?(e.s=-t,e):new BigNumber(f[0]?s:3==C?-0:0)}l=bitFloor(l);h=bitFloor(h);f=f.slice();if(c=l-h){if(i=c<0){c=-c;a=f}else{h=l;a=d}a.reverse();for(t=c;t--;a.push(0));a.reverse()}else{r=(i=(c=f.length)<(t=d.length))?c:t;for(c=t=0;t<r;t++)if(f[t]!=d[t]){i=f[t]<d[t];break}}i&&(a=f,f=d,d=a,e.s=-e.s);if((t=(r=d.length)-(n=f.length))>0)for(;t--;f[n++]=0);t=o-1;for(;r>c;){if(f[--r]<d[r]){for(n=r;n&&!f[--n];f[n]=t);--f[n];f[r]+=o}f[r]-=d[r]}for(;0==f[0];f.splice(0,1),--h);if(!f[0]){e.s=3==C?-1:1;e.c=[e.e=0];return e}return normalise(e,f,h)};m.modulo=m.mod=function(e,n){var r,a,i=this;e=new BigNumber(e,n);if(!i.c||!e.s||e.c&&!e.c[0])return new BigNumber(NaN);if(!e.c||i.c&&!i.c[0])return new BigNumber(i);if(9==B){a=e.s;e.s=1;r=t(i,e,0,3);e.s=a;r.s*=a}else r=t(i,e,0,B);(e=i.minus(r.times(e))).c[0]||1!=B||(e.s=i.s);return e};m.multipliedBy=m.times=function(e,t){var n,r,a,i,s,c,l,f,d,A,_,p,g,y,v,k=this,m=k.c,b=(e=new BigNumber(e,t)).c;if(!(m&&b&&m[0]&&b[0])){if(!k.s||!e.s||m&&!m[0]&&!b||b&&!b[0]&&!m)e.c=e.e=e.s=null;else{e.s*=k.s;if(m&&b){e.c=[0];e.e=0}else e.c=e.e=null}return e}r=bitFloor(k.e/u)+bitFloor(e.e/u);e.s*=k.s;(l=m.length)<(A=b.length)&&(g=m,m=b,b=g,a=l,l=A,A=a);for(a=l+A,g=[];a--;g.push(0));y=o;v=h;for(a=A;--a>=0;){n=0;_=b[a]%v;p=b[a]/v|0;for(i=a+(s=l);i>a;){n=((f=_*(f=m[--s]%v)+(c=p*f+(d=m[s]/v|0)*_)%v*v+g[i]+n)/y|0)+(c/v|0)+p*d;g[i--]=f%y}g[i]=n}n?++r:g.splice(0,1);return normalise(e,g,r)};m.negated=function(){var e=new BigNumber(this);e.s=-e.s||null;return e};m.plus=function(e,t){var n,r=this,a=r.s;t=(e=new BigNumber(e,t)).s;if(!a||!t)return new BigNumber(NaN);if(a!=t){e.s=-t;return r.minus(e)}var i=r.e/u,s=e.e/u,c=r.c,l=e.c;if(!i||!s){if(!c||!l)return new BigNumber(a/0);if(!c[0]||!l[0])return l[0]?e:new BigNumber(c[0]?r:0*a)}i=bitFloor(i);s=bitFloor(s);c=c.slice();if(a=i-s){if(a>0){s=i;n=l}else{a=-a;n=c}n.reverse();for(;a--;n.push(0));n.reverse()}(a=c.length)-(t=l.length)<0&&(n=l,l=c,c=n,t=a);for(a=0;t;){a=(c[--t]=c[t]+l[t]+a)/o|0;c[t]=o===c[t]?0:c[t]%o}if(a){c=[a].concat(c);++s}return normalise(e,c,s)};m.precision=m.sd=function(e,t){var n,r,a,i=this;if(null!=e&&e!==!!e){intCheck(e,1,f);null==t?t=C:intCheck(t,0,8);return round(new BigNumber(i),e,t)}if(!(n=i.c))return null;r=(a=n.length-1)*u+1;if(a=n[a]){for(;a%10==0;a/=10,r--);for(a=n[0];a>=10;a/=10,r++);}e&&i.e+1>r&&(r=i.e+1);return r};m.shiftedBy=function(e){intCheck(e,-c,c);return this.times("1e"+e)};m.squareRoot=m.sqrt=function(){var e,n,r,a,i,s=this,o=s.c,u=s.s,c=s.e,l=w+4,h=new BigNumber("0.5");if(1!==u||!o||!o[0])return new BigNumber(!u||u<0&&(!o||o[0])?NaN:o?s:1/0);if(0==(u=Math.sqrt(+s))||u==1/0){((n=coeffToString(o)).length+c)%2==0&&(n+="0");u=Math.sqrt(n);c=bitFloor((c+1)/2)-(c<0||c%2);r=new BigNumber(n=u==1/0?"1e"+c:(n=u.toExponential()).slice(0,n.indexOf("e")+1)+c)}else r=new BigNumber(u+"");if(r.c[0]){(u=(c=r.e)+l)<3&&(u=0);for(;;){i=r;r=h.times(i.plus(t(s,i,l,1)));if(coeffToString(i.c).slice(0,u)===(n=coeffToString(r.c)).slice(0,u)){r.e<c&&--u;if("9999"!=(n=n.slice(u-3,u+1))&&(a||"4999"!=n)){if(!+n||!+n.slice(1)&&"5"==n.charAt(0)){round(r,r.e+w+2,1);e=!r.times(r).eq(s)}break}if(!a){round(i,i.e+w+2,0);if(i.times(i).eq(s)){r=i;break}}l+=4;u+=4;a=1}}}return round(r,r.e+w+1,C,e)};m.toExponential=function(e,t){if(null!=e){intCheck(e,0,f);e++}return format(this,e,t,1)};m.toFixed=function(e,t){if(null!=e){intCheck(e,0,f);e=e+this.e+1}return format(this,e,t)};m.toFormat=function(e,t){var n=this.toFixed(e,t);if(this.c){var r,a=n.split("."),i=+N.groupSize,s=+N.secondaryGroupSize,o=N.groupSeparator,u=a[0],c=a[1],l=this.s<0,h=l?u.slice(1):u,f=h.length;s&&(r=i,i=s,s=r,f-=r);if(i>0&&f>0){r=f%i||i;u=h.substr(0,r);for(;r<f;r+=i)u+=o+h.substr(r,i);s>0&&(u+=o+h.slice(r));l&&(u="-"+u)}n=c?u+N.decimalSeparator+((s=+N.fractionGroupSize)?c.replace(new RegExp("\\d{"+s+"}\\B","g"),"$&"+N.fractionGroupSeparator):c):u}return n};m.toFraction=function(e){var n,r,a,s,o,c,h,f,d,A,_,p,g=this,y=g.c;if(null!=e&&(!(f=new BigNumber(e)).isInteger()&&(f.c||1!==f.s)||f.lt(b)))throw Error(i+"Argument "+(f.isInteger()?"out of range: ":"not an integer: ")+e);if(!y)return g.toString();r=new BigNumber(b);A=a=new BigNumber(b);s=d=new BigNumber(b);p=coeffToString(y);c=r.e=p.length-g.e-1;r.c[0]=l[(h=c%u)<0?u+h:h];e=!e||f.comparedTo(r)>0?c>0?r:A:f;h=x;x=1/0;f=new BigNumber(p);d.c[0]=0;for(;;){_=t(f,r,0,1);if(1==(o=a.plus(_.times(s))).comparedTo(e))break;a=s;s=o;A=d.plus(_.times(o=A));d=o;r=f.minus(_.times(o=r));f=o}o=t(e.minus(a),s,0,1);d=d.plus(o.times(A));a=a.plus(o.times(s));d.s=A.s=g.s;n=t(A,s,c*=2,C).minus(g).abs().comparedTo(t(d,a,c,C).minus(g).abs())<1?[A.toString(),s.toString()]:[d.toString(),a.toString()];x=h;return n};m.toNumber=function(){return+this};m.toPrecision=function(e,t){null!=e&&intCheck(e,1,f);return format(this,e,t,2)};m.toString=function(e){var t,n=this,r=n.s,a=n.e;if(null===a)if(r){t="Infinity";r<0&&(t="-"+t)}else t="NaN";else{t=coeffToString(n.c);if(null==e)t=a<=S||a>=T?toExponential(t,a):toFixedPoint(t,a,"0");else{intCheck(e,2,O.length,"Base");t=d(toFixedPoint(t,a,"0"),10,e,r,!0)}r<0&&n.c[0]&&(t="-"+t)}return t};m.valueOf=m.toJSON=function(){var e,t=this,n=t.e;if(null===n)return t.toString();e=coeffToString(t.c);e=n<=S||n>=T?toExponential(e,n):toFixedPoint(e,n,"0");return t.s<0?"-"+e:e};m._isBigNumber=!0;null!=e&&BigNumber.set(e);return BigNumber}())["default"]=t.BigNumber=t;e.BigNumber=t}(n.scope);var J=n.scope.BigNumber;J.config({DECIMAL_PLACES:10});var Y=function(){function NumberUtils(){(0,_classCallCheck2["default"])(this,NumberUtils)}(0,_createClass2["default"])(NumberUtils,null,[{key:"isUint8",value:function isUint8(e){return(0,_isInteger["default"])(e)&&e>=0&&e<=NumberUtils.UINT8_MAX}},{key:"isUint16",value:function isUint16(e){return(0,_isInteger["default"])(e)&&e>=0&&e<=NumberUtils.UINT16_MAX}},{key:"isUint32",value:function isUint32(e){return(0,_isInteger["default"])(e)&&e>=0&&e<=NumberUtils.UINT32_MAX}},{key:"isUint64",value:function isUint64(e){return(0,_isInteger["default"])(e)&&e>=0&&e<=NumberUtils.UINT64_MAX}},{key:"randomUint32",value:function randomUint32(){return Math.floor(Math.random()*(NumberUtils.UINT32_MAX+1))}},{key:"randomUint64",value:function randomUint64(){return Math.floor(Math.random()*(NumberUtils.UINT64_MAX+1))}},{key:"fromBinary",value:function fromBinary(e){return(0,_parseInt2["default"])(e,2)}}]);return NumberUtils}();Y.UINT8_MAX=255;Y.UINT16_MAX=65535;Y.UINT32_MAX=4294967295;Y.UINT64_MAX=_maxSafeInteger["default"];n.register(Y);var X=function(){function MerkleTree(){(0,_classCallCheck2["default"])(this,MerkleTree)}(0,_createClass2["default"])(MerkleTree,null,[{key:"computeRoot",value:function computeRoot(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:MerkleTree._hash;return MerkleTree._computeRoot(e,t)}},{key:"_computeRoot",value:function _computeRoot(e,t){var n=e.length;if(0===n)return ie.light(new Uint8Array(0));if(1===n)return t(e[0]);var r=Math.round(n/2),a=e.slice(0,r),i=e.slice(r),s=MerkleTree._computeRoot(a,t),o=MerkleTree._computeRoot(i,t);return ie.light(M.concatTypedArrays(s.serialize(),o.serialize()))}},{key:"_hash",value:function _hash(e){if(e instanceof ie)return e;if("function"==typeof e.hash)return e.hash();if("function"==typeof e.serialize)return ie.light(e.serialize());if(e instanceof Uint8Array)return ie.light(e);throw new Error("MerkleTree objects must be Uint8Array or have a .hash()/.serialize() method")}}]);return MerkleTree}();n.register(X);var Z=function(){function MerklePath(e){(0,_classCallCheck2["default"])(this,MerklePath);if(!(0,_isArray["default"])(e)||!Y.isUint8(e.length)||e.some(function(e){return!(e instanceof $)}))throw new Error("Malformed nodes");this._nodes=e}(0,_createClass2["default"])(MerklePath,[{key:"computeRoot",value:function computeRoot(e){var t=(arguments.length>1&&arguments[1]!==undefined?arguments[1]:X._hash)(e),n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(this._nodes);!(n=(i=s.next()).done);n=!0){var o=i.value,u=o.left,c=o.hash,l=new U(2*c.serializedSize);u&&c.serialize(l);t.serialize(l);u||c.serialize(l);t=ie.light(l)}}catch(h){r=!0;a=h}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}return t}},{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint8(this._nodes.length);e.write(MerklePath._compress(this._nodes));var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._nodes);!(t=(a=i.next()).done);t=!0){a.value.hash.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"equals",value:function equals(e){return e instanceof MerklePath&&this._nodes.length===e._nodes.length&&this._nodes.every(function(t,n){return t.equals(e._nodes[n])})}},{key:"serializedSize",get:function get(){return 1+Math.ceil(this._nodes.length/8)+this._nodes.reduce(function(e,t){return e+t.hash.serializedSize},0)}},{key:"nodes",get:function get(){return this._nodes}}],[{key:"compute",value:function compute(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:X._hash,r=n(t),a=[];MerklePath._compute(e,r,a,n);return new MerklePath(a)}},{key:"_compute",value:function _compute(e,t,n,r){var a,i=e.length;if(0===i)return{containsLeaf:!1,inner:a=ie.light(new Uint8Array(0))};if(1===i)return{containsLeaf:(a=r(e[0])).equals(t),inner:a};var s=Math.round(i/2),o=e.slice(0,s),u=e.slice(s),c=MerklePath._compute(o,t,n,r),l=c.containsLeaf,h=c.inner,f=MerklePath._compute(u,t,n,r),d=f.containsLeaf,A=f.inner;a=ie.light(M.concatTypedArrays(h.serialize(),A.serialize()));if(l){n.push(new $(A,!1));return{containsLeaf:!0,inner:a}}if(d){n.push(new $(h,!0));return{containsLeaf:!0,inner:a}}return{containsLeaf:!1,inner:a}}},{key:"_compress",value:function _compress(e){for(var t=e.length,n=Math.ceil(t/8),r=new Uint8Array(n),a=0;a<t;a++)e[a].left&&(r[Math.floor(a/8)]|=128>>>a%8);return r}},{key:"unserialize",value:function unserialize(e){for(var t=e.readUint8(),n=Math.ceil(t/8),r=e.read(n),a=[],i=0;i<t;i++){var s=0!=(r[Math.floor(i/8)]&128>>>i%8),o=ie.unserialize(e);a.push(new $(o,s))}return new MerklePath(a)}}]);return MerklePath}();n.register(Z);var $=function(){function MerklePathNode(e,t){(0,_classCallCheck2["default"])(this,MerklePathNode);this._hash=e;this._left=t}(0,_createClass2["default"])(MerklePathNode,[{key:"equals",value:function equals(e){return e instanceof MerklePathNode&&this._hash.equals(e.hash)&&this._left===e.left}},{key:"hash",get:function get(){return this._hash}},{key:"left",get:function get(){return this._left}}]);return MerklePathNode}();n.register($);var ee=function(){function MerkleProof(e,t){(0,_classCallCheck2["default"])(this,MerkleProof);if(!(0,_isArray["default"])(e)||!Y.isUint16(e.length))throw new Error("Malformed nodes");if(!(0,_isArray["default"])(t)||!Y.isUint16(t.length))throw new Error("Malformed operations");this._nodes=e;this._operations=t}(0,_createClass2["default"])(MerkleProof,[{key:"computeRoot",value:function computeRoot(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:X._hash,n=e.map(t),r=[],a=this._nodes.slice(),i=!0,s=!1,o=undefined;try{for(var u,c=(0,_getIterator2["default"])(this._operations);!(i=(u=c.next()).done);i=!0){switch(u.value){case MerkleProof.Operation.CONSUME_PROOF:if(0===a.length)throw new Error("Invalid operation.");r.push(a.shift());break;case MerkleProof.Operation.CONSUME_INPUT:if(0===n.length)throw new Error("Invalid operation.");r.push(n.shift());break;case MerkleProof.Operation.HASH:if(r.length<2)throw new Error("Invalid operation.");var l=r.splice(-2,2),h=new U(l.reduce(function(e,t){return e+t.serializedSize},0)),f=(0,_slicedToArray2["default"])(l,2),d=f[0],A=f[1];d.serialize(h);A.serialize(h);r.push(ie.light(h));break;default:throw new Error("Invalid operation.")}}}catch(_){s=!0;o=_}finally{try{i||null==c["return"]||c["return"]()}finally{if(s)throw o}}if(1!==r.length||0!==a.length||0!==n.length)throw Error("Did not consume all nodes.");return r[0]}},{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint16(this._operations.length);e.write(MerkleProof._compress(this._operations));e.writeUint16(this._nodes.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._nodes);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"equals",value:function equals(e){return e instanceof MerkleProof&&this._nodes.length===e._nodes.length&&this._nodes.every(function(t,n){return t.equals(e._nodes[n])})&&this._operations.length===e._operations.length&&this._operations.every(function(t,n){return t===e._operations[n]})}},{key:"serializedSize",get:function get(){return 4+Math.ceil(this._operations.length/4)+this._nodes.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"nodes",get:function get(){return this._nodes}}],[{key:"compute",value:function compute(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:X._hash,r=t.map(n),a=MerkleProof._compute(e,r,n),i=(a.containsLeaf,a.operations),s=a.path;a.inner;return new MerkleProof(s,i)}},{key:"computeWithAbsence",value:function computeWithAbsence(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:X._hash,a=new _set5["default"];(t=t.slice()).sort(n);for(var i=0,s=0;s<e.length&&i<t.length;){var o=e[s],u=n(o,t[i]);if(0===u){a.add(t[i]);++i}else if(u>0){s>0&&a.add(e[s-1]);a.add(o);++i}else++s}i<t.length&&e.length>0&&a.add(e[e.length-1]);return MerkleProof.compute(e,(0,_from["default"])(a),r)}},{key:"_compute",value:function _compute(e,t,n){var r,a=e.length;if(0===a){r=ie.light(new Uint8Array(0));return{containsLeaf:!1,operations:[MerkleProof.Operation.CONSUME_PROOF],path:[r],inner:r}}if(1===a){r=n(e[0]);var i=t.some(function(e){return r.equals(e)});return{containsLeaf:i,operations:[i?MerkleProof.Operation.CONSUME_INPUT:MerkleProof.Operation.CONSUME_PROOF],path:i?[]:[r],inner:r}}var s=Math.round(a/2),o=e.slice(0,s),u=e.slice(s),c=MerkleProof._compute(o,t,n),l=c.containsLeaf,h=c.operations,f=c.path,d=c.inner,A=MerkleProof._compute(u,t,n),_=A.containsLeaf,p=A.operations,g=A.path,y=A.inner;r=ie.light(M.concatTypedArrays(d.serialize(),y.serialize()));if(!l&&!_)return{containsLeaf:!1,operations:[MerkleProof.Operation.CONSUME_PROOF],path:[r],inner:r};var v=h;v=v.concat(p);var k=f;k=k.concat(g);v.push(MerkleProof.Operation.HASH);return{containsLeaf:!0,operations:v,path:k,inner:r}}},{key:"_compress",value:function _compress(e){for(var t=e.length,n=Math.ceil(t/4),r=new Uint8Array(n),a=0;a<t;a++){var i=3&e[a];r[Math.floor(a/4)]|=i<<a%4*2}return r}},{key:"unserialize",value:function unserialize(e){for(var t=e.readUint16(),n=Math.ceil(t/4),r=e.read(n),a=[],i=0;i<t;i++){var s=r[Math.floor(i/4)]>>>i%4*2&3;a.push(s)}for(var o=e.readUint16(),u=[],c=0;c<o;c++)u.push(ie.unserialize(e));return new MerkleProof(u,a)}}]);return MerkleProof}();ee.Operation={CONSUME_PROOF:0,CONSUME_INPUT:1,HASH:2};n.register(ee);var te=function(){function MnemonicUtils(){(0,_classCallCheck2["default"])(this,MnemonicUtils)}(0,_createClass2["default"])(MnemonicUtils,null,[{key:"_crcChecksum",value:function _crcChecksum(e){var t=8*e.length/32,n=V.compute(e);return M.toBinary([n]).slice(0,t)}},{key:"_sha256Checksum",value:function _sha256Checksum(e){var t=8*e.length/32,n=ie.computeSha256(e);return M.toBinary(n).slice(0,t)}},{key:"_entropyToBits",value:function _entropyToBits(e){if(e.length<16)throw new Error("Invalid key, length < 16");if(e.length>32)throw new Error("Invalid key, length > 32");if(e.length%4!=0)throw new Error("Invalid key, length % 4 != 0");return M.toBinary(e)}},{key:"_normalizeEntropy",value:function _normalizeEntropy(e){"string"==typeof e&&(e=M.fromHex(e));e instanceof le&&(e=e.serialize());e instanceof ArrayBuffer&&(e=new Uint8Array(e));return e}},{key:"_bitsToMnemonic",value:function _bitsToMnemonic(e,t){return e.match(/(.{11})/g).map(function(e){var n=Y.fromBinary(e);return t[n]})}},{key:"_mnemonicToBits",value:function _mnemonicToBits(e,t){var n=e;if(n.length<12)throw new Error("Invalid mnemonic, less than 12 words");if(n.length>24)throw new Error("Invalid mnemonic, more than 24 words");if(n.length%3!=0)throw new Error("Invalid mnemonic, words % 3 != 0");return n.map(function(e){var n=t.indexOf(e.toLowerCase());if(-1===n)throw new Error("Invalid mnemonic, word >".concat(e,"< is not in wordlist"));return ne.lpad(n.toString(2),"0",11)}).join("")}},{key:"_bitsToEntropy",value:function _bitsToEntropy(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1],n=e.length-(e.length%8||8),r=e.slice(0,n),a=e.slice(n),i=r.match(/(.{8})/g).map(Y.fromBinary);if(i.length<16)throw new Error("Invalid generated key, length < 16");if(i.length>32)throw new Error("Invalid generated key, length > 32");if(i.length%4!=0)throw new Error("Invalid generated key, length % 4 != 0");var s=new Uint8Array(i);if((t?MnemonicUtils._crcChecksum(s):MnemonicUtils._sha256Checksum(s))!==a)throw new Error("Invalid checksum");return s}},{key:"entropyToMnemonic",value:function entropyToMnemonic(e,t){t=t||MnemonicUtils.DEFAULT_WORDLIST;e=MnemonicUtils._normalizeEntropy(e);var n=MnemonicUtils._entropyToBits(e)+MnemonicUtils._sha256Checksum(e);return MnemonicUtils._bitsToMnemonic(n,t)}},{key:"entropyToLegacyMnemonic",value:function entropyToLegacyMnemonic(e,t){t=t||MnemonicUtils.DEFAULT_WORDLIST;e=MnemonicUtils._normalizeEntropy(e);var n=MnemonicUtils._entropyToBits(e)+MnemonicUtils._crcChecksum(e);return MnemonicUtils._bitsToMnemonic(n,t)}},{key:"mnemonicToEntropy",value:function mnemonicToEntropy(e,t){(0,_isArray["default"])(e)||(e=e.trim().split(/\s+/g));t=t||MnemonicUtils.DEFAULT_WORDLIST;var n=MnemonicUtils._mnemonicToBits(e,t);return new le(MnemonicUtils._bitsToEntropy(n,!1))}},{key:"legacyMnemonicToEntropy",value:function legacyMnemonicToEntropy(e,t){(0,_isArray["default"])(e)||(e=e.trim().split(/\s+/g));t=t||MnemonicUtils.DEFAULT_WORDLIST;var n=MnemonicUtils._mnemonicToBits(e,t);return new le(MnemonicUtils._bitsToEntropy(n,!0))}},{key:"_salt",value:function _salt(e){return"mnemonic".concat(e||"")}},{key:"mnemonicToSeed",value:function mnemonicToSeed(e,t){(0,_isArray["default"])(e)&&(e=e.join(" "));var n=M.fromAscii(e),r=M.fromAscii(MnemonicUtils._salt(t));return j.computePBKDF2sha512(n,r,2048,64)}},{key:"mnemonicToExtendedPrivateKey",value:function mnemonicToExtendedPrivateKey(e,t){var n=MnemonicUtils.mnemonicToSeed(e,t);return he.generateMasterKey(n)}},{key:"isCollidingChecksum",value:function isCollidingChecksum(e){var t=MnemonicUtils._normalizeEntropy(e);return MnemonicUtils._crcChecksum(t)===MnemonicUtils._sha256Checksum(t)}},{key:"getMnemonicType",value:function getMnemonicType(e,t){(0,_isArray["default"])(e)||(e=e.trim().split(/\s+/g));t=t||MnemonicUtils.DEFAULT_WORDLIST;var n=MnemonicUtils._mnemonicToBits(e,t),r=!0;try{MnemonicUtils._bitsToEntropy(n,!1)}catch(i){r=!1}var a=!0;try{MnemonicUtils._bitsToEntropy(n,!0)}catch(i){a=!1}if(r&&a)return MnemonicUtils.MnemonicType.UNKNOWN;if(!r&&!a)throw new Error("Invalid checksum");return r?MnemonicUtils.MnemonicType.BIP39:MnemonicUtils.MnemonicType.LEGACY}}]);return MnemonicUtils}();te.ENGLISH_WORDLIST=["abandon","ability","able","about","above","absent","absorb","abstract","absurd","abuse","access","accident","account","accuse","achieve","acid","acoustic","acquire","across","act","action","actor","actress","actual","adapt","add","addict","address","adjust","admit","adult","advance","advice","aerobic","affair","afford","afraid","again","age","agent","agree","ahead","aim","air","airport","aisle","alarm","album","alcohol","alert","alien","all","alley","allow","almost","alone","alpha","already","also","alter","always","amateur","amazing","among","amount","amused","analyst","anchor","ancient","anger","angle","angry","animal","ankle","announce","annual","another","answer","antenna","antique","anxiety","any","apart","apology","appear","apple","approve","april","arch","arctic","area","arena","argue","arm","armed","armor","army","around","arrange","arrest","arrive","arrow","art","artefact","artist","artwork","ask","aspect","assault","asset","assist","assume","asthma","athlete","atom","attack","attend","attitude","attract","auction","audit","august","aunt","author","auto","autumn","average","avocado","avoid","awake","aware","away","awesome","awful","awkward","axis","baby","bachelor","bacon","badge","bag","balance","balcony","ball","bamboo","banana","banner","bar","barely","bargain","barrel","base","basic","basket","battle","beach","bean","beauty","because","become","beef","before","begin","behave","behind","believe","below","belt","bench","benefit","best","betray","better","between","beyond","bicycle","bid","bike","bind","biology","bird","birth","bitter","black","blade","blame","blanket","blast","bleak","bless","blind","blood","blossom","blouse","blue","blur","blush","board","boat","body","boil","bomb","bone","bonus","book","boost","border","boring","borrow","boss","bottom","bounce","box","boy","bracket","brain","brand","brass","brave","bread","breeze","brick","bridge","brief","bright","bring","brisk","broccoli","broken","bronze","broom","brother","brown","brush","bubble","buddy","budget","buffalo","build","bulb","bulk","bullet","bundle","bunker","burden","burger","burst","bus","business","busy","butter","buyer","buzz","cabbage","cabin","cable","cactus","cage","cake","call","calm","camera","camp","can","canal","cancel","candy","cannon","canoe","canvas","canyon","capable","capital","captain","car","carbon","card","cargo","carpet","carry","cart","case","cash","casino","castle","casual","cat","catalog","catch","category","cattle","caught","cause","caution","cave","ceiling","celery","cement","census","century","cereal","certain","chair","chalk","champion","change","chaos","chapter","charge","chase","chat","cheap","check","cheese","chef","cherry","chest","chicken","chief","child","chimney","choice","choose","chronic","chuckle","chunk","churn","cigar","cinnamon","circle","citizen","city","civil","claim","clap","clarify","claw","clay","clean","clerk","clever","click","client","cliff","climb","clinic","clip","clock","clog","close","cloth","cloud","clown","club","clump","cluster","clutch","coach","coast","coconut","code","coffee","coil","coin","collect","color","column","combine","come","comfort","comic","common","company","concert","conduct","confirm","congress","connect","consider","control","convince","cook","cool","copper","copy","coral","core","corn","correct","cost","cotton","couch","country","couple","course","cousin","cover","coyote","crack","cradle","craft","cram","crane","crash","crater","crawl","crazy","cream","credit","creek","crew","cricket","crime","crisp","critic","crop","cross","crouch","crowd","crucial","cruel","cruise","crumble","crunch","crush","cry","crystal","cube","culture","cup","cupboard","curious","current","curtain","curve","cushion","custom","cute","cycle","dad","damage","damp","dance","danger","daring","dash","daughter","dawn","day","deal","debate","debris","decade","december","decide","decline","decorate","decrease","deer","defense","define","defy","degree","delay","deliver","demand","demise","denial","dentist","deny","depart","depend","deposit","depth","deputy","derive","describe","desert","design","desk","despair","destroy","detail","detect","develop","device","devote","diagram","dial","diamond","diary","dice","diesel","diet","differ","digital","dignity","dilemma","dinner","dinosaur","direct","dirt","disagree","discover","disease","dish","dismiss","disorder","display","distance","divert","divide","divorce","dizzy","doctor","document","dog","doll","dolphin","domain","donate","donkey","donor","door","dose","double","dove","draft","dragon","drama","drastic","draw","dream","dress","drift","drill","drink","drip","drive","drop","drum","dry","duck","dumb","dune","during","dust","dutch","duty","dwarf","dynamic","eager","eagle","early","earn","earth","easily","east","easy","echo","ecology","economy","edge","edit","educate","effort","egg","eight","either","elbow","elder","electric","elegant","element","elephant","elevator","elite","else","embark","embody","embrace","emerge","emotion","employ","empower","empty","enable","enact","end","endless","endorse","enemy","energy","enforce","engage","engine","enhance","enjoy","enlist","enough","enrich","enroll","ensure","enter","entire","entry","envelope","episode","equal","equip","era","erase","erode","erosion","error","erupt","escape","essay","essence","estate","eternal","ethics","evidence","evil","evoke","evolve","exact","example","excess","exchange","excite","exclude","excuse","execute","exercise","exhaust","exhibit","exile","exist","exit","exotic","expand","expect","expire","explain","expose","express","extend","extra","eye","eyebrow","fabric","face","faculty","fade","faint","faith","fall","false","fame","family","famous","fan","fancy","fantasy","farm","fashion","fat","fatal","father","fatigue","fault","favorite","feature","february","federal","fee","feed","feel","female","fence","festival","fetch","fever","few","fiber","fiction","field","figure","file","film","filter","final","find","fine","finger","finish","fire","firm","first","fiscal","fish","fit","fitness","fix","flag","flame","flash","flat","flavor","flee","flight","flip","float","flock","floor","flower","fluid","flush","fly","foam","focus","fog","foil","fold","follow","food","foot","force","forest","forget","fork","fortune","forum","forward","fossil","foster","found","fox","fragile","frame","frequent","fresh","friend","fringe","frog","front","frost","frown","frozen","fruit","fuel","fun","funny","furnace","fury","future","gadget","gain","galaxy","gallery","game","gap","garage","garbage","garden","garlic","garment","gas","gasp","gate","gather","gauge","gaze","general","genius","genre","gentle","genuine","gesture","ghost","giant","gift","giggle","ginger","giraffe","girl","give","glad","glance","glare","glass","glide","glimpse","globe","gloom","glory","glove","glow","glue","goat","goddess","gold","good","goose","gorilla","gospel","gossip","govern","gown","grab","grace","grain","grant","grape","grass","gravity","great","green","grid","grief","grit","grocery","group","grow","grunt","guard","guess","guide","guilt","guitar","gun","gym","habit","hair","half","hammer","hamster","hand","happy","harbor","hard","harsh","harvest","hat","have","hawk","hazard","head","health","heart","heavy","hedgehog","height","hello","helmet","help","hen","hero","hidden","high","hill","hint","hip","hire","history","hobby","hockey","hold","hole","holiday","hollow","home","honey","hood","hope","horn","horror","horse","hospital","host","hotel","hour","hover","hub","huge","human","humble","humor","hundred","hungry","hunt","hurdle","hurry","hurt","husband","hybrid","ice","icon","idea","identify","idle","ignore","ill","illegal","illness","image","imitate","immense","immune","impact","impose","improve","impulse","inch","include","income","increase","index","indicate","indoor","industry","infant","inflict","inform","inhale","inherit","initial","inject","injury","inmate","inner","innocent","input","inquiry","insane","insect","inside","inspire","install","intact","interest","into","invest","invite","involve","iron","island","isolate","issue","item","ivory","jacket","jaguar","jar","jazz","jealous","jeans","jelly","jewel","job","join","joke","journey","joy","judge","juice","jump","jungle","junior","junk","just","kangaroo","keen","keep","ketchup","key","kick","kid","kidney","kind","kingdom","kiss","kit","kitchen","kite","kitten","kiwi","knee","knife","knock","know","lab","label","labor","ladder","lady","lake","lamp","language","laptop","large","later","latin","laugh","laundry","lava","law","lawn","lawsuit","layer","lazy","leader","leaf","learn","leave","lecture","left","leg","legal","legend","leisure","lemon","lend","length","lens","leopard","lesson","letter","level","liar","liberty","library","license","life","lift","light","like","limb","limit","link","lion","liquid","list","little","live","lizard","load","loan","lobster","local","lock","logic","lonely","long","loop","lottery","loud","lounge","love","loyal","lucky","luggage","lumber","lunar","lunch","luxury","lyrics","machine","mad","magic","magnet","maid","mail","main","major","make","mammal","man","manage","mandate","mango","mansion","manual","maple","marble","march","margin","marine","market","marriage","mask","mass","master","match","material","math","matrix","matter","maximum","maze","meadow","mean","measure","meat","mechanic","medal","media","melody","melt","member","memory","mention","menu","mercy","merge","merit","merry","mesh","message","metal","method","middle","midnight","milk","million","mimic","mind","minimum","minor","minute","miracle","mirror","misery","miss","mistake","mix","mixed","mixture","mobile","model","modify","mom","moment","monitor","monkey","monster","month","moon","moral","more","morning","mosquito","mother","motion","motor","mountain","mouse","move","movie","much","muffin","mule","multiply","muscle","museum","mushroom","music","must","mutual","myself","mystery","myth","naive","name","napkin","narrow","nasty","nation","nature","near","neck","need","negative","neglect","neither","nephew","nerve","nest","net","network","neutral","never","news","next","nice","night","noble","noise","nominee","noodle","normal","north","nose","notable","note","nothing","notice","novel","now","nuclear","number","nurse","nut","oak","obey","object","oblige","obscure","observe","obtain","obvious","occur","ocean","october","odor","off","offer","office","often","oil","okay","old","olive","olympic","omit","once","one","onion","online","only","open","opera","opinion","oppose","option","orange","orbit","orchard","order","ordinary","organ","orient","original","orphan","ostrich","other","outdoor","outer","output","outside","oval","oven","over","own","owner","oxygen","oyster","ozone","pact","paddle","page","pair","palace","palm","panda","panel","panic","panther","paper","parade","parent","park","parrot","party","pass","patch","path","patient","patrol","pattern","pause","pave","payment","peace","peanut","pear","peasant","pelican","pen","penalty","pencil","people","pepper","perfect","permit","person","pet","phone","photo","phrase","physical","piano","picnic","picture","piece","pig","pigeon","pill","pilot","pink","pioneer","pipe","pistol","pitch","pizza","place","planet","plastic","plate","play","please","pledge","pluck","plug","plunge","poem","poet","point","polar","pole","police","pond","pony","pool","popular","portion","position","possible","post","potato","pottery","poverty","powder","power","practice","praise","predict","prefer","prepare","present","pretty","prevent","price","pride","primary","print","priority","prison","private","prize","problem","process","produce","profit","program","project","promote","proof","property","prosper","protect","proud","provide","public","pudding","pull","pulp","pulse","pumpkin","punch","pupil","puppy","purchase","purity","purpose","purse","push","put","puzzle","pyramid","quality","quantum","quarter","question","quick","quit","quiz","quote","rabbit","raccoon","race","rack","radar","radio","rail","rain","raise","rally","ramp","ranch","random","range","rapid","rare","rate","rather","raven","raw","razor","ready","real","reason","rebel","rebuild","recall","receive","recipe","record","recycle","reduce","reflect","reform","refuse","region","regret","regular","reject","relax","release","relief","rely","remain","remember","remind","remove","render","renew","rent","reopen","repair","repeat","replace","report","require","rescue","resemble","resist","resource","response","result","retire","retreat","return","reunion","reveal","review","reward","rhythm","rib","ribbon","rice","rich","ride","ridge","rifle","right","rigid","ring","riot","ripple","risk","ritual","rival","river","road","roast","robot","robust","rocket","romance","roof","rookie","room","rose","rotate","rough","round","route","royal","rubber","rude","rug","rule","run","runway","rural","sad","saddle","sadness","safe","sail","salad","salmon","salon","salt","salute","same","sample","sand","satisfy","satoshi","sauce","sausage","save","say","scale","scan","scare","scatter","scene","scheme","school","science","scissors","scorpion","scout","scrap","screen","script","scrub","sea","search","season","seat","second","secret","section","security","seed","seek","segment","select","sell","seminar","senior","sense","sentence","series","service","session","settle","setup","seven","shadow","shaft","shallow","share","shed","shell","sheriff","shield","shift","shine","ship","shiver","shock","shoe","shoot","shop","short","shoulder","shove","shrimp","shrug","shuffle","shy","sibling","sick","side","siege","sight","sign","silent","silk","silly","silver","similar","simple","since","sing","siren","sister","situate","six","size","skate","sketch","ski","skill","skin","skirt","skull","slab","slam","sleep","slender","slice","slide","slight","slim","slogan","slot","slow","slush","small","smart","smile","smoke","smooth","snack","snake","snap","sniff","snow","soap","soccer","social","sock","soda","soft","solar","soldier","solid","solution","solve","someone","song","soon","sorry","sort","soul","sound","soup","source","south","space","spare","spatial","spawn","speak","special","speed","spell","spend","sphere","spice","spider","spike","spin","spirit","split","spoil","sponsor","spoon","sport","spot","spray","spread","spring","spy","square","squeeze","squirrel","stable","stadium","staff","stage","stairs","stamp","stand","start","state","stay","steak","steel","stem","step","stereo","stick","still","sting","stock","stomach","stone","stool","story","stove","strategy","street","strike","strong","struggle","student","stuff","stumble","style","subject","submit","subway","success","such","sudden","suffer","sugar","suggest","suit","summer","sun","sunny","sunset","super","supply","supreme","sure","surface","surge","surprise","surround","survey","suspect","sustain","swallow","swamp","swap","swarm","swear","sweet","swift","swim","swing","switch","sword","symbol","symptom","syrup","system","table","tackle","tag","tail","talent","talk","tank","tape","target","task","taste","tattoo","taxi","teach","team","tell","ten","tenant","tennis","tent","term","test","text","thank","that","theme","then","theory","there","they","thing","this","thought","three","thrive","throw","thumb","thunder","ticket","tide","tiger","tilt","timber","time","tiny","tip","tired","tissue","title","toast","tobacco","today","toddler","toe","together","toilet","token","tomato","tomorrow","tone","tongue","tonight","tool","tooth","top","topic","topple","torch","tornado","tortoise","toss","total","tourist","toward","tower","town","toy","track","trade","traffic","tragic","train","transfer","trap","trash","travel","tray","treat","tree","trend","trial","tribe","trick","trigger","trim","trip","trophy","trouble","truck","true","truly","trumpet","trust","truth","try","tube","tuition","tumble","tuna","tunnel","turkey","turn","turtle","twelve","twenty","twice","twin","twist","two","type","typical","ugly","umbrella","unable","unaware","uncle","uncover","under","undo","unfair","unfold","unhappy","uniform","unique","unit","universe","unknown","unlock","until","unusual","unveil","update","upgrade","uphold","upon","upper","upset","urban","urge","usage","use","used","useful","useless","usual","utility","vacant","vacuum","vague","valid","valley","valve","van","vanish","vapor","various","vast","vault","vehicle","velvet","vendor","venture","venue","verb","verify","version","very","vessel","veteran","viable","vibrant","vicious","victory","video","view","village","vintage","violin","virtual","virus","visa","visit","visual","vital","vivid","vocal","voice","void","volcano","volume","vote","voyage","wage","wagon","wait","walk","wall","walnut","want","warfare","warm","warrior","wash","wasp","waste","water","wave","way","wealth","weapon","wear","weasel","weather","web","wedding","weekend","weird","welcome","west","wet","whale","what","wheat","wheel","when","where","whip","whisper","wide","width","wife","wild","will","win","window","wine","wing","wink","winner","winter","wire","wisdom","wise","wish","witness","wolf","woman","wonder","wood","wool","word","work","world","worry","worth","wrap","wreck","wrestle","wrist","write","wrong","yard","year","yellow","you","young","youth","zebra","zero","zone","zoo"];te.DEFAULT_WORDLIST=te.ENGLISH_WORDLIST;te.MnemonicType={UNKNOWN:-1,LEGACY:0,BIP39:1};(0,_freeze["default"])(te);n.register(te);var ne=function(){function StringUtils(){(0,_classCallCheck2["default"])(this,StringUtils)}(0,_createClass2["default"])(StringUtils,null,[{key:"isMultibyte",value:function isMultibyte(e){return/[\uD800-\uDFFF]/.test(e)}},{key:"isHex",value:function isHex(e){return/^[0-9A-Fa-f]*$/.test(e)}},{key:"isHexBytes",value:function isHexBytes(e,t){return!!StringUtils.isHex(e)&&(e.length%2==0&&("number"!=typeof t||e.length/2===t))}},{key:"commonPrefix",value:function commonPrefix(e,t){for(var n=0;n<e.length&&e[n]===t[n];++n);return e.substr(0,n)}},{key:"lpad",value:function lpad(e,t,n){for(;e.length<n;)e=t+e;return e}}]);return StringUtils}();n.register(ne);var re=function(){function Policy(){(0,_classCallCheck2["default"])(this,Policy)}(0,_createClass2["default"])(Policy,null,[{key:"coinsToLunas",value:function coinsToLunas(e){return Math.round(e*Policy.LUNAS_PER_COIN)}},{key:"lunasToCoins",value:function lunasToCoins(e){return e/Policy.LUNAS_PER_COIN}},{key:"coinsToSatoshis",value:function coinsToSatoshis(e){return Policy.coinsToLunas(e)}},{key:"satoshisToCoins",value:function satoshisToCoins(e){return Policy.lunasToCoins(e)}},{key:"supplyAfter",value:function supplyAfter(e){for(var t=Math.floor(e/Policy._supplyCacheInterval)*Policy._supplyCacheInterval,n=(t=Math.max(0,Math.min(t,Policy._supplyCacheMax)))/Policy._supplyCacheInterval,r=Math.floor(e/Policy._supplyCacheInterval),a=0===t?Policy.INITIAL_SUPPLY:Policy._supplyCache.get(t),i=n;i<r;++i){t=i*Policy._supplyCacheInterval;var s=(i+1)*Policy._supplyCacheInterval-1;a=Policy._supplyAfter(a,s,t);Policy._supplyCache.set(s+1,a);Policy._supplyCacheMax=s+1}return Policy._supplyAfter(a,e,r*Policy._supplyCacheInterval)}},{key:"_supplyAfter",value:function _supplyAfter(e,t){for(var n=e,r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;r<=t;++r)n+=Policy._blockRewardAt(n,r);return n}},{key:"blockRewardAt",value:function blockRewardAt(e){var t=Policy.supplyAfter(e-1);return Policy._blockRewardAt(t,e)}},{key:"_blockRewardAt",value:function _blockRewardAt(e,t){if(t<=0)return 0;var n=Policy.TOTAL_SUPPLY-e;return t>=Policy.EMISSION_TAIL_START&&n>=Policy.EMISSION_TAIL_REWARD?Policy.EMISSION_TAIL_REWARD:(n-n%Policy.EMISSION_SPEED)/Policy.EMISSION_SPEED}},{key:"SATOSHIS_PER_COIN",get:function get(){return Policy.LUNAS_PER_COIN}}]);return Policy}();re.BLOCK_TIME=60;re.BLOCK_SIZE_MAX=1e5;re.BLOCK_TARGET_MAX=new J(2).pow(240);re.DIFFICULTY_BLOCK_WINDOW=120;re.DIFFICULTY_MAX_ADJUSTMENT_FACTOR=2;re.TRANSACTION_VALIDITY_WINDOW=120;re.LUNAS_PER_COIN=1e5;re.TOTAL_SUPPLY=21e14;re.INITIAL_SUPPLY=252e12;re.EMISSION_SPEED=Math.pow(2,22);re.EMISSION_TAIL_START=48692960;re.EMISSION_TAIL_REWARD=4e3;re.M=240;re.K=120;re.DELTA=.15;re.NUM_BLOCKS_VERIFICATION=250;re.NUM_SNAPSHOTS_MAX=20;re._supplyCache=new _map2["default"];re._supplyCacheMax=0;re._supplyCacheInterval=5e3;n.register(re);var ae=function(){function Serializable(){(0,_classCallCheck2["default"])(this,Serializable)}(0,_createClass2["default"])(Serializable,[{key:"equals",value:function equals(e){return e instanceof Serializable&&M.equals(this.serialize(),e.serialize())}},{key:"compare",value:function compare(e){return M.compare(this.serialize(),e.serialize())}},{key:"hashCode",value:function hashCode(){return this.toBase64()}},{key:"serialize",value:function serialize(e){}},{key:"toString",value:function toString(){return this.toBase64()}},{key:"toBase64",value:function toBase64(){return M.toBase64(this.serialize())}},{key:"toHex",value:function toHex(){return M.toHex(this.serialize())}}]);return Serializable}();n.register(ae);var ie=function(e){(0,_inherits2["default"])(Hash,e);var t=_createSuper(Hash);function Hash(e){var n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Hash.Algorithm.BLAKE2B;(0,_classCallCheck2["default"])(this,Hash);if(null===e)e=new Uint8Array(Hash.getSize(r));else{if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==Hash.getSize(r))throw new Error("Primitive: Invalid length")}(n=t.call(this))._obj=e;n._algorithm=r;return n}(0,_createClass2["default"])(Hash,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"subarray",value:function subarray(e,t){return this._obj.subarray(e,t)}},{key:"equals",value:function equals(e){return e instanceof Hash&&e._algorithm===this._algorithm&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(Hash.prototype),"equals",this).call(this,e)}},{key:"toPlain",value:function toPlain(){return this.toHex()}},{key:"serializedSize",get:function get(){return Hash.SIZE.get(this._algorithm)}},{key:"array",get:function get(){return this._obj}},{key:"algorithm",get:function get(){return this._algorithm}}],[{key:"light",value:function light(e){return Hash.blake2b(e)}},{key:"blake2b",value:function blake2b(e){return new Hash(Hash.computeBlake2b(e),Hash.Algorithm.BLAKE2B)}},{key:"hard",value:function hard(e){return Hash.argon2d(e)}},{key:"argon2d",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee136(e){return _regenerator["default"].wrap(function _callee136$(t){for(;;)switch(t.prev=t.next){case 0:t.t0=Hash;t.next=3;return q.getInstanceAsync();case 3:t.next=5;return t.sent.computeArgon2d(e);case 5:t.t1=t.sent;t.t2=Hash.Algorithm.ARGON2D;return t.abrupt("return",new t.t0(t.t1,t.t2));case 8:case"end":return t.stop()}},_callee136)}));return function argon2d(t){return e.apply(this,arguments)}}()},{key:"sha256",value:function sha256(e){return new Hash(Hash.computeSha256(e),Hash.Algorithm.SHA256)}},{key:"sha512",value:function sha512(e){return new Hash(Hash.computeSha512(e),Hash.Algorithm.SHA512)}},{key:"compute",value:function compute(e,t){switch(t){case Hash.Algorithm.BLAKE2B:return Hash.blake2b(e);case Hash.Algorithm.SHA256:return Hash.sha256(e);default:throw new Error("Invalid hash algorithm")}}},{key:"unserialize",value:function unserialize(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Hash.Algorithm.BLAKE2B;return new Hash(e.read(Hash.getSize(t)),t)}},{key:"fromAny",value:function fromAny(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Hash.Algorithm.BLAKE2B;if(e instanceof Hash)return e;try{return new Hash(M.fromAny(e,Hash.SIZE.get(t)),t)}catch(n){throw new Error("Invalid hash format")}}},{key:"fromBase64",value:function fromBase64(e){return new Hash(M.fromBase64(e))}},{key:"fromHex",value:function fromHex(e){return new Hash(M.fromHex(e))}},{key:"fromPlain",value:function fromPlain(e){return Hash.fromString(e)}},{key:"fromString",value:function fromString(e){try{return Hash.fromHex(e)}catch(t){}try{return Hash.fromBase64(e)}catch(t){}throw new Error("Invalid hash format")}},{key:"isHash",value:function isHash(e){return e instanceof Hash}},{key:"getSize",value:function getSize(e){var t=Hash.SIZE.get(e);if("number"!=typeof t)throw new Error("Invalid hash algorithm");return t}},{key:"computeBlake2b",value:function computeBlake2b(e){if(f.isNodeJs()){var t=new Uint8Array(Hash.getSize(Hash.Algorithm.BLAKE2B));NodeNative.node_blake2(t,new Uint8Array(e));return t}var n;try{n=Module.stackSave();var r=Hash.getSize(Hash.Algorithm.BLAKE2B),i=Module.stackAlloc(r),s=Module.stackAlloc(e.length);new Uint8Array(Module.HEAPU8.buffer,s,e.length).set(e);var o=Module._nimiq_blake2(i,s,e.length);if(0!==o)throw o;var u=new Uint8Array(r);u.set(new Uint8Array(Module.HEAPU8.buffer,i,r));return u}catch(c){a.w(Hash,c);throw c}finally{n!==undefined&&Module.stackRestore(n)}}},{key:"computeSha256",value:function computeSha256(e){if(f.isNodeJs()){var t=new Uint8Array(Hash.getSize(Hash.Algorithm.SHA256));NodeNative.node_sha256(t,new Uint8Array(e));return t}var n;try{n=Module.stackSave();var r=Hash.getSize(Hash.Algorithm.SHA256),i=Module.stackAlloc(r),s=Module.stackAlloc(e.length);new Uint8Array(Module.HEAPU8.buffer,s,e.length).set(e);Module._nimiq_sha256(i,s,e.length);var o=new Uint8Array(r);o.set(new Uint8Array(Module.HEAPU8.buffer,i,r));return o}catch(u){a.w(Hash,u);throw u}finally{n!==undefined&&Module.stackRestore(n)}}},{key:"computeSha512",value:function computeSha512(e){if(f.isNodeJs()){var t=new Uint8Array(Hash.getSize(Hash.Algorithm.SHA512));NodeNative.node_sha512(t,new Uint8Array(e));return t}var n;try{n=Module.stackSave();var r=Hash.getSize(Hash.Algorithm.SHA512),i=Module.stackAlloc(r),s=Module.stackAlloc(e.length);new Uint8Array(Module.HEAPU8.buffer,s,e.length).set(e);Module._nimiq_sha512(i,s,e.length);var o=new Uint8Array(r);o.set(new Uint8Array(Module.HEAPU8.buffer,i,r));return o}catch(u){a.w(Hash,u);throw u}finally{n!==undefined&&Module.stackRestore(n)}}}]);return Hash}(ae);ie.Algorithm={BLAKE2B:1,ARGON2D:2,SHA256:3,SHA512:4};ie.Algorithm.toString=function(e){switch(e){case ie.Algorithm.BLAKE2B:return"blake2b";case ie.Algorithm.ARGON2D:return"argon2d";case ie.Algorithm.SHA256:return"sha256";case ie.Algorithm.SHA512:return"sha512"}throw new Error("Invalid hash algorithm")};ie.Algorithm.fromAny=function(e){if("number"==typeof e)return e;switch(e){case"blake2b":return ie.Algorithm.BLAKE2B;case"argon2d":return ie.Algorithm.ARGON2D;case"sha256":return ie.Algorithm.SHA256;case"sha512":return ie.Algorithm.SHA512}throw new Error("Invalid hash algorithm")};ie.SIZE=new _map2["default"];ie.SIZE.set(ie.Algorithm.BLAKE2B,32);ie.SIZE.set(ie.Algorithm.ARGON2D,32);ie.SIZE.set(ie.Algorithm.SHA256,32);ie.SIZE.set(ie.Algorithm.SHA512,64);ie.NULL=new ie(new Uint8Array(32));n.register(ie);var se=function(e){(0,_inherits2["default"])(Secret,e);var t=_createSuper(Secret);function Secret(e,n){var r;(0,_classCallCheck2["default"])(this,Secret);(r=t.call(this))._type=e;r._purposeId=n;return r}(0,_createClass2["default"])(Secret,[{key:"exportEncrypted",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee137(e){var t,n,r,a,i,s;return _regenerator["default"].wrap(function _callee137$(o){for(;;)switch(o.prev=o.next){case 0:t=new Uint8Array(Secret.ENCRYPTION_SALT_SIZE);q.lib.getRandomValues(t);(n=new U(4+Secret.SIZE)).writeUint32(this._purposeId);n.write(this.serialize());r=ie.computeBlake2b(n).subarray(0,Secret.ENCRYPTION_CHECKSUM_SIZE_V3);(a=new U(r.byteLength+n.byteLength)).write(r);a.write(n);o.next=11;return j.otpKdf(a,e,t,Secret.ENCRYPTION_KDF_ROUNDS);case 11:i=o.sent;(s=new U(2+t.byteLength+i.byteLength)).writeUint8(3);s.writeUint8(Math.log2(Secret.ENCRYPTION_KDF_ROUNDS));s.write(t);s.write(i);return o.abrupt("return",s);case 18:case"end":return o.stop()}},_callee137,this)}));return function exportEncrypted(t){return e.apply(this,arguments)}}()},{key:"encryptedSize",get:function get(){return 2+Secret.ENCRYPTION_SALT_SIZE+Secret.ENCRYPTION_CHECKSUM_SIZE_V3+4+Secret.SIZE}},{key:"type",get:function get(){return this._type}}],[{key:"fromEncrypted",value:function fromEncrypted(e,t){var n=e.readUint8(),r=e.readUint8();if(r>32)throw new Error("Rounds out-of-bounds");var a=Math.pow(2,r);switch(n){case 1:return Secret._decryptV1(e,t,a);case 2:return Secret._decryptV2(e,t,a);case 3:return Secret._decryptV3(e,t,a);default:throw new Error("Unsupported version")}}},{key:"_decryptV1",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee138(e,t,n){var r,a,i,s,o,u,c;return _regenerator["default"].wrap(function _callee138$(l){for(;;)switch(l.prev=l.next){case 0:r=e.read(Secret.SIZE);a=e.read(Secret.ENCRYPTION_SALT_SIZE);i=e.read(Secret.ENCRYPTION_CHECKSUM_SIZE);l.next=5;return j.otpKdfLegacy(r,t,a,n);case 5:s=l.sent;o=new oe(s);u=ue.derive(o);c=u.hash().subarray(0,Secret.ENCRYPTION_CHECKSUM_SIZE);if(M.equals(i,c)){l.next=11;break}throw new Error("Invalid key");case 11:return l.abrupt("return",o);case 12:case"end":return l.stop()}},_callee138)}));return function _decryptV1(t,n,r){return e.apply(this,arguments)}}()},{key:"_decryptV2",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee139(e,t,n){var r,a,i,s,o;return _regenerator["default"].wrap(function _callee139$(u){for(;;)switch(u.prev=u.next){case 0:r=e.read(Secret.SIZE);a=e.read(Secret.ENCRYPTION_SALT_SIZE);i=e.read(Secret.ENCRYPTION_CHECKSUM_SIZE);u.next=5;return j.otpKdfLegacy(r,t,a,n);case 5:s=u.sent;o=ie.computeBlake2b(s).subarray(0,Secret.ENCRYPTION_CHECKSUM_SIZE);if(M.equals(i,o)){u.next=9;break}throw new Error("Invalid key");case 9:return u.abrupt("return",new oe(s));case 10:case"end":return u.stop()}},_callee139)}));return function _decryptV2(t,n,r){return e.apply(this,arguments)}}()},{key:"_decryptV3",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee140(e,t,n){var r,a,i,s,o,u,c,l;return _regenerator["default"].wrap(function _callee140$(h){for(;;)switch(h.prev=h.next){case 0:r=e.read(Secret.ENCRYPTION_SALT_SIZE);a=e.read(Secret.ENCRYPTION_CHECKSUM_SIZE_V3+4+Secret.SIZE);h.next=4;return j.otpKdf(a,t,r,n);case 4:i=h.sent;s=i.subarray(0,Secret.ENCRYPTION_CHECKSUM_SIZE_V3);o=i.subarray(Secret.ENCRYPTION_CHECKSUM_SIZE_V3);u=ie.computeBlake2b(o).subarray(0,Secret.ENCRYPTION_CHECKSUM_SIZE_V3);if(M.equals(s,u)){h.next=10;break}throw new Error("Invalid key");case 10:c=o[0]<<24|o[1]<<16|o[2]<<8|o[3];l=o.subarray(4);h.t0=c;h.next=h.t0===oe.PURPOSE_ID?15:(h.t0,le.PURPOSE_ID,16);break;case 15:return h.abrupt("return",new oe(l));case 16:return h.abrupt("return",new le(l));case 17:case"end":return h.stop()}},_callee140)}));return function _decryptV3(t,n,r){return e.apply(this,arguments)}}()}]);return Secret}(ae);se.Type={PRIVATE_KEY:1,ENTROPY:2};se.SIZE=32;se.ENCRYPTION_SALT_SIZE=16;se.ENCRYPTION_KDF_ROUNDS=256;se.ENCRYPTION_CHECKSUM_SIZE=4;se.ENCRYPTION_CHECKSUM_SIZE_V3=2;n.register(se);var oe=function(e){(0,_inherits2["default"])(PrivateKey,e);var t=_createSuper(PrivateKey);function PrivateKey(e){var n;(0,_classCallCheck2["default"])(this,PrivateKey);n=t.call(this,se.Type.PRIVATE_KEY,PrivateKey.PURPOSE_ID);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==PrivateKey.SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(PrivateKey,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"overwrite",value:function overwrite(e){this._obj.set(e._obj)}},{key:"equals",value:function equals(e){return e instanceof PrivateKey&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(PrivateKey.prototype),"equals",this).call(this,e)}},{key:"serializedSize",get:function get(){return PrivateKey.SIZE}}],[{key:"generate",value:function generate(){var e=new Uint8Array(PrivateKey.SIZE);q.lib.getRandomValues(e);return new PrivateKey(e)}},{key:"unserialize",value:function unserialize(e){return new PrivateKey(e.read(PrivateKey.SIZE))}},{key:"_privateKeyDelinearize",value:function _privateKeyDelinearize(e,t,n){if(e.byteLength!==PrivateKey.SIZE||t.byteLength!==ue.SIZE||n.byteLength!==ie.getSize(ie.Algorithm.SHA512))throw Error("Wrong buffer size.");if(f.isNodeJs()){var r=new Uint8Array(ue.SIZE);NodeNative.node_ed25519_derive_delinearized_private_key(r,new Uint8Array(n),new Uint8Array(t),new Uint8Array(e));return r}var i;try{i=Module.stackSave();var s=Module.stackAlloc(ue.SIZE),o=Module.stackAlloc(e.length),u=Module.stackAlloc(t.length),c=Module.stackAlloc(n.length);new Uint8Array(Module.HEAPU8.buffer,o,e.length).set(e);new Uint8Array(Module.HEAPU8.buffer,u,t.length).set(t);new Uint8Array(Module.HEAPU8.buffer,c,n.length).set(n);Module._ed25519_derive_delinearized_private_key(s,c,u,o);var l=new Uint8Array(PrivateKey.SIZE);l.set(new Uint8Array(Module.HEAPU8.buffer,s,PrivateKey.SIZE));return l}catch(h){a.w(W,h);throw h}finally{i!==undefined&&Module.stackRestore(i)}}}]);return PrivateKey}(se);oe.SIZE=se.SIZE;oe.PURPOSE_ID=1107296257;n.register(oe);var ue=function(e){(0,_inherits2["default"])(PublicKey,e);var t=_createSuper(PublicKey);(0,_createClass2["default"])(PublicKey,null,[{key:"copy",value:function copy(e){return e?new PublicKey(new Uint8Array(e._obj)):e}}]);function PublicKey(e){var n;(0,_classCallCheck2["default"])(this,PublicKey);n=t.call(this);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==PublicKey.SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(PublicKey,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"equals",value:function equals(e){return e instanceof PublicKey&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(PublicKey.prototype),"equals",this).call(this,e)}},{key:"hash",value:function hash(){return ie.light(this.serialize())}},{key:"compare",value:function compare(e){return M.compare(this._obj,e._obj)}},{key:"toAddress",value:function toAddress(){return ge.fromHash(this.hash())}},{key:"toPeerId",value:function toPeerId(){return new Bn(this.hash().subarray(0,16))}},{key:"serializedSize",get:function get(){return PublicKey.SIZE}}],[{key:"derive",value:function derive(e){return new PublicKey(PublicKey._publicKeyDerive(e._obj))}},{key:"sum",value:function sum(e){(e=e.slice()).sort(function(e,t){return e.compare(t)});return PublicKey._delinearizeAndAggregatePublicKeys(e)}},{key:"unserialize",value:function unserialize(e){return new PublicKey(e.read(PublicKey.SIZE))}},{key:"fromAny",value:function fromAny(e){if(!e)throw new Error("Invalid public key format");if(e instanceof PublicKey)return e;try{return new PublicKey(M.fromAny(e,PublicKey.SIZE))}catch(t){throw new Error("Invalid public key format")}}},{key:"_delinearizeAndAggregatePublicKeys",value:function _delinearizeAndAggregatePublicKeys(e){var t=e.map(function(e){return e.serialize()}),n=PublicKey._publicKeysHash(t),r=PublicKey._publicKeysDelinearizeAndAggregate(t,n);return new PublicKey(r)}},{key:"_publicKeyDerive",value:function _publicKeyDerive(e){if(e.byteLength!==oe.SIZE)throw Error("Wrong buffer size.");if(f.isNodeJs()){var t=new Uint8Array(PublicKey.SIZE);NodeNative.node_ed25519_public_key_derive(t,new Uint8Array(e));return t}var n;try{n=Module.stackSave();var r=Module.stackAlloc(PublicKey.SIZE),i=new Uint8Array(Module.HEAP8.buffer,r,oe.SIZE);i.set(e);var s=Module.stackAlloc(e.length),o=new Uint8Array(Module.HEAP8.buffer,s,oe.SIZE);o.set(e);Module._ed25519_public_key_derive(r,s);o.fill(0);var u=new Uint8Array(PublicKey.SIZE);u.set(i);return u}catch(c){a.w(PublicKey,c);throw c}finally{n!==undefined&&Module.stackRestore(n)}}},{key:"_publicKeysHash",value:function _publicKeysHash(e){if(e.some(function(e){return e.byteLength!==PublicKey.SIZE}))throw Error("Wrong buffer size.");for(var t,n=new Uint8Array(e.length*PublicKey.SIZE),r=0;r<e.length;++r)n.set(e[r],r*PublicKey.SIZE);if(f.isNodeJs()){var i=new Uint8Array(ie.getSize(ie.Algorithm.SHA512));NodeNative.node_ed25519_hash_public_keys(i,n,e.length);return i}try{t=Module.stackSave();var s=ie.getSize(ie.Algorithm.SHA512),o=Module.stackAlloc(s),u=Module.stackAlloc(n.length);new Uint8Array(Module.HEAPU8.buffer,u,n.length).set(n);Module._ed25519_hash_public_keys(o,u,e.length);var c=new Uint8Array(s);c.set(new Uint8Array(Module.HEAPU8.buffer,o,s));return c}catch(l){a.w(PublicKey,l);throw l}finally{t!==undefined&&Module.stackRestore(t)}}},{key:"_publicKeyDelinearize",value:function _publicKeyDelinearize(e,t){if(e.byteLength!==PublicKey.SIZE||t.byteLength!==ie.getSize(ie.Algorithm.SHA512))throw Error("Wrong buffer size.");if(f.isNodeJs()){var n=new Uint8Array(PublicKey.SIZE);NodeNative.node_ed25519_delinearize_public_key(n,new Uint8Array(t),new Uint8Array(e));return n}var r;try{r=Module.stackSave();var i=Module.stackAlloc(PublicKey.SIZE),s=Module.stackAlloc(e.length),o=Module.stackAlloc(t.length);new Uint8Array(Module.HEAPU8.buffer,s,e.length).set(e);new Uint8Array(Module.HEAPU8.buffer,o,t.length).set(t);Module._ed25519_delinearize_public_key(i,o,s);var u=new Uint8Array(PublicKey.SIZE);u.set(new Uint8Array(Module.HEAPU8.buffer,i,PublicKey.SIZE));return u}catch(c){a.w(PublicKey,c);throw c}finally{r!==undefined&&Module.stackRestore(r)}}},{key:"_publicKeysDelinearizeAndAggregate",value:function _publicKeysDelinearizeAndAggregate(e,t){if(e.some(function(e){return e.byteLength!==PublicKey.SIZE})||t.byteLength!==ie.getSize(ie.Algorithm.SHA512))throw Error("Wrong buffer size.");for(var n,r=new Uint8Array(e.length*PublicKey.SIZE),i=0;i<e.length;++i)r.set(e[i],i*PublicKey.SIZE);if(f.isNodeJs()){var s=new Uint8Array(PublicKey.SIZE);NodeNative.node_ed25519_aggregate_delinearized_public_keys(s,new Uint8Array(t),r,e.length);return s}try{n=Module.stackSave();var o=Module.stackAlloc(PublicKey.SIZE),u=Module.stackAlloc(r.length),c=Module.stackAlloc(t.length);new Uint8Array(Module.HEAPU8.buffer,u,r.length).set(r);new Uint8Array(Module.HEAPU8.buffer,c,t.length).set(t);Module._ed25519_aggregate_delinearized_public_keys(o,c,u,e.length);var l=new Uint8Array(PublicKey.SIZE);l.set(new Uint8Array(Module.HEAPU8.buffer,o,PublicKey.SIZE));return l}catch(h){a.w(PublicKey,h);throw h}finally{n!==undefined&&Module.stackRestore(n)}}}]);return PublicKey}(ae);ue.SIZE=32;n.register(ue);var ce=function(e){(0,_inherits2["default"])(KeyPair,e);var t=_createSuper(KeyPair);function KeyPair(e,n){var r,a=arguments.length>2&&arguments[2]!==undefined&&arguments[2],i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;(0,_classCallCheck2["default"])(this,KeyPair);if(!(e instanceof Object))throw new Error("Primitive: Invalid type");if(!(n instanceof Object))throw new Error("Primitive: Invalid type");(r=t.call(this))._locked=a;r._lockedInternally=a;r._lockSalt=i;r._publicKey=n;r._internalPrivateKey=new oe(e.serialize());return r}(0,_createClass2["default"])(KeyPair,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this._privateKey.serialize(e);this.publicKey.serialize(e);if(this._locked){e.writeUint8(1);e.write(this._lockSalt)}else e.writeUint8(0);return e}},{key:"lock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee141(e,t){return _regenerator["default"].wrap(function _callee141$(n){for(;;)switch(n.prev=n.next){case 0:if(!this._locked){n.next=2;break}throw new Error("KeyPair already locked");case 2:t&&(this._lockSalt=t);if(!this._lockSalt||0===this._lockSalt.length){this._lockSalt=new Uint8Array(32);q.lib.getRandomValues(this._lockSalt)}n.t0=this._internalPrivateKey;n.next=7;return this._otpPrivateKey(e);case 7:n.t1=n.sent;n.t0.overwrite.call(n.t0,n.t1);this._clearUnlockedPrivateKey();this._locked=!0;this._lockedInternally=!0;case 12:case"end":return n.stop()}},_callee141,this)}));return function lock(t,n){return e.apply(this,arguments)}}()},{key:"unlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee142(e){var t;return _regenerator["default"].wrap(function _callee142$(n){for(;;)switch(n.prev=n.next){case 0:if(this._locked){n.next=2;break}throw new Error("KeyPair not locked");case 2:n.next=4;return this._otpPrivateKey(e);case 4:t=n.sent;if(!ue.derive(t).equals(this.publicKey)){n.next=11;break}this._unlockedPrivateKey=t;this._locked=!1;n.next=12;break;case 11:throw new Error("Invalid key");case 12:case"end":return n.stop()}},_callee142,this)}));return function unlock(t){return e.apply(this,arguments)}}()},{key:"relock",value:function relock(){if(this._locked)throw new Error("KeyPair already locked");if(!this._lockedInternally)throw new Error("KeyPair was never locked");this._clearUnlockedPrivateKey();this._locked=!0}},{key:"_clearUnlockedPrivateKey",value:function _clearUnlockedPrivateKey(){if(this._lockedInternally&&!this._locked){this._unlockedPrivateKey.overwrite(oe.unserialize(new U(this._unlockedPrivateKey.serializedSize)));this._unlockedPrivateKey=null}}},{key:"_otpPrivateKey",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee143(e){return _regenerator["default"].wrap(function _callee143$(t){for(;;)switch(t.prev=t.next){case 0:t.t0=oe;t.next=3;return j.otpKdfLegacy(this._privateKey.serialize(),e,this._lockSalt,KeyPair.LOCK_KDF_ROUNDS);case 3:t.t1=t.sent;return t.abrupt("return",new t.t0(t.t1));case 5:case"end":return t.stop()}},_callee143,this)}));return function _otpPrivateKey(t){return e.apply(this,arguments)}}()},{key:"exportEncrypted",value:function exportEncrypted(e){return this._privateKey.exportEncrypted(e)}},{key:"equals",value:function equals(e){return e instanceof KeyPair&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(KeyPair.prototype),"equals",this).call(this,e)}},{key:"privateKey",get:function get(){if(this.isLocked)throw new Error("KeyPair is locked");return this._privateKey}},{key:"_privateKey",get:function get(){return this._unlockedPrivateKey||this._internalPrivateKey}},{key:"publicKey",get:function get(){return this._publicKey||(this._publicKey=new ue(this._obj.publicKey))}},{key:"serializedSize",get:function get(){return this._privateKey.serializedSize+this.publicKey.serializedSize+(this._locked?this._lockSalt.byteLength+1:1)}},{key:"isLocked",get:function get(){return this._locked}},{key:"encryptedSize",get:function get(){return this._privateKey.encryptedSize}}],[{key:"generate",value:function generate(){var e=oe.generate();return new KeyPair(e,ue.derive(e))}},{key:"derive",value:function derive(e){return new KeyPair(e,ue.derive(e))}},{key:"fromHex",value:function fromHex(e){return KeyPair.unserialize(M.fromHex(e))}},{key:"unserialize",value:function unserialize(e){var t=oe.unserialize(e),n=ue.unserialize(e),r=!1,a=null;if(e.readPos<e.byteLength){if(1===e.readUint8()){r=!0;a=e.read(32)}}return new KeyPair(t,n,r,a)}},{key:"fromEncrypted",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee144(e,t){var n;return _regenerator["default"].wrap(function _callee144$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return se.fromEncrypted(e,t);case 2:if((n=r.sent).type===se.Type.PRIVATE_KEY){r.next=5;break}throw new Error("Expected privateKey, got Entropy");case 5:return r.abrupt("return",KeyPair.derive(n));case 6:case"end":return r.stop()}},_callee144)}));return function fromEncrypted(t,n){return e.apply(this,arguments)}}()}]);return KeyPair}(ae);ce.LOCK_KDF_ROUNDS=256;n.register(ce);var le=function(e){(0,_inherits2["default"])(Entropy,e);var t=_createSuper(Entropy);function Entropy(e){var n;(0,_classCallCheck2["default"])(this,Entropy);n=t.call(this,se.Type.ENTROPY,Entropy.PURPOSE_ID);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==Entropy.SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(Entropy,[{key:"toExtendedPrivateKey",value:function toExtendedPrivateKey(e,t){return te.mnemonicToExtendedPrivateKey(this.toMnemonic(t),e)}},{key:"toMnemonic",value:function toMnemonic(e){return te.entropyToMnemonic(this,e)}},{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"overwrite",value:function overwrite(e){this._obj.set(e._obj)}},{key:"equals",value:function equals(e){return e instanceof Entropy&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(Entropy.prototype),"equals",this).call(this,e)}},{key:"serializedSize",get:function get(){return Entropy.SIZE}}],[{key:"generate",value:function generate(){var e=new Uint8Array(Entropy.SIZE);q.lib.getRandomValues(e);return new Entropy(e)}},{key:"unserialize",value:function unserialize(e){return new Entropy(e.read(Entropy.SIZE))}}]);return Entropy}(se);le.SIZE=se.SIZE;le.PURPOSE_ID=1107296258;n.register(le);var he=function(e){(0,_inherits2["default"])(ExtendedPrivateKey,e);var t=_createSuper(ExtendedPrivateKey);function ExtendedPrivateKey(e,n){var r;(0,_classCallCheck2["default"])(this,ExtendedPrivateKey);r=t.call(this);if(!(e instanceof oe))throw new Error("ExtendedPrivateKey: Invalid key");if(!(n instanceof Uint8Array))throw new Error("ExtendedPrivateKey: Invalid chainCode");if(n.length!==ExtendedPrivateKey.CHAIN_CODE_SIZE)throw new Error("ExtendedPrivateKey: Invalid chainCode length");r._key=e;r._chainCode=n;return r}(0,_createClass2["default"])(ExtendedPrivateKey,[{key:"derive",value:function derive(e){e<2147483648&&(e+=2147483648);var t=new U(1+oe.SIZE+4);t.writeUint8(0);this._key.serialize(t);t.writeUint32(e);var n=j.computeHmacSha512(this._chainCode,t);return new ExtendedPrivateKey(new oe(n.slice(0,32)),n.slice(32))}},{key:"derivePath",value:function derivePath(e){if(!ExtendedPrivateKey.isValidPath(e))throw new Error("Invalid path");for(var t=this,n=e.split("/"),r=1;r<n.length;r++){var a=(0,_parseInt2["default"])(n[r]);t=t.derive(a)}return t}},{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this._key.serialize(e);e.write(this._chainCode);return e}},{key:"equals",value:function equals(e){return e instanceof ExtendedPrivateKey&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(ExtendedPrivateKey.prototype),"equals",this).call(this,e)}},{key:"toAddress",value:function toAddress(){return ue.derive(this._key).toAddress()}},{key:"serializedSize",get:function get(){return this._key.serializedSize+ExtendedPrivateKey.CHAIN_CODE_SIZE}},{key:"privateKey",get:function get(){return this._key}}],[{key:"generateMasterKey",value:function generateMasterKey(e){var t=M.fromAscii("ed25519 seed"),n=j.computeHmacSha512(t,e);return new ExtendedPrivateKey(new oe(n.slice(0,32)),n.slice(32))}},{key:"isValidPath",value:function isValidPath(e){if(null===e.match(/^m(\/[0-9]+')*$/))return!1;for(var t=e.split("/"),n=1;n<t.length;n++)if(!Y.isUint32((0,_parseInt2["default"])(t[n])))return!1;return!0}},{key:"derivePathFromSeed",value:function derivePathFromSeed(e,t){return ExtendedPrivateKey.generateMasterKey(t).derivePath(e)}},{key:"unserialize",value:function unserialize(e){return new ExtendedPrivateKey(oe.unserialize(e),e.read(ExtendedPrivateKey.CHAIN_CODE_SIZE))}}]);return ExtendedPrivateKey}(ae);he.CHAIN_CODE_SIZE=32;n.register(he);var fe=function(e){(0,_inherits2["default"])(RandomSecret,e);var t=_createSuper(RandomSecret);function RandomSecret(e){var n;(0,_classCallCheck2["default"])(this,RandomSecret);n=t.call(this);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==RandomSecret.SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(RandomSecret,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"equals",value:function equals(e){return e instanceof RandomSecret&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(RandomSecret.prototype),"equals",this).call(this,e)}},{key:"serializedSize",get:function get(){return RandomSecret.SIZE}}],[{key:"unserialize",value:function unserialize(e){return new RandomSecret(e.read(RandomSecret.SIZE))}}]);return RandomSecret}(ae);fe.SIZE=32;n.register(fe);var de=function(e){(0,_inherits2["default"])(Signature,e);var t=_createSuper(Signature);(0,_createClass2["default"])(Signature,null,[{key:"copy",value:function copy(e){return e?new Signature(new Uint8Array(e._obj)):e}}]);function Signature(e){var n;(0,_classCallCheck2["default"])(this,Signature);n=t.call(this);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==Signature.SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(Signature,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"verify",value:function verify(e,t){return Signature._signatureVerify(e._obj,t,this._obj)}},{key:"equals",value:function equals(e){return e instanceof Signature&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(Signature.prototype),"equals",this).call(this,e)}},{key:"serializedSize",get:function get(){return Signature.SIZE}}],[{key:"create",value:function create(e,t,n){return new Signature(Signature._signatureCreate(e._obj,t._obj,n))}},{key:"fromPartialSignatures",value:function fromPartialSignatures(e,t){var n=Signature._combinePartialSignatures(e.serialize(),t.map(function(e){return e.serialize()}));return new Signature(n)}},{key:"unserialize",value:function unserialize(e){return new Signature(e.read(Signature.SIZE))}},{key:"fromAny",value:function fromAny(e){if(!e)throw new Error("Invalid signature format");if(e instanceof Signature)return e;try{return new Signature(M.fromAny(e,Signature.SIZE))}catch(t){throw new Error("Invalid signature format")}}},{key:"_combinePartialSignatures",value:function _combinePartialSignatures(e,t){var n=Signature._aggregatePartialSignatures(t);return M.concatTypedArrays(e,n)}},{key:"_aggregatePartialSignatures",value:function _aggregatePartialSignatures(e){return e.reduce(function(e,t){return Signature._scalarsAdd(e,t)})}},{key:"_scalarsAdd",value:function _scalarsAdd(e,t){if(e.byteLength!==pe.SIZE||t.byteLength!==pe.SIZE)throw Error("Wrong buffer size.");if(f.isNodeJs()){var n=new Uint8Array(pe.SIZE);NodeNative.node_ed25519_add_scalars(n,new Uint8Array(e),new Uint8Array(t));return n}var r;try{r=Module.stackSave();var i=Module.stackAlloc(pe.SIZE),s=Module.stackAlloc(e.length),o=Module.stackAlloc(t.length);new Uint8Array(Module.HEAPU8.buffer,s,e.length).set(e);new Uint8Array(Module.HEAPU8.buffer,o,t.length).set(t);Module._ed25519_add_scalars(i,s,o);var u=new Uint8Array(pe.SIZE);u.set(new Uint8Array(Module.HEAPU8.buffer,i,pe.SIZE));return u}catch(c){a.w(Signature,c);throw c}finally{r!==undefined&&Module.stackRestore(r)}}},{key:"_signatureCreate",value:function _signatureCreate(e,t,n){if(t.byteLength!==ue.SIZE||e.byteLength!==oe.SIZE)throw Error("Wrong buffer size.");if(f.isNodeJs()){var r=new Uint8Array(Signature.SIZE);NodeNative.node_ed25519_sign(r,new Uint8Array(n),new Uint8Array(t),new Uint8Array(e));return r}var i;try{i=Module.stackSave();var s=Module.stackAlloc(Signature.SIZE),o=new Uint8Array(Module.HEAP8.buffer,s,Signature.SIZE),u=Module.stackAlloc(n.length);new Uint8Array(Module.HEAP8.buffer,u,n.length).set(n);var c=Module.stackAlloc(t.length);new Uint8Array(Module.HEAP8.buffer,c,t.length).set(t);var l=Module.stackAlloc(e.length),h=new Uint8Array(Module.HEAP8.buffer,l,e.length);h.set(e);Module._ed25519_sign(s,u,n.byteLength,c,l);h.fill(0);var d=new Uint8Array(Signature.SIZE);d.set(o);return d}catch(A){a.w(Signature,A);throw A}finally{i!==undefined&&Module.stackRestore(i)}}},{key:"_signatureVerify",value:function _signatureVerify(e,t,n){if(f.isNodeJs())return!!NodeNative.node_ed25519_verify(new Uint8Array(n),new Uint8Array(t),new Uint8Array(e));var r;try{r=Module.stackSave();var i=Module.stackAlloc(e.length);new Uint8Array(Module.HEAP8.buffer,i,e.length).set(e);var s=Module.stackAlloc(t.length);new Uint8Array(Module.HEAP8.buffer,s,t.length).set(t);var o=Module.stackAlloc(n.length);new Uint8Array(Module.HEAP8.buffer,o,n.length).set(n);return!!Module._ed25519_verify(o,s,t.byteLength,i)}catch(u){a.w(Signature,u);throw u}finally{r!==undefined&&Module.stackRestore(r)}}}]);return Signature}(ae);de.SIZE=64;n.register(de);var Ae=function(e){(0,_inherits2["default"])(Commitment,e);var t=_createSuper(Commitment);(0,_createClass2["default"])(Commitment,null,[{key:"copy",value:function copy(e){return e?new Commitment(new Uint8Array(e._obj)):e}},{key:"sum",value:function sum(e){return new Commitment(Commitment._commitmentsAggregate(e.map(function(e){return e._obj})))}}]);function Commitment(e){var n;(0,_classCallCheck2["default"])(this,Commitment);n=t.call(this);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==Commitment.SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(Commitment,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"equals",value:function equals(e){return e instanceof Commitment&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(Commitment.prototype),"equals",this).call(this,e)}},{key:"serializedSize",get:function get(){return Commitment.SIZE}}],[{key:"unserialize",value:function unserialize(e){return new Commitment(e.read(Commitment.SIZE))}},{key:"_commitmentsAggregate",value:function _commitmentsAggregate(e){if(e.some(function(e){return e.byteLength!==ue.SIZE}))throw Error("Wrong buffer size.");for(var t,n=new Uint8Array(e.length*ue.SIZE),r=0;r<e.length;++r)n.set(e[r],r*ue.SIZE);if(f.isNodeJs()){var i=new Uint8Array(ue.SIZE);NodeNative.node_ed25519_aggregate_commitments(i,n,e.length);return i}try{t=Module.stackSave();var s=Module.stackAlloc(ue.SIZE),o=Module.stackAlloc(n.length);new Uint8Array(Module.HEAPU8.buffer,o,n.length).set(n);Module._ed25519_aggregate_commitments(s,o,e.length);var u=new Uint8Array(ue.SIZE);u.set(new Uint8Array(Module.HEAPU8.buffer,s,ue.SIZE));return u}catch(c){a.w(W,c);throw c}finally{t!==undefined&&Module.stackRestore(t)}}}]);return Commitment}(ae);Ae.SIZE=32;n.register(Ae);var _e=function(e){(0,_inherits2["default"])(CommitmentPair,e);var t=_createSuper(CommitmentPair);function CommitmentPair(e,n){var r;(0,_classCallCheck2["default"])(this,CommitmentPair);r=t.call(this);if(!(e instanceof fe))throw new Error("Primitive: Invalid type");if(!(n instanceof Ae))throw new Error("Primitive: Invalid type");r._secret=e;r._commitment=n;return r}(0,_createClass2["default"])(CommitmentPair,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this.secret.serialize(e);this.commitment.serialize(e);return e}},{key:"equals",value:function equals(e){return e instanceof CommitmentPair&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(CommitmentPair.prototype),"equals",this).call(this,e)}},{key:"secret",get:function get(){return this._secret}},{key:"commitment",get:function get(){return this._commitment}},{key:"serializedSize",get:function get(){return this.secret.serializedSize+this.commitment.serializedSize}}],[{key:"generate",value:function generate(){var e=new Uint8Array(CommitmentPair.RANDOMNESS_SIZE);q.lib.getRandomValues(e);var t=CommitmentPair._commitmentCreate(e);return new CommitmentPair(new fe(t.secret),new Ae(t.commitment))}},{key:"unserialize",value:function unserialize(e){return new CommitmentPair(fe.unserialize(e),Ae.unserialize(e))}},{key:"fromHex",value:function fromHex(e){return this.unserialize(M.fromHex(e))}},{key:"_commitmentCreate",value:function _commitmentCreate(e){if(f.isNodeJs()){var t=new Uint8Array(ue.SIZE),n=new Uint8Array(oe.SIZE);NodeNative.node_ed25519_create_commitment(n,t,e);return{commitment:t,secret:n}}var r;try{r=Module.stackSave();var i=Module.stackAlloc(ue.SIZE),s=Module.stackAlloc(oe.SIZE),o=Module.stackAlloc(e.length);new Uint8Array(Module.HEAPU8.buffer,o,e.length).set(e);var u=Module._ed25519_create_commitment(s,i,o);if(1!==u)throw new Error("Secret must not be 0 or 1: ".concat(u));var c=new Uint8Array(ue.SIZE),l=new Uint8Array(oe.SIZE);c.set(new Uint8Array(Module.HEAPU8.buffer,i,ue.SIZE));l.set(new Uint8Array(Module.HEAPU8.buffer,s,oe.SIZE));return{commitment:c,secret:l}}catch(h){a.w(CommitmentPair,h);throw h}finally{r!==undefined&&Module.stackRestore(r)}}}]);return CommitmentPair}(ae);_e.SERIALIZED_SIZE=fe.SIZE+de.SIZE;_e.RANDOMNESS_SIZE=32;n.register(_e);var pe=function(e){(0,_inherits2["default"])(PartialSignature,e);var t=_createSuper(PartialSignature);function PartialSignature(e){var n;(0,_classCallCheck2["default"])(this,PartialSignature);n=t.call(this);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==PartialSignature.SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(PartialSignature,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"equals",value:function equals(e){return e instanceof PartialSignature&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(PartialSignature.prototype),"equals",this).call(this,e)}},{key:"serializedSize",get:function get(){return PartialSignature.SIZE}}],[{key:"create",value:function create(e,t,n,r,a,i){var s=PartialSignature._delinearizedPartialSignatureCreate(n.map(function(e){return e._obj}),e._obj,t._obj,r._obj,a._obj,i);return new PartialSignature(s)}},{key:"unserialize",value:function unserialize(e){return new PartialSignature(e.read(PartialSignature.SIZE))}},{key:"_delinearizedPartialSignatureCreate",value:function _delinearizedPartialSignatureCreate(e,t,n,r,i,s){if(e.some(function(e){return e.byteLength!==ue.SIZE})||t.byteLength!==oe.SIZE||n.byteLength!==ue.SIZE||r.byteLength!==fe.SIZE||i.byteLength!==Ae.SIZE)throw Error("Wrong buffer size.");for(var o,u=new Uint8Array(e.length*ue.SIZE),c=0;c<e.length;++c)u.set(e[c],c*ue.SIZE);if(f.isNodeJs()){var l=new Uint8Array(PartialSignature.SIZE);NodeNative.node_ed25519_delinearized_partial_sign(l,new Uint8Array(s),new Uint8Array(i),new Uint8Array(r),new Uint8Array(u),e.length,new Uint8Array(n),new Uint8Array(t));return l}try{o=Module.stackSave();var h=Module.stackAlloc(PartialSignature.SIZE),d=Module.stackAlloc(u.length),A=Module.stackAlloc(t.length),_=Module.stackAlloc(n.length),p=Module.stackAlloc(r.length),g=Module.stackAlloc(i.length),y=Module.stackAlloc(s.length);new Uint8Array(Module.HEAPU8.buffer,d,u.length).set(u);new Uint8Array(Module.HEAPU8.buffer,A,t.length).set(t);new Uint8Array(Module.HEAPU8.buffer,_,n.length).set(n);new Uint8Array(Module.HEAPU8.buffer,p,r.length).set(r);new Uint8Array(Module.HEAPU8.buffer,g,i.length).set(i);new Uint8Array(Module.HEAPU8.buffer,y,s.length).set(s);Module._ed25519_delinearized_partial_sign(h,y,s.length,g,p,d,e.length,_,A);var v=new Uint8Array(PartialSignature.SIZE);v.set(new Uint8Array(Module.HEAPU8.buffer,h,PartialSignature.SIZE));return v}catch(k){a.w(W,k);throw k}finally{o!==undefined&&Module.stackRestore(o)}}}]);return PartialSignature}(ae);pe.SIZE=32;n.register(pe);var ge=function(e){(0,_inherits2["default"])(Address,e);var t=_createSuper(Address);(0,_createClass2["default"])(Address,null,[{key:"copy",value:function copy(e){return e?new Address(new Uint8Array(e._obj)):e}},{key:"fromHash",value:function fromHash(e){return new Address(e.subarray(0,Address.SERIALIZED_SIZE))}}]);function Address(e){var n;(0,_classCallCheck2["default"])(this,Address);n=t.call(this);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==Address.SERIALIZED_SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(Address,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"subarray",value:function subarray(e,t){return this._obj.subarray(e,t)}},{key:"equals",value:function equals(e){return e instanceof Address&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(Address.prototype),"equals",this).call(this,e)}},{key:"toPlain",value:function toPlain(){return this.toUserFriendlyAddress()}},{key:"toUserFriendlyAddress",value:function toUserFriendlyAddress(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0],t=M.toBase32(this.serialize()),n=("00"+(98-Address._ibanCheck(t+Address.CCODE+"00"))).slice(-2),r=Address.CCODE+n+t;e&&(r=r.replace(/.{4}/g,"$& ").trim());return r}},{key:"serializedSize",get:function get(){return Address.SERIALIZED_SIZE}}],[{key:"unserialize",value:function unserialize(e){return new Address(e.read(Address.SERIALIZED_SIZE))}},{key:"fromAny",value:function fromAny(e){if(e instanceof Address)return e;if("string"==typeof e)return Address.fromString(e);throw new Error("Invalid address format")}},{key:"fromString",value:function fromString(e){try{return Address.fromUserFriendlyAddress(e)}catch(t){}try{return Address.fromHex(e)}catch(t){}try{return Address.fromBase64(e)}catch(t){}throw new Error("Invalid address format")}},{key:"fromBase64",value:function fromBase64(e){return new Address(M.fromBase64(e))}},{key:"fromHex",value:function fromHex(e){return new Address(M.fromHex(e))}},{key:"fromUserFriendlyAddress",value:function fromUserFriendlyAddress(e){if((e=e.replace(/ /g,"")).substr(0,2).toUpperCase()!==Address.CCODE)throw new Error("Invalid Address: Wrong country code");if(36!==e.length)throw new Error("Invalid Address: Should be 36 chars (ignoring spaces)");if(1!==Address._ibanCheck(e.substr(4)+e.substr(0,4)))throw new Error("Invalid Address: Checksum invalid");return new Address(M.fromBase32(e.substr(4)))}},{key:"_ibanCheck",value:function _ibanCheck(e){for(var t=e.split("").map(function(e){var t=e.toUpperCase().charCodeAt(0);return t>=48&&t<=57?e:(t-55).toString()}).join(""),n="",r=0;r<Math.ceil(t.length/6);r++)n=((0,_parseInt2["default"])(n+t.substr(6*r,6))%97).toString();return(0,_parseInt2["default"])(n)}}]);return Address}(ae);ge.CCODE="NQ";ge.SERIALIZED_SIZE=20;ge.HEX_SIZE=40;ge.NULL=new ge(new Uint8Array(ge.SERIALIZED_SIZE));ge.CONTRACT_CREATION=new ge(new Uint8Array(ge.SERIALIZED_SIZE));n.register(ge);var ye=function(){function Account(e,t){(0,_classCallCheck2["default"])(this,Account);if(!Y.isUint8(e))throw new Error("Malformed type");if(!Y.isUint64(t))throw new Error("Malformed balance");this._type=e;this._balance=t}(0,_createClass2["default"])(Account,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint8(this._type);e.writeUint64(this._balance);return e}},{key:"equals",value:function equals(e){return M.equals(this.serialize(),e.serialize())}},{key:"toString",value:function toString(){return"Account{type=".concat(this._type,", balance=").concat(this._balance.toString())}},{key:"toPlain",value:function toPlain(){return{type:Account.Type.toString(this.type),balance:this.balance}}},{key:"withBalance",value:function withBalance(e){throw new Error("Not yet implemented.")}},{key:"withOutgoingTransaction",value:function withOutgoingTransaction(e,t,n){if(arguments.length>3&&arguments[3]!==undefined&&arguments[3]){if(t<e.validityStartHeight||t>=e.validityStartHeight+re.TRANSACTION_VALIDITY_WINDOW)throw new Account.ValidityError;return this.withBalance(this._balance+e.value+e.fee)}var r=this._balance-e.value-e.fee;if(r<0)throw new Account.BalanceError;if(t<e.validityStartHeight||t>=e.validityStartHeight+re.TRANSACTION_VALIDITY_WINDOW)throw new Account.ValidityError;if(n.containsTransaction(e))throw new Account.DoubleTransactionError;return this.withBalance(r)}},{key:"withIncomingTransaction",value:function withIncomingTransaction(e,t){if(arguments.length>2&&arguments[2]!==undefined&&arguments[2]){var n=this._balance-e.value;if(n<0)throw new Account.BalanceError;return this.withBalance(n)}return this.withBalance(this._balance+e.value)}},{key:"withContractCommand",value:function withContractCommand(e,t){arguments.length>2&&arguments[2]!==undefined&&arguments[2];throw new Error("Not yet implemented")}},{key:"isInitial",value:function isInitial(){return this===Account.INITIAL}},{key:"isToBePruned",value:function isToBePruned(){return 0===this._balance&&!this.isInitial()}},{key:"serializedSize",get:function get(){return 9}},{key:"balance",get:function get(){return this._balance}},{key:"type",get:function get(){return this._type}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint8();e.readPos--;if(!Account.TYPE_MAP.has(t))throw new Error("Unknown account type");return Account.TYPE_MAP.get(t).unserialize(e)}},{key:"fromAny",value:function fromAny(e){return e instanceof Account?e:Account.fromPlain(e)}},{key:"fromPlain",value:function fromPlain(e){if(!e||e.type===undefined)throw new Error("Invalid account");var t=Account.Type.fromAny(e.type);return Account.TYPE_MAP.get(t).fromPlain(e)}},{key:"dataToPlain",value:function dataToPlain(e){return{}}},{key:"proofToPlain",value:function proofToPlain(e){return{}}}]);return Account}();ye.Type={BASIC:0,VESTING:1,HTLC:2};ye.Type.toString=function(e){switch(e){case ye.Type.BASIC:return"basic";case ye.Type.VESTING:return"vesting";case ye.Type.HTLC:return"htlc"}throw new Error("Invalid account type")};ye.Type.fromAny=function(e){if("number"==typeof e)return e;switch(e){case"basic":return ye.Type.BASIC;case"vesting":return ye.Type.VESTING;case"htlc":return ye.Type.HTLC}throw new Error("Invalid account type")};ye.TYPE_MAP=new _map2["default"];ye.BalanceError=function(e){(0,_inherits2["default"])(_class,e);var t=_createSuper(_class);function _class(){(0,_classCallCheck2["default"])(this,_class);return t.call(this,"Balance Error!")}return _class}((0,_wrapNativeSuper2["default"])(Error));ye.DoubleTransactionError=function(e){(0,_inherits2["default"])(_class2,e);var t=_createSuper(_class2);function _class2(){(0,_classCallCheck2["default"])(this,_class2);return t.call(this,"Double Transaction Error!")}return _class2}((0,_wrapNativeSuper2["default"])(Error));ye.ProofError=function(e){(0,_inherits2["default"])(_class3,e);var t=_createSuper(_class3);function _class3(){(0,_classCallCheck2["default"])(this,_class3);return t.call(this,"Proof Error!")}return _class3}((0,_wrapNativeSuper2["default"])(Error));ye.ValidityError=function(e){(0,_inherits2["default"])(_class4,e);var t=_createSuper(_class4);function _class4(){(0,_classCallCheck2["default"])(this,_class4);return t.call(this,"Validity Error!")}return _class4}((0,_wrapNativeSuper2["default"])(Error));n.register(ye);var ve=function(){function PrunedAccount(e,t){(0,_classCallCheck2["default"])(this,PrunedAccount);if(!(e instanceof ge))throw new Error("Malformed address");this._address=e;this._account=t}(0,_createClass2["default"])(PrunedAccount,[{key:"compare",value:function compare(e){return this._address.compare(e._address)}},{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this._address.serialize(e);this._account.serialize(e);return this}},{key:"hashCode",value:function hashCode(){return this._address.hashCode()}},{key:"toPlain",value:function toPlain(){return{address:this.address.toPlain(),account:this.account.toPlain()}}},{key:"address",get:function get(){return this._address}},{key:"account",get:function get(){return this._account}},{key:"serializedSize",get:function get(){return this._address.serializedSize+this._account.serializedSize}}],[{key:"unserialize",value:function unserialize(e){return new PrunedAccount(ge.unserialize(e),ye.unserialize(e))}},{key:"fromAny",value:function fromAny(e){return e instanceof PrunedAccount?e:PrunedAccount.fromPlain(e)}},{key:"fromPlain",value:function fromPlain(e){return new PrunedAccount(ge.fromAny(e.address),ye.fromAny(e.account))}}]);return PrunedAccount}();n.register(ve);var ke=function(e){(0,_inherits2["default"])(BasicAccount,e);var t=_createSuper(BasicAccount);(0,_createClass2["default"])(BasicAccount,null,[{key:"copy",value:function copy(e){return e?new BasicAccount(e._balance):e}}]);function BasicAccount(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;(0,_classCallCheck2["default"])(this,BasicAccount);return t.call(this,ye.Type.BASIC,e)}(0,_createClass2["default"])(BasicAccount,[{key:"equals",value:function equals(e){return e instanceof BasicAccount&&this._type===e._type&&this._balance===e._balance}},{key:"toString",value:function toString(){return"BasicAccount{balance=".concat(this._balance,"}")}},{key:"withBalance",value:function withBalance(e){return new BasicAccount(e)}},{key:"withIncomingTransaction",value:function withIncomingTransaction(e,t){var n=arguments.length>2&&arguments[2]!==undefined&&arguments[2];if(!n){if(e.hasFlag(ze.Flag.CONTRACT_CREATION)!==(e.recipientType!==this._type))throw new Error("Data Error!")}return(0,_get10["default"])((0,_getPrototypeOf2["default"])(BasicAccount.prototype),"withIncomingTransaction",this).call(this,e,t,n)}},{key:"withContractCommand",value:function withContractCommand(e,t){return!(arguments.length>2&&arguments[2]!==undefined&&arguments[2])&&e.recipientType!==this._type&&e.hasFlag(ze.Flag.CONTRACT_CREATION)?ye.TYPE_MAP.get(e.recipientType).create(this._balance,t,e):this}},{key:"isInitial",value:function isInitial(){return 0===this._balance}}],[{key:"unserialize",value:function unserialize(e){if(e.readUint8()!==ye.Type.BASIC)throw new Error("Invalid account type");return new BasicAccount(e.readUint64())}},{key:"fromPlain",value:function fromPlain(e){if(!e)throw new Error("Invalid account");return new BasicAccount(e.balance)}},{key:"verifyOutgoingTransaction",value:function verifyOutgoingTransaction(e){return He.verifyTransaction(e)}},{key:"verifyIncomingTransaction",value:function verifyIncomingTransaction(e){return!(e.data.byteLength>64)}},{key:"dataToPlain",value:function dataToPlain(e){return ye.dataToPlain(e)}},{key:"proofToPlain",value:function proofToPlain(e){try{var t=He.unserialize(new U(e));return{signature:t.signature.toHex(),publicKey:t.publicKey.toHex(),signer:t.publicKey.toAddress().toPlain(),pathLength:t.merklePath.nodes.length}}catch(n){return ye.proofToPlain(e)}}}]);return BasicAccount}(ye);ye.INITIAL=new ke(0);ye.TYPE_MAP.set(ye.Type.BASIC,ke);n.register(ke);var me=function(e){(0,_inherits2["default"])(Contract,e);var t=_createSuper(Contract);function Contract(e,n){(0,_classCallCheck2["default"])(this,Contract);return t.call(this,e,n)}(0,_createClass2["default"])(Contract,[{key:"withIncomingTransaction",value:function withIncomingTransaction(e,t){var n=arguments.length>2&&arguments[2]!==undefined&&arguments[2];if(!n&&e.hasFlag(ze.Flag.CONTRACT_CREATION))throw new Error("Data error");return(0,_get10["default"])((0,_getPrototypeOf2["default"])(Contract.prototype),"withIncomingTransaction",this).call(this,e,t,n)}},{key:"withContractCommand",value:function withContractCommand(e,t){return arguments.length>2&&arguments[2]!==undefined&&arguments[2]&&e.hasFlag(ze.Flag.CONTRACT_CREATION)?new ke(this.balance):this}}],[{key:"verifyIncomingTransaction",value:function verifyIncomingTransaction(e){return!!e.recipient.equals(e.getContractCreationAddress())}}]);return Contract}(ye);n.register(me);var be=function(e){(0,_inherits2["default"])(HashedTimeLockedContract,e);var t=_createSuper(HashedTimeLockedContract);function HashedTimeLockedContract(){var e,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:ge.NULL,a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:ge.NULL,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:ie.NULL,s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1,o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0,u=arguments.length>6&&arguments[6]!==undefined?arguments[6]:n;(0,_classCallCheck2["default"])(this,HashedTimeLockedContract);e=t.call(this,ye.Type.HTLC,n);if(!(r instanceof ge))throw new Error("Malformed sender address");if(!(a instanceof ge))throw new Error("Malformed recipient address");if(!(i instanceof ie))throw new Error("Malformed hashRoot");if(!Y.isUint8(s)||0===s)throw new Error("Malformed hashCount");if(!Y.isUint32(o))throw new Error("Malformed timeout");if(!Y.isUint64(u))throw new Error("Malformed totalAmount");e._sender=r;e._recipient=a;e._hashRoot=i;e._hashCount=s;e._timeout=o;e._totalAmount=u;return e}(0,_createClass2["default"])(HashedTimeLockedContract,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(HashedTimeLockedContract.prototype),"serialize",this).call(this,e);this._sender.serialize(e);this._recipient.serialize(e);e.writeUint8(this._hashRoot.algorithm);this._hashRoot.serialize(e);e.writeUint8(this._hashCount);e.writeUint32(this._timeout);e.writeUint64(this._totalAmount);return e}},{key:"toString",value:function toString(){return"HashedTimeLockedContract{balance=".concat(this._balance,", sender=").concat(this._sender.toUserFriendlyAddress(!1),", recipient=").concat(this._sender.toUserFriendlyAddress(!1),", amount=").concat(this._totalAmount,"/").concat(this._hashCount,", timeout=").concat(this._timeout,"}")}},{key:"toPlain",value:function toPlain(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(HashedTimeLockedContract.prototype),"toPlain",this).call(this);e.sender=this.sender.toPlain();e.recipient=this.recipient.toPlain();e.hashAlgorithm=ie.Algorithm.toString(this.hashRoot.algorithm);e.hashRoot=this.hashRoot.toPlain();e.hashCount=this.hashCount;e.timeout=this.timeout;e.totalAmount=this.totalAmount;return e}},{key:"equals",value:function equals(e){return e instanceof HashedTimeLockedContract&&this._type===e._type&&this._balance===e._balance&&this._sender.equals(e._sender)&&this._recipient.equals(e._recipient)&&this._hashRoot.equals(e._hashRoot)&&this._hashCount===e._hashCount&&this._timeout===e._timeout&&this._totalAmount===e._totalAmount}},{key:"withBalance",value:function withBalance(e){return new HashedTimeLockedContract(e,this._sender,this._recipient,this._hashRoot,this._hashCount,this._timeout,this._totalAmount)}},{key:"withOutgoingTransaction",value:function withOutgoingTransaction(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined&&arguments[3],a=new U(e.proof),i=0;switch(a.readUint8()){case HashedTimeLockedContract.ProofType.REGULAR_TRANSFER:if(this._timeout<t)throw new ye.ProofError;var s=a.readUint8(),o=a.readUint8();if(!ie.unserialize(a,s).equals(this._hashRoot))throw new ye.ProofError;ie.unserialize(a,s);if(!He.unserialize(a).isSignedBy(this._recipient))throw new ye.ProofError;i=Math.max(0,Math.floor((1-o/this._hashCount)*this._totalAmount));break;case HashedTimeLockedContract.ProofType.EARLY_RESOLVE:if(!He.unserialize(a).isSignedBy(this._recipient))throw new ye.ProofError;if(!He.unserialize(a).isSignedBy(this._sender))throw new ye.ProofError;break;case HashedTimeLockedContract.ProofType.TIMEOUT_RESOLVE:if(this._timeout>=t)throw new ye.ProofError;if(!He.unserialize(a).isSignedBy(this._sender))throw new ye.ProofError;break;default:throw new ye.ProofError}if(!r){if(this._balance-e.value-e.fee<i)throw new ye.BalanceError}return(0,_get10["default"])((0,_getPrototypeOf2["default"])(HashedTimeLockedContract.prototype),"withOutgoingTransaction",this).call(this,e,t,n,r)}},{key:"withIncomingTransaction",value:function withIncomingTransaction(e,t){arguments.length>2&&arguments[2]!==undefined&&arguments[2];throw new Error("Illegal incoming transaction")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(HashedTimeLockedContract.prototype),"serializedSize",this)+this._sender.serializedSize+this._recipient.serializedSize+1+this._hashRoot.serializedSize+1+4+8}},{key:"sender",get:function get(){return this._sender}},{key:"recipient",get:function get(){return this._recipient}},{key:"hashAlgorithm",get:function get(){return this._hashRoot.algorithm}},{key:"hashRoot",get:function get(){return this._hashRoot}},{key:"hashCount",get:function get(){return this._hashCount}},{key:"timeout",get:function get(){return this._timeout}},{key:"totalAmount",get:function get(){return this._totalAmount}}],[{key:"create",value:function create(e,t,n){var r=new U(n.data),a=ge.unserialize(r),i=ge.unserialize(r),s=r.readUint8();return new HashedTimeLockedContract(e,a,i,ie.unserialize(r,s),r.readUint8(),r.readUint32())}},{key:"unserialize",value:function unserialize(e){if(e.readUint8()!==ye.Type.HTLC)throw new Error("Invalid account type");var t=e.readUint64(),n=ge.unserialize(e),r=ge.unserialize(e),a=e.readUint8();return new HashedTimeLockedContract(t,n,r,ie.unserialize(e,a),e.readUint8(),e.readUint32(),e.readUint64())}},{key:"fromPlain",value:function fromPlain(e){if(!e)throw new Error("Invalid account");return new HashedTimeLockedContract(e.balance,ge.fromAny(e.sender),ge.fromAny(e.recipient),ie.fromAny(e.hashRoot,ie.Algorithm.fromAny(e.hashAlgorithm)),e.hashCount,e.timeout,e.totalAmount)}},{key:"verifyOutgoingTransaction",value:function verifyOutgoingTransaction(e){try{var t=new U(e.proof);switch(t.readUint8()){case HashedTimeLockedContract.ProofType.REGULAR_TRANSFER:for(var n=t.readUint8(),r=t.readUint8(),a=ie.unserialize(t,n),i=ie.unserialize(t,n),s=0;s<r;++s)i=ie.compute(i.array,n);if(!a.equals(i))return!1;if(!He.unserialize(t).verify(null,e.serializeContent()))return!1;break;case HashedTimeLockedContract.ProofType.EARLY_RESOLVE:if(!He.unserialize(t).verify(null,e.serializeContent()))return!1;if(!He.unserialize(t).verify(null,e.serializeContent()))return!1;break;case HashedTimeLockedContract.ProofType.TIMEOUT_RESOLVE:if(!He.unserialize(t).verify(null,e.serializeContent()))return!1;break;default:return!1}return t.readPos===t.byteLength}catch(o){return!1}}},{key:"verifyIncomingTransaction",value:function verifyIncomingTransaction(e){try{var t=new U(e.data);ge.unserialize(t);ge.unserialize(t);var n=t.readUint8();ie.unserialize(t,n);var r=t.readUint8();t.readUint32();return 0!==r&&(n!==ie.Algorithm.ARGON2D&&(t.readPos===t.byteLength&&me.verifyIncomingTransaction(e)))}catch(a){return!1}}},{key:"dataToPlain",value:function dataToPlain(e){try{var t=new U(e),n=ge.unserialize(t),r=ge.unserialize(t),a=t.readUint8(),i=ie.unserialize(t,a),s=t.readUint8(),o=t.readUint32();return{sender:n.toPlain(),recipient:r.toPlain(),hashAlgorithm:ie.Algorithm.toString(a),hashRoot:i.toPlain(),hashCount:s,timeout:o}}catch(u){return ye.dataToPlain(e)}}},{key:"proofToPlain",value:function proofToPlain(e){try{var t=new U(e),n=t.readUint8();switch(n){case HashedTimeLockedContract.ProofType.REGULAR_TRANSFER:var r=t.readUint8(),a=t.readUint8(),i=ie.unserialize(t,r),s=ie.unserialize(t,r),o=He.unserialize(t);return{type:HashedTimeLockedContract.ProofType.toString(n),hashAlgorithm:ie.Algorithm.toString(r),hashDepth:a,hashRoot:i.toPlain(),preImage:s.toPlain(),signer:o.publicKey.toAddress().toPlain(),signature:o.signature.toHex(),publicKey:o.publicKey.toHex(),pathLength:o.merklePath.nodes.length};case HashedTimeLockedContract.ProofType.EARLY_RESOLVE:var u=He.unserialize(t),c=He.unserialize(t);return{type:HashedTimeLockedContract.ProofType.toString(n),signer:u.publicKey.toAddress().toPlain(),signature:u.signature.toHex(),publicKey:u.publicKey.toHex(),pathLength:u.merklePath.nodes.length,creator:c.publicKey.toAddress().toPlain(),creatorSignature:c.signature.toHex(),creatorPublicKey:c.publicKey.toHex(),creatorPathLength:c.merklePath.nodes.length};case HashedTimeLockedContract.ProofType.TIMEOUT_RESOLVE:var l=He.unserialize(t);return{type:HashedTimeLockedContract.ProofType.toString(n),creator:l.publicKey.toAddress().toPlain(),creatorSignature:l.signature.toHex(),creatorPublicKey:l.publicKey.toHex(),creatorPathLength:l.merklePath.nodes.length};default:return!1}}catch(h){return ye.proofToPlain(e)}}}]);return HashedTimeLockedContract}(me);be.ProofType={REGULAR_TRANSFER:1,EARLY_RESOLVE:2,TIMEOUT_RESOLVE:3};be.ProofType.toString=function(e){switch(e){case be.ProofType.REGULAR_TRANSFER:return"regular-transfer";case be.ProofType.EARLY_RESOLVE:return"early-resolve";case be.ProofType.TIMEOUT_RESOLVE:return"timeout-resolve"}throw new Error("Invalid proof type")};ye.TYPE_MAP.set(ye.Type.HTLC,be);n.register(be);var we=function(e){(0,_inherits2["default"])(VestingContract,e);var t=_createSuper(VestingContract);function VestingContract(){var e,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:ge.NULL,a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0,s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:n,o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:n;(0,_classCallCheck2["default"])(this,VestingContract);e=t.call(this,ye.Type.VESTING,n);if(!(r instanceof ge))throw new Error("Malformed owner address");if(!Y.isUint32(a))throw new Error("Malformed vestingStart");if(!Y.isUint32(i))throw new Error("Malformed vestingStepBlocks");if(!Y.isUint64(s))throw new Error("Malformed vestingStepAmount");if(!Y.isUint64(o))throw new Error("Malformed vestingTotalAmount");e._owner=r;e._vestingStart=a;e._vestingStepBlocks=i;e._vestingStepAmount=s;e._vestingTotalAmount=o;return e}(0,_createClass2["default"])(VestingContract,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(VestingContract.prototype),"serialize",this).call(this,e);this._owner.serialize(e);e.writeUint32(this._vestingStart);e.writeUint32(this._vestingStepBlocks);e.writeUint64(this._vestingStepAmount);e.writeUint64(this._vestingTotalAmount);return e}},{key:"toString",value:function toString(){return"VestingAccount{balance=".concat(this._balance,", owner=").concat(this._owner.toUserFriendlyAddress())}},{key:"toPlain",value:function toPlain(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(VestingContract.prototype),"toPlain",this).call(this);e.owner=this.owner.toPlain();e.vestingStart=this.vestingStart;e.vestingStepBlocks=this.vestingStepBlocks;e.vestingStepAmount=this.vestingStepAmount;e.vestingTotalAmount=this.vestingTotalAmount;return e}},{key:"equals",value:function equals(e){return e instanceof VestingContract&&this._type===e._type&&this._balance===e._balance&&this._owner.equals(e._owner)&&this._vestingStart===e._vestingStart&&this._vestingStepBlocks===e._vestingStepBlocks&&this._vestingStepAmount===e._vestingStepAmount&&this._vestingTotalAmount===e._vestingTotalAmount}},{key:"withBalance",value:function withBalance(e){return new VestingContract(e,this._owner,this._vestingStart,this._vestingStepBlocks,this._vestingStepAmount,this._vestingTotalAmount)}},{key:"withOutgoingTransaction",value:function withOutgoingTransaction(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined&&arguments[3];if(!r){var a=this.getMinCap(t);if(this._balance-e.value-e.fee<a)throw new ye.BalanceError;var i=new U(e.proof);if(!He.unserialize(i).isSignedBy(this._owner))throw new ye.ProofError}return(0,_get10["default"])((0,_getPrototypeOf2["default"])(VestingContract.prototype),"withOutgoingTransaction",this).call(this,e,t,n,r)}},{key:"withIncomingTransaction",value:function withIncomingTransaction(e,t){arguments.length>2&&arguments[2]!==undefined&&arguments[2];throw new Error("Illegal incoming transaction")}},{key:"getMinCap",value:function getMinCap(e){return this._vestingStepBlocks&&this._vestingStepAmount>0?Math.max(0,this._vestingTotalAmount-Math.floor((e-this._vestingStart)/this._vestingStepBlocks)*this._vestingStepAmount):0}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(VestingContract.prototype),"serializedSize",this)+this._owner.serializedSize+4+4+8+8}},{key:"owner",get:function get(){return this._owner}},{key:"vestingStart",get:function get(){return this._vestingStart}},{key:"vestingStepBlocks",get:function get(){return this._vestingStepBlocks}},{key:"vestingStepAmount",get:function get(){return this._vestingStepAmount}},{key:"vestingTotalAmount",get:function get(){return this._vestingTotalAmount}}],[{key:"create",value:function create(e,t,n){var r,a,i,s,o=new U(n.data),u=ge.unserialize(o);s=n.value;switch(n.data.length){case ge.SERIALIZED_SIZE+4:r=0;a=o.readUint32();i=s;break;case ge.SERIALIZED_SIZE+16:r=o.readUint32();a=o.readUint32();i=o.readUint64();break;case ge.SERIALIZED_SIZE+24:r=o.readUint32();a=o.readUint32();i=o.readUint64();s=o.readUint64();break;default:throw new Error("Invalid transaction data")}return new VestingContract(e,u,r,a,i,s)}},{key:"unserialize",value:function unserialize(e){if(e.readUint8()!==ye.Type.VESTING)throw new Error("Invalid account type");return new VestingContract(e.readUint64(),ge.unserialize(e),e.readUint32(),e.readUint32(),e.readUint64(),e.readUint64())}},{key:"fromPlain",value:function fromPlain(e){if(!e)throw new Error("Invalid account");return new VestingContract(e.balance,ge.fromAny(e.owner),e.vestingStart,e.vestingStepBlocks,e.vestingStepAmount,e.vestingTotalAmount)}},{key:"verifyOutgoingTransaction",value:function verifyOutgoingTransaction(e){var t=new U(e.proof);return!!He.unserialize(t).verify(null,e.serializeContent())&&t.readPos===t.byteLength}},{key:"verifyIncomingTransaction",value:function verifyIncomingTransaction(e){switch(e.data.length){case ge.SERIALIZED_SIZE+4:case ge.SERIALIZED_SIZE+16:case ge.SERIALIZED_SIZE+24:return me.verifyIncomingTransaction(e);default:return!1}}},{key:"dataToPlain",value:function dataToPlain(e){try{var t,n,r,a,i=new U(e),s=ge.unserialize(i);switch(transaction.data.length){case ge.SERIALIZED_SIZE+4:t=0;n=i.readUint32();break;case ge.SERIALIZED_SIZE+16:t=i.readUint32();n=i.readUint32();r=i.readUint64();break;case ge.SERIALIZED_SIZE+24:t=i.readUint32();n=i.readUint32();r=i.readUint64();a=i.readUint64();break;default:throw new Error("Invalid transaction data")}return{owner:s.toPlain(),vestingStart:t,vestingStepBlocks:n,vestingStepAmount:r,vestingTotalAmount:a}}catch(o){return ye.dataToPlain(e)}}},{key:"proofToPlain",value:function proofToPlain(e){try{var t=He.unserialize(new U(e));return{signature:t.signature.toHex(),publicKey:t.publicKey.toHex(),signer:t.publicKey.toAddress().toPlain(),pathLength:t.merklePath.nodes.length}}catch(n){return ye.proofToPlain(e)}}}]);return VestingContract}(me);ye.TYPE_MAP.set(ye.Type.VESTING,we);n.register(we);var Ce=function(){(0,_createClass2["default"])(AccountsTreeNode,null,[{key:"terminalNode",value:function terminalNode(e,t){return new AccountsTreeNode(AccountsTreeNode.TERMINAL,e,t)}},{key:"branchNode",value:function branchNode(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[],n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(t.length!==n.length)throw new Error("Invalid list of children for branch node");return new AccountsTreeNode(AccountsTreeNode.BRANCH,e,t,n)}}]);function AccountsTreeNode(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"",n=arguments.length>2?arguments[2]:undefined,r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];(0,_classCallCheck2["default"])(this,AccountsTreeNode);this._type=e;this._prefix=t;if(this.isBranch()){this._childrenSuffixes=n;this._childrenHashes=r}else{if(!this.isTerminal())throw"Invalid AccountsTreeNode type: ".concat(e);this._account=n}}(0,_createClass2["default"])(AccountsTreeNode,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint8(this._type);e.writeVarLengthString(this._prefix);if(this.isTerminal())this._account.serialize(e);else{var t=this._childrenSuffixes.reduce(function(e,t){return e+!!t},0);e.writeUint8(t);for(var n=0;n<this._childrenSuffixes.length;++n)if(this._childrenHashes[n]){e.writeVarLengthString(this._childrenSuffixes[n]);this._childrenHashes[n].serialize(e)}}return e}},{key:"getChildHash",value:function getChildHash(e){return this._childrenHashes&&this._childrenHashes[this._getChildIndex(e)]}},{key:"getChild",value:function getChild(e){var t=this._childrenSuffixes&&this._childrenSuffixes[this._getChildIndex(e)];return t?this.prefix+t:t}},{key:"withChild",value:function withChild(e,t){var n=this._childrenSuffixes.slice()||[],r=this._childrenHashes.slice()||[];n[this._getChildIndex(e)]=e.substr(this.prefix.length);r[this._getChildIndex(e)]=t;return AccountsTreeNode.branchNode(this._prefix,n,r)}},{key:"withoutChild",value:function withoutChild(e){var t=this._childrenSuffixes.slice()||[],n=this._childrenHashes.slice()||[];delete t[this._getChildIndex(e)];delete n[this._getChildIndex(e)];return AccountsTreeNode.branchNode(this._prefix,t,n)}},{key:"hasChildren",value:function hasChildren(){return this._childrenSuffixes&&this._childrenSuffixes.some(function(e){return!!e})}},{key:"hasSingleChild",value:function hasSingleChild(){return this._childrenSuffixes&&1===this._childrenSuffixes.reduce(function(e,t){return e+!!t},0)}},{key:"getFirstChild",value:function getFirstChild(){if(!this._childrenSuffixes)return undefined;var e=this._childrenSuffixes.find(function(e){return!!e});return e?this.prefix+e:undefined}},{key:"getLastChild",value:function getLastChild(){if(!this._childrenSuffixes)return undefined;for(var e=this._childrenSuffixes.length-1;e>=0;--e)if(this._childrenSuffixes[e])return this.prefix+this._childrenSuffixes[e];return undefined}},{key:"getChildren",value:function getChildren(){var e=this;return this._childrenSuffixes?this._childrenSuffixes.filter(function(e){return!!e}).map(function(t){return e.prefix+t}):undefined}},{key:"withAccount",value:function withAccount(e){return AccountsTreeNode.terminalNode(this._prefix,e)}},{key:"hash",value:function hash(){this._hash||(this._hash=ie.light(this.serialize()));return this._hash}},{key:"isChildOf",value:function isChildOf(e){return e.getChildren()&&e.getChildren().includes(this._prefix)}},{key:"isTerminal",value:function isTerminal(){return AccountsTreeNode.isTerminalType(this._type)}},{key:"isBranch",value:function isBranch(){return AccountsTreeNode.isBranchType(this._type)}},{key:"_getChildIndex",value:function _getChildIndex(e){R.that(e.substr(0,this.prefix.length)===this.prefix,"Prefix ".concat(e," is not a child of the current node ").concat(this.prefix));return(0,_parseInt2["default"])(e[this.prefix.length],16)}},{key:"equals",value:function equals(e){if(!(e instanceof AccountsTreeNode))return!1;if(!(0,_is["default"])(this.prefix,e.prefix))return!1;if(this.isTerminal())return e.isTerminal()&&e._account.equals(this._account);if(!e.isBranch())return!1;if(this._childrenSuffixes.length!==e._childrenSuffixes.length)return!1;if(e._childrenSuffixes.length!==e._childrenHashes.length)return!1;for(var t=0;t<this._childrenSuffixes.length;++t){var n=this._childrenHashes[t],r=e._childrenHashes[t];if(n){if(!r||!n.equals(r))return!1}else if(r)return!1;if(this._childrenSuffixes[t]!==e._childrenSuffixes[t])return!1}return!0}},{key:"serializedSize",get:function get(){var e,t=this;if(this.isTerminal())e=this._account.serializedSize;else{e=1+this._childrenHashes.reduce(function(e,n,r){return e+(n?n.serializedSize+U.varLengthStringSize(t._childrenSuffixes[r]):0)},0)}return 1+U.varLengthStringSize(this._prefix)+e}},{key:"account",get:function get(){return this._account}},{key:"prefix",get:function get(){return this._prefix},set:function set(e){this._prefix=e;this._hash=undefined}}],[{key:"isTerminalType",value:function isTerminalType(e){return e===AccountsTreeNode.TERMINAL}},{key:"isBranchType",value:function isBranchType(e){return e===AccountsTreeNode.BRANCH}},{key:"unserialize",value:function unserialize(e){var t=e.readUint8(),n=e.readVarLengthString();if(AccountsTreeNode.isTerminalType(t)){var r=ye.unserialize(e);return AccountsTreeNode.terminalNode(n,r)}if(AccountsTreeNode.isBranchType(t)){for(var a=[],i=[],s=e.readUint8(),o=0;o<s;++o){var u=e.readVarLengthString(),c=ie.unserialize(e),l=(0,_parseInt2["default"])(u[0],16);a[l]=u;i[l]=c}return AccountsTreeNode.branchNode(n,a,i)}throw"Invalid AccountsTreeNode type: ".concat(t)}}]);return AccountsTreeNode}();Ce.BRANCH=0;Ce.TERMINAL=255;n.register(Ce);var Se=function(){(0,_createClass2["default"])(AccountsTreeStore,null,[{key:"initPersistent",value:function initPersistent(e){e.createObjectStore("Accounts",{codec:new Te})}},{key:"getPersistent",value:function getPersistent(e){return new AccountsTreeStore(e.getObjectStore("Accounts"))}},{key:"createVolatile",value:function createVolatile(){return new AccountsTreeStore(JDB.JungleDB.createVolatileObjectStore())}}]);function AccountsTreeStore(e){(0,_classCallCheck2["default"])(this,AccountsTreeStore);this._store=e}(0,_createClass2["default"])(AccountsTreeStore,[{key:"get",value:function get(e){return this._store.get(e)}},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee145(e){var t;return _regenerator["default"].wrap(function _callee145$(n){for(;;)switch(n.prev=n.next){case 0:t=e.prefix;n.next=3;return this._store.put(t,e);case 3:return n.abrupt("return",t);case 4:case"end":return n.stop()}},_callee145,this)}));return function put(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee146(e){var t;return _regenerator["default"].wrap(function _callee146$(n){for(;;)switch(n.prev=n.next){case 0:t=e.prefix;n.next=3;return this._store.remove(t);case 3:return n.abrupt("return",t);case 4:case"end":return n.stop()}},_callee146,this)}));return function remove(t){return e.apply(this,arguments)}}()},{key:"getRootNode",value:function getRootNode(){return this.get("")}},{key:"getTerminalNodes",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee147(e,t){var n,r,a,i,s;return _regenerator["default"].wrap(function _callee147$(o){for(;;)switch(o.prev=o.next){case 0:n=[];o.next=3;return this._store.keyStream(function(e){if(e.length===ge.HEX_SIZE){n.push(e);if(n.length===t)return!1}return!0},!0,JDB.KeyRange.lowerBound(e,!0));case 3:r=[];for(a=0,i=n;a<i.length;a++){s=i[a];r.push(this._store.get(s))}return o.abrupt("return",_promise["default"].all(r));case 6:case"end":return o.stop()}},_callee147,this)}));return function getTerminalNodes(t,n){return e.apply(this,arguments)}}()},{key:"snapshot",value:function snapshot(e){var snapshot=this._store.snapshot();e&&snapshot.inherit(e._store);return new AccountsTreeStore(snapshot)}},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];return new AccountsTreeStore(this._store.transaction(e))}},{key:"synchronousTransaction",value:function synchronousTransaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0],t=this._store.synchronousTransaction(e);return new Ee(t)}},{key:"truncate",value:function truncate(){return this._store.truncate()}},{key:"commit",value:function commit(){return this._store.commit()}},{key:"abort",value:function abort(){return this._store.abort()}},{key:"tx",get:function get(){return this._store instanceof JDB.Transaction?this._store:undefined}}]);return AccountsTreeStore}();n.register(Se);var Te=function(){function AccountsTreeStoreCodec(){(0,_classCallCheck2["default"])(this,AccountsTreeStoreCodec)}(0,_createClass2["default"])(AccountsTreeStoreCodec,[{key:"encode",value:function encode(e){return e.serialize()}},{key:"decode",value:function decode(e,t){return Ce.unserialize(new U(e))}},{key:"valueEncoding",get:function get(){return JDB.JungleDB.BINARY_ENCODING}}]);return AccountsTreeStoreCodec}(),Ee=function(e){(0,_inherits2["default"])(SynchronousAccountsTreeStore,e);var t=_createSuper(SynchronousAccountsTreeStore);function SynchronousAccountsTreeStore(e){var n;(0,_classCallCheck2["default"])(this,SynchronousAccountsTreeStore);(n=t.call(this,e))._syncStore=e;return n}(0,_createClass2["default"])(SynchronousAccountsTreeStore,[{key:"preload",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee148(e){return _regenerator["default"].wrap(function _callee148$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._syncStore.preload(e);case 2:case"end":return t.stop()}},_callee148,this)}));return function preload(t){return e.apply(this,arguments)}}()},{key:"getSync",value:function getSync(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1];return this._syncStore.getSync(e,{expectPresence:t})}},{key:"putSync",value:function putSync(e){var t=e.prefix;this._syncStore.putSync(t,e);return t}},{key:"removeSync",value:function removeSync(e){var t=e.prefix;this._syncStore.removeSync(t);return t}},{key:"getRootNodeSync",value:function getRootNodeSync(){return this.getSync("")}}]);return SynchronousAccountsTreeStore}(Se);n.register(Ee);var xe=function(){function AccountsProof(e){(0,_classCallCheck2["default"])(this,AccountsProof);if(!e||!(0,_isArray["default"])(e)||!Y.isUint16(e.length)||e.some(function(e){return!(e instanceof Ce)}))throw new Error("Malformed nodes");this._nodes=e;this._index=null}(0,_createClass2["default"])(AccountsProof,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint16(this._nodes.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._nodes);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"verify",value:function verify(){var e=[];this._index=new b;var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._nodes);!(t=(a=i.next()).done);t=!0){var s=a.value;if(s.isBranch())for(var o=void 0;o=e.pop();){if(!o.isChildOf(s)){e.push(o);break}var u=o.hash();if(!s.getChildHash(o.prefix).equals(u)||s.getChild(o.prefix)!==o.prefix)return!1;this._index.put(u,o)}e.push(s)}}catch(c){n=!0;r=c}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return 1===e.length&&""===e[0].prefix&&e[0].isBranch()}},{key:"getAccount",value:function getAccount(e){if(!this._index)throw new Error("AccountsProof must be verified before retrieving accounts. Call verify() first.");var t=this._nodes[this._nodes.length-1],n=e.toHex();return this._getAccount(t,n)}},{key:"_getAccount",value:function _getAccount(e,t){var n=ne.commonPrefix(e.prefix,t);if(n.length!==e.prefix.length)return ye.INITIAL;if(n===t)return e.account;var r=e.getChildHash(t);if(r){var a=this._index.get(r);if(!a)throw new Error("Requested address not part of AccountsProof");return this._getAccount(a,t)}return ye.INITIAL}},{key:"toString",value:function toString(){return"AccountsProof{length=".concat(this.length,"}")}},{key:"root",value:function root(){return this._nodes[this._nodes.length-1].hash()}},{key:"serializedSize",get:function get(){var e=2,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._nodes);!(t=(a=i.next()).done);t=!0){e+=a.value.serializedSize}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"length",get:function get(){return this._nodes.length}},{key:"nodes",get:function get(){return this._nodes}}],[{key:"unserialize",value:function unserialize(e){for(var t=e.readUint16(),n=[],r=0;r<t;r++)n.push(Ce.unserialize(e));return new AccountsProof(n)}}]);return AccountsProof}();n.register(xe);var Ie=function(){function AccountsTreeChunk(e,t){(0,_classCallCheck2["default"])(this,AccountsTreeChunk);if(!e||!Y.isUint16(e.length)||e.some(function(e){return!(e instanceof Ce&&e.isTerminal())}))throw new Error("Malformed nodes");this._nodes=e;this._proof=t}(0,_createClass2["default"])(AccountsTreeChunk,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint16(this._nodes.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._nodes);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}this._proof.serialize(e);return e}},{key:"verify",value:function verify(){if(!this._proof.verify())return!1;for(var e=null,t=0;t<=this._nodes.length;++t){var n=t<this._nodes.length?this._nodes[t]:this.tail;if(e&&e>=n.prefix)return!1;e=n.prefix}return!0}},{key:"toString",value:function toString(){return"AccountsTreeChunk{length=".concat(this.length,"}")}},{key:"root",value:function root(){return this._proof.root()}},{key:"serializedSize",get:function get(){var e=2,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._nodes);!(t=(a=i.next()).done);t=!0){e+=a.value.serializedSize}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e+=this._proof.serializedSize}},{key:"terminalNodes",get:function get(){return this._nodes.concat([this.tail])}},{key:"proof",get:function get(){return this._proof}},{key:"head",get:function get(){return this._nodes.length>0?this._nodes[0]:this.tail}},{key:"tail",get:function get(){return this._proof.nodes[0]}},{key:"length",get:function get(){return this._nodes.length+1}}],[{key:"unserialize",value:function unserialize(e){for(var t=e.readUint16(),n=[],r=0;r<t;r++)n.push(Ce.unserialize(e));return new AccountsTreeChunk(n,xe.unserialize(e))}}]);return AccountsTreeChunk}();Ie.SIZE_MAX=5e3;Ie.EMPTY=new Ie([],new xe([]));n.register(Ie);var Be=function(e){(0,_inherits2["default"])(AccountsTree,e);var t=_createSuper(AccountsTree);(0,_createClass2["default"])(AccountsTree,null,[{key:"getPersistent",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee149(e){var t,n;return _regenerator["default"].wrap(function _callee149$(r){for(;;)switch(r.prev=r.next){case 0:t=Se.getPersistent(e);n=new AccountsTree(t);return r.abrupt("return",n._init());case 3:case"end":return r.stop()}},_callee149)}));return function getPersistent(t){return e.apply(this,arguments)}}()},{key:"createVolatile",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee150(){var e,t;return _regenerator["default"].wrap(function _callee150$(n){for(;;)switch(n.prev=n.next){case 0:e=Se.createVolatile();t=new AccountsTree(e);return n.abrupt("return",t._init());case 3:case"end":return n.stop()}},_callee150)}));return function createVolatile(){return e.apply(this,arguments)}}()}]);function AccountsTree(e){var n;(0,_classCallCheck2["default"])(this,AccountsTree);(n=t.call(this))._store=e;n._synchronizer=new z;return n}(0,_createClass2["default"])(AccountsTree,[{key:"_init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee151(){var e;return _regenerator["default"].wrap(function _callee151$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._store.getRootNode();case 2:if(e=t.sent){t.next=7;break}e=Ce.branchNode("",[],[]);t.next=7;return this._store.put(e);case 7:return t.abrupt("return",this);case 8:case"end":return t.stop()}},_callee151,this)}));return function _init(){return e.apply(this,arguments)}}()},{key:"put",value:function put(e,t){var n=this;return this._synchronizer.push(function(){return n._put(e,t)})}},{key:"_put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee152(e,t){var n,r;return _regenerator["default"].wrap(function _callee152$(a){for(;;)switch(a.prev=a.next){case 0:a.t0=t.isInitial();if(!a.t0){a.next=5;break}a.next=4;return this.get(e);case 4:a.t0=!a.sent;case 5:if(!a.t0){a.next=7;break}return a.abrupt("return");case 7:a.next=9;return this._store.getRootNode();case 9:n=a.sent;R.that(!!n,"Corrupted store: Failed to fetch AccountsTree root node");r=e.toHex();a.next=14;return this._insert(n,r,t,[]);case 14:case"end":return a.stop()}},_callee152,this)}));return function _put(t,n){return e.apply(this,arguments)}}()},{key:"_insert",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee153(e,t,n,r){var a,i,s,o,u,c,l,h,f,d,A;return _regenerator["default"].wrap(function _callee153$(_){for(;;)switch(_.prev=_.next){case 0:if((a=ne.commonPrefix(e.prefix,t)).length===e.prefix.length){_.next=11;break}i=Ce.terminalNode(t,n);s=i.hash();_.next=6;return this._store.put(i);case 6:o=Ce.branchNode(a).withChild(e.prefix,e.hash()).withChild(i.prefix,s);u=o.hash();_.next=10;return this._store.put(o);case 10:return _.abrupt("return",this._updateKeys(o.prefix,u,r));case 11:if(a!==t){_.next=21;break}if(!n.isInitial()){_.next=16;break}_.next=15;return this._store.remove(e);case 15:return _.abrupt("return",this._prune(e.prefix,r));case 16:e=e.withAccount(n);c=e.hash();_.next=20;return this._store.put(e);case 20:return _.abrupt("return",this._updateKeys(e.prefix,c,r));case 21:if(!(l=e.getChild(t))){_.next=28;break}_.next=25;return this._store.get(l);case 25:h=_.sent;r.push(e);return _.abrupt("return",this._insert(h,t,n,r));case 28:f=Ce.terminalNode(t,n);d=f.hash();_.next=32;return this._store.put(f);case 32:e=e.withChild(f.prefix,d);A=e.hash();_.next=36;return this._store.put(e);case 36:return _.abrupt("return",this._updateKeys(e.prefix,A,r));case 37:case"end":return _.stop()}},_callee153,this)}));return function _insert(t,n,r,a){return e.apply(this,arguments)}}()},{key:"_prune",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee154(e,t){var n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee154$(u){for(;;)switch(u.prev=u.next){case 0:n=t.length-1;case 1:if(!(n>=0)){u.next=26;break}if(!(r=(r=t[n]).withoutChild(e)).hasSingleChild()||""===r.prefix){u.next=17;break}u.next=7;return this._store.remove(r);case 7:a=r.getFirstChild();u.next=10;return this._store.get(a);case 10:i=u.sent;u.next=13;return this._store.put(i);case 13:s=i.hash();return u.abrupt("return",this._updateKeys(i.prefix,s,t.slice(0,n)));case 17:if(!r.hasChildren()&&""!==r.prefix){u.next=22;break}o=r.hash();u.next=21;return this._store.put(r);case 21:return u.abrupt("return",this._updateKeys(r.prefix,o,t.slice(0,n)));case 22:e=r.prefix;case 23:--n;u.next=1;break;case 26:return u.abrupt("return",undefined);case 27:case"end":return u.stop()}},_callee154,this)}));return function _prune(t,n){return e.apply(this,arguments)}}()},{key:"_updateKeys",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee155(e,t,n){var r,a;return _regenerator["default"].wrap(function _callee155$(i){for(;;)switch(i.prev=i.next){case 0:r=n.length-1;case 1:if(!(r>=0)){i.next=11;break}a=(a=n[r]).withChild(e,t);i.next=6;return this._store.put(a);case 6:t=a.hash();e=a.prefix;case 8:--r;i.next=1;break;case 11:return i.abrupt("return",t);case 12:case"end":return i.stop()}},_callee155,this)}));return function _updateKeys(t,n,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee156(e){var t;return _regenerator["default"].wrap(function _callee156$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this._store.get(e.toHex());case 2:t=n.sent;return n.abrupt("return",t!==undefined?t.account:null);case 4:case"end":return n.stop()}},_callee156,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"getAccountsProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee157(e){var t,n,r,a,i,s,o,u,c;return _regenerator["default"].wrap(function _callee157$(l){for(;;)switch(l.prev=l.next){case 0:l.next=2;return this._store.getRootNode();case 2:t=l.sent;R.that(!!t,"Corrupted store: Failed to fetch AccountsTree root node");n=[];r=!0;a=!1;i=undefined;l.prev=8;for(s=(0,_getIterator2["default"])(e);!(r=(o=s.next()).done);r=!0){u=o.value;n.push(u.toHex())}l.next=16;break;case 12:l.prev=12;l.t0=l["catch"](8);a=!0;i=l.t0;case 16:l.prev=16;l.prev=17;r||null==s["return"]||s["return"]();case 19:l.prev=19;if(!a){l.next=22;break}throw i;case 22:return l.finish(19);case 23:return l.finish(16);case 24:n.sort();c=[];l.next=28;return this._getAccountsProof(t,n,c);case 28:return l.abrupt("return",new xe(c));case 29:case"end":return l.stop()}},_callee157,this,[[8,12,16,24],[17,,19,23]])}));return function getAccountsProof(t){return e.apply(this,arguments)}}()},{key:"_getAccountsProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee158(e,t,n){var r,a,i,s,o,u,c;return _regenerator["default"].wrap(function _callee158$(l){for(;;)switch(l.prev=l.next){case 0:r=!1;a=0;case 2:if(!(a<t.length)){l.next=36;break}i=t[a];if(ne.commonPrefix(e.prefix,i).length===e.prefix.length&&e.prefix!==i){l.next=9;break}r=!0;a++;return l.abrupt("continue",34);case 9:if(!(s=e.getChild(i))){l.next=32;break}l.next=13;return this._store.get(s);case 13:o=l.sent;u=[i];c=a+1;case 16:if(!(c<t.length)){l.next=23;break}if(t[c].startsWith(o.prefix)){l.next=19;break}return l.abrupt("break",23);case 19:u.push(t[c]);case 20:++c;l.next=16;break;case 23:a=c;l.next=26;return this._getAccountsProof(o,u,n);case 26:l.t0=l.sent;if(l.t0){l.next=29;break}l.t0=r;case 29:r=l.t0;l.next=34;break;case 32:r=!0;a++;case 34:l.next=2;break;case 36:r&&n.push(e);return l.abrupt("return",r);case 38:case"end":return l.stop()}},_callee158,this)}));return function _getAccountsProof(t,n,r){return e.apply(this,arguments)}}()},{key:"getChunk",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee159(e,t){var n,r,a;return _regenerator["default"].wrap(function _callee159$(i){for(;;)switch(i.prev=i.next){case 0:i.next=2;return this._store.getTerminalNodes(e,t);case 2:n=i.sent;if(!(r=n.pop())){i.next=10;break}i.next=7;return this.getAccountsProof([ge.fromHex(r.prefix)]);case 7:a=i.sent;i.next=13;break;case 10:i.next=12;return this.getAccountsProof([ge.fromHex("ffffffffffffffffffffffffffffffffffffffff")]);case 12:a=i.sent;case 13:return i.abrupt("return",new Ie(n,a));case 14:case"end":return i.stop()}},_callee159,this)}));return function getChunk(t,n){return e.apply(this,arguments)}}()},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];return new AccountsTree(this._store.transaction(e))._init()}},{key:"synchronousTransaction",value:function synchronousTransaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0],t=this._store.synchronousTransaction(e);return new Pe(t)._init()}},{key:"partialTree",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee160(){var e,t;return _regenerator["default"].wrap(function _callee160$(n){for(;;)switch(n.prev=n.next){case 0:e=this._store.synchronousTransaction(!1);n.next=3;return e.truncate();case 3:t=new Ne(e);return n.abrupt("return",t._init());case 5:case"end":return n.stop()}},_callee160,this)}));return function partialTree(){return e.apply(this,arguments)}}()},{key:"snapshot",value:function snapshot(e){return new AccountsTree(this._store.snapshot(e?e._store:undefined))._init()}},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee161(){return _regenerator["default"].wrap(function _callee161$(e){for(;;)switch(e.prev=e.next){case 0:e.t0=R;e.next=3;return this.root();case 3:e.t1=!e.sent.equals(new ie(null));e.t0.that.call(e.t0,e.t1);return e.abrupt("return",this._store.commit());case 6:case"end":return e.stop()}},_callee161,this)}));return function commit(){return e.apply(this,arguments)}}()},{key:"abort",value:function abort(){return this._store.abort()}},{key:"root",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee162(){var e;return _regenerator["default"].wrap(function _callee162$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._store.getRootNode();case 2:e=t.sent;return t.abrupt("return",e&&e.hash());case 4:case"end":return t.stop()}},_callee162,this)}));return function root(){return e.apply(this,arguments)}}()},{key:"isEmpty",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee163(){var e;return _regenerator["default"].wrap(function _callee163$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._store.getRootNode();case 2:e=t.sent;return t.abrupt("return",!e.hasChildren());case 4:case"end":return t.stop()}},_callee163,this)}));return function isEmpty(){return e.apply(this,arguments)}}()},{key:"tx",get:function get(){return this._store.tx}}]);return AccountsTree}(i);n.register(Be);var Pe=function(e){(0,_inherits2["default"])(SynchronousAccountsTree,e);var t=_createSuper(SynchronousAccountsTree);function SynchronousAccountsTree(e){var n;(0,_classCallCheck2["default"])(this,SynchronousAccountsTree);(n=t.call(this,e))._syncStore=e;return n}(0,_createClass2["default"])(SynchronousAccountsTree,[{key:"preloadAddresses",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee164(e){var t,n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee164$(c){for(;;)switch(c.prev=c.next){case 0:c.next=2;return this._syncStore.getRootNode();case 2:t=c.sent;R.that(!!t,"Corrupted store: Failed to fetch AccountsTree root node");n=[];r=!0;a=!1;i=undefined;c.prev=8;for(s=(0,_getIterator2["default"])(e);!(r=(o=s.next()).done);r=!0){u=o.value;n.push(u.toHex())}c.next=16;break;case 12:c.prev=12;c.t0=c["catch"](8);a=!0;i=c.t0;case 16:c.prev=16;c.prev=17;r||null==s["return"]||s["return"]();case 19:c.prev=19;if(!a){c.next=22;break}throw i;case 22:return c.finish(19);case 23:return c.finish(16);case 24:n.sort();c.next=27;return this._preloadAddresses(t,n);case 27:case"end":return c.stop()}},_callee164,this,[[8,12,16,24],[17,,19,23]])}));return function preloadAddresses(t){return e.apply(this,arguments)}}()},{key:"_preloadAddresses",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee165(e,t){var n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee165$(u){for(;;)switch(u.prev=u.next){case 0:if(!e.hasChildren()){u.next=3;break}u.next=3;return this._syncStore.preload(e.getChildren());case 3:n=0;case 4:if(!(n<t.length)){u.next=30;break}r=t[n];if(ne.commonPrefix(e.prefix,r).length===e.prefix.length&&e.prefix!==r){u.next=10;break}n++;return u.abrupt("continue",28);case 10:if(!(a=e.getChild(r))){u.next=27;break}i=this._syncStore.getSync(a);s=[r];o=n+1;case 15:if(!(o<t.length)){u.next=22;break}if(t[o].startsWith(i.prefix)){u.next=18;break}return u.abrupt("break",22);case 18:s.push(t[o]);case 19:++o;u.next=15;break;case 22:n=o;u.next=25;return this._preloadAddresses(i,s);case 25:u.next=28;break;case 27:n++;case 28:u.next=4;break;case 30:case"end":return u.stop()}},_callee165,this)}));return function _preloadAddresses(t,n){return e.apply(this,arguments)}}()},{key:"putSync",value:function putSync(e,t){this.putBatch(e,t);this.finalizeBatch()}},{key:"finalizeBatch",value:function finalizeBatch(){var e=this._syncStore.getRootNodeSync();this._updateHashes(e)}},{key:"putBatch",value:function putBatch(e,t){if(!t.isInitial()||this.getSync(e,!1)){var n=this._syncStore.getRootNodeSync();R.that(!!n,"Corrupted store: Failed to fetch AccountsTree root node");var r=e.toHex();this._insertBatch(n,r,t,[])}}},{key:"_insertBatch",value:function _insertBatch(e,t,n,r){var a=ne.commonPrefix(e.prefix,t);if(a.length!==e.prefix.length){var i=Ce.terminalNode(t,n);this._syncStore.putSync(i);var s=Ce.branchNode(a).withChild(e.prefix,new ie(null)).withChild(i.prefix,new ie(null));this._syncStore.putSync(s);return this._updateKeysBatch(s.prefix,r)}if(a===t){if(n.isInitial()){this._syncStore.removeSync(e);return this._pruneBatch(e.prefix,r)}e=e.withAccount(n);this._syncStore.putSync(e);return this._updateKeysBatch(e.prefix,r)}var o=e.getChild(t);if(o){var u=this._syncStore.getSync(o);r.push(e);return this._insertBatch(u,t,n,r)}var c=Ce.terminalNode(t,n);this._syncStore.putSync(c);e=e.withChild(c.prefix,new ie(null));this._syncStore.putSync(e);return this._updateKeysBatch(e.prefix,r)}},{key:"_pruneBatch",value:function _pruneBatch(e,t){for(var n=t.length-1;n>=0;--n){var r=t[n];if((r=r.withoutChild(e)).hasSingleChild()&&""!==r.prefix){this._syncStore.removeSync(r);var a=r.getFirstChild(),i=this._syncStore.getSync(a);this._syncStore.putSync(i);return this._updateKeysBatch(i.prefix,t.slice(0,n))}if(r.hasChildren()||""===r.prefix){this._syncStore.putSync(r);return this._updateKeysBatch(r.prefix,t.slice(0,n))}e=r.prefix}return undefined}},{key:"_updateKeysBatch",value:function _updateKeysBatch(e,t){for(var n=t.length-1;n>=0;--n){var r=t[n];r=r.withChild(e,new ie(null));this._syncStore.putSync(r);e=r.prefix}}},{key:"_updateHashes",value:function _updateHashes(e){var t=this;if(e.isTerminal())return e.hash();var n=new ie(null),r=e.getChildren().map(function(r){var a=e.getChildHash(r);if(!a.equals(n))return a;var i=t._syncStore.getSync(r);return t._updateHashes(i)}),a=e;e.getChildren().forEach(function(e,t){a=a.withChild(e,r[t])});this._syncStore.putSync(a);return a.hash()}},{key:"getSync",value:function getSync(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=this._syncStore.getSync(e.toHex(),t);return n!==undefined?n.account:null}},{key:"rootSync",value:function rootSync(){var e=this._syncStore.getRootNodeSync();return e&&e.hash()}}]);return SynchronousAccountsTree}(Be);n.register(Pe);var Ne=function(e){(0,_inherits2["default"])(PartialAccountsTree,e);var t=_createSuper(PartialAccountsTree);function PartialAccountsTree(e){var n;(0,_classCallCheck2["default"])(this,PartialAccountsTree);(n=t.call(this,e))._complete=!1;n._lastPrefix="";return n}(0,_createClass2["default"])(PartialAccountsTree,[{key:"pushChunk",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee166(e){var t;return _regenerator["default"].wrap(function _callee166$(n){for(;;)switch(n.prev=n.next){case 0:if(e.verify()){n.next=2;break}return n.abrupt("return",PartialAccountsTree.Status.ERR_INCORRECT_PROOF);case 2:(t=this.synchronousTransaction())._putLight(e.terminalNodes);if(t._mergeProof(e.proof,e.tail.prefix)){n.next=8;break}n.next=7;return t.abort();case 7:return n.abrupt("return",PartialAccountsTree.Status.ERR_UNMERGEABLE);case 8:this._complete=t.complete;n.next=11;return t.commit();case 11:this._lastPrefix=e.tail.prefix;return n.abrupt("return",this._complete?PartialAccountsTree.Status.OK_COMPLETE:PartialAccountsTree.Status.OK_UNFINISHED);case 13:case"end":return n.stop()}},_callee166,this)}));return function pushChunk(t){return e.apply(this,arguments)}}()},{key:"_mergeProof",value:function _mergeProof(e,t){for(var n=this._store.getRootNodeSync(),r=n.getChildren(),a=!0,i=e.length-1;i>0;--i){var s=e.nodes[i];if(ne.commonPrefix(n.prefix,s.prefix)!==n.prefix)return!1;var o=s.getChildren();if(r.length>o.length)return!1;var u=n.getLastChild(),c=!1,l=0,h=!0,f=!1,d=undefined;try{for(var A,_=(0,_getIterator2["default"])(o);!(h=(A=_.next()).done);h=!0){var p=A.value;if(!(p<=t.substr(0,p.length)))break;var g=r.shift();if(ne.commonPrefix(u,p)!==p){if(g!==p)return!1;var y=n.getChildHash(g),v=s.getChildHash(g);if(!y||!v||!y.equals(v))return!1;++l}else p!==u&&(c=!0)}}catch(k){f=!0;d=k}finally{try{h||null==_["return"]||_["return"]()}finally{if(f)throw d}}if(0!==r.length)return!1;a=a&&l===o.length-1;if(c)r=[u];else{if(n.isTerminal())return!1;r=(n=this._store.getSync(n.getLastChild())).getChildren();if(n.isTerminal())break}}if(!n.equals(e.nodes[0]))return!1;this._complete=a;return!0}},{key:"_putLight",value:function _putLight(e){R.that(e.every(function(e){return e.isTerminal()}),"Can only build tree from terminal nodes");var t=this._store.getRootNodeSync();R.that(!!t,"Corrupted store: Failed to fetch AccountsTree root node");var n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(e);!(n=(i=s.next()).done);n=!0){var o=i.value;this._insertBatch(t,o.prefix,o.account,[]);t=this._store.getRootNodeSync();R.that(!!t,"Corrupted store: Failed to fetch AccountsTree root node")}}catch(u){r=!0;a=u}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}this._updateHashes(t)}},{key:"synchronousTransaction",value:function synchronousTransaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0],t=new PartialAccountsTree(this._store.synchronousTransaction(e));t._complete=this._complete;t._lastPrefix=this._lastPrefix;return t}},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if(!this.complete)throw new Error("Can only construct AccountsTree from complete PartialAccountsTree");return new Be(this._store.synchronousTransaction(e))}},{key:"commit",value:function commit(){return this._store.commit()}},{key:"abort",value:function abort(){return this._store.abort()}},{key:"complete",get:function get(){return this._complete}},{key:"missingPrefix",get:function get(){return this._lastPrefix}}]);return PartialAccountsTree}(Pe);Ne.Status={ERR_HASH_MISMATCH:-3,ERR_INCORRECT_PROOF:-2,ERR_UNMERGEABLE:-1,OK_COMPLETE:0,OK_UNFINISHED:1};n.register(Ne);var Oe=function(e){(0,_inherits2["default"])(Accounts,e);var t=_createSuper(Accounts);(0,_createClass2["default"])(Accounts,null,[{key:"getPersistent",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee167(e){var t;return _regenerator["default"].wrap(function _callee167$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return Be.getPersistent(e);case 2:t=n.sent;return n.abrupt("return",new Accounts(t));case 4:case"end":return n.stop()}},_callee167)}));return function getPersistent(t){return e.apply(this,arguments)}}()},{key:"createVolatile",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee168(){var e;return _regenerator["default"].wrap(function _callee168$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return Be.createVolatile();case 2:e=t.sent;return t.abrupt("return",new Accounts(e));case 4:case"end":return t.stop()}},_callee168)}));return function createVolatile(){return e.apply(this,arguments)}}()}]);function Accounts(e){var n;(0,_classCallCheck2["default"])(this,Accounts);(n=t.call(this))._tree=e;n.bubble(n._tree,"*");return n}(0,_createClass2["default"])(Accounts,[{key:"initialize",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee169(e,t){var n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee169$(c){for(;;)switch(c.prev=c.next){case 0:c.t0=R;c.next=3;return this._tree.isEmpty();case 3:c.t1=c.sent;c.t0.that.call(c.t0,c.t1);c.next=7;return this._tree.synchronousTransaction();case 7:n=c.sent;c.prev=8;r=M.fromBase64(t);a=r.readUint16();for(i=0;i<a;i++){s=ge.unserialize(r);o=ye.unserialize(r);n.putSync(s,o)}c.next=14;return this._commitBlockBody(n,e.body,e.height,new qe);case 14:n.finalizeBatch();c.next=22;break;case 17:c.prev=17;c.t2=c["catch"](8);c.next=21;return n.abort();case 21:throw c.t2;case 22:u=n.rootSync();if(e.accountsHash.equals(u)){c.next=27;break}c.next=26;return n.abort();case 26:throw new Error("Genesis AccountsHash mismatch");case 27:return c.abrupt("return",n.commit());case 28:case"end":return c.stop()}},_callee169,this,[[8,17]])}));return function initialize(t,n){return e.apply(this,arguments)}}()},{key:"getAccountsProof",value:function getAccountsProof(e){return this._tree.getAccountsProof(e)}},{key:"getAccountsTreeChunk",value:function getAccountsTreeChunk(e){return this._tree.getChunk(e,Ie.SIZE_MAX)}},{key:"commitBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee170(e,t){var n,r;return _regenerator["default"].wrap(function _callee170$(a){for(;;)switch(a.prev=a.next){case 0:a.next=2;return this._tree.synchronousTransaction();case 2:n=a.sent;a.next=5;return n.preloadAddresses(e.body.getAddresses());case 5:a.prev=5;this._commitBlockBody(n,e.body,e.height,t);a.next=14;break;case 9:a.prev=9;a.t0=a["catch"](5);a.next=13;return n.abort();case 13:throw a.t0;case 14:n.finalizeBatch();r=n.rootSync();if(e.accountsHash.equals(r)){a.next=20;break}a.next=19;return n.abort();case 19:throw new Error("AccountsHash mismatch");case 20:return a.abrupt("return",n.commit());case 21:case"end":return a.stop()}},_callee170,this,[[5,9]])}));return function commitBlock(t,n){return e.apply(this,arguments)}}()},{key:"commitBlockBody",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee171(e,t,n){var r;return _regenerator["default"].wrap(function _callee171$(a){for(;;)switch(a.prev=a.next){case 0:a.next=2;return this._tree.synchronousTransaction();case 2:r=a.sent;a.next=5;return r.preloadAddresses(e.getAddresses());case 5:a.prev=5;this._commitBlockBody(r,e,t,n);a.next=14;break;case 9:a.prev=9;a.t0=a["catch"](5);a.next=13;return r.abort();case 13:throw a.t0;case 14:r.finalizeBatch();return a.abrupt("return",r.commit());case 16:case"end":return a.stop()}},_callee171,this,[[5,9]])}));return function commitBlockBody(t,n,r){return e.apply(this,arguments)}}()},{key:"gatherToBePrunedAccounts",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee172(e,t,n){var r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y;return _regenerator["default"].wrap(function _callee172$(v){for(;;)switch(v.prev=v.next){case 0:v.next=2;return this._tree.synchronousTransaction();case 2:r=v.sent;a=[];i=!0;s=!1;o=undefined;v.prev=7;for(u=(0,_getIterator2["default"])(e);!(i=(c=u.next()).done);i=!0){l=c.value;a.push(l.sender,l.recipient)}v.next=15;break;case 11:v.prev=11;v.t0=v["catch"](7);s=!0;o=v.t0;case 15:v.prev=15;v.prev=16;i||null==u["return"]||u["return"]();case 18:v.prev=18;if(!s){v.next=21;break}throw o;case 21:return v.finish(18);case 22:return v.finish(15);case 23:v.next=25;return r.preloadAddresses(a);case 25:v.prev=25;this._processSenderAccounts(r,e,t,n);this._processRecipientAccounts(r,e,t);this._processContracts(r,e,t);h=new w;f=!0;d=!1;A=undefined;v.prev=33;for(_=(0,_getIterator2["default"])(e);!(f=(p=_.next()).done);f=!0){g=p.value;(y=this._getSync(g.sender,undefined,r)).isToBePruned()&&h.add(new ve(g.sender,y))}v.next=41;break;case 37:v.prev=37;v.t1=v["catch"](33);d=!0;A=v.t1;case 41:v.prev=41;v.prev=42;f||null==_["return"]||_["return"]();case 44:v.prev=44;if(!d){v.next=47;break}throw A;case 47:return v.finish(44);case 48:return v.finish(41);case 49:return v.abrupt("return",h.values().sort(function(e,t){return e.compare(t)}));case 50:v.prev=50;v.next=53;return r.abort();case 53:return v.finish(50);case 54:case"end":return v.stop()}},_callee172,this,[[7,11,15,23],[16,,18,22],[25,,50,54],[33,37,41,49],[42,,44,48]])}));return function gatherToBePrunedAccounts(t,n,r){return e.apply(this,arguments)}}()},{key:"revertBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee173(e,t){var n;return _regenerator["default"].wrap(function _callee173$(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}throw new Error("block undefined");case 2:r.next=4;return this._tree.root();case 4:n=r.sent;if(e.accountsHash.equals(n)){r.next=7;break}throw new Error("AccountsHash mismatch");case 7:return r.abrupt("return",this.revertBlockBody(e.body,e.height,t));case 8:case"end":return r.stop()}},_callee173,this)}));return function revertBlock(t,n){return e.apply(this,arguments)}}()},{key:"revertBlockBody",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee174(e,t,n){var r;return _regenerator["default"].wrap(function _callee174$(a){for(;;)switch(a.prev=a.next){case 0:a.next=2;return this._tree.synchronousTransaction();case 2:r=a.sent;a.next=5;return r.preloadAddresses(e.getAddresses());case 5:a.prev=5;this._revertBlockBody(r,e,t,n);a.next=14;break;case 9:a.prev=9;a.t0=a["catch"](5);a.next=13;return r.abort();case 13:throw a.t0;case 14:r.finalizeBatch();return a.abrupt("return",r.commit());case 16:case"end":return a.stop()}},_callee174,this,[[5,9]])}));return function revertBlockBody(t,n,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee175(e,t){var n,r,a=arguments;return _regenerator["default"].wrap(function _callee175$(i){for(;;)switch(i.prev=i.next){case 0:n=a.length>2&&a[2]!==undefined?a[2]:this._tree;i.next=3;return n.get(e);case 3:if(r=i.sent){i.next=10;break}if("undefined"!=typeof t){i.next=7;break}return i.abrupt("return",ye.INITIAL);case 7:throw new Error("Account type was given but account not present");case 10:if("undefined"==typeof t||r.type===t){i.next=12;break}throw new Error("Account type does match actual account");case 12:return i.abrupt("return",r);case 13:case"end":return i.stop()}},_callee175,this)}));return function get(t,n){return e.apply(this,arguments)}}()},{key:"_getSync",value:function _getSync(e,t,n){var r=n.getSync(e,!1);if(!r){if("undefined"==typeof t)return ye.INITIAL;throw new Error("Account type was given but account not present")}if("undefined"!=typeof t&&r.type!==t)throw new Error("Account type does match actual account");return r}},{key:"transaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee176(){var e,t=arguments;return _regenerator["default"].wrap(function _callee176$(n){for(;;)switch(n.prev=n.next){case 0:e=!(t.length>0&&t[0]!==undefined)||t[0];n.t0=Accounts;n.next=4;return this._tree.transaction(e);case 4:n.t1=n.sent;return n.abrupt("return",new n.t0(n.t1));case 6:case"end":return n.stop()}},_callee176,this)}));return function transaction(){return e.apply(this,arguments)}}()},{key:"snapshot",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee177(e){return _regenerator["default"].wrap(function _callee177$(t){for(;;)switch(t.prev=t.next){case 0:t.t0=Accounts;t.next=3;return this._tree.snapshot(e?e._tree:undefined);case 3:t.t1=t.sent;return t.abrupt("return",new t.t0(t.t1));case 5:case"end":return t.stop()}},_callee177,this)}));return function snapshot(t){return e.apply(this,arguments)}}()},{key:"partialAccountsTree",value:function partialAccountsTree(){return this._tree.partialTree()}},{key:"commit",value:function commit(){return this._tree.commit()}},{key:"abort",value:function abort(){return this._tree.abort()}},{key:"_processSenderAccounts",value:function _processSenderAccounts(e,t,n,r){var a=arguments.length>4&&arguments[4]!==undefined&&arguments[4],i=!0,s=!1,o=undefined;try{for(var u,c=(0,_getIterator2["default"])(t);!(i=(u=c.next()).done);i=!0){var l=u.value,h=this._getSync(l.sender,a?undefined:l.senderType,e);e.putBatch(l.sender,h.withOutgoingTransaction(l,n,r,a))}}catch(f){s=!0;o=f}finally{try{i||null==c["return"]||c["return"]()}finally{if(s)throw o}}}},{key:"_processRecipientAccounts",value:function _processRecipientAccounts(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined&&arguments[3],a=!0,i=!1,s=undefined;try{for(var o,u=(0,_getIterator2["default"])(t);!(a=(o=u.next()).done);a=!0){var c=o.value,l=this._getSync(c.recipient,undefined,e);e.putBatch(c.recipient,l.withIncomingTransaction(c,n,r))}}catch(h){i=!0;s=h}finally{try{a||null==u["return"]||u["return"]()}finally{if(i)throw s}}}},{key:"_processContracts",value:function _processContracts(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined&&arguments[3];r&&(t=t.slice().reverse());var a=!0,i=!1,s=undefined;try{for(var o,u=(0,_getIterator2["default"])(t);!(a=(o=u.next()).done);a=!0){var c=o.value,l=this._getSync(c.recipient,r?c.recipientType:undefined,e);e.putBatch(c.recipient,l.withContractCommand(c,n,r))}}catch(h){i=!0;s=h}finally{try{a||null==u["return"]||u["return"]()}finally{if(i)throw s}}}},{key:"_commitBlockBody",value:function _commitBlockBody(e,t,n,r){var a=this;this._processSenderAccounts(e,t.transactions,n,r);this._processRecipientAccounts(e,t.transactions,n);this._processContracts(e,t.transactions,n);var i=t.prunedAccounts.slice(),s=!0,o=!1,u=undefined;try{for(var c,l=function _loop9(){var t=c.value,n=a._getSync(t.sender,undefined,e);if(n.isToBePruned()){var r=i.findIndex(function(e){return e.address.equals(t.sender)});if(-1===r||!n.equals(i[r].account))throw new Error("Account was not pruned correctly");e.putBatch(t.sender,ye.INITIAL);i.splice(r,1)}},h=(0,_getIterator2["default"])(t.transactions);!(s=(c=h.next()).done);s=!0)l()}catch(f){o=!0;u=f}finally{try{s||null==h["return"]||h["return"]()}finally{if(o)throw u}}if(i.length>0)throw new Error("Account was invalidly pruned");this._rewardMiner(e,t,n,!1)}},{key:"_revertBlockBody",value:function _revertBlockBody(e,t,n,r){this._rewardMiner(e,t,n,!0);var a=!0,i=!1,s=undefined;try{for(var o,u=(0,_getIterator2["default"])(t.prunedAccounts);!(a=(o=u.next()).done);a=!0){var c=o.value;e.putBatch(c.address,c.account)}}catch(l){i=!0;s=l}finally{try{a||null==u["return"]||u["return"]()}finally{if(i)throw s}}this._processContracts(e,t.transactions,n,!0);this._processRecipientAccounts(e,t.transactions,n,!0);this._processSenderAccounts(e,t.transactions,n,r,!0)}},{key:"_rewardMiner",value:function _rewardMiner(e,t,n){var r=arguments.length>3&&arguments[3]!==undefined&&arguments[3],a=t.transactions.reduce(function(e,t){return e+t.fee},0),i=new Fe(ge.NULL,ye.Type.BASIC,t.minerAddr,ye.Type.BASIC,a+re.blockRewardAt(n),0,0,ze.Flag.NONE,new Uint8Array(0)),s=this._getSync(t.minerAddr,undefined,e);e.putBatch(t.minerAddr,s.withIncomingTransaction(i,n,r))}},{key:"hash",value:function hash(){return this._tree.root()}},{key:"tx",get:function get(){return this._tree.tx}}]);return Accounts}(i);n.register(Oe);var Re=function(){function BlockHeader(e,t,n,r,a,i,s,o){var u=arguments.length>8&&arguments[8]!==undefined?arguments[8]:BlockHeader.CURRENT_VERSION;(0,_classCallCheck2["default"])(this,BlockHeader);if(!Y.isUint16(u))throw new Error("Malformed version");if(!ie.isHash(e))throw new Error("Malformed prevHash");if(!ie.isHash(t))throw new Error("Malformed interlinkHash");if(!ie.isHash(n))throw new Error("Malformed bodyHash");if(!ie.isHash(r))throw new Error("Malformed accountsHash");if(!Y.isUint32(a)||!De.isValidCompact(a))throw new Error("Malformed nBits");if(!Y.isUint32(i))throw new Error("Invalid height");if(!Y.isUint32(s))throw new Error("Malformed timestamp");if(!Y.isUint32(o))throw new Error("Malformed nonce");this._version=u;this._prevHash=e;this._interlinkHash=t;this._bodyHash=n;this._accountsHash=r;this._nBits=a;this._height=i;this._timestamp=s;this._nonce=o}(0,_createClass2["default"])(BlockHeader,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint16(this._version);this._prevHash.serialize(e);this._interlinkHash.serialize(e);this._bodyHash.serialize(e);this._accountsHash.serialize(e);e.writeUint32(this._nBits);e.writeUint32(this._height);e.writeUint32(this._timestamp);e.writeUint32(this._nonce);return e}},{key:"verifyProofOfWork",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee178(e){var t;return _regenerator["default"].wrap(function _callee178$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this.pow(e);case 2:t=n.sent;return n.abrupt("return",De.isProofOfWork(t,this.target));case 4:case"end":return n.stop()}},_callee178,this)}));return function verifyProofOfWork(t){return e.apply(this,arguments)}}()},{key:"isImmediateSuccessorOf",value:function isImmediateSuccessorOf(e){if(this.height!==e.height+1)return!1;if(this.timestamp<e.timestamp)return!1;var t=e.hash();return!!this.prevHash.equals(t)}},{key:"hash",value:function hash(e){this._hash=this._hash||ie.light(this.serialize(e));return this._hash}},{key:"pow",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee179(e){return _regenerator["default"].wrap(function _callee179$(t){for(;;)switch(t.prev=t.next){case 0:t.t0=this._pow;if(t.t0){t.next=5;break}t.next=4;return ie.hard(this.serialize(e));case 4:t.t0=t.sent;case 5:this._pow=t.t0;return t.abrupt("return",this._pow);case 7:case"end":return t.stop()}},_callee179,this)}));return function pow(t){return e.apply(this,arguments)}}()},{key:"equals",value:function equals(e){return e instanceof BlockHeader&&this._prevHash.equals(e.prevHash)&&this._interlinkHash.equals(e.interlinkHash)&&this._bodyHash.equals(e.bodyHash)&&this._accountsHash.equals(e.accountsHash)&&this._nBits===e.nBits&&this._height===e.height&&this._timestamp===e.timestamp&&this._nonce===e.nonce}},{key:"toString",value:function toString(){return"BlockHeader{"+"prevHash=".concat(this._prevHash,", ")+"interlinkHash=".concat(this._interlinkHash,", ")+"bodyHash=".concat(this._bodyHash,", ")+"accountsHash=".concat(this._accountsHash,", ")+"nBits=".concat(this._nBits.toString(16),", ")+"height=".concat(this._height,", ")+"timestamp=".concat(this._timestamp,", ")+"nonce=".concat(this._nonce)+"}"}},{key:"serializedSize",get:function get(){return 2+this._prevHash.serializedSize+this._interlinkHash.serializedSize+this._bodyHash.serializedSize+this._accountsHash.serializedSize+4+4+4+4}},{key:"version",get:function get(){return this._version}},{key:"prevHash",get:function get(){return this._prevHash}},{key:"interlinkHash",get:function get(){return this._interlinkHash}},{key:"bodyHash",get:function get(){return this._bodyHash}},{key:"accountsHash",get:function get(){return this._accountsHash}},{key:"nBits",get:function get(){return this._nBits}},{key:"target",get:function get(){return De.compactToTarget(this._nBits)}},{key:"difficulty",get:function get(){return De.compactToDifficulty(this._nBits)}},{key:"height",get:function get(){return this._height}},{key:"timestamp",get:function get(){return this._timestamp}},{key:"nonce",get:function get(){return this._nonce},set:function set(e){this._nonce=e;this._hash=null;this._pow=null}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint16();if(!BlockHeader.SUPPORTED_VERSIONS.includes(t))throw new Error("Unsupported block version ".concat(t));return new BlockHeader(ie.unserialize(e),ie.unserialize(e),ie.unserialize(e),ie.unserialize(e),e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32(),t)}}]);return BlockHeader}();Re.Version={V1:1};Re.CURRENT_VERSION=Re.Version.V1;Re.SUPPORTED_VERSIONS=[Re.Version.V1];Re.SERIALIZED_SIZE=146;n.register(Re);var Me=function(){(0,_createClass2["default"])(BlockInterlink,null,[{key:"_compress",value:function _compress(e,t){for(var n=e.length,r=Math.ceil(n/8),a=new Uint8Array(r),i=t,s=[],o=0;o<n;o++){var u=e[o];if(u.equals(i))a[Math.floor(o/8)]|=128>>>o%8;else{s.push(u);i=u}}return{repeatBits:a,compressed:s}}}]);function BlockInterlink(e,t,n,r){(0,_classCallCheck2["default"])(this,BlockInterlink);if(!(0,_isArray["default"])(e)||!Y.isUint8(e.length)||e.some(function(e){return!(e instanceof ie)}))throw new Error("Malformed hashes");if((n||r)&&(!n||!r))throw new Error("Malformed repeatBits/compressed");if(!t&&!n)throw new Error("Either prevHash or repeatBits/compressed required");if(!n){var a=BlockInterlink._compress(e,t);n=a.repeatBits;r=a.compressed}this._hashes=e;this._repeatBits=n;this._compressed=r}(0,_createClass2["default"])(BlockInterlink,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint8(this._hashes.length);e.write(this._repeatBits);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._compressed);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"equals",value:function equals(e){return e instanceof BlockInterlink&&this._hashes.length===e._hashes.length&&this._hashes.every(function(t,n){return t.equals(e.hashes[n])})}},{key:"hash",value:function hash(){this._hash||(this._hash=X.computeRoot([this._repeatBits,qn.GENESIS_HASH].concat((0,_toConsumableArray2["default"])(this._compressed))));return this._hash}},{key:"serializedSize",get:function get(){return 1+this._repeatBits.length+this._compressed.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"hashes",get:function get(){return this._hashes}},{key:"length",get:function get(){return this._hashes.length}}],[{key:"unserialize",value:function unserialize(e,t){for(var n=e.readUint8(),r=Math.ceil(n/8),a=e.read(r),i=t,s=[],o=[],u=0;u<n;u++){if(!(0!=(a[Math.floor(u/8)]&128>>>u%8))){i=ie.unserialize(e);o.push(i)}s.push(i)}return new BlockInterlink(s,t,a,o)}}]);return BlockInterlink}();n.register(Me);var Le=function(){(0,_createClass2["default"])(BlockBody,null,[{key:"getMetadataSize",value:function getMetadataSize(e){return ge.SERIALIZED_SIZE+1+e.byteLength+2+2}}]);function BlockBody(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Uint8Array(0),r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];(0,_classCallCheck2["default"])(this,BlockBody);if(!(e instanceof ge))throw new Error("Malformed minerAddr");if(!(0,_isArray["default"])(t)||t.some(function(e){return!(e instanceof ze)}))throw new Error("Malformed transactions");if(!(n instanceof Uint8Array&&Y.isUint8(n.byteLength)))throw new Error("Malformed extraData");this._minerAddr=e;this._extraData=n;this._transactions=t;this._prunedAccounts=r;this._hash=null}(0,_createClass2["default"])(BlockBody,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this._minerAddr.serialize(e);e.writeUint8(this._extraData.byteLength);e.write(this._extraData);e.writeUint16(this._transactions.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._transactions);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(h){n=!0;r=h}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}e.writeUint16(this._prunedAccounts.length);var s=!0,o=!1,u=undefined;try{for(var c,l=(0,_getIterator2["default"])(this._prunedAccounts);!(s=(c=l.next()).done);s=!0){c.value.serialize(e)}}catch(h){o=!0;u=h}finally{try{s||null==l["return"]||l["return"]()}finally{if(o)throw u}}return e}},{key:"verify",value:function verify(){var e=null,t=!0,n=!1,r=undefined;try{for(var i,s=(0,_getIterator2["default"])(this._transactions);!(t=(i=s.next()).done);t=!0){var o=i.value;if(e&&e.compareBlockOrder(o)>=0){a.w(BlockBody,"Invalid block - transactions not ordered.");return!1}e=o;if(!o.verify()){a.w(BlockBody,"Invalid block - invalid transaction");return!1}}}catch(_){n=!0;r=_}finally{try{t||null==s["return"]||s["return"]()}finally{if(n)throw r}}var u=null,c=!0,l=!1,h=undefined;try{for(var f,d=(0,_getIterator2["default"])(this._prunedAccounts);!(c=(f=d.next()).done);c=!0){var A=f.value;if(u&&u.compare(A)>=0){a.w(BlockBody,"Invalid block - pruned accounts not ordered.");return!1}u=A;if(!A.account.isToBePruned()){a.w(BlockBody,"Invalid block - invalid pruned account");return!1}}}catch(_){l=!0;h=_}finally{try{c||null==d["return"]||d["return"]()}finally{if(l)throw h}}return!0}},{key:"getMerkleLeafs",value:function getMerkleLeafs(){return[this._minerAddr,this._extraData].concat((0,_toConsumableArray2["default"])(this._transactions),(0,_toConsumableArray2["default"])(this.prunedAccounts))}},{key:"hash",value:function hash(){this._hash||(this._hash=X.computeRoot(this.getMerkleLeafs()));return this._hash}},{key:"equals",value:function equals(e){return e instanceof BlockBody&&this._minerAddr.equals(e.minerAddr)&&M.equals(this._extraData,e.extraData)&&this._transactions.length===e.transactions.length&&this._transactions.every(function(t,n){return t.equals(e.transactions[n])})}},{key:"getAddresses",value:function getAddresses(){var e=[this._minerAddr],t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._transactions);!(t=(a=i.next()).done);t=!0){var s=a.value;e.push(s.sender,s.recipient)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"serializedSize",get:function get(){var e=this._minerAddr.serializedSize+1+this._extraData.byteLength+2+2,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._transactions);!(t=(a=i.next()).done);t=!0){e+=a.value.serializedSize}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e+=this._prunedAccounts.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"extraData",get:function get(){return this._extraData}},{key:"minerAddr",get:function get(){return this._minerAddr}},{key:"transactions",get:function get(){return this._transactions}},{key:"transactionCount",get:function get(){return this._transactions.length}},{key:"prunedAccounts",get:function get(){return this._prunedAccounts}}],[{key:"unserialize",value:function unserialize(e){for(var t=ge.unserialize(e),n=e.readUint8(),r=e.read(n),a=e.readUint16(),i=new Array(a),s=0;s<a;s++)i[s]=ze.unserialize(e);for(var o=e.readUint16(),u=[],c=0;c<o;c++)u.push(ve.unserialize(e));return new BlockBody(t,i,r,u)}}]);return BlockBody}();n.register(Le);var De=function(){function BlockUtils(){(0,_classCallCheck2["default"])(this,BlockUtils)}(0,_createClass2["default"])(BlockUtils,null,[{key:"compactToTarget",value:function compactToTarget(e){return new J(16777215&e).times(new J(2).pow(8*Math.max((e>>24)-3,0)))}},{key:"targetToCompact",value:function targetToCompact(e){if(!e.isFinite()||e.isNaN())throw new Error("Invalid Target");var t=Math.max(Math.ceil(Math.log2(e.toNumber())/8),1);e/Math.pow(2,8*(t-1))>=128&&t>=3&&t++;return(t<<24)+(e/Math.pow(2,8*Math.max(t-3,0))&16777215)}},{key:"getTargetHeight",value:function getTargetHeight(e){return Math.ceil(Math.log2(e.toNumber()))}},{key:"getTargetDepth",value:function getTargetDepth(e){return BlockUtils.getTargetHeight(re.BLOCK_TARGET_MAX)-BlockUtils.getTargetHeight(e)}},{key:"compactToDifficulty",value:function compactToDifficulty(e){return re.BLOCK_TARGET_MAX.div(BlockUtils.compactToTarget(e))}},{key:"difficultyToCompact",value:function difficultyToCompact(e){return BlockUtils.targetToCompact(BlockUtils.difficultyToTarget(e))}},{key:"difficultyToTarget",value:function difficultyToTarget(e){return re.BLOCK_TARGET_MAX.div(e)}},{key:"targetToDifficulty",value:function targetToDifficulty(e){return re.BLOCK_TARGET_MAX.div(e)}},{key:"hashToTarget",value:function hashToTarget(e){return new J(e.toHex(),16)}},{key:"realDifficulty",value:function realDifficulty(e){return BlockUtils.targetToDifficulty(BlockUtils.hashToTarget(e))}},{key:"getHashDepth",value:function getHashDepth(e){return BlockUtils.getTargetDepth(BlockUtils.hashToTarget(e))}},{key:"isProofOfWork",value:function isProofOfWork(e,t){return new J(e.toHex(),16).lte(t)}},{key:"isValidCompact",value:function isValidCompact(e){return BlockUtils.isValidTarget(BlockUtils.compactToTarget(e))}},{key:"isValidTarget",value:function isValidTarget(e){return null!==e&&e.gte(1)&&e.lte(re.BLOCK_TARGET_MAX)}},{key:"getNextTarget",value:function getNextTarget(e,t,n){R.that(e.height-t.height===re.DIFFICULTY_BLOCK_WINDOW||e.height<=re.DIFFICULTY_BLOCK_WINDOW&&1===t.height,"Tail and head block must be ".concat(re.DIFFICULTY_BLOCK_WINDOW," blocks apart"));var r=e.timestamp-t.timestamp;if(e.height<=re.DIFFICULTY_BLOCK_WINDOW){r+=(re.DIFFICULTY_BLOCK_WINDOW-e.height+1)*re.BLOCK_TIME;n=n.plus(re.DIFFICULTY_BLOCK_WINDOW-e.height+1)}var a=r/(re.DIFFICULTY_BLOCK_WINDOW*re.BLOCK_TIME);a=Math.max(a,1/re.DIFFICULTY_MAX_ADJUSTMENT_FACTOR);a=Math.min(a,re.DIFFICULTY_MAX_ADJUSTMENT_FACTOR);var i=n.div(re.DIFFICULTY_BLOCK_WINDOW),s=BlockUtils.difficultyToTarget(i).times(a);s=J.min(s,re.BLOCK_TARGET_MAX);s=J.max(s,1);var o=BlockUtils.targetToCompact(s);return BlockUtils.compactToTarget(o)}}]);return BlockUtils}();n.register(De);var Ue=function(){(0,_createClass2["default"])(Subscription,null,[{key:"fromAddresses",value:function fromAddresses(e){return new Subscription(Subscription.Type.ADDRESSES,e)}},{key:"fromMinFeePerByte",value:function fromMinFeePerByte(e){return new Subscription(Subscription.Type.MIN_FEE,e)}}]);function Subscription(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;(0,_classCallCheck2["default"])(this,Subscription);if(!Y.isUint8(e))throw new Error("Invalid type");if(e===Subscription.Type.ADDRESSES&&(!(0,_isArray["default"])(t)||!Y.isUint16(t.length)||t.some(function(e){return!(e instanceof ge)})))throw new Error("Invalid addresses");if(e===Subscription.Type.MIN_FEE&&!Y.isUint64(t))throw new Error("Invalid minFeePerByte");this._type=e;this._addresses=new w;this._minFeePerByte=0;switch(e){case Subscription.Type.ADDRESSES:this._addresses.addAll(t);break;case Subscription.Type.MIN_FEE:this._minFeePerByte=t}}(0,_createClass2["default"])(Subscription,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint8(this._type);switch(this._type){case Subscription.Type.ADDRESSES:e.writeUint16(this._addresses.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._addresses);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}break;case Subscription.Type.MIN_FEE:e.writeUint64(this._minFeePerByte)}return e}},{key:"matchesBlock",value:function matchesBlock(e){switch(this._type){case Subscription.Type.NONE:return!1;case Subscription.Type.ANY:case Subscription.Type.ADDRESSES:case Subscription.Type.MIN_FEE:return!0;default:throw new Error("Unknown type")}}},{key:"matchesTransaction",value:function matchesTransaction(e){switch(this._type){case Subscription.Type.NONE:return!1;case Subscription.Type.ANY:return!0;case Subscription.Type.ADDRESSES:return this._addresses.contains(e.recipient)||this._addresses.contains(e.sender);case Subscription.Type.MIN_FEE:return e.fee/e.serializedSize>=this._minFeePerByte;default:throw new Error("Unknown type")}}},{key:"isSubsetOf",value:function isSubsetOf(e){if(e.type===Subscription.Type.ANY||this.type===Subscription.Type.NONE)return!0;if(e.type!==this.type)return!1;switch(this.type){case Subscription.Type.ADDRESSES:return this.addresses.reduce(function(t,n){return t&&e.addresses.find(function(e){return e.equals(n)})},!0);case Subscription.Type.MIN_FEE:return this.minFeePerByte>e.minFeePerByte}return!1}},{key:"toString",value:function toString(){return"Subscription{type=".concat(this._type,", addresses=[").concat(this._addresses.values(),"], minFeePerByte=").concat(this._minFeePerByte,"}")}},{key:"serializedSize",get:function get(){var e=0;switch(this._type){case Subscription.Type.ADDRESSES:e=2;var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._addresses);!(t=(a=i.next()).done);t=!0){e+=a.value.serializedSize}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}break;case Subscription.Type.MIN_FEE:e=8}return 1+e}},{key:"type",get:function get(){return this._type}},{key:"addresses",get:function get(){return this._addresses.values()}},{key:"minFeePerByte",get:function get(){return this._minFeePerByte}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint8(),n=null;switch(t){case Subscription.Type.ADDRESSES:n=[];for(var r=e.readUint16(),a=0;a<r;++a)n.push(ge.unserialize(e));break;case Subscription.Type.MIN_FEE:n=e.readUint64()}return new Subscription(t,n)}}]);return Subscription}();Ue.Type={NONE:0,ANY:1,ADDRESSES:2,MIN_FEE:3};Ue.NONE=new Ue(Ue.Type.NONE);Ue.BLOCKS_ONLY=new Ue(Ue.Type.ADDRESSES,[]);Ue.ANY=new Ue(Ue.Type.ANY);n.register(Ue);var ze=function(){function Transaction(e,t,n,r,a,i,s,o,u,c,l){var h=arguments.length>11&&arguments[11]!==undefined?arguments[11]:qn.NETWORK_ID;(0,_classCallCheck2["default"])(this,Transaction);if(!(t instanceof ge))throw new Error("Malformed sender");if(!Y.isUint8(n))throw new Error("Malformed sender type");if(!(r instanceof ge))throw new Error("Malformed recipient");if(!Y.isUint8(a))throw new Error("Malformed recipient type");if(!Y.isUint64(i)||0===i)throw new Error("Malformed value");if(!Y.isUint64(s))throw new Error("Malformed fee");if(!Y.isUint32(o))throw new Error("Malformed validityStartHeight");if(!Y.isUint8(u)&&(u&~Transaction.Flag.ALL)>0)throw new Error("Malformed flags");if(!(c instanceof Uint8Array&&Y.isUint16(c.byteLength)))throw new Error("Malformed data");if(l&&(!(l instanceof Uint8Array)||!Y.isUint16(l.byteLength)))throw new Error("Malformed proof");if(!Y.isUint8(h))throw new Error("Malformed networkId");this._format=e;this._sender=t;this._senderType=n;this._recipient=r;this._recipientType=a;this._value=i;this._fee=s;this._networkId=h;this._validityStartHeight=o;this._flags=u;this._data=c;this._proof=l;this._recipient===ge.CONTRACT_CREATION&&(this._recipient=this.getContractCreationAddress())}(0,_createClass2["default"])(Transaction,[{key:"serializeContent",value:function serializeContent(e){(e=e||new U(this.serializedContentSize)).writeUint16(this._data.byteLength);e.write(this._data);this._sender.serialize(e);e.writeUint8(this._senderType);this._recipient.serialize(e);e.writeUint8(this._recipientType);e.writeUint64(this._value);e.writeUint64(this._fee);e.writeUint32(this._validityStartHeight);e.writeUint8(this._networkId);e.writeUint8(this._flags);return e}},{key:"verify",value:function verify(e){this._valid===undefined&&(this._valid=this._verify(e));return this._valid}},{key:"_verify",value:function _verify(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:qn.NETWORK_ID;if(this._networkId!==e){a.w(Transaction,"Transaction is not valid in this network",this);return!1}if(this._recipient.equals(this._sender)){a.w(Transaction,"Sender and recipient must not match",this);return!1}if(!ye.TYPE_MAP.has(this._senderType)||!ye.TYPE_MAP.has(this._recipientType)){a.w(Transaction,"Invalid account type",this);return!1}if(!ye.TYPE_MAP.get(this._senderType).verifyOutgoingTransaction(this)){a.w(Transaction,"Invalid for sender",this);return!1}if(!ye.TYPE_MAP.get(this._recipientType).verifyIncomingTransaction(this)){a.w(Transaction,"Invalid for recipient",this);return!1}return!0}},{key:"serialize",value:function serialize(e){throw new Error("Method needs to be overwritten by subclasses")}},{key:"hash",value:function hash(){this._hash=this._hash||ie.light(this.serializeContent());return this._hash}},{key:"compare",value:function compare(e){return this.fee/this.serializedSize>e.fee/e.serializedSize?-1:this.fee/this.serializedSize<e.fee/e.serializedSize?1:this.serializedSize>e.serializedSize?-1:this.serializedSize<e.serializedSize?1:this.fee>e.fee?-1:this.fee<e.fee?1:this.value>e.value?-1:this.value<e.value?1:this.compareBlockOrder(e)}},{key:"compareBlockOrder",value:function compareBlockOrder(e){var t=this._recipient.compare(e._recipient);if(0!==t)return t;if(this._validityStartHeight<e._validityStartHeight)return-1;if(this._validityStartHeight>e._validityStartHeight)return 1;if(this._fee>e._fee)return-1;if(this._fee<e._fee)return 1;if(this._value>e._value)return-1;if(this._value<e._value)return 1;var n=this._sender.compare(e._sender);return 0!==n?n:this._recipientType<e._recipientType?-1:this._recipientType>e._recipientType?1:this._senderType<e._senderType?-1:this._senderType>e._senderType?1:this._flags<e._flags?-1:this._flags>e._flags?1:M.compare(this._data,e._data)}},{key:"equals",value:function equals(e){return e instanceof Transaction&&this._sender.equals(e._sender)&&this._senderType===e._senderType&&this._recipient.equals(e._recipient)&&this._recipientType===e._recipientType&&this._value===e._value&&this._fee===e._fee&&this._validityStartHeight===e._validityStartHeight&&this._networkId===e._networkId&&this._flags===e._flags&&M.equals(this._data,e._data)}},{key:"toString",value:function toString(){return"Transaction{"+"sender=".concat(this._sender.toBase64(),", ")+"recipient=".concat(this._recipient.toBase64(),", ")+"value=".concat(this._value,", ")+"fee=".concat(this._fee,", ")+"validityStartHeight=".concat(this._validityStartHeight,", ")+"networkId=".concat(this._networkId)+"}"}},{key:"toPlain",value:function toPlain(){var e=ye.TYPE_MAP.get(this.recipientType).dataToPlain(this.data);e.raw=M.toHex(this.data);var t=ye.TYPE_MAP.get(this.senderType).proofToPlain(this.proof);t.raw=M.toHex(this.proof);return{transactionHash:this.hash().toPlain(),format:Transaction.Format.toString(this._format),sender:this.sender.toPlain(),senderType:ye.Type.toString(this.senderType),recipient:this.recipient.toPlain(),recipientType:ye.Type.toString(this.recipientType),value:this.value,fee:this.fee,feePerByte:this.feePerByte,validityStartHeight:this.validityStartHeight,network:qn.networkIdToNetworkName(this.networkId),flags:this.flags,data:e,proof:t,size:this.serializedSize,valid:this.verify()}}},{key:"getContractCreationAddress",value:function getContractCreationAddress(){var e=Transaction.unserialize(this.serialize());e._recipient=ge.NULL;e._hash=null;return ge.fromHash(e.hash())}},{key:"hasFlag",value:function hasFlag(e){return(this._flags&e)>0}},{key:"serializedContentSize",get:function get(){return 2+this._data.byteLength+this._sender.serializedSize+1+this._recipient.serializedSize+1+8+8+4+1+1}},{key:"serializedSize",get:function get(){throw new Error("Getter needs to be overwritten by subclasses")}},{key:"format",get:function get(){return this._format}},{key:"sender",get:function get(){return this._sender}},{key:"senderType",get:function get(){return this._senderType}},{key:"recipient",get:function get(){return this._recipient}},{key:"recipientType",get:function get(){return this._recipientType}},{key:"value",get:function get(){return this._value}},{key:"fee",get:function get(){return this._fee}},{key:"feePerByte",get:function get(){return this._fee/this.serializedSize}},{key:"networkId",get:function get(){return this._networkId}},{key:"validityStartHeight",get:function get(){return this._validityStartHeight}},{key:"flags",get:function get(){return this._flags}},{key:"data",get:function get(){return this._data}},{key:"proof",get:function get(){return this._proof},set:function set(e){this._proof=e}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint8();e.readPos--;if(!Transaction.FORMAT_MAP.has(t))throw new Error("Invalid transaction type");return Transaction.FORMAT_MAP.get(t).unserialize(e)}},{key:"fromPlain",value:function fromPlain(e){if(!e)throw new Error("Invalid transaction format");var t=Transaction.Format.fromAny(e.format);if(!Transaction.FORMAT_MAP.has(t))throw new Error("Invalid transaction type");return Transaction.FORMAT_MAP.get(t).fromPlain(e)}},{key:"fromAny",value:function fromAny(e){if(e instanceof Transaction)return e;if("object"===(0,_typeof2["default"])(e))return Transaction.fromPlain(e);if("string"==typeof e)return Transaction.unserialize(new U(M.fromHex(e)));throw new Error("Invalid transaction format")}}]);return Transaction}();ze.Format={BASIC:0,EXTENDED:1};ze.Format.toString=function(e){switch(e){case ze.Format.BASIC:return"basic";case ze.Format.EXTENDED:return"extended"}throw new Error("Invalid transaction format")};ze.Format.fromAny=function(e){if("number"==typeof e)return e;switch(e){case"basic":return ze.Format.BASIC;case"extended":return ze.Format.EXTENDED}throw new Error("Invalid transaction format")};ze.Flag={NONE:0,CONTRACT_CREATION:1,ALL:1};ze.FORMAT_MAP=new _map2["default"];n.register(ze);var He=function(){(0,_createClass2["default"])(SignatureProof,null,[{key:"verifyTransaction",value:function verifyTransaction(e){try{var t=new U(e.proof),n=SignatureProof.unserialize(t);if(t.readPos!==t.byteLength){a.w(SignatureProof,"Invalid SignatureProof - overlong");return!1}return n.verify(e.sender,e.serializeContent())}catch(r){a.w(SignatureProof,"Failed to verify transaction: ".concat(r.message||r));return!1}}},{key:"singleSig",value:function singleSig(e,t){return new SignatureProof(e,new Z([]),t)}},{key:"multiSig",value:function multiSig(e,t,n){return new SignatureProof(e,Z.compute(t,e),n)}}]);function SignatureProof(e,t,n){(0,_classCallCheck2["default"])(this,SignatureProof);if(!(e instanceof ue))throw new Error("Malformed publickKey");if(!(t instanceof Z))throw new Error("Malformed merklePath");if(n&&!(n instanceof de))throw new Error("Malformed signature");this._publicKey=e;this._merklePath=t;this._signature=n}(0,_createClass2["default"])(SignatureProof,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this._publicKey.serialize(e);this._merklePath.serialize(e);this._signature&&this._signature.serialize(e);return e}},{key:"equals",value:function equals(e){return e instanceof SignatureProof&&this._publicKey.equals(e._publicKey)&&this._merklePath.equals(e._merklePath)&&(this._signature?this._signature.equals(e._signature):this._signature===e._signature)}},{key:"verify",value:function verify(e,t){if(null!==e&&!this.isSignedBy(e)){a.w(SignatureProof,"Invalid SignatureProof - signer does not match sender address");return!1}if(!this._signature){a.w(SignatureProof,"Invalid SignatureProof - signature is missing");return!1}if(!this._signature.verify(this._publicKey,t)){a.w(SignatureProof,"Invalid SignatureProof - signature is invalid");return!1}return!0}},{key:"isSignedBy",value:function isSignedBy(e){var t=this._merklePath.computeRoot(this._publicKey);return ge.fromHash(t).equals(e)}},{key:"serializedSize",get:function get(){return this._publicKey.serializedSize+this._merklePath.serializedSize+(this._signature?this._signature.serializedSize:0)}},{key:"publicKey",get:function get(){return this._publicKey}},{key:"merklePath",get:function get(){return this._merklePath}},{key:"signature",get:function get(){return this._signature},set:function set(e){this._signature=e}}],[{key:"unserialize",value:function unserialize(e){return new SignatureProof(ue.unserialize(e),Z.unserialize(e),de.unserialize(e))}},{key:"SINGLE_SIG_SIZE",get:function get(){return ue.SIZE+new Z([]).serializedSize+de.SIZE}}]);return SignatureProof}();n.register(He);var Ge=function(e){(0,_inherits2["default"])(BasicTransaction,e);var t=_createSuper(BasicTransaction);function BasicTransaction(e,n,r,a,i,s,o){var u;(0,_classCallCheck2["default"])(this,BasicTransaction);if(!(e instanceof ue))throw new Error("Malformed senderPubKey");if(s!==undefined&&!(s instanceof de))throw new Error("Malformed signature");var c=He.singleSig(e,s);(u=t.call(this,ze.Format.BASIC,e.toAddress(),ye.Type.BASIC,n,ye.Type.BASIC,r,a,i,ze.Flag.NONE,new Uint8Array(0),c.serialize(),o))._signatureProof=c;return u}(0,_createClass2["default"])(BasicTransaction,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint8(ze.Format.BASIC);this.senderPubKey.serialize(e);this._recipient.serialize(e);e.writeUint64(this._value);e.writeUint64(this._fee);e.writeUint32(this._validityStartHeight);e.writeUint8(this._networkId);this.signature.serialize(e);return e}},{key:"serializedSize",get:function get(){return 1+this.senderPubKey.serializedSize+this._recipient.serializedSize+8+8+4+1+this.signature.serializedSize}},{key:"senderPubKey",get:function get(){return this._signatureProof.publicKey}},{key:"signature",get:function get(){return this._signatureProof.signature},set:function set(e){this._signatureProof.signature=e;this._proof=this._signatureProof.serialize()}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint8();R.that(t===ze.Format.BASIC);var n=ue.unserialize(e),r=ge.unserialize(e),a=e.readUint64(),i=e.readUint64(),s=e.readUint32(),o=e.readUint8();return new BasicTransaction(n,r,a,i,s,de.unserialize(e),o)}},{key:"fromPlain",value:function fromPlain(e){if(!e)throw new Error("Invalid transaction format");return new BasicTransaction(ue.fromAny(e.proof.publicKey||e.senderPubKey),ge.fromAny(e.recipient),e.value,e.fee,e.validityStartHeight,de.fromAny(e.proof.signature||e.signature),qn.networkIdFromAny(e.network||e.networkId))}}]);return BasicTransaction}(ze);ze.FORMAT_MAP.set(ze.Format.BASIC,Ge);n.register(Ge);var Fe=function(e){(0,_inherits2["default"])(ExtendedTransaction,e);var t=_createSuper(ExtendedTransaction);function ExtendedTransaction(e,n,r,a,i,s,o,u,c){var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:new Uint8Array(0),h=arguments.length>10?arguments[10]:undefined;(0,_classCallCheck2["default"])(this,ExtendedTransaction);return t.call(this,ze.Format.EXTENDED,e,n,r,a,i,s,o,u,c,l,h)}(0,_createClass2["default"])(ExtendedTransaction,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint8(ze.Format.EXTENDED);this.serializeContent(e);e.writeUint16(this._proof.byteLength);e.write(this._proof);return e}},{key:"serializedSize",get:function get(){return 1+this.serializedContentSize+2+this._proof.byteLength}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint8();R.that(t===ze.Format.EXTENDED);var n=e.readUint16(),r=e.read(n),a=ge.unserialize(e),i=e.readUint8(),s=ge.unserialize(e),o=e.readUint8(),u=e.readUint64(),c=e.readUint64(),l=e.readUint32(),h=e.readUint8(),f=e.readUint8(),d=e.readUint16();return new ExtendedTransaction(a,i,s,o,u,c,l,f,r,e.read(d),h)}},{key:"fromPlain",value:function fromPlain(e){if(!e)throw new Error("Invalid transaction format");return new ExtendedTransaction(ge.fromAny(e.sender),ye.Type.fromAny(e.senderType),ge.fromAny(e.recipient),ye.Type.fromAny(e.recipientType),e.value,e.fee,e.validityStartHeight,e.flags,M.fromAny(e.data.raw===undefined?e.data:e.data.raw),M.fromAny(e.proof.raw===undefined?e.proof:e.proof.raw),qn.networkIdFromAny(e.network||e.networkId))}}]);return ExtendedTransaction}(ze);ze.FORMAT_MAP.set(ze.Format.EXTENDED,Fe);n.register(Fe);var Ke=function(){function TransactionsProof(e,t){(0,_classCallCheck2["default"])(this,TransactionsProof);if(!(0,_isArray["default"])(e)||!Y.isUint16(e.length)||e.some(function(e){return!(e instanceof ze)}))throw new Error("Malformed transactions");if(!(t instanceof ee))throw new Error("Malformed merkle proof");this._transactions=e;this._proof=t}(0,_createClass2["default"])(TransactionsProof,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint16(this._transactions.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._transactions);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}this._proof.serialize(e);return e}},{key:"toString",value:function toString(){return"TransactionsProof{length=".concat(this.length,"}")}},{key:"root",value:function root(){return this._proof.computeRoot(this._transactions)}},{key:"serializedSize",get:function get(){return 2+this._transactions.reduce(function(e,t){return e+t.serializedSize},0)+this._proof.serializedSize}},{key:"length",get:function get(){return this._transactions.length}},{key:"transactions",get:function get(){return this._transactions}},{key:"proof",get:function get(){return this._proof}}],[{key:"unserialize",value:function unserialize(e){for(var t=e.readUint16(),n=[],r=0;r<t;++r)n.push(ze.unserialize(e));return new TransactionsProof(n,ee.unserialize(e))}}]);return TransactionsProof}();n.register(Ke);var qe=function(){function TransactionCache(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];(0,_classCallCheck2["default"])(this,TransactionCache);this._transactionHashes=e||new S(function(e){return e.toBase64()});this._blockOrder=t}(0,_createClass2["default"])(TransactionCache,[{key:"containsTransaction",value:function containsTransaction(e){return this._transactionHashes.contains(e.hash())}},{key:"pushBlock",value:function pushBlock(e){R.that(!this.head||e.prevHash.equals(this.head.hash),"Not a successor of head");var t=TransactionCache._getBlockDescriptor(e);this._blockOrder.push(t);this._transactionHashes.addAll(t.transactionHashes);this._blockOrder.length>re.TRANSACTION_VALIDITY_WINDOW&&this.shiftBlock()}},{key:"shiftBlock",value:function shiftBlock(){var e=this._blockOrder.shift();e&&this._transactionHashes.removeAll(e.transactionHashes)}},{key:"revertBlock",value:function revertBlock(e){var t=this._blockOrder.pop();if(t){R.that(t.hash.equals(e.hash()),"Invalid block to revert");this._transactionHashes.removeAll(t.transactionHashes)}return this.missingBlocks}},{key:"prependBlocks",value:function prependBlocks(e){var t,n=this;if(e.length+this._blockOrder.length>re.TRANSACTION_VALIDITY_WINDOW)throw new Error("Exceeding transaction cache size");R.that(!this.tail||0===e.length||this.tail.prevHash.equals(e[e.length-1].hash()),"Not a predecessor of tail");var r=e.map(function(e){return TransactionCache._getBlockDescriptor(e)});(t=this._blockOrder).unshift.apply(t,(0,_toConsumableArray2["default"])(r));r.forEach(function(e){return n._transactionHashes.addAll(e.transactionHashes)})}},{key:"clone",value:function clone(){return new TransactionCache(this._transactionHashes.clone(),this._blockOrder.slice())}},{key:"isEmpty",value:function isEmpty(){return 0===this._blockOrder.length}},{key:"missingBlocks",get:function get(){return re.TRANSACTION_VALIDITY_WINDOW-this._blockOrder.length}},{key:"transactions",get:function get(){return this._transactionHashes}},{key:"head",get:function get(){return 0===this._blockOrder.length?null:this._blockOrder[this._blockOrder.length-1]}},{key:"tail",get:function get(){return 0===this._blockOrder.length?null:this._blockOrder[0]}}],[{key:"_getBlockDescriptor",value:function _getBlockDescriptor(e){return{hash:e.hash(),prevHash:e.prevHash,transactionHashes:e.transactions.map(function(e){return e.hash()})}}}]);return TransactionCache}();n.register(qe);var We=function(){function TransactionStoreEntry(e,t,n,r,a,i){(0,_classCallCheck2["default"])(this,TransactionStoreEntry);this._transactionHash=e;this._sender=t;this._recipient=n;this._blockHeight=r;this._blockHash=a;this._index=i;this.senderBuffer=this._sender.serialize();this.recipientBuffer=this._recipient.serialize();this.transactionHashBuffer=this._transactionHash.serialize()}(0,_createClass2["default"])(TransactionStoreEntry,[{key:"toJSON",value:function toJSON(){return{transactionHashBuffer:this.transactionHashBuffer,senderBuffer:this.senderBuffer,recipientBuffer:this.recipientBuffer,blockHeight:this.blockHeight,blockHash:this.blockHash.toBase64(),index:this.index}}},{key:"transactionHash",get:function get(){return this._transactionHash}},{key:"sender",get:function get(){return this._sender}},{key:"recipient",get:function get(){return this._recipient}},{key:"blockHeight",get:function get(){return this._blockHeight}},{key:"blockHash",get:function get(){return this._blockHash}},{key:"index",get:function get(){return this._index}}],[{key:"fromBlock",value:function fromBlock(e){for(var t=e.hash(),n=[],r=0;r<e.transactions.length;++r){var a=e.transactions[r];n.push(new TransactionStoreEntry(a.hash(),a.sender,a.recipient,e.height,t,r))}return n}},{key:"fromJSON",value:function fromJSON(e,t){return new TransactionStoreEntry(ie.unserialize(new U(t.transactionHashBuffer)),ge.unserialize(new U(t.senderBuffer)),ge.unserialize(new U(t.recipientBuffer)),t.blockHeight,ie.fromBase64(t.blockHash),t.index)}}]);return TransactionStoreEntry}();n.register(We);var je=function(){(0,_createClass2["default"])(TransactionStore,null,[{key:"initPersistent",value:function initPersistent(e){e.deleteObjectStore("Transactions",{upgradeCondition:function upgradeCondition(e){return e<4},indexNames:["sender","recipient"]});e.deleteObjectStore("Transactions",{upgradeCondition:function upgradeCondition(e){return e>=4&&e<8},indexNames:["sender","recipient","transactionHash"]});var t=e.createObjectStore("Transactions",{codec:new Ve,keyEncoding:JDB.JungleDB.NUMBER_ENCODING});t.createIndex("sender",["senderBuffer"],{keyEncoding:JDB.JungleDB.BINARY_ENCODING});t.createIndex("recipient",["recipientBuffer"],{keyEncoding:JDB.JungleDB.BINARY_ENCODING});t.createIndex("transactionHash",["transactionHashBuffer"],{keyEncoding:JDB.JungleDB.BINARY_ENCODING})}},{key:"getPersistent",value:function getPersistent(e){return new TransactionStore(e.getObjectStore("Transactions"))}},{key:"createVolatile",value:function createVolatile(){var e=JDB.JungleDB.createVolatileObjectStore();e.createIndex("sender",["senderBuffer"]);e.createIndex("recipient",["recipientBuffer"]);e.createIndex("transactionHash",["transactionHashBuffer"],{unique:!0});return new TransactionStore(e)}}]);function TransactionStore(e){(0,_classCallCheck2["default"])(this,TransactionStore);this._store=e}(0,_createClass2["default"])(TransactionStore,[{key:"_getCurrentId",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee180(e){return _regenerator["default"].wrap(function _callee180$(t){for(;;)switch(t.prev=t.next){case 0:e=e||this._store;t.next=3;return e.get(TransactionStore.CURRENT_ID_KEY);case 3:t.t0=t.sent;if(t.t0){t.next=6;break}t.t0=1;case 6:return t.abrupt("return",t.t0);case 7:case"end":return t.stop()}},_callee180,this)}));return function _getCurrentId(t){return e.apply(this,arguments)}}()},{key:"_setCurrentId",value:function _setCurrentId(e,t){return(t=t||this._store).put(TransactionStore.CURRENT_ID_KEY,e)}},{key:"_idForHash",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee181(e,t){var n,r,a,i,s,o,u,c;return _regenerator["default"].wrap(function _callee181$(l){for(;;)switch(l.prev=l.next){case 0:t=t||this._store;n=t.index("transactionHash");l.next=4;return n.keys(JDB.KeyRange.only(e.serialize()));case 4:r=l.sent;a=!0;i=!1;s=undefined;l.prev=8;o=(0,_getIterator2["default"])(r);case 10:if(a=(u=o.next()).done){l.next=16;break}c=u.value;return l.abrupt("return",c);case 13:a=!0;l.next=10;break;case 16:l.next=22;break;case 18:l.prev=18;l.t0=l["catch"](8);i=!0;s=l.t0;case 22:l.prev=22;l.prev=23;a||null==o["return"]||o["return"]();case 25:l.prev=25;if(!i){l.next=28;break}throw s;case 28:return l.finish(25);case 29:return l.finish(22);case 30:return l.abrupt("return",null);case 31:case"end":return l.stop()}},_callee181,this,[[8,18,22,30],[23,,25,29]])}));return function _idForHash(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee182(e){var t,n;return _regenerator["default"].wrap(function _callee182$(r){for(;;)switch(r.prev=r.next){case 0:t=this._store.index("transactionHash");r.next=3;return t.values(JDB.KeyRange.only(e.serialize()));case 3:n=r.sent;return r.abrupt("return",n&&n.length>0?n[0]:null);case 5:case"end":return r.stop()}},_callee182,this)}));return function get(t){return e.apply(this,arguments)}}()},{key:"getBySender",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee183(e){var t,n,r,a=arguments;return _regenerator["default"].wrap(function _callee183$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined?a[1]:null;n=this._store.index("sender");r=[];i.next=5;return n.valueStream(function(e,n){if(null!==t&&r.length>=t)return!1;r.push(e);return!0},!1,JDB.KeyRange.only(e.serialize()));case 5:return i.abrupt("return",r);case 6:case"end":return i.stop()}},_callee183,this)}));return function getBySender(t){return e.apply(this,arguments)}}()},{key:"getByRecipient",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee184(e){var t,n,r,a=arguments;return _regenerator["default"].wrap(function _callee184$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined?a[1]:null;n=this._store.index("recipient");r=[];i.next=5;return n.valueStream(function(e,n){if(null!==t&&r.length>=t)return!1;r.push(e);return!0},!1,JDB.KeyRange.only(e.serialize()));case 5:return i.abrupt("return",r);case 6:case"end":return i.stop()}},_callee184,this)}));return function getByRecipient(t){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee185(e){var t,n,r,a,i,s,o,u,c;return _regenerator["default"].wrap(function _callee185$(l){for(;;)switch(l.prev=l.next){case 0:t=We.fromBlock(e);n=this._store.transaction();l.next=4;return this._getCurrentId(n);case 4:r=l.sent;a=!0;i=!1;s=undefined;l.prev=8;for(o=(0,_getIterator2["default"])(t);!(a=(u=o.next()).done);a=!0){c=u.value;n.putSync(r,c);r++}l.next=16;break;case 12:l.prev=12;l.t0=l["catch"](8);i=!0;s=l.t0;case 16:l.prev=16;l.prev=17;a||null==o["return"]||o["return"]();case 19:l.prev=19;if(!i){l.next=22;break}throw s;case 22:return l.finish(19);case 23:return l.finish(16);case 24:l.next=26;return this._setCurrentId(r,n);case 26:return l.abrupt("return",n.commit());case 27:case"end":return l.stop()}},_callee185,this,[[8,12,16,24],[17,,19,23]])}));return function put(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee186(e){var t,n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee186$(u){for(;;)switch(u.prev=u.next){case 0:t=this._store.transaction();n=!0;r=!1;a=undefined;u.prev=4;i=(0,_getIterator2["default"])(e.transactions);case 6:if(n=(s=i.next()).done){u.next=16;break}o=s.value;u.t0=t;u.next=11;return this._idForHash(o.hash(),t);case 11:u.t1=u.sent;u.t0.removeSync.call(u.t0,u.t1);case 13:n=!0;u.next=6;break;case 16:u.next=22;break;case 18:u.prev=18;u.t2=u["catch"](4);r=!0;a=u.t2;case 22:u.prev=22;u.prev=23;n||null==i["return"]||i["return"]();case 25:u.prev=25;if(!r){u.next=28;break}throw a;case 28:return u.finish(25);case 29:return u.finish(22);case 30:return u.abrupt("return",t.commit());case 31:case"end":return u.stop()}},_callee186,this,[[4,18,22,30],[23,,25,29]])}));return function remove(t){return e.apply(this,arguments)}}()},{key:"snapshot",value:function snapshot(e){var snapshot=this._store.snapshot();e&&snapshot.inherit(e._store);return new TransactionStore(snapshot)}},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];return new TransactionStore(this._store.transaction(e))}},{key:"truncate",value:function truncate(){return this._store.truncate()}},{key:"commit",value:function commit(){return this._store.commit()}},{key:"abort",value:function abort(){return this._store.abort()}},{key:"tx",get:function get(){return this._store instanceof JDB.Transaction?this._store:undefined}}]);return TransactionStore}();je.CURRENT_ID_KEY=0;n.register(je);var Ve=function(){function TransactionStoreCodec(){(0,_classCallCheck2["default"])(this,TransactionStoreCodec)}(0,_createClass2["default"])(TransactionStoreCodec,[{key:"encode",value:function encode(e){return e instanceof We?e.toJSON():e}},{key:"decode",value:function decode(e,t){return 0===t?e:We.fromJSON(t,e)}},{key:"valueEncoding",get:function get(){return JDB.JungleDB.JSON_ENCODING}}]);return TransactionStoreCodec}(),Qe=function(){function TransactionReceipt(e,t,n){(0,_classCallCheck2["default"])(this,TransactionReceipt);this._transactionHash=e;this._blockHash=t;this._blockHeight=n}(0,_createClass2["default"])(TransactionReceipt,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this._transactionHash.serialize(e);this._blockHash.serialize(e);e.writeUint32(this._blockHeight);return e}},{key:"equals",value:function equals(e){return e instanceof TransactionReceipt&&(this.transactionHash.equals(e.transactionHash)&&this.blockHash.equals(e.blockHash)&&this.blockHeight===e.blockHeight)}},{key:"toPlain",value:function toPlain(){return{transactionHash:this.transactionHash.toPlain(),blockHash:this.blockHash.toPlain(),blockHeight:this.blockHeight}}},{key:"serializedSize",get:function get(){return this._transactionHash.serializedSize+this._blockHash.serializedSize+4}},{key:"transactionHash",get:function get(){return this._transactionHash}},{key:"blockHash",get:function get(){return this._blockHash}},{key:"blockHeight",get:function get(){return this._blockHeight}}],[{key:"unserialize",value:function unserialize(e){return new TransactionReceipt(ie.unserialize(e),ie.unserialize(e),e.readUint32())}},{key:"fromPlain",value:function fromPlain(e){if(!e)throw new Error("invalid transaction receipt");return new TransactionReceipt(ie.fromAny(e.transactionHash),ie.fromAny(e.blockHash),e.blockHeight)}},{key:"fromAny",value:function fromAny(e){if(e instanceof TransactionReceipt)return e;if("string"==typeof e)return TransactionReceipt.unserialize(M.fromHex(e));if("object"===(0,_typeof2["default"])(e))return TransactionReceipt.fromPlain(e);throw new Error("invalid transaction receipt")}}]);return TransactionReceipt}();n.register(Qe);var Je=function(){function Block(e,t,n){(0,_classCallCheck2["default"])(this,Block);if(!(e instanceof Re))throw new Error("Malformed header");if(!(t instanceof Me))throw new Error("Malformed interlink");if(n&&!(n instanceof Le))throw new Error("Malformed body");this._header=e;this._interlink=t;this._body=n}(0,_createClass2["default"])(Block,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this._header.serialize(e);this._interlink.serialize(e);if(this._body){e.writeUint8(1);this._body.serialize(e)}else e.writeUint8(0);return e}},{key:"verify",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee187(e){var t,n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee187$(u){for(;;)switch(u.prev=u.next){case 0:if(this._valid!==undefined){u.next=22;break}if(!(this.isLight()||this.body.transactions.length<150)&&K.areWorkersAsync){u.next=7;break}u.next=4;return this._verify(e.now());case 4:this._valid=u.sent;u.next=22;break;case 7:t=this.body.transactions.map(function(e){return e._valid});u.next=10;return q.getInstanceAsync();case 10:n=u.sent;u.next=13;return n.blockVerify(this.serialize(),t,e.now(),qn.GENESIS_HASH.serialize(),qn.NETWORK_ID);case 13:r=u.sent;a=r.valid;i=r.pow;s=r.interlinkHash;o=r.bodyHash;this._valid=a;this.header._pow=ie.unserialize(new U(i));this.interlink._hash=ie.unserialize(new U(s));this.body._hash=ie.unserialize(new U(o));case 22:return u.abrupt("return",this._valid);case 23:case"end":return u.stop()}},_callee187,this)}));return function verify(t){return e.apply(this,arguments)}}()},{key:"_verify",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee188(e){return _regenerator["default"].wrap(function _callee188$(t){for(;;)switch(t.prev=t.next){case 0:if(!(1e3*this._header.timestamp>e+1e3*Block.TIMESTAMP_DRIFT_MAX)){t.next=3;break}a.w(Block,"Invalid block - timestamp too far in the future");return t.abrupt("return",!1);case 3:t.next=5;return this._header.verifyProofOfWork();case 5:if(t.sent){t.next=8;break}a.w(Block,"Invalid block - PoW verification failed");return t.abrupt("return",!1);case 8:if(!(this.serializedSize>re.BLOCK_SIZE_MAX)){t.next=11;break}a.w(Block,"Invalid block - max block size exceeded");return t.abrupt("return",!1);case 11:if(this._verifyInterlink()){t.next=13;break}return t.abrupt("return",!1);case 13:if(!this.isFull()||this._verifyBody()){t.next=15;break}return t.abrupt("return",!1);case 15:return t.abrupt("return",!0);case 16:case"end":return t.stop()}},_callee188,this)}));return function _verify(t){return e.apply(this,arguments)}}()},{key:"_verifyInterlink",value:function _verifyInterlink(){if(1===this.height&&this._header.interlinkHash.equals(new ie(null)))return!0;var e=this._interlink.hash();if(!this._header.interlinkHash.equals(e)){a.w(Block,"Invalid block - interlink hash mismatch");return!1}return!0}},{key:"_verifyBody",value:function _verifyBody(){if(!this._body.verify())return!1;var e=this._body.hash();if(!this._header.bodyHash.equals(e)){a.w(Block,"Invalid block - body hash mismatch");return!1}return!0}},{key:"isImmediateSuccessorOf",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee189(e){var t;return _regenerator["default"].wrap(function _callee189$(n){for(;;)switch(n.prev=n.next){case 0:if(this._header.isImmediateSuccessorOf(e.header)){n.next=2;break}return n.abrupt("return",!1);case 2:n.next=4;return e.getNextInterlink(this.target,this.version);case 4:t=n.sent;if(this._interlink.equals(t)){n.next=7;break}return n.abrupt("return",!1);case 7:return n.abrupt("return",!0);case 8:case"end":return n.stop()}},_callee189,this)}));return function isImmediateSuccessorOf(t){return e.apply(this,arguments)}}()},{key:"isInterlinkSuccessorOf",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee190(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_,p,g;return _regenerator["default"].wrap(function _callee190$(y){for(;;)switch(y.prev=y.next){case 0:if(!(this._header.height<=e.header.height)){y.next=3;break}a.v(Block,"No interlink successor - height");return y.abrupt("return",!1);case 3:if(!(this._header.timestamp<e.header.timestamp)){y.next=6;break}a.v(Block,"No interlink successor - timestamp");return y.abrupt("return",!1);case 6:t=e.hash();if(qn.GENESIS_HASH.equals(t)){y.next=27;break}y.next=10;return e.pow();case 10:n=y.sent;r=De.getTargetHeight(this.target);i=!1;s=0;case 14:if(!(s<this._interlink.length)){y.next=24;break}if(!t.equals(this._interlink.hashes[s])){y.next=21;break}i=!0;o=new J(2).pow(r-s);if(De.isProofOfWork(n,o)){y.next=21;break}a.v(Block,"No interlink successor - invalid position in interlink");return y.abrupt("return",!1);case 21:s++;y.next=14;break;case 24:if(i){y.next=27;break}a.v(Block,"No interlink successor - not in interlink");return y.abrupt("return",!1);case 27:if(!this._header.prevHash.equals(t)){y.next=40;break}if(this._header.height===e.header.height+1){y.next=31;break}a.v(Block,"No interlink successor - immediate height");return y.abrupt("return",!1);case 31:y.next=33;return e.getNextInterlink(this.target,this.version);case 33:u=y.sent;c=u.hash();if(this._header.interlinkHash.equals(c)){y.next=38;break}a.v(Block,"No interlink successor - immediate interlink");return y.abrupt("return",!1);case 38:y.next=72;break;case 40:if(this._header.height!==e.header.height+1){y.next=45;break}a.v(Block,"No interlink successor - immediate height (2)");return y.abrupt("return",!1);case 45:(l=new w).addAll(this._interlink.hashes);l.removeAll(e.interlink.hashes);if(!(l.length>this._header.height-e.header.height)){y.next=51;break}a.v(Block,"No interlink successor - too many new blocks");return y.abrupt("return",!1);case 51:h=De.getTargetDepth(this.target);f=De.getTargetDepth(e.target);d=h-f;if(!(this._interlink.length<e.interlink.length-d)){y.next=57;break}a.v(Block,"No interlink successor - interlink too short");return y.abrupt("return",!1);case 57:A=!1;_=this._interlink.hashes;p=e.interlink.hashes;g=1;case 61:if(!(g<p.length&&g-d<_.length)){y.next=72;break}if(!p[g].equals(_[g-d])){y.next=66;break}A=!0;y.next=69;break;case 66:if(!A){y.next=69;break}a.v(Block,"No interlink successor - invalid common suffix");return y.abrupt("return",!1);case 69:g++;y.next=61;break;case 72:return y.abrupt("return",!0);case 73:case"end":return y.stop()}},_callee190,this)}));return function isInterlinkSuccessorOf(t){return e.apply(this,arguments)}}()},{key:"isSuccessorOf",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee191(e){return _regenerator["default"].wrap(function _callee191$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this.isImmediateSuccessorOf(e);case 2:t.t0=t.sent;if(t.t0){t.next=7;break}t.next=6;return this.isInterlinkSuccessorOf(e);case 6:t.t0=t.sent;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}},_callee191,this)}));return function isSuccessorOf(t){return e.apply(this,arguments)}}()},{key:"getNextInterlink",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee192(e){var t,n,r,a,i,s,o,u,c=arguments;return _regenerator["default"].wrap(function _callee192$(l){for(;;)switch(l.prev=l.next){case 0:c.length>1&&c[1]!==undefined?c[1]:Re.CURRENT_VERSION;t=[];n=this.hash();l.t0=De;l.next=6;return this.pow();case 6:l.t1=l.sent;r=l.t0.getHashDepth.call(l.t0,l.t1);a=De.getTargetDepth(e);i=Math.max(r-a+1,0);for(s=0;s<i;s++)t.push(n);o=De.getTargetDepth(this.target);for(u=i+(a-o);u<this.interlink.length;u++)t.push(this.interlink.hashes[u]);return l.abrupt("return",new Me(t,n));case 16:case"end":return l.stop()}},_callee192,this)}));return function getNextInterlink(t){return e.apply(this,arguments)}}()},{key:"shallowCopy",value:function shallowCopy(){return new Block(this._header,this._interlink,this._body)}},{key:"equals",value:function equals(e){return e instanceof Block&&this._header.equals(e._header)&&this._interlink.equals(e._interlink)&&(this._body?this._body.equals(e._body):!e._body)}},{key:"isLight",value:function isLight(){return!this._body}},{key:"isFull",value:function isFull(){return!!this._body}},{key:"toLight",value:function toLight(){return this.isLight()?this:new Block(this._header,this._interlink)}},{key:"toFull",value:function toFull(e){return this.isFull()?this:new Block(this._header,this._interlink,e)}},{key:"hash",value:function hash(e){return this._header.hash(e)}},{key:"pow",value:function pow(e){return this._header.pow(e)}},{key:"toString",value:function toString(){return"Block{height=".concat(this.height,",prev=").concat(this.prevHash,"}")}},{key:"toPlain",value:function toPlain(){var e={version:this.version,hash:this.hash().toPlain(),prevHash:this.prevHash.toPlain(),interlinkHash:this.interlinkHash.toPlain(),bodyHash:this.bodyHash.toPlain(),accountsHash:this.accountsHash.toPlain(),nBits:this.nBits,difficulty:this.difficulty.toString(),height:this.height,timestamp:this.timestamp,nonce:this.nonce,interlink:this.interlink.hashes.map(function(e){return e.toPlain()})};if(this.isFull()){e.minerAddr=this.minerAddr.toPlain();e.transactions=this.transactions.map(function(e){return e.toPlain()});e.extraData=M.toHex(this.extraData);e.prunedAccounts=this.prunedAccounts.map(function(e){return e.toPlain()})}return e}},{key:"serializedSize",get:function get(){return this._header.serializedSize+this._interlink.serializedSize+1+(this._body?this._body.serializedSize:0)}},{key:"header",get:function get(){return this._header}},{key:"interlink",get:function get(){return this._interlink}},{key:"body",get:function get(){if(this.isLight())throw new Error("Cannot access body of light block");return this._body}},{key:"version",get:function get(){return this._header.version}},{key:"prevHash",get:function get(){return this._header.prevHash}},{key:"interlinkHash",get:function get(){return this._header.interlinkHash}},{key:"bodyHash",get:function get(){return this._header.bodyHash}},{key:"accountsHash",get:function get(){return this._header.accountsHash}},{key:"nBits",get:function get(){return this._header.nBits}},{key:"target",get:function get(){return this._header.target}},{key:"difficulty",get:function get(){return this._header.difficulty}},{key:"height",get:function get(){return this._header.height}},{key:"timestamp",get:function get(){return this._header.timestamp}},{key:"nonce",get:function get(){return this._header.nonce}},{key:"minerAddr",get:function get(){return this._body?this._body.minerAddr:undefined}},{key:"transactions",get:function get(){return this._body?this._body.transactions:undefined}},{key:"extraData",get:function get(){return this._body?this._body.extraData:undefined}},{key:"prunedAccounts",get:function get(){return this._body?this._body.prunedAccounts:undefined}},{key:"transactionCount",get:function get(){return this._body?this._body.transactionCount:undefined}}],[{key:"unserialize",value:function unserialize(e){var t=Re.unserialize(e),n=Me.unserialize(e,t.prevHash),r=undefined;e.readUint8()&&(r=Le.unserialize(e));return new Block(t,n,r)}},{key:"fromAny",value:function fromAny(e){if(e instanceof Block)return e;if("object"===(0,_typeof2["default"])(e))return Block.fromPlain(e);if("string"==typeof e)return Block.unserialize(M.fromHex(e));throw new Error("Invalid block")}},{key:"fromPlain",value:function fromPlain(e){var t=new Re(ie.fromAny(e.prevHash),ie.fromAny(e.interlinkHash),ie.fromAny(e.bodyHash),ie.fromAny(e.accountsHash),e.nBits,e.height,e.timestamp,e.nonce,e.version),n=new Me((e.interlink.hashes||e.interlink).map(function(e){return ie.fromAny(e)}),ie.fromAny(e.prevHash)),r=null;e.minerAddr&&e.extraData!==undefined&&(0,_isArray["default"])(e.transactions)&&(0,_isArray["default"])(e.prunedAccounts)&&(r=new Le(ge.fromAny(e.minerAddr),e.transactions.map(function(e){return ze.fromAny(e)}),M.fromAny(e.extraData),e.prunedAccounts.map(function(e){return ve.fromAny(e)})));return new Block(t,n,r)}}]);return Block}();Je.TIMESTAMP_DRIFT_MAX=600;n.register(Je);var Ye=function(e){(0,_inherits2["default"])(IBlockchain,e);var t=_createSuper(IBlockchain);function IBlockchain(){(0,_classCallCheck2["default"])(this,IBlockchain);return t.apply(this,arguments)}(0,_createClass2["default"])(IBlockchain,[{key:"head",get:function get(){}},{key:"headHash",get:function get(){}},{key:"height",get:function get(){}}]);return IBlockchain}(i);n.register(Ye);var Xe=function(e){(0,_inherits2["default"])(BaseChain,e);var t=_createSuper(BaseChain);function BaseChain(e){var n;(0,_classCallCheck2["default"])(this,BaseChain);(n=t.call(this))._store=e;return n}(0,_createClass2["default"])(BaseChain,[{key:"getBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee193(e){var t,n,r,a=arguments;return _regenerator["default"].wrap(function _callee193$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined&&a[1];n=a.length>2&&a[2]!==undefined&&a[2];i.next=4;return this._store.getChainData(e,n);case 4:r=i.sent;return i.abrupt("return",r&&(r.onMainChain||t)?r.head:null);case 6:case"end":return i.stop()}},_callee193,this)}));return function getBlock(t){return e.apply(this,arguments)}}()},{key:"getRawBlock",value:function getRawBlock(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return this._store.getRawBlock(e,t)}},{key:"getBlockAt",value:function getBlockAt(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return this._store.getBlockAt(e,t)||null}},{key:"getNearestBlockAt",value:function getNearestBlockAt(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1];return this._store.getNearestBlockAt(e,t)||null}},{key:"getSuccessorBlocks",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee194(e){return _regenerator["default"].wrap(function _callee194$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._store.getSuccessorBlocks(e));case 1:case"end":return t.stop()}},_callee194,this)}));return function getSuccessorBlocks(t){return e.apply(this,arguments)}}()},{key:"getBlockLocators",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee195(){var e,t,n,r,a;return _regenerator["default"].wrap(function _callee195$(i){for(;;)switch(i.prev=i.next){case 0:e=[this.headHash];t=this.head;n=Math.min(10,this.height)-1;case 3:if(!(n>0)){i.next=13;break}if(t){i.next=6;break}return i.abrupt("break",13);case 6:e.push(t.prevHash);i.next=9;return this.getBlock(t.prevHash);case 9:t=i.sent;case 10:n--;i.next=3;break;case 13:r=2;a=this.height-10-r;case 15:if(!(a>0)){i.next=31;break}i.next=18;return this.getBlockAt(a);case 18:if(!(t=i.sent)){i.next=25;break}i.t0=e;i.next=23;return t.hash();case 23:i.t1=i.sent;i.t0.push.call(i.t0,i.t1);case 25:r*=2;if(!(e.length>=zt.LOCATORS_MAX_COUNT)){i.next=28;break}return i.abrupt("break",31);case 28:a-=r;i.next=15;break;case 31:if(0===e.length||!e[e.length-1].equals(qn.GENESIS_HASH)){e.length>=zt.LOCATORS_MAX_COUNT&&e.pop();e.push(qn.GENESIS_HASH)}return i.abrupt("return",e);case 33:case"end":return i.stop()}},_callee195,this)}));return function getBlockLocators(){return e.apply(this,arguments)}}()},{key:"getNextTarget",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee196(e,t){var n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee196$(c){for(;;)switch(c.prev=c.next){case 0:if(!e){c.next=8;break}r=e.hash();c.next=4;return this._store.getChainData(r);case 4:n=c.sent;R.that(!!n);c.next=10;break;case 8:e=this.head;n=this._mainChain;case 10:if(!t){c.next=15;break}c.next=13;return n.nextChainData(t);case 13:n=c.sent;e=t;case 15:a=Math.max(e.height-re.DIFFICULTY_BLOCK_WINDOW,1);if(!n.onMainChain){c.next=22;break}c.next=19;return this._store.getChainDataAt(a);case 19:i=c.sent;c.next=40;break;case 22:s=n;o=0;case 24:if(!(o<re.DIFFICULTY_BLOCK_WINDOW)||s.onMainChain){c.next=33;break}c.next=27;return this._store.getChainData(s.head.prevHash);case 27:if(s=c.sent){c.next=30;break}return c.abrupt("return",null);case 30:o++;c.next=24;break;case 33:if(!(s.onMainChain&&s.head.height>a)){c.next=39;break}c.next=36;return this._store.getChainDataAt(a);case 36:i=c.sent;c.next=40;break;case 39:i=s;case 40:if(i&&!i.totalDifficulty.lt(1)){c.next=42;break}return c.abrupt("return",null);case 42:u=n.totalDifficulty.minus(i.totalDifficulty);return c.abrupt("return",De.getNextTarget(n.head.header,i.head.header,u));case 44:case"end":return c.stop()}},_callee196,this)}));return function getNextTarget(t,n){return e.apply(this,arguments)}}()},{key:"_getChainProof",value:function _getChainProof(){return this._prove(re.M,re.K,re.DELTA)}},{key:"_prove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee197(e,t,n){var r,i,s,o,u,c,l,h=this;return _regenerator["default"].wrap(function _callee197$(f){for(;;)switch(f.prev=f.next){case 0:R.that(e>=1,"m must be >= 1");R.that(n>0,"delta must be > 0");r=new Ze([]);i=1;f.next=6;return this._store.getChainDataAt(Math.max(this.height-t,1));case 6:s=f.sent;o=s.superBlockCounts.getCandidateDepth(e);u=_regenerator["default"].mark(function _loop10(t){var o;return _regenerator["default"].wrap(function _loop10$(u){for(;;)switch(u.prev=u.next){case 0:u.next=2;return h._getSuperChain(t,s,i);case 2:o=u.sent;r=Ze.merge(r,new Ze(o.map(function(e){return e.head.toLight()})));if(BaseChain._isGoodSuperChain(o,t,e,n)){R.that(o.length>=e,"Good superchain expected to be at least ".concat(e," long"));a.v(BaseChain,function(){return"Found good superchain at depth ".concat(t," with length ").concat(o.length," (#").concat(i," - #").concat(s.head.height,")")});i=o[o.length-e].head.height}case 5:case"end":return u.stop()}},_loop10)});c=o;case 10:if(!(c>=0)){f.next=15;break}return f.delegateYield(u(c),"t0",12);case 12:c--;f.next=10;break;case 15:f.next=17;return this._getHeaderChain(this.height-s.head.height);case 17:l=f.sent;return f.abrupt("return",new tt(r,l));case 19:case"end":return f.stop()}},_callee197,this)}));return function _prove(t,n,r){return e.apply(this,arguments)}}()},{key:"_getSuperChain",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee198(e,t){var n,r,i,s,o,u=arguments;return _regenerator["default"].wrap(function _callee198$(c){for(;;)switch(c.prev=c.next){case 0:n=u.length>2&&u[2]!==undefined?u[2]:1;R.that(n>=1,"tailHeight must be >= 1");r=[];c.t0=De;c.next=6;return t.head.pow();case 6:c.t1=c.sent;c.t0.getHashDepth.call(c.t0,c.t1)>=e&&r.push(t);i=t;s=Math.max(e-De.getTargetDepth(i.head.target),-1);case 11:if(!(s<i.head.interlink.hashes.length&&i.head.height>n)){c.next=23;break}o=s<0?i.head.prevHash:i.head.interlink.hashes[s];c.next=15;return this._store.getChainData(o);case 15:if(i=c.sent){c.next=19;break}a.w(BaseChain,"Failed to find block ".concat(o," while constructing SuperChain at depth ").concat(e," - returning truncated chain"));return c.abrupt("break",23);case 19:r.push(i);s=Math.max(e-De.getTargetDepth(i.head.target),-1);c.next=11;break;case 23:if(!(0===r.length||r[r.length-1].head.height>1)||1!==n){c.next=29;break}c.t2=r;c.next=27;return nt.initial(qn.GENESIS_BLOCK);case 27:c.t3=c.sent;c.t2.push.call(c.t2,c.t3);case 29:return c.abrupt("return",r.reverse());case 30:case"end":return c.stop()}},_callee198,this)}));return function _getSuperChain(t,n){return e.apply(this,arguments)}}()},{key:"_getHeaderChain",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee199(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee199$(a){for(;;)switch(a.prev=a.next){case 0:t=r.length>1&&r[1]!==undefined?r[1]:this.head;n=[];case 2:if(!(t&&n.length<e)){a.next=9;break}n.push(t.header);a.next=6;return this.getBlock(t.prevHash);case 6:t=a.sent;a.next=2;break;case 9:return a.abrupt("return",new et(n.reverse()));case 10:case"end":return a.stop()}},_callee199,this)}));return function _getHeaderChain(t){return e.apply(this,arguments)}}()},{key:"_extendChainProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee200(e,t){var n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m=arguments;return _regenerator["default"].wrap(function _callee200$(b){for(;;)switch(b.prev=b.next){case 0:n=!(m.length>2&&m[2]!==undefined)||m[2];(r=e.suffix.headers.slice()).push(t);i=e.prefix.blocks.slice();if(!(r.length<=re.K)){b.next=6;break}return b.abrupt("return",new tt(new Ze(i),new et(r)));case 6:s=r.shift();b.next=9;return e.prefix.head.getNextInterlink(s.target,s.version);case 9:o=b.sent;u=new Je(s,o);i.push(u);b.next=14;return e.prefix.getSuperChains();case 14:c=b.sent.slice();b.t0=De;b.next=18;return u.pow();case 18:b.t1=b.sent;l=b.t0.getHashDepth.call(b.t0,b.t1);for(h=l;h>=0;h--)c[h]?c[h]=new Ze([].concat((0,_toConsumableArray2["default"])(c[h].blocks),[u])):c[h]=new Ze([u]);if(!(l-De.getTargetDepth(u.target)<=0)){b.next=23;break}return b.abrupt("return",new tt(new Ze(i,c),new et(r)));case 23:f=new _set5["default"];d=l;case 25:if(!(d>=0)){b.next=58;break}if(!((A=c[d]).length<re.M)){b.next=29;break}return b.abrupt("continue",55);case 29:_=A.blocks.map(function(e){return{head:e}});if(BaseChain._hasSuperQuality(_,d,re.M,re.DELTA)){b.next=35;break}a.w(BaseChain,"Chain quality badness detected at depth ".concat(d));if(!n){b.next=34;break}return b.abrupt("return",null);case 34:return b.abrupt("continue",55);case 35:p=A.blocks[A.length-re.M];g=d-1;case 37:if(!(g>=0)){b.next=55;break}y=0;v=c[g].blocks[y];case 40:if(!(v.height<=p.height)){b.next=51;break}b.t2=De;b.next=44;return v.pow();case 44:b.t3=b.sent;b.t2.getHashDepth.call(b.t2,b.t3)===g&&v.height>1&&f.add(v.height);y++;v=c[g].blocks[y];b.next=40;break;case 51:y>0&&(c[g]=new Ze(c[g].blocks.slice(y)));case 52:g--;b.next=37;break;case 55:d--;b.next=25;break;case 58:k=new Ze(i.filter(function(e){return!f.has(e.height)}),c);return b.abrupt("return",new tt(k,new et(r)));case 60:case"end":return b.stop()}},_callee200)}));return function _extendChainProof(t,n){return e.apply(this,arguments)}}()},{key:"_getBlockProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee201(e,t){var n,r,i,s,o,u,c,l,h;return _regenerator["default"].wrap(function _callee201$(f){for(;;)switch(f.prev=f.next){case 0:n=function getInterlinkReference(e,t){var n=Math.min(t-De.getTargetDepth(e.target),e.interlink.length-1);return n<0?e.prevHash:e.interlink.hashes[n]};r=[];i=e.hash();f.t0=De;f.next=6;return e.pow();case 6:f.t1=f.sent;s=f.t0.hashToTarget.call(f.t0,f.t1);o=De.getTargetDepth(s);u=De.getTargetDepth(t.target)+t.interlink.length-1;l=n(c=t,u);case 12:if(i.equals(l)){f.next=36;break}f.next=15;return this.getBlock(l);case 15:if(h=f.sent){f.next=19;break}a.w(BaseChain,"Failed to find block ".concat(l," while constructing inclusion proof"));return f.abrupt("return",null);case 19:if(!(h.height<e.height)){f.next=26;break}if(!(u<=o)){f.next=22;break}return f.abrupt("return",null);case 22:l=n(c,--u);f.next=34;break;case 26:if(!(h.height>e.height)){f.next=32;break}r.push(h.toLight());l=n(c=h,u);f.next=34;break;case 32:a.w(BaseChain,"Failed to prove block ".concat(i," - different block ").concat(l," at its height ").concat(c.height));return f.abrupt("return",null);case 34:f.next=12;break;case 36:r.push(e.toLight());return f.abrupt("return",new Ze(r.reverse()));case 38:case"end":return f.stop()}},_callee201,this)}));return function _getBlockProof(t,n){return e.apply(this,arguments)}}()}],[{key:"_isGoodSuperChain",value:function _isGoodSuperChain(e,t,n,r){return BaseChain._hasSuperQuality(e,t,n,r)&&BaseChain._hasMultiLevelQuality(e,t,n,r)}},{key:"_hasSuperQuality",value:function _hasSuperQuality(e,t,n,r){R.that(n>=1,"m must be >= 1");if(e.length<n)return!1;for(var a=n;a<=e.length;a++){var i=e[e.length-1].head.height-e[e.length-a].head.height+1;if(!BaseChain._isLocallyGood(a,i,t,r))return!1}return!0}},{key:"_hasMultiLevelQuality",value:function _hasMultiLevelQuality(e,t,n,r){if(t<=0)return!0;for(var i=0;i<e.length-n;i++)for(var s=e[i],o=e[i+n],u=t;u>=1;u--){var c=o.superBlockCounts.get(u)-s.superBlockCounts.get(u);switch(BaseChain.MULTILEVEL_STRATEGY){case BaseChain.MultilevelStrategy.STRICT:var l=o.superBlockCounts.get(u-1)-s.superBlockCounts.get(u-1);if(2*c<Math.pow(1-r,1/t)*l){a.d(BaseChain,"Chain badness detected at depth ".concat(t,", failing at ").concat(u,"/").concat(u-1)+" with ".concat(c,"/").concat(Math.pow(1-r,1/t)*l,"/").concat(l," blocks"));return!1}break;default:case BaseChain.MultilevelStrategy.MODERATE:for(var h=u-1;h>=0;h--){var f=o.superBlockCounts.get(h)-s.superBlockCounts.get(h);if(!BaseChain._isLocallyGood(c,f,u-h,r)){a.d(BaseChain,"Chain badness detected at depth ".concat(t,"[").concat(i,":").concat(i+n,"], failing at ").concat(u,"/").concat(h));return!1}}break;case BaseChain.MultilevelStrategy.RELAXED:var d=o.superBlockCounts.get(u-1)-s.superBlockCounts.get(u-1),A=o.head.height-s.head.height+1;if(!BaseChain._isLocallyGood(d,A,t,r)){a.d(BaseChain,"Chain badness detected at depth ".concat(t,"[").concat(i,":").concat(i+n,"], failing at ").concat(u));return!1}}}return!0}},{key:"_isLocallyGood",value:function _isLocallyGood(e,t,n,r){return e>(1-r)*Math.pow(2,-n)*t}},{key:"manyPow",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee202(e){var t,n,r,a,i,s,o,u,c,l,h;return _regenerator["default"].wrap(function _callee202$(f){for(;;)switch(f.prev=f.next){case 0:f.next=2;return q.getInstanceAsync();case 2:t=f.sent;n=t.poolSize||1;r=[];a=0;for(i=0;i<n;++i){r.push([]);for(;a<(i+1)/n*e.length;++a)r[i].push(e[a].serialize())}s=[];for(o=0,u=r;o<u.length;o++){c=u[o];s.push(t.computeArgon2dBatch(c))}f.next=11;return _promise["default"].all(s);case 11:l=f.sent.reduce(function(e,t){return[].concat((0,_toConsumableArray2["default"])(e),(0,_toConsumableArray2["default"])(t))},[]);for(h=0;h<e.length;++h)e[h]._pow=new ie(l[h]);case 13:case"end":return f.stop()}},_callee202)}));return function manyPow(t){return e.apply(this,arguments)}}()},{key:"isBetterProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee203(e,t,n){var r,a,i;return _regenerator["default"].wrap(function _callee203$(s){for(;;)switch(s.prev=s.next){case 0:r=Ze.lowestCommonAncestor(e.prefix,t.prefix);s.next=3;return wt._getProofScore(e.prefix,r,n);case 3:a=s.sent;s.next=6;return wt._getProofScore(t.prefix,r,n);case 6:i=s.sent;return s.abrupt("return",a===i?e.suffix.totalDifficulty().gt(t.suffix.totalDifficulty()):a>i);case 8:case"end":return s.stop()}},_callee203)}));return function isBetterProof(t,n,r){return e.apply(this,arguments)}}()},{key:"_getProofScore",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee204(e,t,n){var r,a,i,s,o,u,c,l,h,f,d,A,_,p;return _regenerator["default"].wrap(function _callee204$(g){for(;;)switch(g.prev=g.next){case 0:r=[];a=!0;i=!1;s=undefined;g.prev=4;o=(0,_getIterator2["default"])(e.blocks);case 6:if(a=(u=o.next()).done){g.next=19;break}if(!((c=u.value).height<t.height)){g.next=10;break}return g.abrupt("continue",16);case 10:g.t0=De;g.next=13;return c.pow();case 13:g.t1=g.sent;l=g.t0.getHashDepth.call(g.t0,g.t1);r[l]=r[l]?r[l]+1:1;case 16:a=!0;g.next=6;break;case 19:g.next=25;break;case 21:g.prev=21;g.t2=g["catch"](4);i=!0;s=g.t2;case 25:g.prev=25;g.prev=26;a||null==o["return"]||o["return"]();case 28:g.prev=28;if(!i){g.next=31;break}throw s;case 31:return g.finish(28);case 32:return g.finish(25);case 33:h=0;for(f=r.length-1;h<n&&f>=0;f--)h+=r[f]?r[f]:0;d=Math.pow(2,f+1)*h;A=h;for(_=f;_>=0;_--){A+=r[_]?r[_]:0;p=Math.pow(2,_)*A;d=Math.max(d,p)}return g.abrupt("return",d);case 39:case"end":return g.stop()}},_callee204,null,[[4,21,25,33],[26,,28,32]])}));return function _getProofScore(t,n,r){return e.apply(this,arguments)}}()}]);return BaseChain}(Ye);Xe.MultilevelStrategy={STRICT:1,MODERATE:2,RELAXED:3};Xe.MULTILEVEL_STRATEGY=Xe.MultilevelStrategy.MODERATE;n.register(Xe);var Ze=function(){(0,_createClass2["default"])(BlockChain,null,[{key:"merge",value:function merge(e,t){for(var n=[],r=0,a=0;r<e.length&&a<t.length;){var i=e.blocks[r],s=t.blocks[a];if(i.height===s.height){R.that(i.equals(s),"Encountered different blocks at same height during chain merge");n.push(i);r++;a++}else if(i.height<s.height){n.push(i);r++}else{n.push(s);a++}}for(;r<e.length;r++)n.push(e.blocks[r]);for(;a<t.length;a++)n.push(t.blocks[a]);return new BlockChain(n)}},{key:"lowestCommonAncestor",value:function lowestCommonAncestor(e,t){for(var n=e.length-1,r=t.length-1;n>=0&&r>=0;){var a=e.blocks[n],i=t.blocks[r];if(a.equals(i))return a;a.height>i.height?n--:r--}return undefined}}]);function BlockChain(e,t){(0,_classCallCheck2["default"])(this,BlockChain);if(!(0,_isArray["default"])(e)||!Y.isUint16(e.length)||e.some(function(e){return!(e instanceof Je&&e.isLight())}))throw new Error("Malformed blocks");this._blocks=e;this._chains=t}(0,_createClass2["default"])(BlockChain,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint16(this._blocks.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._blocks);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"verify",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee205(){var e;return _regenerator["default"].wrap(function _callee205$(t){for(;;)switch(t.prev=t.next){case 0:e=this._blocks.length-1;case 1:if(!(e>=1)){t.next=12;break}if(e%100!=99){t.next=5;break}t.next=5;return v.webYield();case 5:t.next=7;return this._blocks[e].isSuccessorOf(this._blocks[e-1]);case 7:if(t.sent){t.next=9;break}return t.abrupt("return",!1);case 9:e--;t.next=1;break;case 12:return t.abrupt("return",!0);case 13:case"end":return t.stop()}},_callee205,this)}));return function verify(){return e.apply(this,arguments)}}()},{key:"denseSuffix",value:function denseSuffix(){for(var denseSuffix=[this.head],e=this.head,t=this.length-2;t>=0;t--){var n=this.blocks[t];if(!n.hash().equals(e.prevHash))break;denseSuffix.push(n);e=n}denseSuffix.reverse();return denseSuffix}},{key:"getSuperChains",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee206(){var e,t,n,r,a;return _regenerator["default"].wrap(function _callee206$(i){for(;;)switch(i.prev=i.next){case 0:if(this._chains){i.next=16;break}this._chains=[];e=0;case 3:if(!(e<this.length)){i.next=15;break}t=this.blocks[e];i.t0=De;i.next=8;return t.pow();case 8:i.t1=i.sent;n=i.t0.getHashDepth.call(i.t0,i.t1);this._chains[n]?this._chains[n].blocks.push(t):this._chains[n]||(this._chains[n]=new BlockChain([t]));for(r=n-1;r>=0;r--)this._chains[r]&&this._chains[r].blocks.push(t);case 12:e++;i.next=3;break;case 15:for(a=0;a<this._chains.length;a++)this._chains[a]||(this._chains[a]=new BlockChain([]));case 16:return i.abrupt("return",this._chains);case 17:case"end":return i.stop()}},_callee206,this)}));return function getSuperChains(){return e.apply(this,arguments)}}()},{key:"isAnchored",value:function isAnchored(){return qn.GENESIS_HASH.equals(this.tail.hash())}},{key:"toString",value:function toString(){return"BlockChain{length=".concat(this.length,"}")}},{key:"totalDifficulty",value:function totalDifficulty(){return this._blocks.reduce(function(e,t){return e+De.targetToDifficulty(t.target)},0)}},{key:"serializedSize",get:function get(){return 2+this._blocks.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"length",get:function get(){return this._blocks.length}},{key:"blocks",get:function get(){return this._blocks}},{key:"head",get:function get(){return this._blocks[this.length-1]}},{key:"tail",get:function get(){return this._blocks[0]}}],[{key:"unserialize",value:function unserialize(e){for(var t=e.readUint16(),n=[],r=0;r<t;r++)n.push(Je.unserialize(e));return new BlockChain(n)}}]);return BlockChain}();n.register(Ze);var $e=function(){function BlockProducer(e,t,n,r){(0,_classCallCheck2["default"])(this,BlockProducer);this._blockchain=e;this._accounts=t;this._mempool=n;this._time=r}(0,_createClass2["default"])(BlockProducer,[{key:"getNextBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee207(e){var t,n,r,a,i,s=arguments;return _regenerator["default"].wrap(function _callee207$(o){for(;;)switch(o.prev=o.next){case 0:t=s.length>1&&s[1]!==undefined?s[1]:new Uint8Array(0);o.next=3;return this._blockchain.getNextTarget();case 3:n=o.sent;o.next=6;return this._getNextInterlink(n);case 6:r=o.sent;o.next=9;return this._getNextBody(r.serializedSize,e,t);case 9:a=o.sent;o.next=12;return this._getNextHeader(n,r,a);case 12:i=o.sent;o.next=15;return this._blockchain.getNextTarget();case 15:if(o.sent.equals(n)){o.next=17;break}return o.abrupt("return",this.getNextBlock(e,t));case 17:return o.abrupt("return",new Je(i,r,a));case 18:case"end":return o.stop()}},_callee207,this)}));return function getNextBlock(t){return e.apply(this,arguments)}}()},{key:"_getNextHeader",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee208(e,t,n){var r,a,i,s,o,u,c,l;return _regenerator["default"].wrap(function _callee208$(h){for(;;)switch(h.prev=h.next){case 0:r=this._blockchain.headHash;a=t.hash();i=this._blockchain.height+1;h.next=5;return this._accounts.transaction();case 5:s=h.sent;h.prev=6;h.next=9;return s.commitBlockBody(n,i,this._blockchain.transactionCache);case 9:h.next=11;return s.hash();case 11:o=h.sent;h.next=17;break;case 14:h.prev=14;h.t0=h["catch"](6);throw new Error("Invalid block body: ".concat(h.t0.message));case 17:h.prev=17;h.next=20;return s.abort();case 20:return h.finish(17);case 21:u=n.hash();c=this._getNextTimestamp();l=De.targetToCompact(e);0;return h.abrupt("return",new Re(r,a,u,o,l,i,c,0));case 26:case"end":return h.stop()}},_callee208,this,[[6,14,17,21]])}));return function _getNextHeader(t,n,r){return e.apply(this,arguments)}}()},{key:"_getNextInterlink",value:function _getNextInterlink(e){return this._blockchain.head.getNextInterlink(e)}},{key:"_getNextBody",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee209(e,t,n){var r,a,i;return _regenerator["default"].wrap(function _callee209$(s){for(;;)switch(s.prev=s.next){case 0:r=re.BLOCK_SIZE_MAX-Re.SERIALIZED_SIZE-e-Le.getMetadataSize(n);s.next=3;return this._mempool.getTransactionsForBlock(r);case 3:a=s.sent;s.next=6;return this._accounts.gatherToBePrunedAccounts(a,this._blockchain.height+1,this._blockchain.transactionCache);case 6:i=s.sent;return s.abrupt("return",new Le(t,a,n,i));case 8:case"end":return s.stop()}},_callee209,this)}));return function _getNextBody(t,n,r){return e.apply(this,arguments)}}()},{key:"_getNextTimestamp",value:function _getNextTimestamp(){var e=Math.floor(this._time.now()/1e3);return Math.max(e,this._blockchain.head.timestamp+1)}}]);return BlockProducer}();n.register($e);var et=function(){function HeaderChain(e){(0,_classCallCheck2["default"])(this,HeaderChain);if(!e||!(0,_isArray["default"])(e)||!Y.isUint16(e.length)||e.some(function(e){return!(e instanceof Re)}))throw new Error("Malformed headers");this._headers=e}(0,_createClass2["default"])(HeaderChain,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint16(this._headers.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._headers);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"verify",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee210(){var e;return _regenerator["default"].wrap(function _callee210$(t){for(;;)switch(t.prev=t.next){case 0:e=this._headers.length-1;case 1:if(!(e>=1)){t.next=7;break}if(this._headers[e].isImmediateSuccessorOf(this._headers[e-1])){t.next=4;break}return t.abrupt("return",!1);case 4:e--;t.next=1;break;case 7:return t.abrupt("return",!0);case 8:case"end":return t.stop()}},_callee210,this)}));return function verify(){return e.apply(this,arguments)}}()},{key:"toString",value:function toString(){return"HeaderChain{length=".concat(this.length,"}")}},{key:"totalDifficulty",value:function totalDifficulty(){var totalDifficulty=new J(0),e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._headers);!(e=(r=a.next()).done);e=!0){var i=r.value;totalDifficulty=totalDifficulty.plus(i.difficulty)}}catch(s){t=!0;n=s}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}return totalDifficulty}},{key:"serializedSize",get:function get(){return 2+this._headers.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"length",get:function get(){return this._headers.length}},{key:"headers",get:function get(){return this._headers}},{key:"head",get:function get(){return this._headers[this.length-1]}},{key:"tail",get:function get(){return this._headers[0]}}],[{key:"unserialize",value:function unserialize(e){for(var t=e.readUint16(),n=[],r=0;r<t;r++)n.push(Re.unserialize(e));return new HeaderChain(n)}}]);return HeaderChain}();n.register(et);var tt=function(){function ChainProof(e,t){(0,_classCallCheck2["default"])(this,ChainProof);if(!(e instanceof Ze&&e.length))throw new Error("Malformed prefix");if(!(t instanceof et))throw new Error("Malformed suffix");this._prefix=e;this._suffix=t}(0,_createClass2["default"])(ChainProof,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);this._prefix.serialize(e);this._suffix.serialize(e);return e}},{key:"verify",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee211(){return _regenerator["default"].wrap(function _callee211$(e){for(;;)switch(e.prev=e.next){case 0:if(this._prefix.isAnchored()){e.next=2;break}return e.abrupt("return",!1);case 2:e.next=4;return this._prefix.verify();case 4:e.t0=!e.sent;if(e.t0){e.next=9;break}e.next=8;return this._suffix.verify();case 8:e.t0=!e.sent;case 9:if(!e.t0){e.next=11;break}return e.abrupt("return",!1);case 11:if(!(this._suffix.length>0)||this._suffix.tail.isImmediateSuccessorOf(this._prefix.head.header)){e.next=13;break}return e.abrupt("return",!1);case 13:if(this._verifyDifficulty()){e.next=15;break}return e.abrupt("return",!1);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}},_callee211,this)}));return function verify(){return e.apply(this,arguments)}}()},{key:"_verifyDifficulty",value:function _verifyDifficulty(){for(var e=this.prefix.denseSuffix().map(function(e){return e.header}).concat(this.suffix.headers),t=new J(0),n=[],r=0;r<e.length;r++){t=t.plus(e[r].difficulty);n[r]=new J(t)}for(var i=e.length-2,s=i-re.DIFFICULTY_BLOCK_WINDOW;s>=0&&i>=0;){var o=e[i],u=e[s],c=n[i].minus(n[s]),l=De.getNextTarget(o,u,c),h=De.targetToCompact(l),f=e[i+1];if(f.nBits!==h){a.w(ChainProof,"Block target mismatch: expected=".concat(h,", got=").concat(f.nBits));return!1}--i;0===s&&1===u.height||--s}return!0}},{key:"toString",value:function toString(){return"ChainProof{prefix=".concat(this._prefix.length,", suffix=").concat(this._suffix.length,", height=").concat(this.head.height,"}")}},{key:"serializedSize",get:function get(){return this._prefix.serializedSize+this._suffix.serializedSize}},{key:"prefix",get:function get(){return this._prefix}},{key:"suffix",get:function get(){return this._suffix}},{key:"head",get:function get(){return this._suffix.length>0?this._suffix.head:this._prefix.head.header}}],[{key:"unserialize",value:function unserialize(e){return new ChainProof(Ze.unserialize(e),et.unserialize(e))}}]);return ChainProof}();n.register(tt);var nt=function(){(0,_createClass2["default"])(ChainData,null,[{key:"initial",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee212(e,t){var n,r,a;return _regenerator["default"].wrap(function _callee212$(i){for(;;)switch(i.prev=i.next){case 0:i.next=2;return e.pow();case 2:n=i.sent;r=De.realDifficulty(n);a=De.getHashDepth(n);t?t=t.copyAndAdd(a):(t=new rt).add(a);return i.abrupt("return",new ChainData(e,e.difficulty,r,t,!0));case 7:case"end":return i.stop()}},_callee212)}));return function initial(t,n){return e.apply(this,arguments)}}()}]);function ChainData(e,t,n,r){var a=arguments.length>4&&arguments[4]!==undefined&&arguments[4],i=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;(0,_classCallCheck2["default"])(this,ChainData);this._head=e;this._totalDifficulty=t;this._totalWork=n;this._superBlockCounts=r;this._onMainChain=a;this._mainChainSuccessor=i;this._height=e.height}(0,_createClass2["default"])(ChainData,[{key:"toObj",value:function toObj(){R.that(this._head.header._pow instanceof ie,"Expected cached PoW hash");return{_head:this._head.toLight().serialize(),_totalDifficulty:this._totalDifficulty.toString(),_totalWork:this._totalWork.toString(),_superBlockCounts:this._superBlockCounts.array,_onMainChain:this._onMainChain,_mainChainSuccessor:this._mainChainSuccessor?this._mainChainSuccessor.serialize():null,_height:this._head.height,_pow:this._head.header._pow.serialize()}}},{key:"shallowCopy",value:function shallowCopy(){return new ChainData(this.head.shallowCopy(),this.totalDifficulty,this.totalWork,this.superBlockCounts,this.onMainChain,this.mainChainSuccessor)}},{key:"nextChainData",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee213(e){var t,n,r,a;return _regenerator["default"].wrap(function _callee213$(i){for(;;)switch(i.prev=i.next){case 0:R.that(this._totalDifficulty>0);i.next=3;return e.pow();case 3:t=i.sent;n=this.totalDifficulty.plus(e.difficulty);r=this.totalWork.plus(De.realDifficulty(t));a=this.superBlockCounts.copyAndAdd(De.getHashDepth(t));return i.abrupt("return",new ChainData(e,n,r,a));case 8:case"end":return i.stop()}},_callee213,this)}));return function nextChainData(t){return e.apply(this,arguments)}}()},{key:"previousChainData",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee214(e){var t,n,r,a;return _regenerator["default"].wrap(function _callee214$(i){for(;;)switch(i.prev=i.next){case 0:R.that(this._totalDifficulty>0);i.next=3;return this.head.pow();case 3:t=i.sent;n=this.totalDifficulty.minus(this.head.difficulty);r=this.totalWork.minus(De.realDifficulty(t));a=this.superBlockCounts.copyAndSubtract(De.getHashDepth(t));return i.abrupt("return",new ChainData(e,n,r,a));case 8:case"end":return i.stop()}},_callee214,this)}));return function previousChainData(t){return e.apply(this,arguments)}}()},{key:"head",get:function get(){return this._head}},{key:"totalDifficulty",get:function get(){return this._totalDifficulty}},{key:"totalWork",get:function get(){return this._totalWork}},{key:"superBlockCounts",get:function get(){return this._superBlockCounts}},{key:"onMainChain",get:function get(){return this._onMainChain},set:function set(e){this._onMainChain=e}},{key:"mainChainSuccessor",get:function get(){return this._mainChainSuccessor},set:function set(e){this._mainChainSuccessor=e}}],[{key:"fromObj",value:function fromObj(e,t){if(!e)return null;var n=Je.unserialize(new U(e._head));n.header._pow=ie.unserialize(new U(e._pow));n.header._hash=t?ie.fromBase64(t):null;var r=new rt(e._superBlockCounts),a=e._mainChainSuccessor?ie.unserialize(new U(e._mainChainSuccessor)):null;return new ChainData(n,new J(e._totalDifficulty),new J(e._totalWork),r,e._onMainChain,a)}}]);return ChainData}();n.register(nt);var rt=function(){function SuperBlockCounts(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];(0,_classCallCheck2["default"])(this,SuperBlockCounts);this._arr=e}(0,_createClass2["default"])(SuperBlockCounts,[{key:"add",value:function add(e){R.that(Y.isUint8(e));for(var t=0;t<=e;t++)this._arr[t]=this.get(t)+1}},{key:"subtract",value:function subtract(e){R.that(Y.isUint8(e));for(var t=0;t<=e;t++){this._arr[t]--;R.that(this._arr[t]>=0)}}},{key:"copyAndAdd",value:function copyAndAdd(e){var t=new SuperBlockCounts(this._arr.slice());t.add(e);return t}},{key:"copyAndSubtract",value:function copyAndSubtract(e){var t=new SuperBlockCounts(this._arr.slice());t.subtract(e);return t}},{key:"get",value:function get(e){R.that(Y.isUint8(e));return this._arr[e]||0}},{key:"getCandidateDepth",value:function getCandidateDepth(e){for(var t=this._arr.length-1;t>=0;t--)if(this._arr[t]>=e)return t;return 0}},{key:"length",get:function get(){return this._arr.length}},{key:"array",get:function get(){return this._arr}}]);return SuperBlockCounts}();n.register(rt);var at=function(){(0,_createClass2["default"])(ChainDataStore,null,[{key:"initPersistent",value:function initPersistent(e){var t=e.createObjectStore("ChainData",{codec:new it,enableLruCache:ChainDataStore.CHAINDATA_CACHING_ENABLED,lruCacheSize:ChainDataStore.CHAINDATA_CACHE_SIZE});ChainDataStore._createIndexes(t);e.createObjectStore("Block",{codec:new st,enableLruCache:ChainDataStore.BLOCKS_CACHING_ENABLED,lruCacheSize:ChainDataStore.BLOCKS_CACHE_SIZE,rawLruCacheSize:ChainDataStore.BLOCKS_RAW_CACHE_SIZE})}},{key:"getPersistent",value:function getPersistent(e){return new ChainDataStore(e.getObjectStore("ChainData"),e.getObjectStore("Block"))}},{key:"createVolatile",value:function createVolatile(){var e=JDB.JungleDB.createVolatileObjectStore({codec:new it}),t=JDB.JungleDB.createVolatileObjectStore({codec:new st});ChainDataStore._createIndexes(e);return new ChainDataStore(e,t)}},{key:"_createIndexes",value:function _createIndexes(e){e.createIndex("height",["_height"],{lmdbKeyEncoding:JDB.JungleDB.NUMBER_ENCODING,leveldbKeyEncoding:JDB.JungleDB.NUMBER_ENCODING})}}]);function ChainDataStore(e,t){(0,_classCallCheck2["default"])(this,ChainDataStore);this._chainStore=e;this._blockStore=t}(0,_createClass2["default"])(ChainDataStore,[{key:"getChainData",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee215(e){var t,n,r,a=arguments;return _regenerator["default"].wrap(function _callee215$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined&&a[1];i.next=3;return this._chainStore.get(e.toBase64());case 3:(n=i.sent)&&(n=n.shallowCopy());if(n&&t){i.next=7;break}return i.abrupt("return",n);case 7:i.next=9;return this._blockStore.get(e.toBase64());case 9:(r=i.sent)&&r.isFull()&&(n.head._body=r.body);return i.abrupt("return",n);case 12:case"end":return i.stop()}},_callee215,this)}));return function getChainData(t){return e.apply(this,arguments)}}()},{key:"putChainData",value:function putChainData(e,t){var n=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2],r=t.shallowCopy();r.head._body=null;if(this._chainStore instanceof JDB.Transaction){this._chainStore.putSync(e.toBase64(),r);n&&t.head.isFull()&&this._blockStore.putSync(e.toBase64(),t.head);return _promise["default"].resolve(!0)}if(n&&t.head.isFull()){var a=this._chainStore.synchronousTransaction();a.putSync(e.toBase64(),r);var i=this._blockStore.synchronousTransaction();i.putSync(e.toBase64(),t.head);return JDB.JungleDB.commitCombined(a,i)}return this._chainStore.put(e.toBase64(),r)}},{key:"putChainDataSync",value:function putChainDataSync(e,t){var n=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2],r=t.shallowCopy();r.head._body=null;R.that(this._chainStore instanceof JDB.Transaction);this._chainStore.putSync(e.toBase64(),r);n&&t.head.isFull()&&this._blockStore.putSync(e.toBase64(),t.head)}},{key:"removeChainDataSync",value:function removeChainDataSync(e){R.that(this._chainStore instanceof JDB.Transaction);this._chainStore.removeSync(e.toBase64());this._blockStore.removeSync(e.toBase64())}},{key:"getBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee216(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee216$(a){for(;;)switch(a.prev=a.next){case 0:if(!(r.length>1&&r[1]!==undefined&&r[1])){a.next=7;break}a.next=4;return this._blockStore.get(e.toBase64());case 4:if(!(t=a.sent)){a.next=7;break}return a.abrupt("return",t);case 7:a.next=9;return this._chainStore.get(e.toBase64());case 9:n=a.sent;return a.abrupt("return",n?n.head:null);case 11:case"end":return a.stop()}},_callee216,this)}));return function getBlock(t){return e.apply(this,arguments)}}()},{key:"getRawBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee217(e){var t,n,r,a=arguments;return _regenerator["default"].wrap(function _callee217$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined&&a[1];i.next=3;return this._chainStore.get(e.toBase64());case 3:if((n=i.sent)&&(n.onMainChain||t)){i.next=6;break}return i.abrupt("return",null);case 6:i.next=8;return this._blockStore.get(e.toBase64(),{raw:!0});case 8:if(!(r=i.sent)){i.next=11;break}return i.abrupt("return",new Uint8Array(r));case 11:return i.abrupt("return",null);case 12:case"end":return i.stop()}},_callee217,this)}));return function getRawBlock(t){return e.apply(this,arguments)}}()},{key:"getChainDataCandidatesAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee218(e){var t;return _regenerator["default"].wrap(function _callee218$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this._chainStore.values(JDB.Query.eq("height",e));case 2:if((t=n.sent)&&t.length){n.next=5;break}return n.abrupt("return",undefined);case 5:return n.abrupt("return",t);case 6:case"end":return n.stop()}},_callee218,this)}));return function getChainDataCandidatesAt(t){return e.apply(this,arguments)}}()},{key:"getChainDataAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee219(e){var t,n,r,a,i,s,o,u,c,l,h=arguments;return _regenerator["default"].wrap(function _callee219$(f){for(;;)switch(f.prev=f.next){case 0:t=h.length>1&&h[1]!==undefined&&h[1];f.next=3;return this.getChainDataCandidatesAt(e);case 3:if(n=f.sent){f.next=6;break}return f.abrupt("return",undefined);case 6:r=!0;a=!1;i=undefined;f.prev=9;s=(0,_getIterator2["default"])(n);case 11:if(r=(o=s.next()).done){f.next=24;break}if(!(u=o.value).onMainChain){f.next=21;break}c=u.shallowCopy();if(!t){f.next=20;break}f.next=18;return this._blockStore.get(u.head.hash().toBase64());case 18:(l=f.sent)&&(c.head._body=l.body);case 20:return f.abrupt("return",c);case 21:r=!0;f.next=11;break;case 24:f.next=30;break;case 26:f.prev=26;f.t0=f["catch"](9);a=!0;i=f.t0;case 30:f.prev=30;f.prev=31;r||null==s["return"]||s["return"]();case 33:f.prev=33;if(!a){f.next=36;break}throw i;case 36:return f.finish(33);case 37:return f.finish(30);case 38:return f.abrupt("return",null);case 39:case"end":return f.stop()}},_callee219,this,[[9,26,30,38],[31,,33,37]])}));return function getChainDataAt(t){return e.apply(this,arguments)}}()},{key:"getBlockAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee220(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee220$(a){for(;;)switch(a.prev=a.next){case 0:t=r.length>1&&r[1]!==undefined&&r[1];a.next=3;return this.getChainDataAt(e,t);case 3:n=a.sent;return a.abrupt("return",n?n.head:null);case 5:case"end":return a.stop()}},_callee220,this)}));return function getBlockAt(t){return e.apply(this,arguments)}}()},{key:"getSuccessorBlocks",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee221(e){var t,n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee221$(c){for(;;)switch(c.prev=c.next){case 0:c.next=2;return this.getChainDataCandidatesAt(e.height+1);case 2:if(t=c.sent){c.next=5;break}return c.abrupt("return",[]);case 5:n=[];r=!0;a=!1;i=undefined;c.prev=9;for(s=(0,_getIterator2["default"])(t);!(r=(o=s.next()).done);r=!0)(u=o.value).head.prevHash.equals(e.hash())&&n.push(u.head);c.next=17;break;case 13:c.prev=13;c.t0=c["catch"](9);a=!0;i=c.t0;case 17:c.prev=17;c.prev=18;r||null==s["return"]||s["return"]();case 20:c.prev=20;if(!a){c.next=23;break}throw i;case 23:return c.finish(20);case 24:return c.finish(17);case 25:return c.abrupt("return",n);case 26:case"end":return c.stop()}},_callee221,this,[[9,13,17,25],[18,,20,24]])}));return function getSuccessorBlocks(t){return e.apply(this,arguments)}}()},{key:"getNearestBlockAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee222(e){var t,n,r,a,i,s,o,u,c,l=arguments;return _regenerator["default"].wrap(function _callee222$(h){for(;;)switch(h.prev=h.next){case 0:t=!(l.length>1&&l[1]!==undefined)||l[1];n=this._chainStore.index("height");if(!t){h.next=8;break}h.next=5;return n.maxValues(JDB.KeyRange.upperBound(e));case 5:h.t0=h.sent;h.next=11;break;case 8:h.next=10;return n.minValues(JDB.KeyRange.lowerBound(e));case 10:h.t0=h.sent;case 11:if((r=h.t0)&&r.length){h.next=14;break}return h.abrupt("return",undefined);case 14:a=!0;i=!1;s=undefined;h.prev=17;o=(0,_getIterator2["default"])(r);case 19:if(a=(u=o.next()).done){h.next=26;break}if(!(c=u.value).onMainChain){h.next=23;break}return h.abrupt("return",c.head);case 23:a=!0;h.next=19;break;case 26:h.next=32;break;case 28:h.prev=28;h.t1=h["catch"](17);i=!0;s=h.t1;case 32:h.prev=32;h.prev=33;a||null==o["return"]||o["return"]();case 35:h.prev=35;if(!i){h.next=38;break}throw s;case 38:return h.finish(35);case 39:return h.finish(32);case 40:return h.abrupt("return",null);case 41:case"end":return h.stop()}},_callee222,this,[[17,28,32,40],[33,,35,39]])}));return function getNearestBlockAt(t){return e.apply(this,arguments)}}()},{key:"getBlocks",value:function getBlocks(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:500,n=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2];return t<=0?_promise["default"].resolve([]):n?this.getBlocksForward(e,t):this.getBlocksBackward(e,t)}},{key:"getBlocksForward",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee223(e){var t,n,r,a=arguments;return _regenerator["default"].wrap(function _callee223$(i){for(;;)switch(i.prev=i.next){case 0:t=a.length>1&&a[1]!==undefined?a[1]:500;i.next=3;return this._chainStore.get(e.toBase64());case 3:if(n=i.sent){i.next=6;break}return i.abrupt("return",[]);case 6:r=[];case 7:if(!(r.length<t&&n.mainChainSuccessor)){i.next=16;break}i.next=10;return this._chainStore.get(n.mainChainSuccessor.toBase64());case 10:if(n=i.sent){i.next=13;break}return i.abrupt("return",r);case 13:r.push(n.head);i.next=7;break;case 16:return i.abrupt("return",r);case 17:case"end":return i.stop()}},_callee223,this)}));return function getBlocksForward(t){return e.apply(this,arguments)}}()},{key:"getBlocksBackward",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee224(e){var t,n,r,a,i,s,o=this,u=arguments;return _regenerator["default"].wrap(function _callee224$(c){for(;;)switch(c.prev=c.next){case 0:t=u.length>1&&u[1]!==undefined?u[1]:500;n=u.length>2&&u[2]!==undefined&&u[2];r=n?function(e){return o._blockStore.get(e)}:function(e){return o._chainStore.get(e).then(function(e){return e.head})};c.next=5;return this._chainStore.get(e.toBase64());case 5:if(a=c.sent){c.next=8;break}return c.abrupt("return",[]);case 8:i=a.head;s=[];case 10:if(!(s.length<t&&i.height>1)){c.next=19;break}c.next=13;return r(i.prevHash.toBase64());case 13:if(i=c.sent){c.next=16;break}return c.abrupt("return",s);case 16:s.push(i);c.next=10;break;case 19:return c.abrupt("return",s);case 20:case"end":return c.stop()}},_callee224,this)}));return function getBlocksBackward(t){return e.apply(this,arguments)}}()},{key:"getHead",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee225(){var e;return _regenerator["default"].wrap(function _callee225$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._chainStore.get("main");case 2:e=t.sent;return t.abrupt("return",e?ie.fromBase64(e):undefined);case 4:case"end":return t.stop()}},_callee225,this)}));return function getHead(){return e.apply(this,arguments)}}()},{key:"setHead",value:function setHead(e){return this._chainStore.put("main",e.toBase64())}},{key:"setHeadSync",value:function setHeadSync(e){R.that(this._chainStore instanceof JDB.SynchronousTransaction);this._chainStore.putSync("main",e.toBase64())}},{key:"transaction",value:function transaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];return new ChainDataStore(this._chainStore.transaction(e),this._blockStore.transaction(e))}},{key:"synchronousTransaction",value:function synchronousTransaction(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];return new ChainDataStore(this._chainStore.synchronousTransaction(e),this._blockStore.synchronousTransaction(e))}},{key:"commit",value:function commit(){return this._chainStore instanceof JDB.Transaction?JDB.JungleDB.commitCombined(this._chainStore,this._blockStore):_promise["default"].resolve()}},{key:"abort",value:function abort(){return _promise["default"].all([this._chainStore.abort(),this._blockStore.abort()])}},{key:"snapshot",value:function snapshot(){return new ChainDataStore(this._chainStore.snapshot(),this._blockStore.snapshot())}},{key:"truncate",value:function truncate(){if(this._chainStore instanceof JDB.Transaction){this._chainStore.truncateSync();this._blockStore.truncateSync();return _promise["default"].resolve(!0)}var e=this._chainStore.transaction();e.truncateSync();var t=this._blockStore.transaction();t.truncateSync();return JDB.JungleDB.commitCombined(e,t)}},{key:"txs",get:function get(){return this._chainStore instanceof JDB.Transaction?[this._chainStore,this._blockStore]:[]}}]);return ChainDataStore}();at.CHAINDATA_CACHING_ENABLED=!0;at.CHAINDATA_CACHE_SIZE=5e3;at.BLOCKS_CACHING_ENABLED=!0;at.BLOCKS_CACHE_SIZE=0;at.BLOCKS_RAW_CACHE_SIZE=500;n.register(at);var it=function(){function ChainDataStoreCodec(){(0,_classCallCheck2["default"])(this,ChainDataStoreCodec)}(0,_createClass2["default"])(ChainDataStoreCodec,[{key:"encode",value:function encode(e){return"string"==typeof e?e:e.toObj()}},{key:"decode",value:function decode(e,t){return"string"==typeof e?e:nt.fromObj(e,t)}},{key:"valueEncoding",get:function get(){return JDB.JungleDB.JSON_ENCODING}}]);return ChainDataStoreCodec}(),st=function(){function BlockStoreCodec(){(0,_classCallCheck2["default"])(this,BlockStoreCodec)}(0,_createClass2["default"])(BlockStoreCodec,[{key:"encode",value:function encode(e){return e.serialize()}},{key:"decode",value:function decode(e,t){var n=Je.unserialize(new U(e));n.header._hash=ie.fromBase64(t);return n}},{key:"valueEncoding",get:function get(){return JDB.JungleDB.BINARY_ENCODING}}]);return BlockStoreCodec}(),ot=function(){function MempoolTransactionSet(e){(0,_classCallCheck2["default"])(this,MempoolTransactionSet);this._transactions=new O(e)}(0,_createClass2["default"])(MempoolTransactionSet,[{key:"add",value:function add(e){this._transactions.add(e);return this}},{key:"remove",value:function remove(e){this._transactions.remove(e);return this}},{key:"copyAndAdd",value:function copyAndAdd(e){var t=this._transactions.copy();t.add(e);return new MempoolTransactionSet(t.values())}},{key:"numBelowFeePerByte",value:function numBelowFeePerByte(e){var t=0,n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(this._transactions);!(n=(i=s.next()).done);n=!0){i.value.feePerByte<e&&t++}}catch(o){r=!0;a=o}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}return t}},{key:"toString",value:function toString(){return"MempoolTransactionSet{length=".concat(this.length,"}")}},{key:"transactions",get:function get(){return this._transactions.values()}},{key:"sender",get:function get(){return this._transactions.length>0?this._transactions.values()[0].sender:null}},{key:"senderType",get:function get(){return this._transactions.length>0?this._transactions.values()[0].senderType:undefined}},{key:"length",get:function get(){return this._transactions.length}}]);return MempoolTransactionSet}();n.register(ot);var ut=function(){function MempoolFilter(){(0,_classCallCheck2["default"])(this,MempoolFilter);this._blacklist=new T(MempoolFilter.BLACKLIST_SIZE)}(0,_createClass2["default"])(MempoolFilter,[{key:"acceptsTransaction",value:function acceptsTransaction(e){return e.fee>=MempoolFilter.FEE&&e.value>=MempoolFilter.VALUE&&e.value+e.fee>=MempoolFilter.TOTAL_VALUE&&(!e.hasFlag(ze.Flag.CONTRACT_CREATION)||e.fee>=MempoolFilter.CONTRACT_FEE&&e.feePerByte>=MempoolFilter.CONTRACT_FEE_PER_BYTE&&e.value>=MempoolFilter.CONTRACT_VALUE)}},{key:"acceptsRecipientAccount",value:function acceptsRecipientAccount(e,t,n){return n.balance>=MempoolFilter.RECIPIENT_BALANCE&&(!t.isInitial()||e.fee>=MempoolFilter.CREATION_FEE&&e.feePerByte>=MempoolFilter.CREATION_FEE_PER_BYTE&&e.value>=MempoolFilter.CREATION_VALUE)}},{key:"acceptsSenderAccount",value:function acceptsSenderAccount(e,t,n){return n.balance>=MempoolFilter.SENDER_BALANCE||n.isInitial()||n.isToBePruned()}},{key:"blacklist",value:function blacklist(e){this._blacklist.add(e)}},{key:"isBlacklisted",value:function isBlacklisted(e){return this._blacklist.contains(e)}}]);return MempoolFilter}();ut.BLACKLIST_SIZE=25e3;ut.FEE=0;ut.VALUE=0;ut.TOTAL_VALUE=0;ut.RECIPIENT_BALANCE=0;ut.SENDER_BALANCE=0;ut.CREATION_FEE=0;ut.CREATION_FEE_PER_BYTE=0;ut.CREATION_VALUE=0;ut.CONTRACT_FEE=0;ut.CONTRACT_FEE_PER_BYTE=0;ut.CONTRACT_VALUE=0;n.register(ut);var ct=function(e){(0,_inherits2["default"])(Mempool,e);var t=_createSuper(Mempool);function Mempool(e,n){var r;(0,_classCallCheck2["default"])(this,Mempool);(r=t.call(this))._blockchain=e;r._accounts=n;r._transactionsByFeePerByte=new O;r._transactionsByHash=new b;r._transactionSetBySender=new b;r._transactionSetByRecipient=new b;r._filter=new ut;r._synchronizer=new z;e.on("head-changed",function(e,t){t||r._evictTransactions()["catch"](a.e.tag(Mempool))});e.on("rebranched",function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee226(e){return _regenerator["default"].wrap(function _callee226$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return r._evictTransactions();case 2:t.next=4;return r._restoreTransactions(e);case 4:case"end":return t.stop()}},_callee226)}));return function(t){return e.apply(this,arguments)}}());return r}(0,_createClass2["default"])(Mempool,[{key:"pushTransaction",value:function pushTransaction(e){var t=this;return this._synchronizer.push(function(){return t._pushTransaction(e)})}},{key:"_pushTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee227(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m=this;return _regenerator["default"].wrap(function _callee227$(b){for(;;)switch(b.prev=b.next){case 0:t=e.hash();if(!this._transactionsByHash.contains(t)){b.next=3;break}return b.abrupt("return",Mempool.ReturnCode.KNOWN);case 3:if(this._filter.acceptsTransaction(e)){b.next=6;break}this._filter.blacklist(t);return b.abrupt("return",Mempool.ReturnCode.FILTERED);case 6:n=this._transactionSetBySender.get(e.sender)||new ot;if(!(e.fee/e.serializedSize<Mempool.TRANSACTION_RELAY_FEE_MIN&&n.numBelowFeePerByte(Mempool.TRANSACTION_RELAY_FEE_MIN)>=Mempool.FREE_TRANSACTIONS_PER_SENDER_MAX)){b.next=9;break}return b.abrupt("return",Mempool.ReturnCode.FEE_TOO_LOW);case 9:if(e.verify()){b.next=11;break}return b.abrupt("return",Mempool.ReturnCode.INVALID);case 11:b.prev=11;b.next=14;return this._accounts.get(e.recipient);case 14:r=b.sent;i=r.withIncomingTransaction(e,this._blockchain.height+1).withContractCommand(e,this._blockchain.height+1);if(this._filter.acceptsRecipientAccount(e,r,i)){b.next=19;break}this._filter.blacklist(t);return b.abrupt("return",Mempool.ReturnCode.FILTERED);case 19:b.next=25;break;case 21:b.prev=21;b.t0=b["catch"](11);a.d(Mempool,function(){return"Rejected transaction ".concat(t.toHex()," from ").concat(e.sender.toUserFriendlyAddress()," - ").concat(b.t0.message)});return b.abrupt("return",Mempool.ReturnCode.INVALID);case 25:b.prev=25;b.next=28;return this._accounts.get(e.sender,e.senderType);case 28:s=b.sent;b.next=35;break;case 31:b.prev=31;b.t1=b["catch"](25);a.d(Mempool,function(){return"Rejected transaction ".concat(t.toHex()," from ").concat(e.sender.toUserFriendlyAddress()," - ").concat(b.t1.message)});return b.abrupt("return",Mempool.ReturnCode.INVALID);case 35:o=[];u=[];c=s;l=!0;h=!1;f=undefined;b.prev=41;d=function _loop11(){var t=_.value,n="transactions per sender exceeded",r=void 0;try{if(o.length<Mempool.TRANSACTIONS_PER_SENDER_MAX){c=c.withOutgoingTransaction(t,m._blockchain.height+1,m._blockchain.transactionCache);o.push(t);return"continue"}}catch(i){r=i;n=i.message}if(t.equals(e)){a.d(Mempool,function(){return"Rejected transaction from ".concat(e.sender.toUserFriendlyAddress()," - ").concat(n)});return r instanceof ye.DoubleTransactionError?{v:Mempool.ReturnCode.MINED}:r instanceof ye.ValidityError?{v:Mempool.ReturnCode.EXPIRED}:{v:Mempool.ReturnCode.INVALID}}u.push(t)};A=(0,_getIterator2["default"])(n.copyAndAdd(e).transactions);case 44:if(l=(_=A.next()).done){b.next=55;break}p=d();b.t2=p;b.next="continue"===b.t2?49:50;break;case 49:return b.abrupt("continue",52);case 50:if("object"!==(0,_typeof2["default"])(p)){b.next=52;break}return b.abrupt("return",p.v);case 52:l=!0;b.next=44;break;case 55:b.next=61;break;case 57:b.prev=57;b.t3=b["catch"](41);h=!0;f=b.t3;case 61:b.prev=61;b.prev=62;l||null==A["return"]||A["return"]();case 64:b.prev=64;if(!h){b.next=67;break}throw f;case 67:return b.finish(64);case 68:return b.finish(61);case 69:if(this._filter.acceptsSenderAccount(e,s,c)){b.next=72;break}this._filter.blacklist(t);return b.abrupt("return",Mempool.ReturnCode.FILTERED);case 72:for(g=0,y=u;g<y.length;g++){v=y[g];this._removeTransaction(v)}this._transactionsByFeePerByte.add(e);this._transactionsByHash.put(t,e);this._transactionSetBySender.put(e.sender,new ot(o));(k=this._transactionSetByRecipient.get(e.recipient)||new w).add(e.hash());this._transactionSetByRecipient.put(e.recipient,k);this.fire("transaction-added",e);this._transactionsByFeePerByte.length>Mempool.SIZE_MAX&&this._popLowFeeTransaction();return b.abrupt("return",Mempool.ReturnCode.ACCEPTED);case 82:case"end":return b.stop()}},_callee227,this,[[11,21],[25,31],[41,57,61,69],[62,,64,68]])}));return function _pushTransaction(t){return e.apply(this,arguments)}}()},{key:"_popLowFeeTransaction",value:function _popLowFeeTransaction(){var e=this._transactionsByFeePerByte.pop(),t=this._transactionSetBySender.get(e.sender);t.remove(e);0===t.length&&this._transactionSetBySender.remove(e.sender);var n=this._transactionSetByRecipient.get(e.recipient);n?1===n.length?this._transactionSetByRecipient.remove(e.recipient):n.remove(e.hash()):a.e(Mempool,"Invalid state: no transactionsByRecipient for ".concat(e));this._transactionsByHash.remove(e.hash());this.fire("transaction-removed",e)}},{key:"_removeTransaction",value:function _removeTransaction(e){this._transactionsByHash.remove(e.hash());this._transactionsByFeePerByte.remove(e);var t=this._transactionSetByRecipient.get(e.recipient);if(t){1===t.length?this._transactionSetByRecipient.remove(e.recipient):t.remove(e.hash());this.fire("transaction-removed",e)}else a.e(Mempool,"Invalid state: no transactionsByRecipient for ".concat(e))}},{key:"getTransaction",value:function getTransaction(e){return this._transactionsByHash.get(e)}},{key:"transactionGenerator",value:_regenerator["default"].mark(function transactionGenerator(){var e,t,n,r,a,i,s,o,u,c,l=arguments;return _regenerator["default"].wrap(function transactionGenerator$(h){for(;;)switch(h.prev=h.next){case 0:e=l.length>0&&l[0]!==undefined?l[0]:Infinity;t=l.length>1&&l[1]!==undefined?l[1]:0;n=0;r=!0;a=!1;i=undefined;h.prev=6;s=(0,_getIterator2["default"])(this._transactionsByFeePerByte);case 8:if(r=(o=s.next()).done){h.next=21;break}u=o.value;c=u.serializedSize;if(!(n+c>=e)){h.next=13;break}return h.abrupt("continue",18);case 13:if(!(u.feePerByte<t)){h.next=15;break}return h.abrupt("break",21);case 15:h.next=17;return u;case 17:n+=c;case 18:r=!0;h.next=8;break;case 21:h.next=27;break;case 23:h.prev=23;h.t0=h["catch"](6);a=!0;i=h.t0;case 27:h.prev=27;h.prev=28;r||null==s["return"]||s["return"]();case 30:h.prev=30;if(!a){h.next=33;break}throw i;case 33:return h.finish(30);case 34:return h.finish(27);case 35:case"end":return h.stop()}},transactionGenerator,this,[[6,23,27,35],[28,,30,34]])})},{key:"getTransactions",value:function getTransactions(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Infinity,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return(0,_from["default"])(this.transactionGenerator(e,t))}},{key:"getTransactionsForBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee228(e){var t,n,r,a;return _regenerator["default"].wrap(function _callee228$(i){for(;;)switch(i.prev=i.next){case 0:t=this.getTransactions(e);i.next=3;return this._accounts.gatherToBePrunedAccounts(t,this._blockchain.height+1,this._blockchain.transactionCache);case 3:n=i.sent;r=n.reduce(function(e,t){return e+t.serializedSize},0);a=r+t.reduce(function(e,t){return e+t.serializedSize},0);for(;a>e;)a-=t.pop().serializedSize;t.sort(function(e,t){return e.compareBlockOrder(t)});return i.abrupt("return",t);case 9:case"end":return i.stop()}},_callee228,this)}));return function getTransactionsForBlock(t){return e.apply(this,arguments)}}()},{key:"getPendingTransactions",value:function getPendingTransactions(e){return this.getTransactionsBySender(e)}},{key:"getTransactionsBySender",value:function getTransactionsBySender(e){var t=this._transactionSetBySender.get(e);return t?t.transactions:[]}},{key:"getTransactionsByRecipient",value:function getTransactionsByRecipient(e){var t=this._transactionSetByRecipient.get(e);if(!t)return[];var n=[],r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(t.valueIterator());!(r=(s=o.next()).done);r=!0){var u=s.value,c=this._transactionsByHash.get(u);R.that(!!c);n.push(c)}}catch(l){a=!0;i=l}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}return n}},{key:"getTransactionsByAddresses",value:function getTransactionsByAddresses(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Infinity,n=[],r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(e);!(r=(s=o.next()).done);r=!0){var u=s.value,c=this.getTransactionsBySender(u),l=!0,h=!1,f=undefined;try{for(var d,A=(0,_getIterator2["default"])(c);!(l=(d=A.next()).done);l=!0){var _=d.value;if(n.length>=t)return n;n.push(_)}}catch(w){h=!0;f=w}finally{try{l||null==A["return"]||A["return"]()}finally{if(h)throw f}}var p=this.getTransactionsByRecipient(u),g=!0,y=!1,v=undefined;try{for(var k,m=(0,_getIterator2["default"])(p);!(g=(k=m.next()).done);g=!0){var b=k.value;if(n.length>=t)return n;n.push(b)}}catch(w){y=!0;v=w}finally{try{g||null==m["return"]||m["return"]()}finally{if(y)throw v}}}}catch(w){a=!0;i=w}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}return n}},{key:"evictBelowMinFeePerByte",value:function evictBelowMinFeePerByte(e){for(var t=this._transactionsByFeePerByte.peekLast();t&&t.feePerByte<e;){this._transactionsByFeePerByte.pop();this._transactionsByHash.remove(t.hash());var n=this._transactionSetBySender.get(t.sender);1===n.length?this._transactionSetBySender.remove(t.sender):n.remove(t);var r=this._transactionSetByRecipient.get(t.recipient);1===r.length?this._transactionSetByRecipient.remove(t.recipient):r.remove(t.hash());t=this._transactionsByFeePerByte.peekLast()}}},{key:"isFiltered",value:function isFiltered(e){return this._filter.isBlacklisted(e)}},{key:"_restoreTransactions",value:function _restoreTransactions(e){var t=this;return this._synchronizer.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee229(){var n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee229$(c){for(;;)switch(c.prev=c.next){case 0:n=e.length-1;case 1:if(!(n>=0)){c.next=31;break}r=!0;a=!1;i=undefined;c.prev=5;s=(0,_getIterator2["default"])(e[n].transactions);case 7:if(r=(o=s.next()).done){c.next=14;break}u=o.value;c.next=11;return t._pushTransaction(u);case 11:r=!0;c.next=7;break;case 14:c.next=20;break;case 16:c.prev=16;c.t0=c["catch"](5);a=!0;i=c.t0;case 20:c.prev=20;c.prev=21;r||null==s["return"]||s["return"]();case 23:c.prev=23;if(!a){c.next=26;break}throw i;case 26:return c.finish(23);case 27:return c.finish(20);case 28:n--;c.next=1;break;case 31:case"end":return c.stop()}},_callee229,null,[[5,16,20,28],[21,,23,27]])})))}},{key:"_evictTransactions",value:function _evictTransactions(){var e=this;return this._synchronizer.push(function(){return e.__evictTransactions()})}},{key:"__evictTransactions",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee230(){var e,t,n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,b;return _regenerator["default"].wrap(function _callee230$(w){for(;;)switch(w.prev=w.next){case 0:e=!0;t=!1;n=undefined;w.prev=3;r=(0,_getIterator2["default"])(this._transactionSetBySender.keys());case 5:if(e=(a=r.next()).done){w.next=79;break}i=a.value;s=this._transactionSetBySender.get(i);w.prev=8;w.next=11;return this._accounts.get(s.sender,s.senderType);case 11:o=w.sent;u=[];c=o;l=!0;h=!1;f=undefined;w.prev=17;d=(0,_getIterator2["default"])(s.transactions);case 19:if(l=(A=d.next()).done){w.next=37;break}_=A.value;w.prev=21;p=c.withOutgoingTransaction(_,this._blockchain.height+1,this._blockchain.transactionCache);w.next=25;return this._accounts.get(_.recipient);case 25:w.sent.withIncomingTransaction(_,this._blockchain.height+1).withContractCommand(_,this._blockchain.height+1);u.push(_);c=p;w.next=34;break;case 31:w.prev=31;w.t0=w["catch"](21);this._removeTransaction(_);case 34:l=!0;w.next=19;break;case 37:w.next=43;break;case 39:w.prev=39;w.t1=w["catch"](17);h=!0;f=w.t1;case 43:w.prev=43;w.prev=44;l||null==d["return"]||d["return"]();case 46:w.prev=46;if(!h){w.next=49;break}throw f;case 49:return w.finish(46);case 50:return w.finish(43);case 51:0===u.length?this._transactionSetBySender.remove(i):this._transactionSetBySender.put(i,new ot(u));w.next=76;break;case 54:w.prev=54;w.t2=w["catch"](8);g=!0;y=!1;v=undefined;w.prev=59;for(k=(0,_getIterator2["default"])(s.transactions);!(g=(m=k.next()).done);g=!0){b=m.value;this._removeTransaction(b)}w.next=67;break;case 63:w.prev=63;w.t3=w["catch"](59);y=!0;v=w.t3;case 67:w.prev=67;w.prev=68;g||null==k["return"]||k["return"]();case 70:w.prev=70;if(!y){w.next=73;break}throw v;case 73:return w.finish(70);case 74:return w.finish(67);case 75:this._transactionSetBySender.remove(i);case 76:e=!0;w.next=5;break;case 79:w.next=85;break;case 81:w.prev=81;w.t4=w["catch"](3);t=!0;n=w.t4;case 85:w.prev=85;w.prev=86;e||null==r["return"]||r["return"]();case 88:w.prev=88;if(!t){w.next=91;break}throw n;case 91:return w.finish(88);case 92:return w.finish(85);case 93:this.fire("transactions-ready");case 94:case"end":return w.stop()}},_callee230,this,[[3,81,85,93],[8,54],[17,39,43,51],[21,31],[44,,46,50],[59,63,67,75],[68,,70,74],[86,,88,92]])}));return function __evictTransactions(){return e.apply(this,arguments)}}()},{key:"length",get:function get(){return this._transactionsByHash.length}},{key:"queue",get:function get(){return this._synchronizer}}]);return Mempool}(i);ct.TRANSACTION_RELAY_FEE_MIN=1;ct.TRANSACTIONS_PER_SENDER_MAX=500;ct.FREE_TRANSACTIONS_PER_SENDER_MAX=10;ct.SIZE_MAX=5e4;ct.ReturnCode={EXPIRED:-5,MINED:-4,FILTERED:-3,FEE_TOO_LOW:-2,INVALID:-1,ACCEPTED:1,KNOWN:2};n.register(ct);var lt=function(){function InvRequestManager(){(0,_classCallCheck2["default"])(this,InvRequestManager);this._vectorsToRequest=new b;this._timers=new p}(0,_createClass2["default"])(InvRequestManager,[{key:"askToRequestVector",value:function askToRequestVector(e,t){if(e.syncing||this._vectorsToRequest.length>InvRequestManager.MAX_INV_MANAGED)e.requestVector(t);else if(this._vectorsToRequest.contains(t)){var n=this._vectorsToRequest.get(t);n.current.peer.channel.closed&&(n.current=null);if(null===n.current){n.current=e;this._request(t)}else n.waiting.add(e)}else{this._vectorsToRequest.put(t,{current:e,waiting:new _set5["default"]});this._request(t)}}},{key:"_request",value:function _request(e){var t=this;R.that(this._vectorsToRequest.contains(e));var n=this._vectorsToRequest.get(e).current;R.that(n);n.requestVector(e);this._timers.resetTimeout(e.hash,function(){return t.noteVectorNotReceived(n,e)},InvRequestManager.MAX_TIME_PER_VECTOR)}},{key:"noteVectorNotReceived",value:function noteVectorNotReceived(e,t){if(this._vectorsToRequest.contains(t)){var n=this._vectorsToRequest.get(t);if(n.current!==e)n.waiting["delete"](e);else{this._timers.clearTimeout(t.hash);n.current=null;if(0!==n.waiting.size){n.current=n.waiting.values().next().value;n.waiting["delete"](n.current);this._request(t)}null===n.current&&this._vectorsToRequest.remove(t)}}}},{key:"noteVectorReceived",value:function noteVectorReceived(e){this._timers.clearTimeout(e.hash);this._vectorsToRequest.remove(e)}}]);return InvRequestManager}();lt.MAX_TIME_PER_VECTOR=1e4;lt.MAX_INV_MANAGED=1e4;n.register(lt);var ht=function(e){(0,_inherits2["default"])(BaseConsensusAgent,e);var t=_createSuper(BaseConsensusAgent);function BaseConsensusAgent(e,n,r,a){var i;(0,_classCallCheck2["default"])(this,BaseConsensusAgent);(i=t.call(this))._time=e;i._peer=n;i._synced=!1;i._knownObjects=new T(BaseConsensusAgent.KNOWN_OBJECTS_COUNT_MAX);i._knownObjects.add(new Gt(Gt.Type.BLOCK,n.headHash));i._blocksToRequest=new P;i._txsToRequest=new N(BaseConsensusAgent.TRANSACTIONS_AT_ONCE+BaseConsensusAgent.FREE_TRANSACTIONS_AT_ONCE,BaseConsensusAgent.TRANSACTIONS_PER_SECOND+BaseConsensusAgent.FREE_TRANSACTIONS_PER_SECOND,1e3,BaseConsensusAgent.REQUEST_TRANSACTIONS_WAITING_MAX);i._objectsInFlight=new w;i._objectsThatFlew=new w;i._objectsProcessing=new w;i._remoteSubscription=Ue.NONE;i._localSubscription=Ue.NONE;i._lastSubscriptionChange=null;i._targetSubscription=a||Ue.ANY;i._timers=new p;i._waitingInvVectors=new N(BaseConsensusAgent.TRANSACTIONS_AT_ONCE,BaseConsensusAgent.TRANSACTIONS_PER_SECOND,1e3,BaseConsensusAgent.REQUEST_TRANSACTIONS_WAITING_MAX);i._timers.setInterval("invVectors",function(){return i._sendWaitingInvVectors()},BaseConsensusAgent.TRANSACTION_RELAY_INTERVAL);i._waitingFreeInvVectors=new N(BaseConsensusAgent.FREE_TRANSACTIONS_AT_ONCE,BaseConsensusAgent.FREE_TRANSACTIONS_PER_SECOND,1e3,BaseConsensusAgent.REQUEST_TRANSACTIONS_WAITING_MAX);i._timers.setInterval("freeInvVectors",function(){return i._sendFreeWaitingInvVectors()},BaseConsensusAgent.FREE_TRANSACTION_RELAY_INTERVAL);i._blockProofRequest=null;i._transactionsProofRequest=null;i._transactionReceiptsRequest=null;i._pendingRequests=new b;i._synchronizer=new H;i._invRequestManager=r;i._listenersToDisconnect=new _set5["default"];i._onToDisconnect(n.channel,"inv",function(e){return i._onInv(e)});i._onToDisconnect(n.channel,"block",function(e){return i._onBlock(e)});i._onToDisconnect(n.channel,"header",function(e){return i._onHeader(e)});i._onToDisconnect(n.channel,"tx",function(e){return i._onTx(e)});i._onToDisconnect(n.channel,"not-found",function(e){return i._onNotFound(e)});i._onToDisconnect(n.channel,"subscribe",function(e){return i._onSubscribe(e)});i._onToDisconnect(n.channel,"get-data",function(e){return i._onGetData(e)});i._onToDisconnect(n.channel,"get-header",function(e){return i._onGetHeader(e)});i._onToDisconnect(n.channel,"block-proof",function(e){return i._onBlockProof(e)});i._onToDisconnect(n.channel,"transactions-proof",function(e){return i._onTransactionsProof(e)});i._onToDisconnect(n.channel,"transaction-receipts",function(e){return i._onTransactionReceipts(e)});i._onToDisconnect(n.channel,"mempool",function(e){return i._onMempool(e)});i._onToDisconnect(n.channel,"get-head",function(e){return i._onGetHead(e)});i._onToDisconnect(n.channel,"head",function(e){return i._onHead(e)});i._onToDisconnect(n.channel,"close",function(){return i._onClose()});i._requestHead();return i}(0,_createClass2["default"])(BaseConsensusAgent,[{key:"_onToDisconnect",value:function _onToDisconnect(e,t,n){var r=e.on(t,n);this._listenersToDisconnect.add({obj:e,type:t,id:r})}},{key:"_disconnectListeners",value:function _disconnectListeners(){var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._listenersToDisconnect);!(e=(r=a.next()).done);e=!0){var i=r.value;i.obj.off(i.type,i.id)}}catch(s){t=!0;n=s}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}this._offAll()}},{key:"providesServices",value:function providesServices(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return _.providesServices.apply(_,[this._peer.peerAddress.services].concat(t))}},{key:"_requestHead",value:function _requestHead(){this._peer.channel.getHead()}},{key:"onHeadUpdated",value:function onHeadUpdated(){var e=this;this._timers.resetTimeout("get-next-head",function(){return e._requestHead()},BaseConsensusAgent.HEAD_REQUEST_INTERVAL)}},{key:"_onGetHead",value:function _onGetHead(e){this._peer.channel.head(this._blockchain.head.header)}},{key:"_onHead",value:function _onHead(e){this._peer.head=e.header;this.onHeadUpdated()}},{key:"subscribe",value:function subscribe(e){this._targetSubscription=e;this._subscribe(e)}},{key:"_subscribeTarget",value:function _subscribeTarget(){this._subscribe(this._targetSubscription)}},{key:"_subscribe",value:function _subscribe(e){this._localSubscription=e;this._lastSubscriptionChange=(0,_now["default"])();this._peer.channel.subscribe(this._localSubscription)}},{key:"relayBlock",value:function relayBlock(e){var t=this;if(!this._synced)return!1;if(!this._remoteSubscription.matchesBlock(e))return!1;var n=Gt.fromBlock(e);if(this._knownObjects.contains(n))return!1;this._peer.channel.inv([n].concat((0,_toConsumableArray2["default"])(this._waitingInvVectors.dequeueMulti(Ft.VECTORS_MAX_COUNT-1))));this._timers.timeoutExists("knows-block-".concat(n.hash.toBase64()))||this._timers.setTimeout("knows-block-".concat(n.hash.toBase64()),function(){t._knownObjects.add(n)},BaseConsensusAgent.KNOWS_OBJECT_AFTER_INV_DELAY);return!0}},{key:"requestBlock",value:function requestBlock(e){var t=this;return new _promise["default"](function(n,r){var a=new Gt(Gt.Type.BLOCK,e);if(t._pendingRequests.contains(a))t._pendingRequests.get(a).push({resolve:n,reject:r});else{t._pendingRequests.put(a,[{resolve:n,reject:r}]);t._peer.channel.getData([a]);t._timers.setTimeout("block-request-".concat(a.hash.toBase64()),function(){var e=t._pendingRequests.get(a);if(e){t._pendingRequests.remove(a);var n=!0,r=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(e);!(n=(s=o.next()).done);n=!0){(0,s.value.reject)(new Error("Timeout"))}}catch(u){r=!0;i=u}finally{try{n||null==o["return"]||o["return"]()}finally{if(r)throw i}}}},BaseConsensusAgent.REQUEST_TIMEOUT)}})}},{key:"requestTransaction",value:function requestTransaction(e){var t=this;return new _promise["default"](function(n,r){var a=new Gt(Gt.Type.TRANSACTION,e);if(t._pendingRequests.contains(a))t._pendingRequests.get(a).push({resolve:n,reject:r});else{t._pendingRequests.put(a,[{resolve:n,reject:r}]);if(!t._objectsInFlight.contains(a)){t._peer.channel.getData([a]);t._objectsInFlight.add(a)}t._timers.setTimeout("tx-request-".concat(a.hash.toBase64()),function(){var e=t._pendingRequests.get(a);if(e){t._pendingRequests.remove(a);var n=!0,r=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(e);!(n=(s=o.next()).done);n=!0){(0,s.value.reject)(new Error("Timeout"))}}catch(u){r=!0;i=u}finally{try{n||null==o["return"]||o["return"]()}finally{if(r)throw i}}}},BaseConsensusAgent.REQUEST_TIMEOUT)}})}},{key:"_sendWaitingInvVectors",value:function _sendWaitingInvVectors(){var e=this,t=this._waitingInvVectors.dequeueMulti(Ft.VECTORS_MAX_COUNT);if(t.length>0){this._peer.channel.inv(t);a.v(BaseConsensusAgent,function(){return"[INV] Sent ".concat(t.length," vectors to ").concat(e._peer.peerAddress)})}}},{key:"_sendFreeWaitingInvVectors",value:function _sendFreeWaitingInvVectors(){for(var e=this,t=[],n=0;t.length<Ft.VECTORS_MAX_COUNT&&this._waitingFreeInvVectors.isAvailable()&&n<BaseConsensusAgent.FREE_TRANSACTION_SIZE_PER_INTERVAL;){var r=this._waitingFreeInvVectors.dequeue();t.push(r.inv);n+=r.serializedSize}if(t.length>0){this._peer.channel.inv(t);a.v(BaseConsensusAgent,function(){return"[INV] Sent ".concat(t.length," vectors to ").concat(e._peer.peerAddress)})}}},{key:"relayTransaction",value:function relayTransaction(e){var t=this;if(!this._remoteSubscription.matchesTransaction(e)){a.v(BaseConsensusAgent,"Not sending ".concat(e.hash()," to ").concat(this.peer.peerAddress,": not subscribed"));return!1}var n=Gt.fromTransaction(e);if(this._knownObjects.contains(n)){a.v(BaseConsensusAgent,"Not sending ".concat(e.hash()," to ").concat(this.peer.peerAddress,": already knows"));return!1}var r=e.serializedSize;e.fee/r<BaseConsensusAgent.TRANSACTION_RELAY_FEE_MIN?this._waitingFreeInvVectors.enqueue(new ft(n,r)):this._waitingInvVectors.enqueue(n);this._timers.setTimeout("knows-tx-".concat(n.hash.toBase64()),function(){t._knownObjects.add(n)},BaseConsensusAgent.KNOWS_OBJECT_AFTER_INV_DELAY);a.v(BaseConsensusAgent,"Sending ".concat(e.hash()," to ").concat(this.peer.peerAddress));return!0}},{key:"removeTransaction",value:function removeTransaction(e){var t=Gt.fromTransaction(e);this._waitingFreeInvVectors.remove(t);this._waitingInvVectors.remove(t)}},{key:"knowsBlock",value:function knowsBlock(e){var t=new Gt(Gt.Type.BLOCK,e);return this._knownObjects.contains(t)}},{key:"knowsTransaction",value:function knowsTransaction(e){var t=new Gt(Gt.Type.TRANSACTION,e);return this._knownObjects.contains(t)}},{key:"_onSubscribe",value:function _onSubscribe(e){this._remoteSubscription=e.subscription}},{key:"_onMempool",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee231(e){var t,n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee231$(e){for(;;)switch(e.prev=e.next){case 0:t=this._getSubscribedMempoolTransactions();n=[];r=!0;a=!1;i=undefined;e.prev=5;s=(0,_getIterator2["default"])(t);case 7:if(r=(o=s.next()).done){e.next=18;break}u=o.value;n.push(Gt.fromTransaction(u));if(!(n.length>=Ft.VECTORS_MAX_COUNT)){e.next=15;break}this._peer.channel.inv(n);n=[];e.next=15;return new _promise["default"](function(e){return setTimeout(e,gt.MEMPOOL_THROTTLE)});case 15:r=!0;e.next=7;break;case 18:e.next=24;break;case 20:e.prev=20;e.t0=e["catch"](5);a=!0;i=e.t0;case 24:e.prev=24;e.prev=25;r||null==s["return"]||s["return"]();case 27:e.prev=27;if(!a){e.next=30;break}throw i;case 30:return e.finish(27);case 31:return e.finish(24);case 32:n.length>0&&this._peer.channel.inv(n);case 33:case"end":return e.stop()}},_callee231,this,[[5,20,24,32],[25,,27,31]])}));return function _onMempool(t){return e.apply(this,arguments)}}()},{key:"_getSubscribedMempoolTransactions",value:function _getSubscribedMempoolTransactions(){return[]}},{key:"_onInv",value:function _onInv(e){return this._synchronizer.push("onInv",this.__onInv.bind(this,e))}},{key:"__onInv",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee232(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,b,w,C,S,T,E,x,I,B=this;return _regenerator["default"].wrap(function _callee232$(P){for(;;)switch(P.prev=P.next){case 0:t=!0;n=!1;r=undefined;P.prev=3;for(i=(0,_getIterator2["default"])(e.vectors);!(t=(s=i.next()).done);t=!0){o=s.value;this._knownObjects.add(o);this._waitingInvVectors.remove(o);this._waitingFreeInvVectors.remove(o)}P.next=11;break;case 7:P.prev=7;P.t0=P["catch"](3);n=!0;r=P.t0;case 11:P.prev=11;P.prev=12;t||null==i["return"]||i["return"]();case 14:P.prev=14;if(!n){P.next=17;break}throw r;case 17:return P.finish(14);case 18:return P.finish(11);case 19:u=[];c=[];l=!0;h=!1;f=undefined;P.prev=24;d=(0,_getIterator2["default"])(e.vectors);case 26:if(l=(A=d.next()).done){P.next=46;break}_=A.value;if(!this._objectsInFlight.contains(_)&&!this._objectsProcessing.contains(_)){P.next=30;break}return P.abrupt("continue",43);case 30:if(this._shouldRequestData(_)){P.next=32;break}return P.abrupt("continue",43);case 32:P.t1=_.type;P.next=P.t1===Gt.Type.BLOCK?35:P.t1===Gt.Type.TRANSACTION?40:43;break;case 35:P.next=37;return this._getBlock(_.hash,!0);case 37:if(p=P.sent)this._onKnownBlockAnnounced(_.hash,p);else{u.push(_);this._onNewBlockAnnounced(_.hash)}return P.abrupt("break",43);case 40:if(g=this._getTransaction(_.hash))this._onKnownTransactionAnnounced(_.hash,g);else{c.push(_);this._onNewTransactionAnnounced(_.hash)}return P.abrupt("break",43);case 43:l=!0;P.next=26;break;case 46:P.next=52;break;case 48:P.prev=48;P.t2=P["catch"](24);h=!0;f=P.t2;case 52:P.prev=52;P.prev=53;l||null==d["return"]||d["return"]();case 55:P.prev=55;if(!h){P.next=58;break}throw f;case 58:return P.finish(55);case 59:return P.finish(52);case 60:a.v(BaseConsensusAgent,function(){return"[INV] ".concat(e.vectors.length," vectors (").concat(u.length," new blocks, ").concat(c.length," new txs) received from ").concat(B._peer.peerAddress)});if(!(u.length>0||c.length>0)){P.next=102;break}y=!0;v=!1;k=undefined;P.prev=65;for(m=(0,_getIterator2["default"])(u);!(y=(b=m.next()).done);y=!0){w=b.value;this._invRequestManager.askToRequestVector(this,w)}P.next=73;break;case 69:P.prev=69;P.t3=P["catch"](65);v=!0;k=P.t3;case 73:P.prev=73;P.prev=74;y||null==m["return"]||m["return"]();case 76:P.prev=76;if(!v){P.next=79;break}throw k;case 79:return P.finish(76);case 80:return P.finish(73);case 81:C=!0;S=!1;T=undefined;P.prev=84;for(E=(0,_getIterator2["default"])(c);!(C=(x=E.next()).done);C=!0){I=x.value;this._invRequestManager.askToRequestVector(this,I)}P.next=92;break;case 88:P.prev=88;P.t4=P["catch"](84);S=!0;T=P.t4;case 92:P.prev=92;P.prev=93;C||null==E["return"]||E["return"]();case 95:P.prev=95;if(!S){P.next=98;break}throw T;case 98:return P.finish(95);case 99:return P.finish(92);case 100:P.next=103;break;case 102:this._onNoUnknownObjects();case 103:case"end":return P.stop()}},_callee232,this,[[3,7,11,19],[12,,14,18],[24,48,52,60],[53,,55,59],[65,69,73,81],[74,,76,80],[84,88,92,100],[93,,95,99]])}));return function __onInv(t){return e.apply(this,arguments)}}()},{key:"requestVector",value:function requestVector(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this._blocksToRequest.enqueueAll(n.filter(function(e){return e.type===Gt.Type.BLOCK}));this._txsToRequest.enqueueAll(n.filter(function(e){return e.type===Gt.Type.TRANSACTION}));this._timers.clearTimeout("inv");this._blocksToRequest.length+this._txsToRequest.available>=BaseConsensusAgent.REQUEST_THRESHOLD?this._requestData():this._timers.setTimeout("inv",function(){return e._requestData()},BaseConsensusAgent.REQUEST_THROTTLE)}},{key:"_shouldRequestData",value:function _shouldRequestData(e){return!0}},{key:"_getBlock",value:function _getBlock(e){arguments.length>1&&arguments[1]!==undefined&&arguments[1],arguments.length>2&&arguments[2]!==undefined&&arguments[2];throw new Error("not implemented")}},{key:"_getRawBlock",value:function _getRawBlock(e){arguments.length>1&&arguments[1]!==undefined&&arguments[1];throw new Error("not implemented")}},{key:"_getTransaction",value:function _getTransaction(e){throw new Error("not implemented")}},{key:"_onNewBlockAnnounced",value:function _onNewBlockAnnounced(e){}},{key:"_onKnownBlockAnnounced",value:function _onKnownBlockAnnounced(e,t){}},{key:"_onNewTransactionAnnounced",value:function _onNewTransactionAnnounced(e){}},{key:"_onKnownTransactionAnnounced",value:function _onKnownTransactionAnnounced(e,t){}},{key:"_requestData",value:function _requestData(){var e=this;if(this._objectsInFlight.isEmpty()&&(!this._blocksToRequest.isEmpty()||this._txsToRequest.isAvailable())){var t=Ft.VECTORS_MAX_COUNT,n=this._blocksToRequest.dequeueMulti(t);n.length<t&&(n=n.concat(this._txsToRequest.dequeueMulti(t-n.length)));this._objectsInFlight.addAll(n);this._doRequestData(n);this._timers.setTimeout("getData",function(){return e._noMoreData()},BaseConsensusAgent.REQUEST_TIMEOUT)}}},{key:"_doRequestData",value:function _doRequestData(e){if(this._willRequestHeaders()){var t=[],n=[],r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(e);!(r=(s=o.next()).done);r=!0){var u=s.value;u.type===Gt.Type.BLOCK?t.push(u):n.push(u)}}catch(c){a=!0;i=c}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}this._peer.channel.getHeader(t);this._peer.channel.getData(n)}else this._peer.channel.getData(e)}},{key:"_willRequestHeaders",value:function _willRequestHeaders(){return!1}},{key:"_onBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee233(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_=this;return _regenerator["default"].wrap(function _callee233$(p){for(;;)switch(p.prev=p.next){case 0:t=e.block.hash();n=new Gt(Gt.Type.BLOCK,t);if((r=this._pendingRequests.get(n))||this._objectsInFlight.contains(n)||this._objectsThatFlew.contains(n)){p.next=6;break}a.w(BaseConsensusAgent,"Unsolicited block ".concat(t," received from ").concat(this._peer.peerAddress,", discarding"));return p.abrupt("return");case 6:i=e.block.isFull()?e.block.body.transactions:[];s=i.map(function(e){return _._getTransaction(e.hash())});for(o=0;o<i.length;o++)(u=s[o])&&(i[o]=u);if(!r){p.next=32;break}this._pendingRequests.remove(n);this._timers.clearTimeout("block-request-".concat(n.hash.toBase64()));c=!0;l=!1;h=undefined;p.prev=15;for(f=(0,_getIterator2["default"])(r);!(c=(d=f.next()).done);c=!0){A=d.value.resolve;try{A(e.block)}catch(g){}}p.next=23;break;case 19:p.prev=19;p.t0=p["catch"](15);l=!0;h=p.t0;case 23:p.prev=23;p.prev=24;c||null==f["return"]||f["return"]();case 26:p.prev=26;if(!l){p.next=29;break}throw h;case 29:return p.finish(26);case 30:return p.finish(23);case 31:return p.abrupt("return");case 32:if(!this._peer.head&&this._peer.headHash.equals(t)||this._peer.head&&this._peer.head.height<e.block.height){this._peer.head=e.block.header;this.onHeadUpdated()}this._onObjectReceived(n);this._objectsProcessing.add(n);p.next=37;return this._processBlock(t,e.block);case 37:this._onObjectProcessed(n);this._invRequestManager.noteVectorReceived(Gt.fromBlock(e.block));case 39:case"end":return p.stop()}},_callee233,this,[[15,19,23,31],[24,,26,30]])}));return function _onBlock(t){return e.apply(this,arguments)}}()},{key:"_processBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee234(e,t){return _regenerator["default"].wrap(function _callee234$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee234)}));return function _processBlock(t,n){return e.apply(this,arguments)}}()},{key:"_onHeader",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee235(e){var t,n;return _regenerator["default"].wrap(function _callee235$(r){for(;;)switch(r.prev=r.next){case 0:t=e.header.hash();n=new Gt(Gt.Type.BLOCK,t);if(this._objectsInFlight.contains(n)||this._objectsThatFlew.contains(n)){r.next=5;break}a.w(BaseConsensusAgent,"Unsolicited header ".concat(t," received from ").concat(this._peer.peerAddress,", discarding"));return r.abrupt("return");case 5:if(!this._peer.head&&this._peer.headHash.equals(t)||this._peer.head&&this._peer.head.height<e.header.height){this._peer.head=e.header;this.onHeadUpdated()}this._onObjectReceived(n);this._objectsProcessing.add(n);r.next=10;return this._processHeader(t,e.header);case 10:this._onObjectProcessed(n);case 11:case"end":return r.stop()}},_callee235,this)}));return function _onHeader(t){return e.apply(this,arguments)}}()},{key:"_processHeader",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee236(e,t){return _regenerator["default"].wrap(function _callee236$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee236)}));return function _processHeader(t,n){return e.apply(this,arguments)}}()},{key:"_onTx",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee237(e){var t,n,r,i,s,o,u,c,l;return _regenerator["default"].wrap(function _callee237$(h){for(;;)switch(h.prev=h.next){case 0:t=e.transaction.hash();n=new Gt(Gt.Type.TRANSACTION,t);if(this._objectsInFlight.contains(n)||this._objectsThatFlew.contains(n)){h.next=5;break}a.w(BaseConsensusAgent,"Unsolicited transaction ".concat(t," received from ").concat(this._peer.peerAddress,", discarding"));return h.abrupt("return");case 5:this._invRequestManager.noteVectorReceived(Gt.fromTransaction(e.transaction));this._onObjectReceived(n);this._objectsProcessing.add(n);if(!this._localSubscription.matchesTransaction(e.transaction)){h.next=11;break}h.next=11;return this._processTransaction(t,e.transaction);case 11:if(!(r=this._pendingRequests.get(n))){h.next=36;break}this._pendingRequests.remove(n);this._timers.clearTimeout("tx-request-".concat(n.hash.toBase64()));i=!0;s=!1;o=undefined;h.prev=18;for(u=(0,_getIterator2["default"])(r);!(i=(c=u.next()).done);i=!0){l=c.value.resolve;try{l(e.transaction)}catch(f){}}h.next=26;break;case 22:h.prev=22;h.t0=h["catch"](18);s=!0;o=h.t0;case 26:h.prev=26;h.prev=27;i||null==u["return"]||u["return"]();case 29:h.prev=29;if(!s){h.next=32;break}throw o;case 32:return h.finish(29);case 33:return h.finish(26);case 34:h.next=37;break;case 36:!this._localSubscription.matchesTransaction(e.transaction)&&this._lastSubscriptionChange+BaseConsensusAgent.SUBSCRIPTION_CHANGE_GRACE_PERIOD>(0,_now["default"])()&&this._peer.channel.close(Wn.TRANSACTION_NOT_MATCHING_SUBSCRIPTION,"received transaction not matching our subscription");case 37:this._onObjectProcessed(n);case 38:case"end":return h.stop()}},_callee237,this,[[18,22,26,34],[27,,29,33]])}));return function _onTx(t){return e.apply(this,arguments)}}()},{key:"_processTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee238(e,t){return _regenerator["default"].wrap(function _callee238$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee238)}));return function _processTransaction(t,n){return e.apply(this,arguments)}}()},{key:"_onNotFound",value:function _onNotFound(e){a.d(BaseConsensusAgent,"[NOTFOUND] ".concat(e.vectors.length," unknown objects received from ").concat(this._peer.peerAddress));var t=!0,n=!1,r=undefined;try{for(var i,s=(0,_getIterator2["default"])(e.vectors);!(t=(i=s.next()).done);t=!0){var o=i.value,u=this._pendingRequests.get(o);if(u){this._pendingRequests.remove(o);this._timers.clearTimeout((o.type===Gt.Type.BLOCK?"block":"tx")+"-request-"+o.hash.toBase64());var c=!0,l=!1,h=undefined;try{for(var f,d=(0,_getIterator2["default"])(u);!(c=(f=d.next()).done);c=!0){var A=f.value.reject;try{A(new Error("Not found"))}catch(_){}}}catch(p){l=!0;h=p}finally{try{c||null==d["return"]||d["return"]()}finally{if(l)throw h}}}if(this._objectsInFlight.contains(o)){this._invRequestManager.noteVectorNotReceived(this,o);this._onObjectReceived(o)}}}catch(p){n=!0;r=p}finally{try{t||null==s["return"]||s["return"]()}finally{if(n)throw r}}}},{key:"_onObjectReceived",value:function _onObjectReceived(e){var t=this;if(!this._objectsInFlight.isEmpty()){this._objectsInFlight.remove(e);this._objectsInFlight.isEmpty()?this._noMoreData():this._timers.resetTimeout("getData",function(){return t._noMoreData()},BaseConsensusAgent.REQUEST_TIMEOUT)}}},{key:"_noMoreData",value:function _noMoreData(){this._timers.clearTimeout("getData");var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._objectsInFlight.values());!(e=(r=a.next()).done);e=!0){var i=r.value;this._invRequestManager.noteVectorNotReceived(this,i)}}catch(s){t=!0;n=s}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}this._objectsThatFlew.addAll(this._objectsInFlight.values());this._objectsInFlight.clear();!this._blocksToRequest.isEmpty()||this._txsToRequest.isAvailable()?this._requestData():this._onAllObjectsReceived()}},{key:"_onNoUnknownObjects",value:function _onNoUnknownObjects(){}},{key:"_onAllObjectsReceived",value:function _onAllObjectsReceived(){}},{key:"_onObjectProcessed",value:function _onObjectProcessed(e){this._objectsProcessing.remove(e);this._objectsProcessing.isEmpty()&&this._onAllObjectsProcessed()}},{key:"_onAllObjectsProcessed",value:function _onAllObjectsProcessed(){}},{key:"_onGetData",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee239(e){var t,n,r,a,i,s,o,u,c,l,h,f,d,A,_;return _regenerator["default"].wrap(function _callee239$(p){for(;;)switch(p.prev=p.next){case 0:t=!0;n=!1;r=undefined;p.prev=3;for(a=(0,_getIterator2["default"])(e.vectors);!(t=(i=a.next()).done);t=!0){s=i.value;this._knownObjects.add(s)}p.next=11;break;case 7:p.prev=7;p.t0=p["catch"](3);n=!0;r=p.t0;case 11:p.prev=11;p.prev=12;t||null==a["return"]||a["return"]();case 14:p.prev=14;if(!n){p.next=17;break}throw r;case 17:return p.finish(14);case 18:return p.finish(11);case 19:o=[];u=!0;c=!1;l=undefined;p.prev=23;h=(0,_getIterator2["default"])(e.vectors);case 25:if(u=(f=h.next()).done){p.next=41;break}d=f.value;p.t1=d.type;p.next=p.t1===Gt.Type.BLOCK?30:p.t1===Gt.Type.TRANSACTION?35:38;break;case 30:p.next=32;return this._getRawBlock(d.hash,!1);case 32:(A=p.sent)?this._peer.channel.rawBlock(A):o.push(d);return p.abrupt("break",38);case 35:if(_=this._getTransaction(d.hash)){this._peer.channel.tx(_);this.fire("transaction-relayed",_)}else o.push(d);return p.abrupt("break",38);case 38:u=!0;p.next=25;break;case 41:p.next=47;break;case 43:p.prev=43;p.t2=p["catch"](23);c=!0;l=p.t2;case 47:p.prev=47;p.prev=48;u||null==h["return"]||h["return"]();case 50:p.prev=50;if(!c){p.next=53;break}throw l;case 53:return p.finish(50);case 54:return p.finish(47);case 55:o.length&&this._peer.channel.notFound(o);case 56:case"end":return p.stop()}},_callee239,this,[[3,7,11,19],[12,,14,18],[23,43,47,55],[48,,50,54]])}));return function _onGetData(t){return e.apply(this,arguments)}}()},{key:"_onGetHeader",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee240(e){var t,n,r,a,i,s,o,u,c,l,h,f,d,A;return _regenerator["default"].wrap(function _callee240$(_){for(;;)switch(_.prev=_.next){case 0:t=!0;n=!1;r=undefined;_.prev=3;for(a=(0,_getIterator2["default"])(e.vectors);!(t=(i=a.next()).done);t=!0){s=i.value;this._knownObjects.add(s)}_.next=11;break;case 7:_.prev=7;_.t0=_["catch"](3);n=!0;r=_.t0;case 11:_.prev=11;_.prev=12;t||null==a["return"]||a["return"]();case 14:_.prev=14;if(!n){_.next=17;break}throw r;case 17:return _.finish(14);case 18:return _.finish(11);case 19:o=[];u=!0;c=!1;l=undefined;_.prev=23;h=(0,_getIterator2["default"])(e.vectors);case 25:if(u=(f=h.next()).done){_.next=38;break}d=f.value;_.t1=d.type;_.next=_.t1===Gt.Type.BLOCK?30:(_.t1,Gt.Type.TRANSACTION,35);break;case 30:_.next=32;return this._getBlock(d.hash);case 32:(A=_.sent)?this._peer.channel.header(A.header):o.push(d);return _.abrupt("break",35);case 35:u=!0;_.next=25;break;case 38:_.next=44;break;case 40:_.prev=40;_.t2=_["catch"](23);c=!0;l=_.t2;case 44:_.prev=44;_.prev=45;u||null==h["return"]||h["return"]();case 47:_.prev=47;if(!c){_.next=50;break}throw l;case 50:return _.finish(47);case 51:return _.finish(44);case 52:o.length&&this._peer.channel.notFound(o);case 53:case"end":return _.stop()}},_callee240,this,[[3,7,11,19],[12,,14,18],[23,40,44,52],[45,,47,51]])}));return function _onGetHeader(t){return e.apply(this,arguments)}}()},{key:"getBlockProof",value:function getBlockProof(e,t){return this._synchronizer.push("getBlockProof",this._getBlockProof.bind(this,e,t))}},{key:"_getBlockProof",value:function _getBlockProof(e,t){var n=this;R.that(null===this._blockProofRequest);a.v(BaseConsensusAgent,function(){return"Requesting BlockProof for ".concat(e," from ").concat(n._peer.peerAddress)});return new _promise["default"](function(r,a){n._blockProofRequest={blockHashToProve:e,knownBlock:t,resolve:r,reject:a};n._peer.channel.getBlockProof(e,t.hash());n._peer.channel.expectMessage(Rt.Type.BLOCK_PROOF,function(){n._blockProofRequest=null;a(new Error("Timeout"))},BaseConsensusAgent.BLOCK_PROOF_REQUEST_TIMEOUT)})}},{key:"getBlockProofAt",value:function getBlockProofAt(e,t){if(this._peer.version<2)throw new Error("Request not supported by peer version");return this._synchronizer.push("getBlockProof",this._getBlockProofAt.bind(this,e,t))}},{key:"_getBlockProofAt",value:function _getBlockProofAt(e,t){var n=this;R.that(null===this._blockProofRequest);a.v(BaseConsensusAgent,function(){return"Requesting BlockProof at ".concat(e," from ").concat(n._peer.peerAddress)});return new _promise["default"](function(r,a){n._blockProofRequest={blockHeightToProve:e,knownBlock:t,resolve:r,reject:a};n._peer.channel.getBlockProofAt(e,t.hash());n._peer.channel.expectMessage(Rt.Type.BLOCK_PROOF,function(){n._blockProofRequest=null;a(new Error("Timeout"))},BaseConsensusAgent.BLOCK_PROOF_REQUEST_TIMEOUT)})}},{key:"_onBlockProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee241(e){var t,n,r,i,s,o,u,c=this;return _regenerator["default"].wrap(function _callee241$(l){for(;;)switch(l.prev=l.next){case 0:a.v(BaseConsensusAgent,function(){return"[BLOCK-PROOF] Received from ".concat(c._peer.peerAddress,": proof=").concat(e.proof," (").concat(e.serializedSize," bytes)")});if(this._blockProofRequest){l.next=4;break}a.w(BaseConsensusAgent,"Unsolicited header proof received from ".concat(this._peer.peerAddress));return l.abrupt("return");case 4:t=this._blockProofRequest,n=t.blockHashToProve,r=t.blockHeightToProve,i=t.knownBlock,s=t.resolve,o=t.reject;this._blockProofRequest=null;if(e.hasProof()&&0!==e.proof.length){l.next=9;break}o(new Error("Block proof request was rejected"));return l.abrupt("return");case 9:if((u=e.proof).tail.hash().equals(n)||u.tail.height===r){l.next=14;break}a.w(BaseConsensusAgent,"Received BlockProof with invalid tail block from ".concat(this._peer.peerAddress));o(new Error("Invalid tail block"));return l.abrupt("return");case 14:l.next=16;return i.isInterlinkSuccessorOf(u.head);case 16:if(l.sent){l.next=20;break}a.w(BaseConsensusAgent,"Received BlockProof with invalid head block from ".concat(this._peer.peerAddress));o(new Error("Invalid head block"));return l.abrupt("return");case 20:l.next=22;return u.verify();case 22:if(l.sent){l.next=27;break}a.w(BaseConsensusAgent,"Invalid BlockProof received from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_BLOCK_PROOF,"Invalid BlockProof");o(new Error("Invalid BlockProof"));return l.abrupt("return");case 27:l.next=29;return _promise["default"].all(u.blocks.map(function(e){return e.verify(c._time)}));case 29:if(l.sent.every(function(e){return e})){l.next=35;break}a.w(BaseConsensusAgent,"Invalid BlockProof received from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_BLOCK_PROOF,"Invalid BlockProof");o(new Error("Invalid BlockProof"));return l.abrupt("return");case 35:s(u.tail);case 36:case"end":return l.stop()}},_callee241,this)}));return function _onBlockProof(t){return e.apply(this,arguments)}}()},{key:"getTransactionsProof",value:function getTransactionsProof(e,t){return this.getTransactionsProofByAddresses(e,t)}},{key:"getTransactionsProofByAddresses",value:function getTransactionsProofByAddresses(e,t){return this._synchronizer.push("getTransactionsProof",this._getTransactionsProofByAddresses.bind(this,e,t))}},{key:"getTransactionsProofByHashes",value:function getTransactionsProofByHashes(e,t){if(this._peer.version<2)throw new Error("Request not supported by peer version");return this._synchronizer.push("getTransactionsProof",this._getTransactionsProofByHashes.bind(this,e,t))}},{key:"_getTransactionsProofByAddresses",value:function _getTransactionsProofByAddresses(e,t){var n=this;R.that(null===this._transactionsProofRequest);a.v(BaseConsensusAgent,function(){return"Requesting TransactionsProof for ".concat(t,"@").concat(e.height," from ").concat(n._peer.peerAddress)});return new _promise["default"](function(r,a){n._transactionsProofRequest={addresses:t,block:e,resolve:r,reject:a};n._peer.channel.getTransactionsProofByAddresses(e.hash(),t);n._peer.channel.expectMessage(Rt.Type.TRANSACTIONS_PROOF,function(){n._transactionsProofRequest=null;n._peer.channel.close(Wn.GET_TRANSACTIONS_PROOF_TIMEOUT,"getTransactionsProof timeout");a(new Error("Timeout"))},BaseConsensusAgent.TRANSACTIONS_PROOF_REQUEST_TIMEOUT)})}},{key:"_getTransactionsProofByHashes",value:function _getTransactionsProofByHashes(e,t){var n=this;R.that(null===this._transactionsProofRequest);a.v(BaseConsensusAgent,function(){return"Requesting TransactionsProof for ".concat(t,"@").concat(e.height," from ").concat(n._peer.peerAddress)});return new _promise["default"](function(r,a){n._transactionsProofRequest={hashes:t,block:e,resolve:r,reject:a};n._peer.channel.getTransactionsProofByHashes(e.hash(),t);n._peer.channel.expectMessage(Rt.Type.TRANSACTIONS_PROOF,function(){n._transactionsProofRequest=null;n._peer.channel.close(Wn.GET_TRANSACTIONS_PROOF_TIMEOUT,"getTransactionsProof timeout");a(new Error("Timeout"))},BaseConsensusAgent.TRANSACTIONS_PROOF_REQUEST_TIMEOUT)})}},{key:"_onTransactionsProof",value:function _onTransactionsProof(e){var t=this;a.v(BaseConsensusAgent,function(){return"[TRANSACTIONS-PROOF] Received from ".concat(t._peer.peerAddress,":")+" blockHash=".concat(e.blockHash,", proof=").concat(e.proof," (").concat(e.serializedSize," bytes)")});if(this._transactionsProofRequest){var n=this._transactionsProofRequest,r=n.addresses,i=void 0===r?[]:r,s=n.hashes,o=void 0===s?[]:s,u=n.block,c=n.resolve,l=n.reject;this._transactionsProofRequest=null;if(e.hasProof())if(u.hash().equals(e.blockHash)){var h=e.proof,f=null;try{f=h.root()}catch(k){}if(u.bodyHash.equals(f)){var d=!0,A=!1,_=undefined;try{for(var p,g=function _loop12(){var e=p.value;if(!i.some(function(t){return e.sender.equals(t)||e.recipient.equals(t)})&&!o.some(function(t){return e.hash().equals(t)})){a.w(BaseConsensusAgent,"TransactionsProof with unwanted transactions received from ".concat(t._peer.peer));t._peer.channel.close(Wn.INVALID_TRANSACTION_PROOF,"TransactionsProof contains unwanted transactions");l(new Error("TransactionsProof contains unwanted transactions"));return{v:void 0}}},y=(0,_getIterator2["default"])(h.transactions);!(d=(p=y.next()).done);d=!0){var v=g();if("object"===(0,_typeof2["default"])(v))return v.v}}catch(m){A=!0;_=m}finally{try{d||null==y["return"]||y["return"]()}finally{if(A)throw _}}c(h.transactions)}else{a.w(BaseConsensusAgent,"Invalid TransactionsProof received from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_TRANSACTION_PROOF,"Invalid TransactionsProof");l(new Error("Invalid TransactionsProof"))}}else{a.w(BaseConsensusAgent,"Received TransactionsProof for invalid reference block from ".concat(this._peer.peerAddress));l(new Error("Invalid reference block"))}else{a.w(BaseConsensusAgent,"TransactionsProof request was rejected by ".concat(this._peer.peerAddress));l(new Error("TransactionsProof request was rejected"))}}else a.w(BaseConsensusAgent,"Unsolicited transactions proof received from ".concat(this._peer.peerAddress))}},{key:"getTransactionReceipts",value:function getTransactionReceipts(e){return this.getTransactionReceiptsByAddress(e)}},{key:"getTransactionReceiptsByAddress",value:function getTransactionReceiptsByAddress(e,t){return this._synchronizer.push("getTransactionReceipts",this._getTransactionReceiptsByAddress.bind(this,e,t))}},{key:"getTransactionReceiptsByHashes",value:function getTransactionReceiptsByHashes(e){if(this._peer.version<2)throw new Error("Request not supported by peer version");return this._synchronizer.push("getTransactionReceipts",this._getTransactionReceiptsByHashes.bind(this,e))}},{key:"_getTransactionReceiptsByAddress",value:function _getTransactionReceiptsByAddress(e,t){var n=this;R.that(null===this._transactionReceiptsRequest);return new _promise["default"](function(r,a){n._transactionReceiptsRequest={address:e,limit:t,resolve:r,reject:a};n._peer.channel.getTransactionReceiptsByAddress(e);n._peer.channel.expectMessage(Rt.Type.TRANSACTION_RECEIPTS,function(){n._transactionReceiptsRequest=null;n._peer.channel.close(Wn.GET_TRANSACTION_RECEIPTS_TIMEOUT,"getTransactionReceipts timeout");a(new Error("Timeout"))},BaseConsensusAgent.TRANSACTION_RECEIPTS_REQUEST_TIMEOUT)})}},{key:"_getTransactionReceiptsByHashes",value:function _getTransactionReceiptsByHashes(e){var t=this;R.that(null===this._transactionReceiptsRequest);return new _promise["default"](function(n,r){t._transactionReceiptsRequest={hashes:e,resolve:n,reject:r};t._peer.channel.getTransactionReceiptsByHashes(e);t._peer.channel.expectMessage(Rt.Type.TRANSACTION_RECEIPTS,function(){t._transactionReceiptsRequest=null;t._peer.channel.close(Wn.GET_TRANSACTION_RECEIPTS_TIMEOUT,"getTransactionReceipts timeout");r(new Error("Timeout"))},BaseConsensusAgent.TRANSACTION_RECEIPTS_REQUEST_TIMEOUT)})}},{key:"_onTransactionReceipts",value:function _onTransactionReceipts(e){var t=this;a.v(BaseConsensusAgent,function(){return"[TRANSACTION-RECEIPTS] Received from ".concat(t._peer.peerAddress,":")+" ".concat(e.hasReceipts()?e.receipts.length:"<rejected>")});if(this._transactionReceiptsRequest){var n=this._transactionReceiptsRequest,r=(n.address,n.hashes),i=n.limit,s=n.resolve,o=n.reject;this._transactionReceiptsRequest=null;if(e.hasReceipts()){var u=e.receipts;u.sort(function(e,t){return t.blockHeight-e.blockHeight});i!==undefined&&i<u.length&&(u=u.slice(0,i));if(r!==undefined){var c=!0,l=!1,h=undefined;try{for(var f,d=function _loop13(){var e=f.value;if(!r.some(function(t){return t.equals(e.transactionHash)})){a.w(BaseConsensusAgent,"TransactionsReceipts with unwanted transactions received from ".concat(t._peer.peer));t._peer.channel.close(Wn.INVALID_TRANSACTION_RECEIPTS,"TransactionsReceipts contains unwanted transactions");o(new Error("TransactionsReceipts contains unwanted transactions"));return{v:void 0}}},A=(0,_getIterator2["default"])(u);!(c=(f=A.next()).done);c=!0){var _=d();if("object"===(0,_typeof2["default"])(_))return _.v}}catch(p){l=!0;h=p}finally{try{c||null==A["return"]||A["return"]()}finally{if(l)throw h}}}s(u)}else{a.w(BaseConsensusAgent,"TransactionReceipts request was rejected by ".concat(this._peer.peerAddress));o(new Error("TransactionReceipts request was rejected"))}}else a.w(BaseConsensusAgent,"Unsolicited transaction receipts received from ".concat(this._peer.peerAddress))}},{key:"_onClose",value:function _onClose(){this._shutdown();this.fire("close",this);this._disconnectListeners()}},{key:"shutdown",value:function shutdown(){this._disconnectListeners();this._shutdown()}},{key:"_shutdown",value:function _shutdown(){this._synchronizer.clear();this._timers.clearAll();this._txsToRequest.stop();this._waitingInvVectors.stop();this._waitingFreeInvVectors.stop()}},{key:"peer",get:function get(){return this._peer}},{key:"synced",get:function get(){return this._synced}},{key:"syncing",get:function get(){return!1}}]);return BaseConsensusAgent}(i);ht.REQUEST_THRESHOLD=50;ht.REQUEST_THROTTLE=500;ht.REQUEST_TIMEOUT=1e4;ht.REQUEST_TRANSACTIONS_WAITING_MAX=5e3;ht.REQUEST_BLOCKS_WAITING_MAX=5e3;ht.BLOCK_PROOF_REQUEST_TIMEOUT=1e4;ht.TRANSACTIONS_PROOF_REQUEST_TIMEOUT=1e4;ht.TRANSACTION_RECEIPTS_REQUEST_TIMEOUT=15e3;ht.TRANSACTION_RELAY_INTERVAL=5e3;ht.TRANSACTIONS_AT_ONCE=100;ht.TRANSACTIONS_PER_SECOND=10;ht.FREE_TRANSACTION_RELAY_INTERVAL=6e3;ht.FREE_TRANSACTIONS_AT_ONCE=10;ht.FREE_TRANSACTIONS_PER_SECOND=1;ht.FREE_TRANSACTION_SIZE_PER_INTERVAL=15e3;ht.TRANSACTION_RELAY_FEE_MIN=1;ht.SUBSCRIPTION_CHANGE_GRACE_PERIOD=3e3;ht.HEAD_REQUEST_INTERVAL=1e5;ht.KNOWS_OBJECT_AFTER_INV_DELAY=3e3;ht.KNOWN_OBJECTS_COUNT_MAX=4e4;n.register(ht);var ft=function(){function FreeTransactionVector(e,t){(0,_classCallCheck2["default"])(this,FreeTransactionVector);this._inv=e;this._serializedSize=t}(0,_createClass2["default"])(FreeTransactionVector,[{key:"hashCode",value:function hashCode(){return this._inv.hashCode()}},{key:"toString",value:function toString(){return this._inv.toString()}},{key:"inv",get:function get(){return this._inv}},{key:"serializedSize",get:function get(){return this._serializedSize}}]);return FreeTransactionVector}(),dt=function(e){(0,_inherits2["default"])(BaseConsensus,e);var t=_createSuper(BaseConsensus);function BaseConsensus(e,n,r){var a;(0,_classCallCheck2["default"])(this,BaseConsensus);(a=t.call(this))._blockchain=e;a._network=r;a._agents=new b;a._timers=new p;a._established=!1;a._syncPeer=null;a._subscription=Ue.ANY;a._invRequestManager=new lt;a._listenersToDisconnect=new _set5["default"];a._onToDisconnect(r,"peer-joined",function(e){return a._onPeerJoined(e)});a._onToDisconnect(r,"peer-left",function(e){return a._onPeerLeft(e)});a._onToDisconnect(e,"head-changed",function(e){return a._onHeadChanged(e)});a._onToDisconnect(e,"rebranched",function(e,t,n){return a._onRebranched(n,e,t)});a._onToDisconnect(e,"extended",function(e){return a._onExtended(e)});a._onToDisconnect(e,"block",function(e){return a.fire("block",e)});a._onToDisconnect(n,"transaction-added",function(e){return a._onTransactionAdded(e)});a._onToDisconnect(n,"transaction-removed",function(e){return a._onTransactionRemoved(e)});return a}(0,_createClass2["default"])(BaseConsensus,[{key:"getHeadHash",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee242(){return _regenerator["default"].wrap(function _callee242$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._blockchain.headHash);case 1:case"end":return e.stop()}},_callee242,this)}));return function getHeadHash(){return e.apply(this,arguments)}}()},{key:"getHeadHeight",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee243(){return _regenerator["default"].wrap(function _callee243$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._blockchain.height);case 1:case"end":return e.stop()}},_callee243,this)}));return function getHeadHeight(){return e.apply(this,arguments)}}()},{key:"getBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee244(e){var t,n,r,a,i=arguments;return _regenerator["default"].wrap(function _callee244$(s){for(;;)switch(s.prev=s.next){case 0:t=!(i.length>1&&i[1]!==undefined)||i[1];n=i.length>2&&i[2]!==undefined?i[2]:t;r=i.length>3?i[3]:undefined;s.next=5;return this._blockchain.getBlock(e,!0,t||n);case 5:a=s.sent;t=t||n&&!this._hasPeersWithVersion(2);if(a&&(!t||a.isFull())){s.next=14;break}s.next=10;return this._requestBlock(e,t,a?a.height:r,!!a);case 10:s.t0=s.sent;if(s.t0){s.next=13;break}s.t0=a;case 13:a=s.t0;case 14:return s.abrupt("return",a);case 15:case"end":return s.stop()}},_callee244,this)}));return function getBlock(t){return e.apply(this,arguments)}}()},{key:"getBlockAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee245(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee245$(a){for(;;)switch(a.prev=a.next){case 0:t=!(r.length>1&&r[1]!==undefined)||r[1];if(!(e>this._blockchain.height||e<1)){a.next=3;break}throw new Error("Invalid height");case 3:a.next=5;return this._blockchain.getBlockAt(e,t);case 5:if(n=a.sent){a.next=12;break}a.next=9;return this._requestBlockAt(e,t);case 9:n=a.sent;a.next=19;break;case 12:if(!n||!t||n.isFull()){a.next=19;break}a.next=15;return this._requestBlock(n.hash(),t,e,!0);case 15:a.t0=a.sent;if(a.t0){a.next=18;break}a.t0=n;case 18:n=a.t0;case 19:return a.abrupt("return",n);case 20:case"end":return a.stop()}},_callee245,this)}));return function getBlockAt(t){return e.apply(this,arguments)}}()},{key:"getBlockTemplate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee246(e,t){return _regenerator["default"].wrap(function _callee246$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented: getBlockTemplate");case 1:case"end":return e.stop()}},_callee246)}));return function getBlockTemplate(t,n){return e.apply(this,arguments)}}()},{key:"submitBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee247(e){return _regenerator["default"].wrap(function _callee247$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented: submitBlock");case 1:case"end":return e.stop()}},_callee247)}));return function submitBlock(t){return e.apply(this,arguments)}}()},{key:"getAccounts",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee248(e){return _regenerator["default"].wrap(function _callee248$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented: getAccounts");case 1:case"end":return e.stop()}},_callee248)}));return function getAccounts(t){return e.apply(this,arguments)}}()},{key:"getPendingTransactions",value:function getPendingTransactions(e){return this._requestPendingTransactions(e)}},{key:"getPendingTransactionsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee249(e,t){return _regenerator["default"].wrap(function _callee249$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented: getPendingTransactionsByAddress");case 1:case"end":return e.stop()}},_callee249)}));return function getPendingTransactionsByAddress(t,n){return e.apply(this,arguments)}}()},{key:"getTransactionsFromBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee250(e,t,n,r){return _regenerator["default"].wrap(function _callee250$(a){for(;;)switch(a.prev=a.next){case 0:if(r){a.next=4;break}a.next=3;return this.getBlock(t,!1,!0,n);case 3:r=a.sent;case 4:if(!r||!r.isFull()){a.next=8;break}return a.abrupt("return",r.transactions.filter(function(t){return e.find(function(e){return e.equals(t.hash())})}));case 8:return a.abrupt("return",this._requestTransactionsByHashes(e,r));case 9:case"end":return a.stop()}},_callee250,this)}));return function getTransactionsFromBlock(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getTransactionsFromBlockByAddresses",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee251(e,t,n){var r;return _regenerator["default"].wrap(function _callee251$(a){for(;;)switch(a.prev=a.next){case 0:a.next=2;return this._blockchain.getBlock(t,!1,!0);case 2:(r=a.sent)||(r=this._requestBlock(t,!1,n));if(!r||!r.isFull()){a.next=8;break}return a.abrupt("return",r.transactions.filter(function(t){return!!e.find(function(e){return e.equals(t.sender)||e.equals(t.recipient)})}));case 8:return a.abrupt("return",this._requestTransactionsByAddresses(e,r));case 9:case"end":return a.stop()}},_callee251,this)}));return function getTransactionsFromBlockByAddresses(t,n,r){return e.apply(this,arguments)}}()},{key:"getTransactionReceiptsByAddress",value:function getTransactionReceiptsByAddress(e,t){return this._requestTransactionReceiptsByAddress(e,t)}},{key:"getTransactionReceiptsByHashes",value:function getTransactionReceiptsByHashes(e){return this._requestTransactionReceiptsByHashes(e)}},{key:"sendTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee252(e){return _regenerator["default"].wrap(function _callee252$(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("not implemented: sendTransaction");case 1:case"end":return e.stop()}},_callee252)}));return function sendTransaction(t){return e.apply(this,arguments)}}()},{key:"getMempoolContents",value:function getMempoolContents(){return[]}},{key:"_onToDisconnect",value:function _onToDisconnect(e,t,n){var r=e.on(t,n);this._listenersToDisconnect.add({obj:e,type:t,id:r})}},{key:"_disconnectListeners",value:function _disconnectListeners(){var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this._listenersToDisconnect);!(e=(r=a.next()).done);e=!0){var i=r.value;i.obj.off(i.type,i.id)}}catch(s){t=!0;n=s}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}this._offAll()}},{key:"handoverTo",value:function handoverTo(e){this._disconnectListeners();var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._agents.valueIterator());!(t=(a=i.next()).done);t=!0){var s=a.value,o=s.peer;s.shutdown();this._onPeerLeft(o);e._onPeerJoined(o)}}catch(u){n=!0;r=u}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"_hasPeersWithVersion",value:function _hasPeersWithVersion(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._agents.valueIterator());!(t=(a=i.next()).done);t=!0){if(a.value.peer.version>=e)return!0}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return!1}},{key:"_requestBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee253(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,p,g,y=arguments;return _regenerator["default"].wrap(function _callee253$(v){for(;;)switch(v.prev=v.next){case 0:t=y.length>1&&y[1]!==undefined&&y[1];n=y.length>2?y[2]:undefined;r=y.length>3?y[3]:undefined;i=null;if(!t&&n){v.next=52;break}s=[];o=!n||n<this._blockchain.height-re.NUM_BLOCKS_VERIFICATION;u=!0;c=!1;l=undefined;v.prev=10;for(h=(0,_getIterator2["default"])(this._agents.valueIterator());!(u=(f=h.next()).done);u=!0)(d=f.value).synced&&d.providesServices(_.FULL_BLOCKS)&&(!o||d.providesServices(_.BLOCK_HISTORY))&&s.push(d);v.next=18;break;case 14:v.prev=14;v.t0=v["catch"](10);c=!0;l=v.t0;case 18:v.prev=18;v.prev=19;u||null==h["return"]||h["return"]();case 21:v.prev=21;if(!c){v.next=24;break}throw l;case 24:return v.finish(21);case 25:return v.finish(18);case 26:s.sort(function(t,n){return t.knowsBlock(e)!==n.knowsBlock(e)?.5-t.knowsBlock(e):Math.random()-.5});A=0,p=s;case 28:if(!(A<p.length)){v.next=44;break}g=p[A];v.prev=30;v.next=33;return g.requestBlock(e);case 33:if(!(i=v.sent)){v.next=36;break}return v.abrupt("break",44);case 36:v.next=41;break;case 38:v.prev=38;v.t1=v["catch"](30);a.w(BaseConsensus,"Failed to retrieve block for ".concat(e," from ").concat(g.peer.peerAddress,": ").concat(v.t1&&v.t1.message||v.t1));case 41:A++;v.next=28;break;case 44:if(i){v.next=46;break}throw new Error("Failed to retrieve block for ".concat(e));case 46:if(r){v.next=49;break}v.next=49;return this._requestBlockProof(e,i.height);case 49:return v.abrupt("return",i);case 52:return v.abrupt("return",this._requestBlockProof(e,n));case 53:case"end":return v.stop()}},_callee253,this,[[10,14,18,26],[19,,21,25],[30,38]])}));return function _requestBlock(t){return e.apply(this,arguments)}}()},{key:"_requestBlockAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee254(e,t){var n,r,i,s,o,u,c,l,h,f,d,A,p;return _regenerator["default"].wrap(function _callee254$(g){for(;;)switch(g.prev=g.next){case 0:g.next=2;return this._requestBlockProofAt(e);case 2:n=g.sent;if(!t||n.isFull()){g.next=43;break}r=n.hash();i=[];s=e<this._blockchain.height-re.NUM_BLOCKS_VERIFICATION;o=!0;u=!1;c=undefined;g.prev=10;for(l=(0,_getIterator2["default"])(this._agents.valueIterator());!(o=(h=l.next()).done);o=!0)(f=h.value).synced&&f.providesServices(_.FULL_BLOCKS)&&(!s||f.providesServices(_.BLOCK_HISTORY))&&i.push(f);g.next=18;break;case 14:g.prev=14;g.t0=g["catch"](10);u=!0;c=g.t0;case 18:g.prev=18;g.prev=19;o||null==l["return"]||l["return"]();case 21:g.prev=21;if(!u){g.next=24;break}throw c;case 24:return g.finish(21);case 25:return g.finish(18);case 26:i.sort(function(e,t){return e.knowsBlock(r)!==t.knowsBlock(r)?.5-e.knowsBlock(r):Math.random()-.5});d=0,A=i;case 28:if(!(d<A.length)){g.next=42;break}p=A[d];g.prev=30;g.next=33;return p.requestBlock(r);case 33:return g.abrupt("return",g.sent);case 36:g.prev=36;g.t1=g["catch"](30);a.w(BaseConsensus,"Failed to retrieve block for ".concat(r,"@").concat(e," from ").concat(p.peer.peerAddress,": ").concat(g.t1&&g.t1.message||g.t1));case 39:d++;g.next=28;break;case 42:throw new Error("Failed to retrieve block for ".concat(r,"@").concat(e));case 43:return g.abrupt("return",n);case 44:case"end":return g.stop()}},_callee254,this,[[10,14,18,26],[19,,21,25],[30,36]])}));return function _requestBlockAt(t,n){return e.apply(this,arguments)}}()},{key:"_requestPendingTransactions",value:function _requestPendingTransactions(e){var t=this;return _promise["default"].all(e.map(function(e){return t._requestPendingTransaction(e)["catch"](function(){return null})})).then(function(e){return e.filter(function(e){return!!e})})}},{key:"_requestPendingTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee255(e){var t,n,r,i,s,o,u,c,l,h,f;return _regenerator["default"].wrap(function _callee255$(d){for(;;)switch(d.prev=d.next){case 0:t=[];n=!0;r=!1;i=undefined;d.prev=4;for(s=(0,_getIterator2["default"])(this._agents.valueIterator());!(n=(o=s.next()).done);n=!0)(u=o.value).synced&&u.providesServices(_.MEMPOOL)&&t.push(u);d.next=12;break;case 8:d.prev=8;d.t0=d["catch"](4);r=!0;i=d.t0;case 12:d.prev=12;d.prev=13;n||null==s["return"]||s["return"]();case 15:d.prev=15;if(!r){d.next=18;break}throw i;case 18:return d.finish(15);case 19:return d.finish(12);case 20:t.sort(function(t,n){return t.knowsTransaction(e)!==n.knowsTransaction(e)?.5-t.knowsTransaction(e):Math.random()-.5});c=0,l=t;case 22:if(!(c<l.length)){d.next=38;break}h=l[c];d.prev=24;d.next=27;return h.requestTransaction(e);case 27:if(!(f=d.sent)){d.next=30;break}return d.abrupt("return",f);case 30:d.next=35;break;case 32:d.prev=32;d.t1=d["catch"](24);a.w(BaseConsensus,"Failed to retrieve pending transaction for ".concat(e," from ").concat(h.peer.peerAddress,": ").concat(d.t1&&d.t1.message||d.t1));case 35:c++;d.next=22;break;case 38:throw new Error("Failed to retrieve pending transaction for ".concat(e));case 39:case"end":return d.stop()}},_callee255,this,[[4,8,12,20],[13,,15,19],[24,32]])}));return function _requestPendingTransaction(t){return e.apply(this,arguments)}}()},{key:"_requestTransactionReceiptsByHashes",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee256(e){var t,n,r,i,s,o,u,c,l,h;return _regenerator["default"].wrap(function _callee256$(f){for(;;)switch(f.prev=f.next){case 0:t=[];n=!0;r=!1;i=undefined;f.prev=4;for(s=(0,_getIterator2["default"])(this._agents.valueIterator());!(n=(o=s.next()).done);n=!0)(u=o.value).synced&&u.providesServices(_.TRANSACTION_INDEX)&&u.peer.version>=2&&t.push(u);f.next=12;break;case 8:f.prev=8;f.t0=f["catch"](4);r=!0;i=f.t0;case 12:f.prev=12;f.prev=13;n||null==s["return"]||s["return"]();case 15:f.prev=15;if(!r){f.next=18;break}throw i;case 18:return f.finish(15);case 19:return f.finish(12);case 20:c=0,l=t;case 21:if(!(c<l.length)){f.next=35;break}h=l[c];f.prev=23;f.next=26;return h.getTransactionReceiptsByHashes(e);case 26:return f.abrupt("return",f.sent);case 29:f.prev=29;f.t1=f["catch"](23);a.w(BaseConsensus,"Failed to retrieve transaction receipts for ".concat(e," from ").concat(h.peer.peerAddress,": ").concat(f.t1&&f.t1.message||f.t1));case 32:c++;f.next=21;break;case 35:throw new Error("Failed to retrieve transaction receipts for ".concat(e));case 36:case"end":return f.stop()}},_callee256,this,[[4,8,12,20],[13,,15,19],[23,29]])}));return function _requestTransactionReceiptsByHashes(t){return e.apply(this,arguments)}}()},{key:"_requestTransactionsByHashes",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee257(e,t){var n,r,i,s,o,u,c,l,h,f,d,A;return _regenerator["default"].wrap(function _callee257$(p){for(;;)switch(p.prev=p.next){case 0:n=[];r=t.height<this._blockchain.height-re.NUM_BLOCKS_VERIFICATION;i=!0;s=!1;o=undefined;p.prev=5;for(u=(0,_getIterator2["default"])(this._agents.valueIterator());!(i=(c=u.next()).done);i=!0)(l=c.value).synced&&l.providesServices(_.BODY_PROOF)&&(!r||l.providesServices(_.BLOCK_HISTORY))&&l.peer.version>=2&&n.push(l);p.next=13;break;case 9:p.prev=9;p.t0=p["catch"](5);s=!0;o=p.t0;case 13:p.prev=13;p.prev=14;i||null==u["return"]||u["return"]();case 16:p.prev=16;if(!s){p.next=19;break}throw o;case 19:return p.finish(16);case 20:return p.finish(13);case 21:h=t.hash();n.sort(function(e,t){return e.knowsBlock(h)!==t.knowsBlock(h)?.5-e.knowsBlock(h):Math.random()-.5});f=0,d=n;case 24:if(!(f<d.length)){p.next=38;break}A=d[f];p.prev=26;p.next=29;return A.getTransactionsProofByHashes(t,e);case 29:return p.abrupt("return",p.sent);case 32:p.prev=32;p.t1=p["catch"](26);a.w(BaseConsensus,"Failed to retrieve transactions for ".concat(e," from ").concat(A.peer.peerAddress,": ").concat(p.t1&&p.t1.message||p.t1));case 35:f++;p.next=24;break;case 38:throw new Error("Failed to retrieve transactions for ".concat(e));case 39:case"end":return p.stop()}},_callee257,this,[[5,9,13,21],[14,,16,20],[26,32]])}));return function _requestTransactionsByHashes(t,n){return e.apply(this,arguments)}}()},{key:"subscribe",value:function subscribe(e){this._subscription=e;var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._agents.valueIterator());!(t=(a=i.next()).done);t=!0){a.value.subscribe(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"getSubscription",value:function getSubscription(){return this._subscription}},{key:"_newConsensusAgent",value:function _newConsensusAgent(e){throw new Error("not implemented")}},{key:"_onPeerJoined",value:function _onPeerJoined(e){var t=this,n=this._newConsensusAgent(e);this._agents.put(e.id,n);n.on("close",function(){return t._onPeerLeft(n.peer)});n.on("sync",function(){return t._onPeerSynced(n.peer)});n.on("out-of-sync",function(){return t._onPeerOutOfSync(n.peer)});this.bubble(n,"transaction-relayed");this._timers.resetTimeout("sync",this._syncBlockchain.bind(this),BaseConsensus.SYNC_THROTTLE);return n}},{key:"_onPeerLeft",value:function _onPeerLeft(e){if(e.equals(this._syncPeer)){a.d(BaseConsensus,"Peer ".concat(e.peerAddress," left during sync"));this._syncPeer=null;this.fire("sync-failed",e.peerAddress)}this._agents.remove(e.id);this._syncBlockchain()}},{key:"_syncBlockchain",value:function _syncBlockchain(){var e=[],t=0,n=!0,r=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(this._agents.valueIterator());!(n=(s=o.next()).done);n=!0){var u=s.value;u.synced?_.isFullNode(u.peer.peerAddress.services)&&t++:e.push(u)}}catch(l){r=!0;i=l}finally{try{n||null==o["return"]||o["return"]()}finally{if(r)throw i}}if(this._established&&(t<BaseConsensus.MIN_FULL_NODES||0===this._agents.length)){this._established=!1;this.fire("lost")}if(!this._syncPeer){var c=m.randomElement(e);if(c){this._syncPeer=c.peer;this._established||this.fire("syncing");a.v(BaseConsensus,"Syncing blockchain with peer ".concat(c.peer.peerAddress));c.syncBlockchain()["catch"](a.e.tag(ht))}else if(this._hasEnoughPeers(t,this._agents.length)){if(!this._established){a.i(BaseConsensus,"Synced with all connected peers (".concat(this._agents.length,"), consensus established."));a.d(BaseConsensus,"Blockchain: height=".concat(this._blockchain.height,", headHash=").concat(this._blockchain.headHash));this._established=!0;this.fire("established");this._network.allowInboundConnections=!0}}else this.fire("waiting")}}},{key:"_hasEnoughPeers",value:function _hasEnoughPeers(e,t){return e>=BaseConsensus.MIN_FULL_NODES}},{key:"_onPeerSynced",value:function _onPeerSynced(e){if(e.equals(this._syncPeer)){a.v(BaseConsensus,"Finished sync with peer ".concat(e.peerAddress));this._syncPeer=null}this._syncBlockchain()}},{key:"_onPeerOutOfSync",value:function _onPeerOutOfSync(e){a.w(BaseConsensus,"Peer ".concat(e.peerAddress," out of sync, resyncing"));this._syncBlockchain()}},{key:"_onHeadChanged",value:function _onHeadChanged(e){if(this._established){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._agents.valueIterator());!(t=(a=i.next()).done);t=!0){a.value.relayBlock(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}}},{key:"_onRebranched",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee258(e,t,n){return _regenerator["default"].wrap(function _callee258$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this.fire("head-changed",e,"rebranched",t,n);case 2:case"end":return r.stop()}},_callee258,this)}));return function _onRebranched(t,n,r){return e.apply(this,arguments)}}()},{key:"_onExtended",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee259(e){return _regenerator["default"].wrap(function _callee259$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this.fire("head-changed",e.hash(),"extended",[],[e]);case 2:case"end":return t.stop()}},_callee259,this)}));return function _onExtended(t){return e.apply(this,arguments)}}()},{key:"_onTransactionAdded",value:function _onTransactionAdded(e){this.fire("transaction-added",e);if(this._established){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._agents.valueIterator());!(t=(a=i.next()).done);t=!0){a.value.relayTransaction(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}}},{key:"_onTransactionRemoved",value:function _onTransactionRemoved(e){this.fire("transaction-removed",e);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._agents.valueIterator());!(t=(a=i.next()).done);t=!0){a.value.removeTransaction(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"_requestBlockProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee260(e,t){var n,r,i,s,o,u,c,l,h,f,d,A,p;return _regenerator["default"].wrap(function _callee260$(g){for(;;)switch(g.prev=g.next){case 0:g.next=2;return this._blockchain.getNearestBlockAt(t,!1);case 2:if(n=g.sent){g.next=5;break}throw new Error("No suitable reference block found for block proof");case 5:if(!e.equals(n.hash())){g.next=7;break}return g.abrupt("return",n);case 7:r=[];i=t<this._blockchain.height-re.NUM_BLOCKS_VERIFICATION||n.height<this._blockchain.height-re.NUM_BLOCKS_VERIFICATION;s=!0;o=!1;u=undefined;g.prev=12;for(c=(0,_getIterator2["default"])(this._agents.valueIterator());!(s=(l=c.next()).done);s=!0)(h=l.value).synced&&h.providesServices(_.BLOCK_PROOF)&&(!i||h.providesServices(_.BLOCK_HISTORY))&&r.push(h);g.next=20;break;case 16:g.prev=16;g.t0=g["catch"](12);o=!0;u=g.t0;case 20:g.prev=20;g.prev=21;s||null==c["return"]||c["return"]();case 23:g.prev=23;if(!o){g.next=26;break}throw u;case 26:return g.finish(23);case 27:return g.finish(20);case 28:f=n.hash();r.sort(function(e,t){return e.knowsBlock(f)!==t.knowsBlock(f)?.5-e.knowsBlock(f):Math.random()-.5});d=0,A=r;case 31:if(!(d<A.length)){g.next=45;break}p=A[d];g.prev=33;g.next=36;return p.getBlockProof(e,n);case 36:return g.abrupt("return",g.sent);case 39:g.prev=39;g.t1=g["catch"](33);a.w(BaseConsensus,"Failed to retrieve block proof for ".concat(e,"@").concat(t," from ").concat(p.peer.peerAddress,": ").concat(g.t1&&g.t1.message||g.t1));case 42:d++;g.next=31;break;case 45:throw new Error("Failed to retrieve block proof for ".concat(e));case 46:case"end":return g.stop()}},_callee260,this,[[12,16,20,28],[21,,23,27],[33,39]])}));return function _requestBlockProof(t,n){return e.apply(this,arguments)}}()},{key:"_requestBlockProofAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee261(e){var t,n,r,i,s,o,u,c,l,h,f,d,A;return _regenerator["default"].wrap(function _callee261$(p){for(;;)switch(p.prev=p.next){case 0:p.next=2;return this._blockchain.getNearestBlockAt(e,!1);case 2:if(t=p.sent){p.next=5;break}throw new Error("No suitable reference block found for block proof");case 5:if(e!==t.height){p.next=7;break}return p.abrupt("return",t);case 7:n=[];r=e<this._blockchain.height-re.NUM_BLOCKS_VERIFICATION||t.height<this._blockchain.height-re.NUM_BLOCKS_VERIFICATION;i=!0;s=!1;o=undefined;p.prev=12;for(u=(0,_getIterator2["default"])(this._agents.valueIterator());!(i=(c=u.next()).done);i=!0)(l=c.value).synced&&l.providesServices(_.BLOCK_PROOF)&&(!r||l.providesServices(_.BLOCK_HISTORY))&&l.peer.version>=2&&n.push(l);p.next=20;break;case 16:p.prev=16;p.t0=p["catch"](12);s=!0;o=p.t0;case 20:p.prev=20;p.prev=21;i||null==u["return"]||u["return"]();case 23:p.prev=23;if(!s){p.next=26;break}throw o;case 26:return p.finish(23);case 27:return p.finish(20);case 28:h=t.hash();n.sort(function(e,t){return e.knowsBlock(h)!==t.knowsBlock(h)?.5-e.knowsBlock(h):Math.random()-.5});f=0,d=n;case 31:if(!(f<d.length)){p.next=45;break}A=d[f];p.prev=33;p.next=36;return A.getBlockProofAt(e,t);case 36:return p.abrupt("return",p.sent);case 39:p.prev=39;p.t1=p["catch"](33);a.w(BaseConsensus,"Failed to retrieve block proof at ".concat(e," from ").concat(A.peer.peerAddress,": ").concat(p.t1&&p.t1.message||p.t1));case 42:f++;p.next=31;break;case 45:throw new Error("Failed to retrieve block proof at ".concat(e));case 46:case"end":return p.stop()}},_callee261,this,[[12,16,20,28],[21,,23,27],[33,39]])}));return function _requestBlockProofAt(t){return e.apply(this,arguments)}}()},{key:"_requestTransactionsByAddresses",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee262(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,p=arguments;return _regenerator["default"].wrap(function _callee262$(g){for(;;)switch(g.prev=g.next){case 0:t=p.length>1&&p[1]!==undefined?p[1]:this._blockchain.head;if(0!==e.length){g.next=3;break}return g.abrupt("return",[]);case 3:n=[];r=t.height<this._blockchain.height-re.NUM_BLOCKS_VERIFICATION;i=!0;s=!1;o=undefined;g.prev=8;for(u=(0,_getIterator2["default"])(this._agents.valueIterator());!(i=(c=u.next()).done);i=!0)(l=c.value).synced&&l.providesServices(_.BODY_PROOF)&&(!r||l.providesServices(_.BLOCK_HISTORY))&&n.push(l);g.next=16;break;case 12:g.prev=12;g.t0=g["catch"](8);s=!0;o=g.t0;case 16:g.prev=16;g.prev=17;i||null==u["return"]||u["return"]();case 19:g.prev=19;if(!s){g.next=22;break}throw o;case 22:return g.finish(19);case 23:return g.finish(16);case 24:h=t.hash();n.sort(function(e,t){return e.knowsBlock(h)!==t.knowsBlock(h)?.5-e.knowsBlock(h):Math.random()-.5});f=0,d=n;case 27:if(!(f<d.length)){g.next=41;break}A=d[f];g.prev=29;g.next=32;return A.getTransactionsProofByAddresses(t,e);case 32:return g.abrupt("return",g.sent);case 35:g.prev=35;g.t1=g["catch"](29);a.w(BaseConsensus,"Failed to retrieve transactions proof for ".concat(e," from ").concat(A.peer.peerAddress,": ").concat(g.t1&&g.t1.message||g.t1));case 38:f++;g.next=27;break;case 41:throw new Error("Failed to retrieve transactions proof for ".concat(e));case 42:case"end":return g.stop()}},_callee262,this,[[8,12,16,24],[17,,19,23],[29,35]])}));return function _requestTransactionsByAddresses(t){return e.apply(this,arguments)}}()},{key:"_requestTransactionReceiptsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee263(e,t){var n,r,i,s,o,u,c,l,h,f;return _regenerator["default"].wrap(function _callee263$(d){for(;;)switch(d.prev=d.next){case 0:n=[];r=!0;i=!1;s=undefined;d.prev=4;for(o=(0,_getIterator2["default"])(this._agents.valueIterator());!(r=(u=o.next()).done);r=!0)(c=u.value).synced&&c.providesServices(_.TRANSACTION_INDEX)&&n.push(c);d.next=12;break;case 8:d.prev=8;d.t0=d["catch"](4);i=!0;s=d.t0;case 12:d.prev=12;d.prev=13;r||null==o["return"]||o["return"]();case 15:d.prev=15;if(!i){d.next=18;break}throw s;case 18:return d.finish(15);case 19:return d.finish(12);case 20:n.sort(function(){return Math.random()-.5});l=0,h=n;case 22:if(!(l<h.length)){d.next=36;break}f=h[l];d.prev=24;d.next=27;return f.getTransactionReceiptsByAddress(e,t);case 27:return d.abrupt("return",d.sent);case 30:d.prev=30;d.t1=d["catch"](24);a.w(BaseConsensus,"Failed to retrieve transaction receipts for ".concat(e," from ").concat(f.peer.peerAddress,": ").concat(d.t1&&d.t1.message||d.t1));case 33:l++;d.next=22;break;case 36:throw new Error("Failed to retrieve transaction receipts for ".concat(e));case 37:case"end":return d.stop()}},_callee263,this,[[4,8,12,20],[13,,15,19],[24,30]])}));return function _requestTransactionReceiptsByAddress(t,n){return e.apply(this,arguments)}}()},{key:"_requestTransactionHistory",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee264(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k=this;return _regenerator["default"].wrap(function _callee264$(m){for(;;)switch(m.prev=m.next){case 0:m.next=2;return this._requestTransactionReceiptsByAddress(e);case 2:t=m.sent;n=[];r=null;i=!0;s=!1;o=undefined;m.prev=8;u=_regenerator["default"].mark(function _loop14(){var e,t,i;return _regenerator["default"].wrap(function _loop14$(s){for(;;)switch(s.prev=s.next){case 0:if((e=l.value).blockHash.equals(r)){s.next=7;break}s.next=4;return k._blockchain.getBlock(e.blockHash);case 4:if(t=s.sent)n.push(_promise["default"].resolve(t));else{i=k._requestBlockProof(e.blockHash,e.blockHeight)["catch"](function(t){return a.e(BaseConsensus,"Failed to retrieve proof for block ".concat(e.blockHash)+" (".concat(t,") - transaction history may be incomplete"))});n.push(i)}r=e.blockHash;case 7:case"end":return s.stop()}},_loop14)});c=(0,_getIterator2["default"])(t);case 11:if(i=(l=c.next()).done){m.next=16;break}return m.delegateYield(u(),"t0",13);case 13:i=!0;m.next=11;break;case 16:m.next=22;break;case 18:m.prev=18;m.t1=m["catch"](8);s=!0;o=m.t1;case 22:m.prev=22;m.prev=23;i||null==c["return"]||c["return"]();case 25:m.prev=25;if(!s){m.next=28;break}throw o;case 28:return m.finish(25);case 29:return m.finish(22);case 30:m.next=32;return _promise["default"].all(n);case 32:h=m.sent;f=[];d=!0;A=!1;_=undefined;m.prev=37;p=function _loop15(){var t=y.value;if(!t)return"continue";var n=k._requestTransactionsByAddresses([e],t).then(function(e){return e.map(function(e){return{transaction:e,header:t.header}})})["catch"](function(e){return a.e(BaseConsensus,"Failed to retrieve transactions for block ".concat(t.hash())+" (".concat(e,") - transaction history may be incomplete"))});f.push(n)};g=(0,_getIterator2["default"])(h);case 40:if(d=(y=g.next()).done){m.next=47;break}if("continue"!==p()){m.next=44;break}return m.abrupt("continue",44);case 44:d=!0;m.next=40;break;case 47:m.next=53;break;case 49:m.prev=49;m.t2=m["catch"](37);A=!0;_=m.t2;case 53:m.prev=53;m.prev=54;d||null==g["return"]||g["return"]();case 56:m.prev=56;if(!A){m.next=59;break}throw _;case 59:return m.finish(56);case 60:return m.finish(53);case 61:m.next=63;return _promise["default"].all(f);case 63:v=m.sent;return m.abrupt("return",v.reduce(function(e,t){return t?e.concat(t):e},[]).sort(function(e,t){return e.header.height-t.header.height}));case 65:case"end":return m.stop()}},_callee264,this,[[8,18,22,30],[23,,25,29],[37,49,53,61],[54,,56,60]])}));return function _requestTransactionHistory(t){return e.apply(this,arguments)}}()},{key:"established",get:function get(){return this._established}},{key:"network",get:function get(){return this._network}},{key:"invRequestManager",get:function get(){return this._invRequestManager}}]);return BaseConsensus}(i);dt.MAX_ATTEMPTS_TO_FETCH=5;dt.SYNC_THROTTLE=1500;dt.MIN_FULL_NODES=1;dt.TRANSACTION_RELAY_TIMEOUT=1e4;dt.SendTransactionResult={REJECTED_LOCAL:-4,EXPIRED:-3,ALREADY_MINED:-2,INVALID:-1,NONE:0,RELAYED:1,KNOWN:2,PENDING_LOCAL:3};n.register(dt);var At=function(e){(0,_inherits2["default"])(BaseMiniConsensusAgent,e);var t=_createSuper(BaseMiniConsensusAgent);function BaseMiniConsensusAgent(e,n,r,a,i,s){var o;(0,_classCallCheck2["default"])(this,BaseMiniConsensusAgent);(o=t.call(this,r,a,i,s))._blockchain=e;o._mempool=n;o._subscribeTarget();o._accountsRequest=null;o._onToDisconnect(a.channel,"accounts-proof",function(e){return o._onAccountsProof(e)});return o}(0,_createClass2["default"])(BaseMiniConsensusAgent,[{key:"requestMempool",value:function requestMempool(){var e=this,t=BaseMiniConsensusAgent.MEMPOOL_DELAY_MIN+Math.random()*(BaseMiniConsensusAgent.MEMPOOL_DELAY_MAX-BaseMiniConsensusAgent.MEMPOOL_DELAY_MIN);setTimeout(function(){return e._peer.channel.mempool()},t)}},{key:"getAccounts",value:function getAccounts(e,t){return this._synchronizer.push("getAccounts",this._getAccounts.bind(this,e,t))}},{key:"_getAccounts",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee265(e,t){var n,r=this;return _regenerator["default"].wrap(function _callee265$(i){for(;;)switch(i.prev=i.next){case 0:R.that(null===this._accountsRequest);i.next=3;return this._blockchain.getBlock(e);case 3:if(n=i.sent){i.next=6;break}throw new Error("Unknown block hash");case 6:a.d(BaseMiniConsensusAgent,"Requesting AccountsProof for ".concat(t," from ").concat(this._peer.peerAddress));return i.abrupt("return",new _promise["default"](function(a,i){r._accountsRequest={addresses:t,block:n,resolve:a,reject:i};r._peer.channel.getAccountsProof(e,t);r._peer.channel.expectMessage(Rt.Type.ACCOUNTS_PROOF,function(){r._peer.channel.close(Wn.GET_ACCOUNTS_PROOF_TIMEOUT,"getAccountsProof timeout");i(new Error("Timeout"))},BaseMiniConsensusAgent.ACCOUNTSPROOF_REQUEST_TIMEOUT)}));case 8:case"end":return i.stop()}},_callee265,this)}));return function _getAccounts(t,n){return e.apply(this,arguments)}}()},{key:"_onAccountsProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee266(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_,p;return _regenerator["default"].wrap(function _callee266$(g){for(;;)switch(g.prev=g.next){case 0:a.d(BaseMiniConsensusAgent,"[ACCOUNTS-PROOF] Received from ".concat(this._peer.peerAddress,": blockHash=").concat(e.blockHash,", proof=").concat(e.proof," (").concat(e.serializedSize," bytes)"));if(this._accountsRequest){g.next=4;break}a.w(BaseMiniConsensusAgent,"Unsolicited accounts proof received from ".concat(this._peer.peerAddress));return g.abrupt("return");case 4:t=this._accountsRequest,n=t.addresses,r=t.block,i=t.resolve,s=t.reject;this._accountsRequest=null;if(e.hasProof()){g.next=9;break}s(new Error("Accounts request was rejected"));return g.abrupt("return");case 9:if(r.hash().equals(e.blockHash)){g.next=14;break}a.w(BaseMiniConsensusAgent,"Received AccountsProof for invalid reference block from ".concat(this._peer.peerAddress));s(new Error("Invalid reference block"));return g.abrupt("return");case 14:if((o=e.proof).verify()){g.next=20;break}a.w(BaseMiniConsensusAgent,"Invalid AccountsProof received from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_ACCOUNTS_PROOF,"Invalid AccountsProof");s(new Error("Invalid AccountsProof"));return g.abrupt("return");case 20:u=o.root();if(r.accountsHash.equals(u)){g.next=26;break}a.w(BaseMiniConsensusAgent,"Invalid AccountsProof (root hash) received from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_ACCOUNTS_PROOF,"AccountsProof root hash mismatch");s(new Error("AccountsProof root hash mismatch"));return g.abrupt("return");case 26:c=[];l=!0;h=!1;f=undefined;g.prev=30;d=(0,_getIterator2["default"])(n);case 32:if(l=(A=d.next()).done){g.next=48;break}_=A.value;g.prev=34;p=o.getAccount(_);c.push(p);g.next=45;break;case 39:g.prev=39;g.t0=g["catch"](34);a.w(BaseMiniConsensusAgent,"Incomplete AccountsProof received from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_ACCOUNTS_PROOF,"Incomplete AccountsProof");s(new Error("Incomplete AccountsProof"));return g.abrupt("return");case 45:l=!0;g.next=32;break;case 48:g.next=54;break;case 50:g.prev=50;g.t1=g["catch"](30);h=!0;f=g.t1;case 54:g.prev=54;g.prev=55;l||null==d["return"]||d["return"]();case 57:g.prev=57;if(!h){g.next=60;break}throw f;case 60:return g.finish(57);case 61:return g.finish(54);case 62:i(c);case 63:case"end":return g.stop()}},_callee266,this,[[30,50,54,62],[34,39],[55,,57,61]])}));return function _onAccountsProof(t){return e.apply(this,arguments)}}()},{key:"_getSubscribedMempoolTransactions",value:function _getSubscribedMempoolTransactions(){var e=this;switch(this._remoteSubscription.type){case Ue.Type.ADDRESSES:return this._mempool.getTransactionsByAddresses(this._remoteSubscription.addresses,BaseMiniConsensusAgent.MEMPOOL_ENTRIES_MAX);case Ue.Type.MIN_FEE:return this._mempool.getTransactions().filter(function(t){return t.feePerByte>=e._remoteSubscription.minFeePerByte});case Ue.Type.ANY:return this._mempool.getTransactions(BaseMiniConsensusAgent.MEMPOOL_ENTRIES_MAX)}return[]}}]);return BaseMiniConsensusAgent}(ht);At.ACCOUNTSPROOF_REQUEST_TIMEOUT=5e3;At.MEMPOOL_DELAY_MIN=500;At.MEMPOOL_DELAY_MAX=5e3;At.MEMPOOL_ENTRIES_MAX=1e3;n.register(At);var _t=function(e){(0,_inherits2["default"])(BaseMiniConsensus,e);var t=_createSuper(BaseMiniConsensus);function BaseMiniConsensus(e,n,r){var a;(0,_classCallCheck2["default"])(this,BaseMiniConsensus);(a=t.call(this,e,n,r))._blockchain=e;a._mempool=n;a._subscription=Ue.BLOCKS_ONLY;a._onToDisconnect((0,_assertThisInitialized2["default"])(a),"head-changed",function(e,t,n,r){return a._onNewAdoptedBlocks(r)});a._onToDisconnect(n,"transaction-mined",function(e,t){return a.fire("transaction-mined",e,t,a._blockchain.head)});return a}(0,_createClass2["default"])(BaseMiniConsensus,[{key:"subscribeAccounts",value:function subscribeAccounts(e){this.subscribe(Ue.fromAddresses(e))}},{key:"subscribe",value:function subscribe(e){var t=this._subscription;(0,_get10["default"])((0,_getPrototypeOf2["default"])(BaseMiniConsensus.prototype),"subscribe",this).call(this,e);e.type===Ue.Type.ADDRESSES&&this._mempool.evictExceptAddresses(e.addresses);if(!e.isSubsetOf(t)){var n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(this._agents.valueIterator());!(n=(i=s.next()).done);n=!0){i.value.requestMempool()}}catch(o){r=!0;a=o}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}}}},{key:"addSubscriptions",value:function addSubscriptions(e){e=(0,_isArray["default"])(e)?e:[e];var t=new w;t.addAll(this._subscription.addresses);t.addAll(e);this.subscribeAccounts(t.values())}},{key:"removeSubscriptions",value:function removeSubscriptions(e){e=(0,_isArray["default"])(e)?e:[e];var t=new w;t.addAll(this._subscription.addresses);t.removeAll(e);this.subscribeAccounts(t.values())}},{key:"_onTransactionAdded",value:function _onTransactionAdded(e){this.fire("transaction-added",e)}},{key:"_onNewAdoptedBlocks",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee267(e){var t,n,r,i,s,o,u;return _regenerator["default"].wrap(function _callee267$(c){for(;;)switch(c.prev=c.next){case 0:if(this._established){c.next=2;break}return c.abrupt("return");case 2:t=!0;n=!1;r=undefined;c.prev=5;i=(0,_getIterator2["default"])(e);case 7:if(t=(s=i.next()).done){c.next=23;break}o=s.value;c.prev=9;c.next=12;return this._requestTransactionsByAddresses(this._subscription.addresses,o);case 12:u=c.sent;c.next=15;return this._mempool.changeHead(o,u);case 15:c.next=20;break;case 17:c.prev=17;c.t0=c["catch"](9);a.e(BaseMiniConsensus,"Failed to retrieve transaction proof to update mempool: ".concat(c.t0.message||c.t0));case 20:t=!0;c.next=7;break;case 23:c.next=29;break;case 25:c.prev=25;c.t1=c["catch"](5);n=!0;r=c.t1;case 29:c.prev=29;c.prev=30;t||null==i["return"]||i["return"]();case 32:c.prev=32;if(!n){c.next=35;break}throw r;case 35:return c.finish(32);case 36:return c.finish(29);case 37:case"end":return c.stop()}},_callee267,this,[[5,25,29,37],[9,17],[30,,32,36]])}));return function _onNewAdoptedBlocks(t){return e.apply(this,arguments)}}()},{key:"getAccount",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee268(e){var t,n=arguments;return _regenerator["default"].wrap(function _callee268$(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&n[1]!==undefined?n[1]:null;r.next=3;return this.getAccounts([e],t);case 3:return r.abrupt("return",r.sent[0]);case 4:case"end":return r.stop()}},_callee268,this)}));return function getAccount(t){return e.apply(this,arguments)}}()},{key:"getAccounts",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee269(e,t){var n,r,i,s,o,u,c,l,h,f;return _regenerator["default"].wrap(function _callee269$(d){for(;;)switch(d.prev=d.next){case 0:t=t||this._blockchain.headHash;n=[];r=!0;i=!1;s=undefined;d.prev=5;for(o=(0,_getIterator2["default"])(this._agents.valueIterator());!(r=(u=o.next()).done);r=!0)(c=u.value).synced&&_.providesServices(c.peer.peerAddress.services,_.ACCOUNTS_PROOF)&&n.push(c);d.next=13;break;case 9:d.prev=9;d.t0=d["catch"](5);i=!0;s=d.t0;case 13:d.prev=13;d.prev=14;r||null==o["return"]||o["return"]();case 16:d.prev=16;if(!i){d.next=19;break}throw s;case 19:return d.finish(16);case 20:return d.finish(13);case 21:n.sort(function(e,n){return e.knowsBlock(t)!==n.knowsBlock(t)?.5-e.knowsBlock(t):Math.random()-.5});l=0,h=n;case 23:if(!(l<h.length)){d.next=37;break}f=h[l];d.prev=25;d.next=28;return f.getAccounts(t,e);case 28:return d.abrupt("return",d.sent);case 31:d.prev=31;d.t1=d["catch"](25);a.w(BaseMiniConsensus,"Failed to retrieve accounts ".concat(e," from ").concat(f.peer.peerAddress,": ").concat(d.t1));case 34:l++;d.next=23;break;case 37:throw new Error("Failed to retrieve accounts ".concat(e));case 38:case"end":return d.stop()}},_callee269,this,[[5,9,13,21],[14,,16,20],[25,31]])}));return function getAccounts(t,n){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee270(e){var t=this;return _regenerator["default"].wrap(function _callee270$(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0;n.next=3;return this.relayTransaction(e);case 3:n.next=5;return new _promise["default"](function(n){var r;r=t.on("transaction-relayed",function(a){if(a.equals(e)){t.off("transaction-relayed",r);n(!0)}});setTimeout(function(){t.off("transaction-relayed",r);n(!1)},dt.TRANSACTION_RELAY_TIMEOUT)});case 5:if(!n.sent){n.next=10;break}return n.abrupt("return",dt.SendTransactionResult.RELAYED);case 10:return n.abrupt("return",dt.SendTransactionResult.PENDING_LOCAL);case 11:n.next=25;break;case 13:n.prev=13;n.t0=n["catch"](0);a.d(BaseMiniConsensus,function(){return"Error sending transaction ".concat(e,": ").concat(n.t0.message||n.t0)});if(!(n.t0 instanceof BaseMiniConsensus.MempoolRejectedError)){n.next=23;break}n.t1=n.t0.mempoolReturnCode;n.next=n.t1===ct.ReturnCode.KNOWN?20:n.t1===ct.ReturnCode.INVALID?21:n.t1===ct.ReturnCode.EXPIRED?22:23;break;case 20:return n.abrupt("return",dt.SendTransactionResult.KNOWN);case 21:return n.abrupt("return",dt.SendTransactionResult.INVALID);case 22:return n.abrupt("return",dt.SendTransactionResult.EXPIRED);case 23:try{this._mempool.removeTransaction(e)}catch(r){}return n.abrupt("return",dt.SendTransactionResult.REJECTED_LOCAL);case 25:case"end":return n.stop()}},_callee270,this,[[0,13]])}));return function sendTransaction(t){return e.apply(this,arguments)}}()},{key:"getPendingTransactions",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee271(e){var t,n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee271$(c){for(;;)switch(c.prev=c.next){case 0:t=new w(function(e){return e instanceof ze?e.hash().hashCode():e.hashCode()});n=!0;r=!1;a=undefined;c.prev=4;for(i=(0,_getIterator2["default"])(e);!(n=(s=i.next()).done);n=!0){o=s.value;(u=this._mempool.getTransaction(o))&&t.add(u)}c.next=12;break;case 8:c.prev=8;c.t0=c["catch"](4);r=!0;a=c.t0;case 12:c.prev=12;c.prev=13;n||null==i["return"]||i["return"]();case 15:c.prev=15;if(!r){c.next=18;break}throw a;case 18:return c.finish(15);case 19:return c.finish(12);case 20:if(t.length===e.length){c.next=26;break}c.t1=t;c.next=24;return this._requestPendingTransactions(e.filter(function(e){return!t.get(e)}));case 24:c.t2=c.sent;c.t1.addAll.call(c.t1,c.t2);case 26:return c.abrupt("return",e.map(function(e){return t.get(e)}).filter(function(e){return!!e}));case 27:case"end":return c.stop()}},_callee271,this,[[4,8,12,20],[13,,15,19]])}));return function getPendingTransactions(t){return e.apply(this,arguments)}}()},{key:"getPendingTransactionsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee272(e,t){return _regenerator["default"].wrap(function _callee272$(n){for(;;)switch(n.prev=n.next){case 0:if(!this._subscription.addresses||!this._subscription.addresses.some(function(t){return t.equals(e)})){n.next=4;break}return n.abrupt("return",this._mempool.getTransactionsByAddresses([e],t));case 4:throw new Error("Can not provide pending transactions without prior subscription");case 5:case"end":return n.stop()}},_callee272,this)}));return function getPendingTransactionsByAddress(t,n){return e.apply(this,arguments)}}()},{key:"relayTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee273(e){var t,n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee273$(c){for(;;)switch(c.prev=c.next){case 0:c.next=2;return this._mempool.pushTransaction(e);case 2:if((t=c.sent)===ct.ReturnCode.ACCEPTED){c.next=5;break}throw new BaseMiniConsensus.MempoolRejectedError(t);case 5:n=!1;r=!0;a=!1;i=undefined;c.prev=9;for(s=(0,_getIterator2["default"])(this._agents.valueIterator());!(r=(o=s.next()).done);r=!0){u=o.value;n=u.relayTransaction(e)&&u.providesServices(_.MEMPOOL)||n}c.next=17;break;case 13:c.prev=13;c.t0=c["catch"](9);a=!0;i=c.t0;case 17:c.prev=17;c.prev=18;r||null==s["return"]||s["return"]();case 20:c.prev=20;if(!a){c.next=23;break}throw i;case 23:return c.finish(20);case 24:return c.finish(17);case 25:if(n){c.next=27;break}throw new Error("Failed to relay transaction - no agent relayed transaction");case 27:case"end":return c.stop()}},_callee273,this,[[9,13,17,25],[18,,20,24]])}));return function relayTransaction(t){return e.apply(this,arguments)}}()}]);return BaseMiniConsensus}(dt);_t.MempoolRejectedError=function(e){(0,_inherits2["default"])(_class5,e);var t=_createSuper(_class5);function _class5(e){var n;(0,_classCallCheck2["default"])(this,_class5);(n=t.call(this,"Failed to relay transaction - mempool rejected transaction"))._mempoolReturnCode=e;return n}(0,_createClass2["default"])(_class5,[{key:"mempoolReturnCode",get:function get(){return this._mempoolReturnCode}}]);return _class5}((0,_wrapNativeSuper2["default"])(Error));n.register(_t);var pt=function(e){(0,_inherits2["default"])(FullChain,e);var t=_createSuper(FullChain);(0,_createClass2["default"])(FullChain,null,[{key:"getPersistent",value:function getPersistent(e,t,n,r){return new FullChain(at.getPersistent(e),t,n,r)._init()}},{key:"createVolatile",value:function createVolatile(e,t,n){return new FullChain(at.createVolatile(),e,t,n)._init()}}]);function FullChain(e,n,r,a){var i;(0,_classCallCheck2["default"])(this,FullChain);(i=t.call(this,e))._accounts=n;i._time=r;i._snapshots=new b;i._snapshotOrder=[];i._mainChain=null;i._proof=null;i._transactionCache=new qe;i._transactionStore=a;i._synchronizer=new G(2,FullChain.SYNCHRONIZER_THROTTLE_AFTER,FullChain.SYNCHRONIZER_THROTTLE_WAIT);i._blockKnownCount=i._blockInvalidCount=i._blockOrphanCount=i._blockExtendedCount=i._blockRebranchedCount=i._blockForkedCount=0;return i}(0,_createClass2["default"])(FullChain,[{key:"_init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee274(){var e,t,n;return _regenerator["default"].wrap(function _callee274$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._store.getHead();case 2:this._headHash=r.sent;if(!this._headHash){r.next=25;break}r.next=6;return this._store.getChainData(qn.GENESIS_HASH);case 6:if((e=r.sent)&&e.onMainChain){r.next=9;break}throw new Error("Invalid genesis block stored. Reset your consensus database.");case 9:r.next=11;return this._store.getChainData(this._headHash,!0);case 11:this._mainChain=r.sent;R.that(!!this._mainChain,"Failed to load main chain from storage");r.t0=this._mainChain.head.accountsHash;r.next=16;return this._accounts.hash();case 16:r.t1=r.sent;if(r.t0.equals.call(r.t0,r.t1)){r.next=19;break}throw new Error("Corrupted store: Inconsistent chain/accounts state");case 19:r.next=21;return this._store.getBlocksBackward(this.headHash,this._transactionCache.missingBlocks-1,!0);case 21:t=r.sent;this._transactionCache.prependBlocks([].concat((0,_toConsumableArray2["default"])(t.reverse()),[this._mainChain.head]));r.next=36;break;case 25:r.next=27;return nt.initial(qn.GENESIS_BLOCK);case 27:this._mainChain=r.sent;this._headHash=qn.GENESIS_HASH;(n=this._store.synchronousTransaction()).putChainDataSync(qn.GENESIS_HASH,this._mainChain);n.setHeadSync(qn.GENESIS_HASH);r.next=34;return n.commit();case 34:r.next=36;return this._accounts.initialize(qn.GENESIS_BLOCK,qn.GENESIS_ACCOUNTS);case 36:return r.abrupt("return",this);case 37:case"end":return r.stop()}},_callee274,this)}));return function _init(){return e.apply(this,arguments)}}()},{key:"pushBlock",value:function pushBlock(e){return this._synchronizer.push(0,this._pushBlock.bind(this,e))}},{key:"_pushBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee275(e){var t,n,r,i,s;return _regenerator["default"].wrap(function _callee275$(o){for(;;)switch(o.prev=o.next){case 0:t=e.hash();o.next=3;return this._store.getBlock(t);case 3:if(!o.sent){o.next=7;break}this._blockKnownCount++;return o.abrupt("return",FullChain.OK_KNOWN);case 7:if(e.isFull()){o.next=11;break}a.w(FullChain,"Rejecting block - body missing");this._blockInvalidCount++;return o.abrupt("return",FullChain.ERR_INVALID);case 11:o.next=13;return e.verify(this._time);case 13:if(o.sent){o.next=16;break}this._blockInvalidCount++;return o.abrupt("return",FullChain.ERR_INVALID);case 16:o.next=18;return this._store.getChainData(e.prevHash);case 18:if(n=o.sent){o.next=23;break}a.w(FullChain,"Rejecting block - unknown predecessor");this._blockOrphanCount++;return o.abrupt("return",FullChain.ERR_ORPHAN);case 23:r=n.head;o.next=26;return e.isImmediateSuccessorOf(r);case 26:if(o.sent){o.next=30;break}a.w(FullChain,"Rejecting block - not a valid immediate successor");this._blockInvalidCount++;return o.abrupt("return",FullChain.ERR_INVALID);case 30:o.next=32;return this.getNextTarget(r);case 32:i=o.sent;R.that(De.isValidTarget(i),"Failed to compute next target in FullChain");if(e.nBits===De.targetToCompact(i)){o.next=38;break}a.w(FullChain,"Rejecting block - difficulty mismatch");this._blockInvalidCount++;return o.abrupt("return",FullChain.ERR_INVALID);case 38:o.next=40;return n.nextChainData(e);case 40:s=o.sent;if(!e.prevHash.equals(this.headHash)){o.next=49;break}o.next=44;return this._extend(t,s,n);case 44:if(o.sent){o.next=47;break}this._blockInvalidCount++;return o.abrupt("return",FullChain.ERR_INVALID);case 47:this._blockExtendedCount++;return o.abrupt("return",FullChain.OK_EXTENDED);case 49:if(!s.totalDifficulty.gt(this.totalDifficulty)){o.next=57;break}o.next=52;return this._rebranch(t,s);case 52:if(o.sent){o.next=55;break}this._blockInvalidCount++;return o.abrupt("return",FullChain.ERR_INVALID);case 55:this._blockRebranchedCount++;return o.abrupt("return",FullChain.OK_REBRANCHED);case 57:a.v(FullChain,"Creating/extending fork with block ".concat(t,", height=").concat(e.height,", totalDifficulty=").concat(s.totalDifficulty,", totalWork=").concat(s.totalWork));o.next=60;return this._store.putChainData(t,s);case 60:this._blockForkedCount++;o.next=63;return this.fire("block",t);case 63:return o.abrupt("return",FullChain.OK_FORKED);case 64:case"end":return o.stop()}},_callee275,this)}));return function _pushBlock(t){return e.apply(this,arguments)}}()},{key:"_verifyInterlink",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee276(e){var t,n;return _regenerator["default"].wrap(function _callee276$(r){for(;;)switch(r.prev=r.next){case 0:t=0;case 1:if(!(t<e.interlink.length)){r.next=15;break}r.next=4;return this._store.getBlock(e.interlink.hashes[t]);case 4:n=r.sent;r.t0=!n;if(r.t0){r.next=10;break}r.next=9;return e.isInterlinkSuccessorOf(n);case 9:r.t0=!r.sent;case 10:if(!r.t0){r.next=12;break}return r.abrupt("return",!1);case 12:t++;r.next=1;break;case 15:return r.abrupt("return",!0);case 16:case"end":return r.stop()}},_callee276,this)}));return function _verifyInterlink(t){return e.apply(this,arguments)}}()},{key:"_extend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee277(e,t,n){var r,i,s,o,u;return _regenerator["default"].wrap(function _callee277$(c){for(;;)switch(c.prev=c.next){case 0:c.next=2;return this._accounts.transaction();case 2:r=c.sent;c.prev=3;c.next=6;return r.commitBlock(t.head,this._transactionCache);case 6:c.next=13;break;case 8:c.prev=8;c.t0=c["catch"](3);a.w(FullChain,"Rejecting block - failed to commit to AccountsTree: ".concat(c.t0.message||c.t0));r.abort()["catch"](a.w.tag(FullChain));return c.abrupt("return",!1);case 13:t.onMainChain=!0;n.mainChainSuccessor=e;c.next=17;return this._store.synchronousTransaction();case 17:(i=c.sent).putChainDataSync(e,t);i.putChainDataSync(t.head.prevHash,n,!1);i.setHeadSync(e);if(!this._transactionStore){c.next=29;break}o=this._transactionStore.transaction();c.next=25;return o.put(t.head);case 25:c.next=27;return(s=JDB.JungleDB).commitCombined.apply(s,(0,_toConsumableArray2["default"])(i.txs).concat([r.tx,o.tx]));case 27:c.next=31;break;case 29:c.next=31;return(u=JDB.JungleDB).commitCombined.apply(u,(0,_toConsumableArray2["default"])(i.txs).concat([r.tx]));case 31:c.next=33;return this._saveSnapshot(e);case 33:this._transactionCache.pushBlock(t.head);if(!this._shouldExtendChainProof()||!this._proof){c.next=40;break}c.next=37;return this._extendChainProof(this._proof,t.head.header);case 37:this._proof=c.sent;c.next=41;break;case 40:this._proof=null;case 41:this._mainChain=t;this._headHash=e;c.next=45;return this.fire("head-changed",this.head,!1);case 45:c.next=47;return this.fire("block",e);case 47:c.next=49;return this.fire("extended",this.head);case 49:return c.abrupt("return",!0);case 50:case"end":return c.stop()}},_callee277,this,[[3,8]])}));return function _extend(t,n,r){return e.apply(this,arguments)}}()},{key:"_shouldExtendChainProof",value:function _shouldExtendChainProof(){return!1}},{key:"_rebranch",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee278(e,t){var n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,b,w,C,S,T,E,x,I,B,P,N,O,M,L,D,U,z,H;return _regenerator["default"].wrap(function _callee278$(G){for(;;)switch(G.prev=G.next){case 0:a.v(FullChain,"Rebranching to fork ".concat(e,", height=").concat(t.head.height,", totalDifficulty=").concat(t.totalDifficulty,", totalWork=").concat(t.totalWork));n=!0;r=!1;i=undefined;G.prev=4;for(s=(0,_getIterator2["default"])(this._snapshotOrder);!(n=(o=s.next()).done);n=!0){u=o.value;this._snapshots.get(u).abort()}G.next=12;break;case 8:G.prev=8;G.t0=G["catch"](4);r=!0;i=G.t0;case 12:G.prev=12;G.prev=13;n||null==s["return"]||s["return"]();case 15:G.prev=15;if(!r){G.next=18;break}throw i;case 18:return G.finish(15);case 19:return G.finish(12);case 20:this._snapshots.clear();this._snapshotOrder=[];c=[];l=[];h=t;f=e;case 26:if(h.onMainChain){G.next=36;break}c.push(h);l.push(f);f=h.head.prevHash;G.next=32;return this._store.getChainData(f,!0);case 32:h=G.sent;R.that(!!h,"Corrupted store: Failed to find fork predecessor while rebranching");G.next=26;break;case 36:a.v(FullChain,function(){return"Found common ancestor ".concat(f.toBase64()," ").concat(c.length," blocks up")});d=h;A=f;G.next=41;return this._accounts.transaction(!1);case 41:_=G.sent;p=this._transactionCache.clone();g=this._transactionStore?this._transactionStore.transaction():null;y=[];v=this._headHash;k=this._mainChain;case 47:if(v.equals(A)){G.next=78;break}G.prev=48;G.next=51;return _.revertBlock(k.head,p);case 51:p.revertBlock(k.head);if(!this._transactionStore){G.next=55;break}G.next=55;return g.remove(k.head);case 55:y.push(k);G.next=64;break;case 58:G.prev=58;G.t1=G["catch"](48);a.e(FullChain,"Failed to revert main chain while rebranching",G.t1);_.abort()["catch"](a.w.tag(FullChain));this._transactionStore&&g.abort()["catch"](a.w.tag(FullChain));return G.abrupt("return",!1);case 64:v=k.head.prevHash;G.next=67;return this._store.getChainData(v,!0);case 67:k=G.sent;R.that(!!k,"Corrupted store: Failed to find main chain predecessor while rebranching");G.t2=R;G.t3=k.head.accountsHash;G.next=73;return _.hash();case 73:G.t4=G.sent;G.t5=G.t3.equals.call(G.t3,G.t4);G.t2.that.call(G.t2,G.t5,"Failed to revert main chain - inconsistent state");G.next=47;break;case 78:R.that(!p.head||v.equals(p.head.hash),"Invalid TransactionCache head");m=p.missingBlocks;b=p.isEmpty()?d.mainChainSuccessor:p.tail.hash;G.next=83;return this._store.getBlocksBackward(b,m,!0);case 83:w=G.sent;p.prependBlocks(w.reverse());C=c.length-1;case 86:if(!(C>=0)){G.next=109;break}G.prev=87;G.next=90;return _.commitBlock(c[C].head,p);case 90:p.pushBlock(c[C].head);if(!this._transactionStore){G.next=94;break}G.next=94;return g.put(c[C].head);case 94:G.next=106;break;case 96:G.prev=96;G.t6=G["catch"](87);a.e(FullChain,"Failed to apply fork block while rebranching",G.t6);_.abort()["catch"](a.w.tag(FullChain));this._transactionStore&&g.abort()["catch"](a.w.tag(FullChain));S=this._store.synchronousTransaction(!1);for(;C>=0;C--)S.removeChainDataSync(l[C]);G.next=105;return S.commit();case 105:return G.abrupt("return",!1);case 106:C--;G.next=86;break;case 109:T=this._store.synchronousTransaction(!1);for(E=0,x=y;E<x.length;E++){(I=x[E]).onMainChain=!1;I.mainChainSuccessor=null;T.putChainDataSync(I.head.hash(),I,!1)}d.mainChainSuccessor=l[l.length-1];T.putChainDataSync(A,d,!1);for(B=c.length-1;B>=0;B--){(P=c[B]).onMainChain=!0;P.mainChainSuccessor=B>0?l[B-1]:null;T.putChainDataSync(l[B],P,0===B)}T.setHeadSync(e);if(!this._transactionStore){G.next=120;break}G.next=118;return(N=JDB.JungleDB).commitCombined.apply(N,(0,_toConsumableArray2["default"])(T.txs).concat([_.tx,g.tx]));case 118:G.next=122;break;case 120:G.next=122;return(O=JDB.JungleDB).commitCombined.apply(O,(0,_toConsumableArray2["default"])(T.txs).concat([_.tx]));case 122:this._transactionCache=p;this._proof=null;M=[];L=0,D=y;case 126:if(!(L<D.length)){G.next=134;break}U=D[L];G.next=130;return this.fire("block-reverted",U.head);case 130:M.push(U.head);case 131:L++;G.next=126;break;case 134:z=[];H=c.length-1;case 136:if(!(H>=0)){G.next=145;break}this._mainChain=c[H];this._headHash=l[H];G.next=141;return this.fire("head-changed",this.head,H>0);case 141:z.push(this.head);case 142:H--;G.next=136;break;case 145:G.next=147;return this.fire("block",e);case 147:G.next=149;return this.fire("rebranched",M,z,e);case 149:return G.abrupt("return",!0);case 150:case"end":return G.stop()}},_callee278,this,[[4,8,12,20],[13,,15,19],[48,58],[87,96]])}));return function _rebranch(t,n){return e.apply(this,arguments)}}()},{key:"getBlocks",value:function getBlocks(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:500,n=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2];return this._store.getBlocks(e,t,n)}},{key:"getChainProof",value:function getChainProof(){var e=this;return this._synchronizer.push(1,(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee279(){return _regenerator["default"].wrap(function _callee279$(t){for(;;)switch(t.prev=t.next){case 0:if(e._proof){t.next=4;break}t.next=3;return e._getChainProof();case 3:e._proof=t.sent;case 4:return t.abrupt("return",e._proof);case 5:case"end":return t.stop()}},_callee279)})))}},{key:"getBlockProof",value:function getBlockProof(e,t){return this._synchronizer.push(1,this._getBlockProof.bind(this,e,t))}},{key:"getAccountsTreeChunk",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee280(e,t){var n;return _regenerator["default"].wrap(function _callee280$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._getSnapshot(e);case 2:n=r.sent;r.t0=n;if(!r.t0){r.next=8;break}r.next=7;return n.getAccountsTreeChunk(t);case 7:r.t0=r.sent;case 8:return r.abrupt("return",r.t0);case 9:case"end":return r.stop()}},_callee280,this)}));return function getAccountsTreeChunk(t,n){return e.apply(this,arguments)}}()},{key:"getAccountsProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee281(e,t){var n;return _regenerator["default"].wrap(function _callee281$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._getSnapshot(e);case 2:n=r.sent;r.t0=n;if(!r.t0){r.next=8;break}r.next=7;return n.getAccountsProof(t);case 7:r.t0=r.sent;case 8:return r.abrupt("return",r.t0);case 9:case"end":return r.stop()}},_callee281,this)}));return function getAccountsProof(t,n){return e.apply(this,arguments)}}()},{key:"getTransactionsProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee282(e,t){return _regenerator["default"].wrap(function _callee282$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.getTransactionsProofByAddresses(e,t));case 1:case"end":return n.stop()}},_callee282,this)}));return function getTransactionsProof(t,n){return e.apply(this,arguments)}}()},{key:"getTransactionsProofByAddresses",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee283(e,t){var n,r,a,i,s,o,u,c,l,h;return _regenerator["default"].wrap(function _callee283$(f){for(;;)switch(f.prev=f.next){case 0:f.next=2;return this.getBlock(e,!1,!0);case 2:if((n=f.sent)&&n.isFull()){f.next=5;break}return f.abrupt("return",null);case 5:r=[];(a=new w).addAll(t);i=!0;s=!1;o=undefined;f.prev=11;for(u=(0,_getIterator2["default"])(n.transactions);!(i=(c=u.next()).done);i=!0){l=c.value;(a.contains(l.sender)||a.contains(l.recipient))&&r.push(l)}f.next=19;break;case 15:f.prev=15;f.t0=f["catch"](11);s=!0;o=f.t0;case 19:f.prev=19;f.prev=20;i||null==u["return"]||u["return"]();case 22:f.prev=22;if(!s){f.next=25;break}throw o;case 25:return f.finish(22);case 26:return f.finish(19);case 27:h=ee.compute(n.body.getMerkleLeafs(),r);return f.abrupt("return",new Ke(r,h));case 29:case"end":return f.stop()}},_callee283,this,[[11,15,19,27],[20,,22,26]])}));return function getTransactionsProofByAddresses(t,n){return e.apply(this,arguments)}}()},{key:"getTransactionsProofByHashes",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee284(e,t){var n,r,a,i,s,o,u,c,l,h;return _regenerator["default"].wrap(function _callee284$(f){for(;;)switch(f.prev=f.next){case 0:f.next=2;return this.getBlock(e,!1,!0);case 2:if((n=f.sent)&&n.isFull()){f.next=5;break}return f.abrupt("return",null);case 5:r=[];(a=new w).addAll(t);i=!0;s=!1;o=undefined;f.prev=11;for(u=(0,_getIterator2["default"])(n.transactions);!(i=(c=u.next()).done);i=!0){l=c.value;a.contains(l.hash())&&r.push(l)}f.next=19;break;case 15:f.prev=15;f.t0=f["catch"](11);s=!0;o=f.t0;case 19:f.prev=19;f.prev=20;i||null==u["return"]||u["return"]();case 22:f.prev=22;if(!s){f.next=25;break}throw o;case 25:return f.finish(22);case 26:return f.finish(19);case 27:h=ee.compute(n.body.getMerkleLeafs(),r);return f.abrupt("return",new Ke(r,h));case 29:case"end":return f.stop()}},_callee284,this,[[11,15,19,27],[20,,22,26]])}));return function getTransactionsProofByHashes(t,n){return e.apply(this,arguments)}}()},{key:"getTransactionReceiptsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee285(e){var t,n,r,a,i=arguments;return _regenerator["default"].wrap(function _callee285$(s){for(;;)switch(s.prev=s.next){case 0:t=i.length>1&&i[1]!==undefined?i[1]:null;if(this._transactionStore){s.next=3;break}return s.abrupt("return",null);case 3:n=[];s.next=6;return this._transactionStore.getBySender(e,!t||t<0||!(0,_isFinite["default"])(t)?null:t/2);case 6:r=s.sent;s.next=9;return this._transactionStore.getByRecipient(e,!t||t<0||!(0,_isFinite["default"])(t)?null:t/2);case 9:a=s.sent;r.forEach(function(e){n.push(new Qe(e.transactionHash,e.blockHash,e.blockHeight))});a.forEach(function(e){n.push(new Qe(e.transactionHash,e.blockHash,e.blockHeight))});return s.abrupt("return",n);case 13:case"end":return s.stop()}},_callee285,this)}));return function getTransactionReceiptsByAddress(t){return e.apply(this,arguments)}}()},{key:"getTransactionReceiptsByHashes",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee286(e){var t,n,r,a,i,s,o,u,c,l=this,h=arguments;return _regenerator["default"].wrap(function _callee286$(f){for(;;)switch(f.prev=f.next){case 0:t=h.length>1&&h[1]!==undefined?h[1]:null;if(this._transactionStore){f.next=3;break}return f.abrupt("return",null);case 3:n=[];f.next=6;return _promise["default"].all(e.map(function(e){return l._transactionStore.get(e)}));case 6:r=f.sent;a=!0;i=!1;s=undefined;f.prev=10;for(o=(0,_getIterator2["default"])(r);!(a=(u=o.next()).done);a=!0)(c=u.value)&&(!t||t<0||n.length<t)&&n.push(new Qe(c.transactionHash,c.blockHash,c.blockHeight));f.next=18;break;case 14:f.prev=14;f.t0=f["catch"](10);i=!0;s=f.t0;case 18:f.prev=18;f.prev=19;a||null==o["return"]||o["return"]();case 21:f.prev=21;if(!i){f.next=24;break}throw s;case 24:return f.finish(21);case 25:return f.finish(18);case 26:return f.abrupt("return",n);case 27:case"end":return f.stop()}},_callee286,this,[[10,14,18,26],[19,,21,25]])}));return function getTransactionReceiptsByHashes(t){return e.apply(this,arguments)}}()},{key:"getTransactionInfoByHash",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee287(e){var t;return _regenerator["default"].wrap(function _callee287$(n){for(;;)switch(n.prev=n.next){case 0:if(this._transactionStore){n.next=2;break}throw new Error("Invalid request");case 2:n.next=4;return this._transactionStore.get(e);case 4:if(t=n.sent){n.next=7;break}return n.abrupt("return",null);case 7:return n.abrupt("return",t);case 8:case"end":return n.stop()}},_callee287,this)}));return function getTransactionInfoByHash(t){return e.apply(this,arguments)}}()},{key:"_getSnapshot",value:function _getSnapshot(e){var t=this;return this._synchronizer.push(1,(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee288(){var n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee288$(u){for(;;)switch(u.prev=u.next){case 0:u.next=2;return t.getBlock(e);case 2:if((n=u.sent)&&!(t._mainChain.head.height-n.height>re.NUM_SNAPSHOTS_MAX)){u.next=5;break}return u.abrupt("return",null);case 5:r=null;if(t._snapshots.contains(e)){u.next=32;break}u.next=9;return t._accounts.transaction();case 9:a=u.sent;i=t._transactionCache.clone();s=t._headHash;case 12:if(n.prevHash.equals(s)){u.next=28;break}u.next=15;return t.getBlock(s,!1,!0);case 15:o=u.sent;if(t._snapshots.contains(s)){u.next=22;break}u.next=19;return t._accounts.snapshot(a);case 19:r=u.sent;t._snapshots.put(s,r);t._snapshotOrder.unshift(s);case 22:u.next=24;return a.revertBlock(o,i);case 24:i.revertBlock(o);s=o.prevHash;u.next=12;break;case 28:u.next=30;return a.abort();case 30:u.next=33;break;case 32:r=t._snapshots.get(e);case 33:u.t0=R;u.t1=n.accountsHash;u.next=37;return r.hash();case 37:u.t2=u.sent;u.t3=u.t1.equals.call(u.t1,u.t2);u.t0.that.call(u.t0,u.t3,"AccountsHash mismatch for snapshot of block ${blockHash}");return u.abrupt("return",r);case 41:case"end":return u.stop()}},_callee288)})))}},{key:"_saveSnapshot",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee289(e){var t,n,r;return _regenerator["default"].wrap(function _callee289$(i){for(;;)switch(i.prev=i.next){case 0:if(!(this._snapshotOrder.length>0)){i.next=15;break}t=this._snapshotOrder.shift();if(!(n=this._snapshots.get(t))){i.next=8;break}i.next=6;return n.abort();case 6:i.next=9;break;case 8:a.e(FullChain,function(){return"Snapshot with hash ".concat(t.toBase64()," not found.")});case 9:this._snapshots.remove(t);i.next=12;return this._accounts.snapshot();case 12:r=i.sent;this._snapshots.put(e,r);this._snapshotOrder.push(e);case 15:case"end":return i.stop()}},_callee289,this)}));return function _saveSnapshot(t){return e.apply(this,arguments)}}()},{key:"accountsHash",value:function accountsHash(){return this._accounts.hash()}},{key:"head",get:function get(){return this._mainChain.head}},{key:"headHash",get:function get(){return this._headHash}},{key:"height",get:function get(){return this._mainChain.head.height}},{key:"totalDifficulty",get:function get(){return this._mainChain.totalDifficulty}},{key:"totalWork",get:function get(){return this._mainChain.totalWork}},{key:"accounts",get:function get(){return this._accounts}},{key:"transactionCache",get:function get(){return this._transactionCache}},{key:"blockForkedCount",get:function get(){return this._blockForkedCount}},{key:"blockRebranchedCount",get:function get(){return this._blockRebranchedCount}},{key:"blockExtendedCount",get:function get(){return this._blockExtendedCount}},{key:"blockOrphanCount",get:function get(){return this._blockOrphanCount}},{key:"blockInvalidCount",get:function get(){return this._blockInvalidCount}},{key:"blockKnownCount",get:function get(){return this._blockKnownCount}},{key:"queue",get:function get(){return this._synchronizer}}]);return FullChain}(Xe);pt.ERR_ORPHAN=-2;pt.ERR_INVALID=-1;pt.OK_KNOWN=0;pt.OK_EXTENDED=1;pt.OK_REBRANCHED=2;pt.OK_FORKED=3;pt.SYNCHRONIZER_THROTTLE_AFTER=500;pt.SYNCHRONIZER_THROTTLE_WAIT=30;n.register(pt);var gt=function(e){(0,_inherits2["default"])(FullConsensusAgent,e);var t=_createSuper(FullConsensusAgent);function FullConsensusAgent(e,n,r,a,i,s){var o;(0,_classCallCheck2["default"])(this,FullConsensusAgent);(o=t.call(this,r,a,i,s))._blockchain=e;o._mempool=n;o._syncing=!1;o._numBlocksExtending=-1;o._numBlocksForking=-1;o._forkHead=null;o._failedSyncs=0;o._syncTarget=a.headHash;o._chainProofLimit=new F(FullConsensusAgent.CHAIN_PROOF_RATE_LIMIT);o._accountsProofLimit=new F(FullConsensusAgent.ACCOUNTS_PROOF_RATE_LIMIT);o._accountsTreeChunkLimit=new F(FullConsensusAgent.ACCOUNTS_TREE_CHUNK_RATE_LIMIT);o._transactionsProofLimit=new F(FullConsensusAgent.TRANSACTION_PROOF_RATE_LIMIT);o._transactionReceiptsLimit=new F(FullConsensusAgent.TRANSACTION_RECEIPTS_RATE_LIMIT);o._blockProofLimit=new F(FullConsensusAgent.BLOCK_PROOF_RATE_LIMIT);o._getBlocksLimit=new F(FullConsensusAgent.GET_BLOCKS_RATE_LIMIT);o._onToDisconnect(a.channel,"get-blocks",function(e){return o._onGetBlocks(e)});o._onToDisconnect(a.channel,"get-chain-proof",function(e){return o._onGetChainProof(e)});o._onToDisconnect(a.channel,"get-accounts-proof",function(e){return o._onGetAccountsProof(e)});o._onToDisconnect(a.channel,"get-accounts-tree-chunk",function(e){return o._onGetAccountsTreeChunk(e)});o._onToDisconnect(a.channel,"get-transactions-proof",function(e){return o._onGetTransactionsProofByAddresses(e)});o._onToDisconnect(a.channel,"get-transaction-receipts",function(e){return o._onGetTransactionReceiptsByAddress(e)});o._onToDisconnect(a.channel,"get-block-proof",function(e){return o._onGetBlockProof(e)});o._onToDisconnect(a.channel,"get-block-proof-at",function(e){return o._onGetBlockProofAt(e)});o._onToDisconnect(a.channel,"get-transactions-proof-by-hashes",function(e){return o._onGetTransactionsProofByHashes(e)});o._onToDisconnect(a.channel,"get-transaction-receipts-by-hashes",function(e){return o._onGetTransactionReceiptsByHashes(e)});return o}(0,_createClass2["default"])(FullConsensusAgent,[{key:"syncBlockchain",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee290(){return _regenerator["default"].wrap(function _callee290$(e){for(;;)switch(e.prev=e.next){case 0:this._syncing=!0;if(this.providesServices(_.BLOCK_HISTORY,_.FULL_BLOCKS)){e.next=4;break}this._syncFinished();return e.abrupt("return");case 4:if(this._objectsInFlight.isEmpty()){e.next=7;break}a.v(FullConsensusAgent,"Waiting for ".concat(this._objectsInFlight.length," objects to arrive ..."));return e.abrupt("return");case 7:if(this._objectsProcessing.isEmpty()){e.next=10;break}a.v(FullConsensusAgent,"Waiting for ".concat(this._objectsProcessing.length," objects to be processed ..."));return e.abrupt("return");case 10:e.next=12;return this._blockchain.getBlock(this._syncTarget,!0);case 12:if(!e.sent){e.next=16;break}this._syncFinished();return e.abrupt("return");case 16:if(!(0===this._numBlocksExtending&&++this._failedSyncs>=FullConsensusAgent.SYNC_ATTEMPTS_MAX)){e.next=19;break}this._peer.channel.close(Wn.BLOCKCHAIN_SYNC_FAILED,"blockchain sync failed");return e.abrupt("return");case 19:this._requestBlocks()["catch"](a.w.tag(FullConsensusAgent));case 20:case"end":return e.stop()}},_callee290,this)}));return function syncBlockchain(){return e.apply(this,arguments)}}()},{key:"_syncFinished",value:function _syncFinished(){var e=this;this._subscribeTarget();var t=FullConsensusAgent.MEMPOOL_DELAY_MIN+Math.random()*(FullConsensusAgent.MEMPOOL_DELAY_MAX-FullConsensusAgent.MEMPOOL_DELAY_MIN);setTimeout(function(){return e._peer.channel.mempool()},t);this._syncing=!1;this._synced=!0;this._numBlocksExtending=0;this._numBlocksForking=0;this._forkHead=null;this._failedSyncs=0;this.fire("sync")}},{key:"_requestBlocks",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee291(e){var t,n=this;return _regenerator["default"].wrap(function _callee291$(r){for(;;)switch(r.prev=r.next){case 0:if(!this._peer.channel.isExpectingMessage(Rt.Type.INV)){r.next=2;break}return r.abrupt("return");case 2:this._peer.channel.expectMessage(Rt.Type.INV,function(){n._peer.channel.close(Wn.GET_BLOCKS_TIMEOUT,"getBlocks timeout")},ht.REQUEST_TIMEOUT);if(!(this._forkHead&&0===this._numBlocksExtending&&this._numBlocksForking>0)){r.next=8;break}t=[this._forkHead.hash()];r.next=11;break;case 8:r.next=10;return this._blockchain.getBlockLocators();case 10:t=r.sent;case 11:this._numBlocksExtending=0;this._numBlocksForking=0;this._peer.channel.getBlocks(t,e);case 14:case"end":return r.stop()}},_callee291,this)}));return function _requestBlocks(t){return e.apply(this,arguments)}}()},{key:"_shouldRequestData",value:function _shouldRequestData(e){return!(e.type===Gt.Type.BLOCK&&!this.providesServices(_.FULL_BLOCKS)||e.type===Gt.Type.TRANSACTION&&this._mempool.isFiltered(e.hash))}},{key:"_getBlock",value:function _getBlock(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1],n=arguments.length>2&&arguments[2]!==undefined&&arguments[2];return this._blockchain.getBlock(e,t,n)}},{key:"_getRawBlock",value:function _getRawBlock(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return this._blockchain.getRawBlock(e,t)}},{key:"_getTransaction",value:function _getTransaction(e){return this._mempool.getTransaction(e)}},{key:"_onKnownBlockAnnounced",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee292(e,t){return _regenerator["default"].wrap(function _callee292$(e){for(;;)switch(e.prev=e.next){case 0:if(this._syncing){e.next=2;break}return e.abrupt("return");case 2:this._numBlocksForking++;this._forkHead=t;case 4:case"end":return e.stop()}},_callee292,this)}));return function _onKnownBlockAnnounced(t,n){return e.apply(this,arguments)}}()},{key:"_onNoUnknownObjects",value:function _onNoUnknownObjects(){this._syncing&&this.syncBlockchain()["catch"](a.e.tag(FullConsensusAgent))}},{key:"_onAllObjectsReceived",value:function _onAllObjectsReceived(){this._syncing&&this.syncBlockchain()["catch"](a.e.tag(FullConsensusAgent))}},{key:"_onHeader",value:function _onHeader(e){a.w(FullConsensusAgent,"Unsolicited header message received from ".concat(this._peer.peerAddress,", discarding"))}},{key:"_processBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee293(e,t){var n;return _regenerator["default"].wrap(function _callee293$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._blockchain.pushBlock(t);case 2:n=r.sent;r.t0=n;r.next=r.t0===pt.ERR_INVALID?6:r.t0===pt.OK_EXTENDED?8:r.t0===pt.OK_REBRANCHED?8:r.t0===pt.OK_FORKED?10:r.t0===pt.ERR_ORPHAN?12:r.t0===pt.OK_KNOWN?14:16;break;case 6:this._peer.channel.close(Wn.INVALID_BLOCK,"received invalid block");return r.abrupt("break",16);case 8:this._syncing&&this._numBlocksExtending++;return r.abrupt("break",16);case 10:if(this._syncing){this._numBlocksForking++;this._forkHead=t}return r.abrupt("break",16);case 12:this._onOrphanBlock(e,t);return r.abrupt("break",16);case 14:a.v(FullConsensusAgent,"Received known block ".concat(e," (height=").concat(t.height,", prevHash=").concat(t.prevHash,") from ").concat(this._peer.peerAddress));return r.abrupt("break",16);case 16:case"end":return r.stop()}},_callee293,this)}));return function _processBlock(t,n){return e.apply(this,arguments)}}()},{key:"_onOrphanBlock",value:function _onOrphanBlock(e,t){var n=this;if(this._synced){a.d(FullConsensusAgent,"Received orphan block ".concat(e," (height=").concat(t.height,", prevHash=").concat(t.prevHash,") from ").concat(this._peer.peerAddress));this._timers.timeoutExists("outOfSync")||this._subscribe(Ue.NONE);this._syncTarget=e;this._timers.resetTimeout("outOfSync",function(){return n._outOfSync()},FullConsensusAgent.RESYNC_THROTTLE)}else a.w(FullConsensusAgent,"Received orphan block ".concat(e," (height=").concat(t.height,", prevHash=").concat(t.prevHash,") while syncing"))}},{key:"_outOfSync",value:function _outOfSync(){this._timers.clearTimeout("outOfSync");this._synced=!1;this.fire("out-of-sync")}},{key:"_processTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee294(e,t){var n,r=this;return _regenerator["default"].wrap(function _callee294$(i){for(;;)switch(i.prev=i.next){case 0:i.next=2;return this._mempool.pushTransaction(t);case 2:n=i.sent;i.t0=n;i.next=i.t0===ct.ReturnCode.FEE_TOO_LOW?6:i.t0===ct.ReturnCode.INVALID?8:i.t0===ct.ReturnCode.MINED?10:i.t0===ct.ReturnCode.EXPIRED?10:i.t0===ct.ReturnCode.FILTERED?12:14;break;case 6:this._peer.channel.reject(Rt.Type.TX,Yt.Code.REJECT_INSUFFICIENT_FEE,"Sender has too many free transactions",t.hash().serialize());return i.abrupt("break",14);case 8:this._peer.channel.reject(Rt.Type.TX,Yt.Code.REJECT_INVALID,"Invalid transaction",t.hash().serialize());return i.abrupt("break",14);case 10:a.v(FullConsensusAgent,function(){return"Ignored transaction ".concat(e.toHex()," relayed by ").concat(r._peer.peerAddress," (").concat(r._peer.netAddress,")")});return i.abrupt("break",14);case 12:a.v(FullConsensusAgent,function(){return"Filtered transaction ".concat(e.toHex()," relayed by ").concat(r._peer.peerAddress," (").concat(r._peer.netAddress,")")});return i.abrupt("break",14);case 14:case"end":return i.stop()}},_callee294,this)}));return function _processTransaction(t,n){return e.apply(this,arguments)}}()},{key:"_onAllObjectsProcessed",value:function _onAllObjectsProcessed(){this._syncing&&this.syncBlockchain()["catch"](a.e.tag(FullConsensusAgent))}},{key:"_onGetBlocks",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee295(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_,p,g;return _regenerator["default"].wrap(function _callee295$(y){for(;;)switch(y.prev=y.next){case 0:if(this._getBlocksLimit.note()){y.next=3;break}a.w(FullConsensusAgent,"Rejecting GetBlocks message - rate-limit exceeded");return y.abrupt("return");case 3:a.v(FullConsensusAgent,"[GETBLOCKS] ".concat(e.locators.length," block locators maxInvSize ").concat(e.maxInvSize," received from ").concat(this._peer.peerAddress));t=qn.GENESIS_BLOCK;n=!0;r=!1;i=undefined;y.prev=8;s=(0,_getIterator2["default"])(e.locators);case 10:if(n=(o=s.next()).done){y.next=21;break}u=o.value;y.next=14;return this._blockchain.getBlock(u);case 14:if(!(c=y.sent)){y.next=18;break}t=c;return y.abrupt("break",21);case 18:n=!0;y.next=10;break;case 21:y.next=27;break;case 23:y.prev=23;y.t0=y["catch"](8);r=!0;i=y.t0;case 27:y.prev=27;y.prev=28;n||null==s["return"]||s["return"]();case 30:y.prev=30;if(!r){y.next=33;break}throw i;case 33:return y.finish(30);case 34:return y.finish(27);case 35:y.next=37;return this._blockchain.getBlocks(t.hash(),Math.min(e.maxInvSize,FullConsensusAgent.GETBLOCKS_VECTORS_MAX),e.direction===zt.Direction.FORWARD);case 37:l=y.sent;h=[];f=!0;d=!1;A=undefined;y.prev=42;for(_=(0,_getIterator2["default"])(l);!(f=(p=_.next()).done);f=!0){g=p.value;h.push(Gt.fromBlock(g))}y.next=50;break;case 46:y.prev=46;y.t1=y["catch"](42);d=!0;A=y.t1;case 50:y.prev=50;y.prev=51;f||null==_["return"]||_["return"]();case 53:y.prev=53;if(!d){y.next=56;break}throw A;case 56:return y.finish(53);case 57:return y.finish(50);case 58:this._peer.channel.inv(h);case 59:case"end":return y.stop()}},_callee295,this,[[8,23,27,35],[28,,30,34],[42,46,50,58],[51,,53,57]])}));return function _onGetBlocks(t){return e.apply(this,arguments)}}()},{key:"_onGetChainProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee296(e){var t;return _regenerator["default"].wrap(function _callee296$(e){for(;;)switch(e.prev=e.next){case 0:if(this._chainProofLimit.note()){e.next=4;break}a.w(FullConsensusAgent,"Rejecting GetChainProof message - rate-limit exceeded");this._peer.channel.close(Wn.RATE_LIMIT_EXCEEDED,"rate-limit exceeded");return e.abrupt("return");case 4:e.next=6;return this._blockchain.getChainProof();case 6:t=e.sent;this._peer.channel.chainProof(t);case 8:case"end":return e.stop()}},_callee296,this)}));return function _onGetChainProof(t){return e.apply(this,arguments)}}()},{key:"_onGetBlockProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee297(e){var t,n,r;return _regenerator["default"].wrap(function _callee297$(i){for(;;)switch(i.prev=i.next){case 0:if(this._blockProofLimit.note()){i.next=4;break}a.w(FullConsensusAgent,"Rejecting GetBlockProof message - rate-limit exceeded");this._peer.channel.blockProof(null);return i.abrupt("return");case 4:i.next=6;return this._blockchain.getBlock(e.blockHashToProve);case 6:t=i.sent;i.next=9;return this._blockchain.getBlock(e.knownBlockHash);case 9:n=i.sent;if(t&&n){i.next=13;break}this._peer.channel.blockProof();return i.abrupt("return");case 13:i.next=15;return this._blockchain.getBlockProof(t,n);case 15:r=i.sent;this._peer.channel.blockProof(r);case 17:case"end":return i.stop()}},_callee297,this)}));return function _onGetBlockProof(t){return e.apply(this,arguments)}}()},{key:"_onGetBlockProofAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee298(e){var t,n,r;return _regenerator["default"].wrap(function _callee298$(i){for(;;)switch(i.prev=i.next){case 0:if(this._blockProofLimit.note()){i.next=4;break}a.w(FullConsensusAgent,"Rejecting GetBlockProof message - rate-limit exceeded");this._peer.channel.blockProof(null);return i.abrupt("return");case 4:i.next=6;return this._blockchain.getBlockAt(e.blockHeightToProve);case 6:t=i.sent;i.next=9;return this._blockchain.getBlock(e.knownBlockHash);case 9:n=i.sent;if(t&&n){i.next=13;break}this._peer.channel.blockProof();return i.abrupt("return");case 13:i.next=15;return this._blockchain.getBlockProof(t,n);case 15:r=i.sent;this._peer.channel.blockProof(r);case 17:case"end":return i.stop()}},_callee298,this)}));return function _onGetBlockProofAt(t){return e.apply(this,arguments)}}()},{key:"_onGetAccountsProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee299(e){var t;return _regenerator["default"].wrap(function _callee299$(n){for(;;)switch(n.prev=n.next){case 0:if(this._accountsProofLimit.note()){n.next=4;break}a.w(FullConsensusAgent,"Rejecting GetAccountsProof message - rate-limit exceeded");this._peer.channel.accountsProof(e.blockHash,null);return n.abrupt("return");case 4:n.next=6;return this._blockchain.getAccountsProof(e.blockHash,e.addresses);case 6:t=n.sent;this._peer.channel.accountsProof(e.blockHash,t);case 8:case"end":return n.stop()}},_callee299,this)}));return function _onGetAccountsProof(t){return e.apply(this,arguments)}}()},{key:"_onGetTransactionsProofByAddresses",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee300(e){var t;return _regenerator["default"].wrap(function _callee300$(n){for(;;)switch(n.prev=n.next){case 0:if(this._transactionsProofLimit.note()){n.next=4;break}a.w(FullConsensusAgent,"Rejecting GetTransactionsProof message - rate-limit exceeded");this._peer.channel.transactionsProof(e.blockHash,null);return n.abrupt("return");case 4:n.next=6;return this._blockchain.getTransactionsProofByAddresses(e.blockHash,e.addresses);case 6:t=n.sent;this._peer.channel.transactionsProof(e.blockHash,t);case 8:case"end":return n.stop()}},_callee300,this)}));return function _onGetTransactionsProofByAddresses(t){return e.apply(this,arguments)}}()},{key:"_onGetTransactionsProofByHashes",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee301(e){var t;return _regenerator["default"].wrap(function _callee301$(n){for(;;)switch(n.prev=n.next){case 0:if(this._transactionsProofLimit.note()){n.next=4;break}a.w(FullConsensusAgent,"Rejecting GetTransactionsProof message - rate-limit exceeded");this._peer.channel.transactionsProof(e.blockHash,null);return n.abrupt("return");case 4:n.next=6;return this._blockchain.getTransactionsProofByHashes(e.blockHash,e.hashes);case 6:t=n.sent;this._peer.channel.transactionsProof(e.blockHash,t);case 8:case"end":return n.stop()}},_callee301,this)}));return function _onGetTransactionsProofByHashes(t){return e.apply(this,arguments)}}()},{key:"_onGetAccountsTreeChunk",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee302(e){var t;return _regenerator["default"].wrap(function _callee302$(n){for(;;)switch(n.prev=n.next){case 0:if(this._accountsTreeChunkLimit.note()){n.next=4;break}a.w(FullConsensusAgent,"Rejecting GetAccountsTreeChunk message - rate-limit exceeded");this._peer.channel.accountsTreeChunk(e.blockHash,null);return n.abrupt("return");case 4:n.next=6;return this._blockchain.getAccountsTreeChunk(e.blockHash,e.startPrefix);case 6:t=n.sent;this._peer.channel.accountsTreeChunk(e.blockHash,t);case 8:case"end":return n.stop()}},_callee302,this)}));return function _onGetAccountsTreeChunk(t){return e.apply(this,arguments)}}()},{key:"_onGetTransactionReceiptsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee303(e){var t;return _regenerator["default"].wrap(function _callee303$(n){for(;;)switch(n.prev=n.next){case 0:if(this._transactionReceiptsLimit.note()){n.next=4;break}a.w(FullConsensusAgent,"Rejecting GetTransactionReceipts message - rate-limit exceeded");this._peer.channel.transactionReceipts(null);return n.abrupt("return");case 4:n.next=6;return this._blockchain.getTransactionReceiptsByAddress(e.address,An.RECEIPTS_MAX_COUNT);case 6:t=n.sent;this._peer.channel.transactionReceipts(t);case 8:case"end":return n.stop()}},_callee303,this)}));return function _onGetTransactionReceiptsByAddress(t){return e.apply(this,arguments)}}()},{key:"_onGetTransactionReceiptsByHashes",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee304(e){var t;return _regenerator["default"].wrap(function _callee304$(n){for(;;)switch(n.prev=n.next){case 0:if(this._transactionReceiptsLimit.note()){n.next=4;break}a.w(FullConsensusAgent,"Rejecting GetTransactionReceipts message - rate-limit exceeded");this._peer.channel.transactionReceipts(null);return n.abrupt("return");case 4:n.next=6;return this._blockchain.getTransactionReceiptsByHashes(e.hashes,An.RECEIPTS_MAX_COUNT);case 6:t=n.sent;this._peer.channel.transactionReceipts(t);case 8:case"end":return n.stop()}},_callee304,this)}));return function _onGetTransactionReceiptsByHashes(t){return e.apply(this,arguments)}}()},{key:"_getSubscribedMempoolTransactions",value:function _getSubscribedMempoolTransactions(){switch(this._remoteSubscription.type){case Ue.Type.ADDRESSES:return this._mempool.getTransactionsByAddresses(this._remoteSubscription.addresses,FullConsensusAgent.MEMPOOL_ENTRIES_MAX);case Ue.Type.MIN_FEE:return new E(this._mempool.transactionGenerator(undefined,this._remoteSubscription.minFeePerByte),FullConsensusAgent.MEMPOOL_ENTRIES_MAX);case Ue.Type.ANY:return new E(this._mempool.transactionGenerator(),FullConsensusAgent.MEMPOOL_ENTRIES_MAX)}return[]}},{key:"syncing",get:function get(){return this._syncing}}]);return FullConsensusAgent}(ht);gt.SYNC_ATTEMPTS_MAX=25;gt.GETBLOCKS_VECTORS_MAX=500;gt.RESYNC_THROTTLE=3e3;gt.MEMPOOL_DELAY_MIN=2e3;gt.MEMPOOL_DELAY_MAX=2e4;gt.MEMPOOL_THROTTLE=1e3;gt.MEMPOOL_ENTRIES_MAX=1e4;gt.CHAIN_PROOF_RATE_LIMIT=3;gt.ACCOUNTS_PROOF_RATE_LIMIT=60;gt.ACCOUNTS_TREE_CHUNK_RATE_LIMIT=300;gt.TRANSACTION_PROOF_RATE_LIMIT=180;gt.TRANSACTION_RECEIPTS_RATE_LIMIT=30;gt.BLOCK_PROOF_RATE_LIMIT=180;gt.GET_BLOCKS_RATE_LIMIT=30;n.register(gt);var yt=function(e){(0,_inherits2["default"])(FullConsensus,e);var t=_createSuper(FullConsensus);function FullConsensus(e,n,r){var a;(0,_classCallCheck2["default"])(this,FullConsensus);(a=t.call(this,e,n,r))._blockchain=e;a._mempool=n;a._producer=new $e(e,e.accounts,n,r.time);return a}(0,_createClass2["default"])(FullConsensus,[{key:"getBlock",value:function getBlock(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n=(arguments.length>2&&arguments[2]!==undefined&&arguments[2],arguments.length>3?arguments[3]:undefined,this._blockchain.getBlock(e,!0,t));if(!n)throw new Error("No block found for hash ".concat(e));return n}},{key:"getBlockAt",value:function getBlockAt(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1];if(e>this._blockchain.height||e<1)throw new Error("Invalid height");var n=this._blockchain.getBlockAt(e,t);if(!n)throw new Error("No block found at height ".concat(e));return n}},{key:"getBlockTemplate",value:function getBlockTemplate(e,t){return this._producer.getNextBlock(e,t)}},{key:"submitBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee305(e){return _regenerator["default"].wrap(function _callee305$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this.blockchain.pushBlock(e);case 2:t.t0=t.sent;return t.abrupt("return",t.t0>=0);case 4:case"end":return t.stop()}},_callee305,this)}));return function submitBlock(t){return e.apply(this,arguments)}}()},{key:"getAccounts",value:function getAccounts(e){var t=this;return _promise["default"].all(e.map(function(e){return t._blockchain.accounts.get(e)}))}},{key:"getPendingTransactions",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee306(e){var t=this;return _regenerator["default"].wrap(function _callee306$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",e.map(function(e){return t._mempool.getTransaction(e)}).filter(function(e){return null!=e}));case 1:case"end":return n.stop()}},_callee306)}));return function getPendingTransactions(t){return e.apply(this,arguments)}}()},{key:"getPendingTransactionsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee307(e,t){return _regenerator["default"].wrap(function _callee307$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this._mempool.getTransactionsByAddresses([e],t));case 1:case"end":return n.stop()}},_callee307,this)}));return function getPendingTransactionsByAddress(t,n){return e.apply(this,arguments)}}()},{key:"getTransactionsFromBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee308(e,t,n,r){return _regenerator["default"].wrap(function _callee308$(n){for(;;)switch(n.prev=n.next){case 0:if(!r||!r.isFull()){n.next=4;break}n.t0=r;n.next=7;break;case 4:n.next=6;return this._blockchain.getBlock(t,!1,!0);case 6:n.t0=n.sent;case 7:if(r=n.t0){n.next=10;break}throw new Error("No block found for hash ".concat(t));case 10:return n.abrupt("return",r.transactions.filter(function(t){return e.find(function(e){return e.equals(t.hash())})}));case 11:case"end":return n.stop()}},_callee308,this)}));return function getTransactionsFromBlock(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getTransactionReceiptsByAddress",value:function getTransactionReceiptsByAddress(e,t){return this._blockchain.getTransactionReceiptsByAddress(e,t)}},{key:"getTransactionReceiptsByHashes",value:function getTransactionReceiptsByHashes(e){return this._blockchain.getTransactionReceiptsByHashes(e)}},{key:"sendTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee309(e){var t,n=this;return _regenerator["default"].wrap(function _callee309$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._mempool.pushTransaction(e);case 2:t=r.sent;r.t0=t;r.next=r.t0===ct.ReturnCode.ACCEPTED?6:r.t0===ct.ReturnCode.KNOWN?14:r.t0===ct.ReturnCode.FEE_TOO_LOW?15:r.t0===ct.ReturnCode.FILTERED?15:r.t0===ct.ReturnCode.MINED?16:r.t0===ct.ReturnCode.EXPIRED?17:r.t0===ct.ReturnCode.INVALID?18:19;break;case 6:r.next=8;return new _promise["default"](function(t){var r;r=n.on("transaction-relayed",function(a){if(a.equals(e)){n.off("transaction-relayed",r);t(!0)}});setTimeout(function(){n.off("transaction-relayed",r);t(!1)},dt.TRANSACTION_RELAY_TIMEOUT)});case 8:if(!r.sent){r.next=13;break}return r.abrupt("return",dt.SendTransactionResult.RELAYED);case 13:return r.abrupt("return",dt.SendTransactionResult.PENDING_LOCAL);case 14:return r.abrupt("return",dt.SendTransactionResult.KNOWN);case 15:return r.abrupt("return",dt.SendTransactionResult.REJECTED_LOCAL);case 16:return r.abrupt("return",dt.SendTransactionResult.ALREADY_MINED);case 17:return r.abrupt("return",dt.SendTransactionResult.EXPIRED);case 18:return r.abrupt("return",dt.SendTransactionResult.INVALID);case 19:return r.abrupt("return",dt.SendTransactionResult.NONE);case 20:case"end":return r.stop()}},_callee309,this)}));return function sendTransaction(t){return e.apply(this,arguments)}}()},{key:"getMempoolContents",value:function getMempoolContents(){return this._mempool.getTransactions()}},{key:"subscribeMinFeePerByte",value:function subscribeMinFeePerByte(e){this.subscribe(Ue.fromMinFeePerByte(e));this.mempool.evictBelowMinFeePerByte(e)}},{key:"_newConsensusAgent",value:function _newConsensusAgent(e){return new gt(this._blockchain,this._mempool,this._network.time,e,this._invRequestManager,this._subscription)}},{key:"minFeePerByte",get:function get(){return this._subscription.type===Ue.Type.MIN_FEE?this._subscription.minFeePerByte:0}},{key:"blockchain",get:function get(){return this._blockchain}},{key:"mempool",get:function get(){return this._mempool}}]);return FullConsensus}(dt);n.register(yt);var vt=function(e){(0,_inherits2["default"])(LightChain,e);var t=_createSuper(LightChain);(0,_createClass2["default"])(LightChain,null,[{key:"getPersistent",value:function getPersistent(e,t,n){return new LightChain(at.getPersistent(e),t,n)._init()}},{key:"createVolatile",value:function createVolatile(e,t){return new LightChain(at.createVolatile(),e,t)._init()}}]);function LightChain(e,n,r){(0,_classCallCheck2["default"])(this,LightChain);return t.call(this,e,n,r)}(0,_createClass2["default"])(LightChain,[{key:"_init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee310(){return _regenerator["default"].wrap(function _callee310$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return pt.prototype._init.call(this);case 2:if(this._proof){e.next=6;break}e.next=5;return this._getChainProof();case 5:this._proof=e.sent;case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}},_callee310,this)}));return function _init(){return e.apply(this,arguments)}}()},{key:"partialChain",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee311(){var e,t,n=this;return _regenerator["default"].wrap(function _callee311$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this.getChainProof();case 2:e=r.sent;(t=new bt(this._store,this._accounts,this._time,e,this._synchronizer)).on("committed",function(e,t,r,a){n._proof=e;n._headHash=t;n._mainChain=r;n._transactionCache=a;n.fire("block",t);n.fire("head-changed",n.head)});r.next=7;return t._init();case 7:return r.abrupt("return",t);case 8:case"end":return r.stop()}},_callee311,this)}));return function partialChain(){return e.apply(this,arguments)}}()},{key:"_shouldExtendChainProof",value:function _shouldExtendChainProof(){return!0}}]);return LightChain}(pt);n.register(vt);var kt=function(e){(0,_inherits2["default"])(LightConsensusAgent,e);var t=_createSuper(LightConsensusAgent);function LightConsensusAgent(e,n,r,a,i,s){var o;(0,_classCallCheck2["default"])(this,LightConsensusAgent);(o=t.call(this,e,n,r,a,i,s))._blockchain=e;o._partialChain=null;o._syncing=!1;o._catchup=!1;o._onMainChain=!1;o._orphanedBlocks=[];o._busy=!1;o._accountsRequest=null;o._requestedChainProof=!1;o._numWeakProofs=0;o._onToDisconnect(a.channel,"chain-proof",function(e){return o._onChainProof(e)});o._onToDisconnect(a.channel,"accounts-tree-chunk",function(e){return o._onAccountsTreeChunk(e)});return o}(0,_createClass2["default"])(LightConsensusAgent,[{key:"syncBlockchain",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee312(){var e,t;return _regenerator["default"].wrap(function _callee312$(n){for(;;)switch(n.prev=n.next){case 0:if(this.providesServices(_.FULL_BLOCKS,_.CHAIN_PROOF,_.ACCOUNTS_CHUNKS,_.MEMPOOL)){n.next=3;break}this._syncFinished();return n.abrupt("return");case 3:if(this._objectsInFlight.isEmpty()){n.next=6;break}a.v(LightConsensusAgent,"Waiting for ".concat(this._objectsInFlight.length," objects to arrive ..."));return n.abrupt("return");case 6:if(this._objectsProcessing.isEmpty()){n.next=9;break}a.v(LightConsensusAgent,"Waiting for ".concat(this._objectsProcessing.length," objects to be processed ..."));return n.abrupt("return");case 9:if(!(this._failedSyncs>=LightConsensusAgent.SYNC_ATTEMPTS_MAX)){n.next=16;break}this._peer.channel.close(Wn.BLOCKCHAIN_SYNC_FAILED,"blockchain sync failed");if(!this._partialChain){n.next=15;break}n.next=14;return this._partialChain.abort();case 14:this._partialChain=null;case 15:return n.abrupt("return");case 16:n.next=18;return this._blockchain.getBlock(this._syncTarget,!0);case 18:if(!(e=n.sent)||this._syncing){n.next=22;break}this._syncFinished();return n.abrupt("return");case 22:if(e||this._syncing){n.next=37;break}this._syncing=!0;this._onMainChain=!1;n.prev=25;n.next=28;return this.getHeader(this._syncTarget);case 28:t=n.sent;n.next=35;break;case 31:n.prev=31;n.t0=n["catch"](25);this._peer.channel.close(Wn.ABORTED_SYNC,"Failed to retrieve sync target header");return n.abrupt("return");case 35:this._catchup=Math.abs(t.height-this._blockchain.height)<=re.NUM_BLOCKS_VERIFICATION;a.d(LightConsensusAgent,"Start syncing, catchup mode: ".concat(this._catchup));case 37:if(!this._syncing||this._busy){n.next=72;break}if(!this._catchup){n.next=43;break}n.next=41;return gt.prototype.syncBlockchain.call(this);case 41:n.next=72;break;case 43:if(this._partialChain){n.next=46;break}n.next=46;return this._initChainProofSync();case 46:n.t1=this._partialChain.state;n.next=n.t1===bt.State.PROVE_CHAIN?49:n.t1===bt.State.PROVE_ACCOUNTS_TREE?52:n.t1===bt.State.PROVE_BLOCKS?55:n.t1===bt.State.COMPLETE?58:n.t1===bt.State.ABORTED?66:n.t1===bt.State.WEAK_PROOF?68:72;break;case 49:this._requestChainProof();this.fire("sync-chain-proof",this._peer.peerAddress);return n.abrupt("break",72);case 52:this._requestAccountsTree();this.fire("sync-accounts-tree",this._peer.peerAddress);return n.abrupt("break",72);case 55:this._requestProofBlocks();this.fire("verify-accounts-tree",this._peer.peerAddress);return n.abrupt("break",72);case 58:this.fire("sync-finalize",this._peer.peerAddress);this._busy=!0;n.next=62;return this._partialChain.commit();case 62:n.next=64;return this._applyOrphanedBlocks();case 64:this._syncFinished();return n.abrupt("break",72);case 66:this._peer.channel.close(Wn.ABORTED_SYNC,"aborted sync");return n.abrupt("break",72);case 68:a.d(LightConsensusAgent,"Not syncing with ".concat(this._peer.peerAddress," - weaker proof"));this._numWeakProofs++;this._numWeakProofs>=LightConsensusAgent.WEAK_PROOFS_MAX?this._peer.channel.close(Wn.BLOCKCHAIN_SYNC_FAILED,"too many weak proofs"):this._syncFinished();return n.abrupt("break",72);case 72:case"end":return n.stop()}},_callee312,this,[[25,31]])}));return function syncBlockchain(){return e.apply(this,arguments)}}()},{key:"_initChainProofSync",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee313(){return _regenerator["default"].wrap(function _callee313$(e){for(;;)switch(e.prev=e.next){case 0:this._subscribeTarget();this._syncing=!0;this._synced=!1;this._catchup=!1;this._onMainChain=!0;if(!this._partialChain){e.next=8;break}e.next=8;return this._partialChain.abort();case 8:e.next=10;return this._blockchain.partialChain();case 10:this._partialChain=e.sent;case 11:case"end":return e.stop()}},_callee313,this)}));return function _initChainProofSync(){return e.apply(this,arguments)}}()},{key:"_syncFinished",value:function _syncFinished(){this._partialChain&&(this._partialChain=null);this._busy=!1;(0,_get10["default"])((0,_getPrototypeOf2["default"])(LightConsensusAgent.prototype),"_syncFinished",this).call(this)}},{key:"_applyOrphanedBlocks",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee314(){var e,t,n,r,a,i;return _regenerator["default"].wrap(function _callee314$(s){for(;;)switch(s.prev=s.next){case 0:e=!0;t=!1;n=undefined;s.prev=3;r=(0,_getIterator2["default"])(this._orphanedBlocks);case 5:if(e=(a=r.next()).done){s.next=16;break}i=a.value;s.next=9;return this._blockchain.pushBlock(i);case 9:if(s.sent!==vt.ERR_INVALID){s.next=13;break}this._peer.channel.close(Wn.INVALID_BLOCK,"received invalid block");return s.abrupt("break",16);case 13:e=!0;s.next=5;break;case 16:s.next=22;break;case 18:s.prev=18;s.t0=s["catch"](3);t=!0;n=s.t0;case 22:s.prev=22;s.prev=23;e||null==r["return"]||r["return"]();case 25:s.prev=25;if(!t){s.next=28;break}throw n;case 28:return s.finish(25);case 29:return s.finish(22);case 30:this._orphanedBlocks=[];case 31:case"end":return s.stop()}},_callee314,this,[[3,18,22,30],[23,,25,29]])}));return function _applyOrphanedBlocks(){return e.apply(this,arguments)}}()},{key:"_requestChainProof",value:function _requestChainProof(){var e=this;R.that(this._partialChain&&this._partialChain.state===bt.State.PROVE_CHAIN);R.that(!this._requestedChainProof);this._busy=!0;this._peer.channel.getChainProof();this._requestedChainProof=!0;this._peer.channel.expectMessage(Rt.Type.CHAIN_PROOF,function(){e._peer.channel.close(Wn.GET_CHAIN_PROOF_TIMEOUT,"getChainProof timeout")},LightConsensusAgent.CHAINPROOF_REQUEST_TIMEOUT,LightConsensusAgent.CHAINPROOF_CHUNK_TIMEOUT)}},{key:"_onChainProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee315(e){return _regenerator["default"].wrap(function _callee315$(t){for(;;)switch(t.prev=t.next){case 0:R.that(this._partialChain&&this._partialChain.state===bt.State.PROVE_CHAIN);a.d(LightConsensusAgent,"[CHAIN-PROOF] Received from ".concat(this._peer.peerAddress,": ").concat(e.proof));if(this._requestedChainProof){t.next=5;break}a.w(LightConsensusAgent,"Unsolicited chain proof received from ".concat(this._peer.peerAddress));return t.abrupt("return");case 5:this._requestedChainProof=!1;this._syncing&&this.fire("verify-chain-proof",this._peer.peerAddress);t.next=9;return this._partialChain.pushProof(e.proof);case 9:if(t.sent){t.next=13;break}a.w(LightConsensusAgent,"Invalid chain proof received from ".concat(this._peer.peerAddress," - verification failed"));this._peer.channel.close(Wn.INVALID_CHAIN_PROOF,"Invalid chain proof");return t.abrupt("return");case 13:this._busy=!1;this.syncBlockchain()["catch"](a.e.tag(LightConsensusAgent));case 15:case"end":return t.stop()}},_callee315,this)}));return function _onChainProof(t){return e.apply(this,arguments)}}()},{key:"_requestAccountsTree",value:function _requestAccountsTree(){var e=this;R.that(this._partialChain&&this._partialChain.state===bt.State.PROVE_ACCOUNTS_TREE);R.that(!this._accountsRequest);this._busy=!0;var t=this._partialChain.getMissingAccountsPrefix(),n=this._partialChain.headHash;a.d(LightConsensusAgent,"Requesting AccountsTreeChunk starting at ".concat(t," from ").concat(this._peer.peerAddress));this._accountsRequest={startPrefix:t,blockHash:n};this._peer.channel.getAccountsTreeChunk(n,t);this._peer.channel.expectMessage(Rt.Type.ACCOUNTS_TREE_CHUNK,function(){e._accountsRequest=null;e._peer.channel.close(Wn.GET_ACCOUNTS_TREE_CHUNK_TIMEOUT,"getAccountsTreeChunk timeout")},LightConsensusAgent.ACCOUNTS_TREE_CHUNK_REQUEST_TIMEOUT)}},{key:"_onAccountsTreeChunk",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee316(e){var t,n,r,i,s,o;return _regenerator["default"].wrap(function _callee316$(u){for(;;)switch(u.prev=u.next){case 0:a.d(LightConsensusAgent,"[ACCOUNTS-TREE-CHUNK] Received from ".concat(this._peer.peerAddress,": blockHash=").concat(e.blockHash,", proof=").concat(e.chunk));if(this._accountsRequest){u.next=4;break}a.w(LightConsensusAgent,"Unsolicited accounts tree chunk received from ".concat(this._peer.peerAddress));return u.abrupt("return");case 4:R.that(this._partialChain&&this._partialChain.state===bt.State.PROVE_ACCOUNTS_TREE);t=this._accountsRequest,n=t.startPrefix,r=t.blockHash;this._accountsRequest=null;if(e.hasChunk()){u.next=14;break}u.next=10;return this._partialChain.abort();case 10:this._partialChain=null;this._busy=!1;this._failedSyncs++;return u.abrupt("return");case 14:if(r.equals(e.blockHash)&&!(e.chunk.head.prefix<=n)){u.next=18;break}a.w(LightConsensusAgent,"Received AccountsTreeChunk for block != head or wrong start prefix from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.UNEXPECTED_ACCOUNTS_TREE_CHUNK,"Unexpected AccountsTreeChunk");return u.abrupt("return");case 18:if((i=e.chunk).verify()){u.next=23;break}a.w(LightConsensusAgent,"Invalid AccountsTreeChunk received from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_ACCOUNTS_TREE_CHUNCK,"Invalid AccountsTreeChunk");return u.abrupt("return");case 23:s=i.root();u.next=26;return this._partialChain.getBlock(r);case 26:if(u.sent.accountsHash.equals(s)){u.next=31;break}a.w(LightConsensusAgent,"Invalid AccountsTreeChunk (root hash) received from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_ACCOUNTS_TREE_CHUNCK,"AccountsTreeChunk root hash mismatch");return u.abrupt("return");case 31:u.next=33;return this._partialChain.pushAccountsTreeChunk(i);case 33:if((o=u.sent)<0){a.e("AccountsTree sync failed with error code ".concat(o," from ").concat(this._peer.peerAddress));this._peer.channel.close(Wn.INVALID_ACCOUNTS_TREE_CHUNCK,"AccountsTreeChunk root hash mismatch")}this._busy=!1;this.syncBlockchain()["catch"](a.e.tag(LightConsensusAgent));case 37:case"end":return u.stop()}},_callee316,this)}));return function _onAccountsTreeChunk(t){return e.apply(this,arguments)}}()},{key:"_requestProofBlocks",value:function _requestProofBlocks(){var e=this;R.that(this._partialChain&&this._partialChain.state===bt.State.PROVE_BLOCKS);this._lastChainHeight===this._partialChain.proofHeadHeight&&this._failedSyncs++;this._lastChainHeight=this._partialChain.proofHeadHeight;if(this._peer.channel.isExpectingMessage(Rt.Type.INV))a.e(LightConsensusAgent,"Duplicate _requestProofBlocks()");else{this._peer.channel.expectMessage(Rt.Type.INV,function(){e._peer.channel.close(Wn.GET_BLOCKS_TIMEOUT,"getBlocks timeout")},ht.REQUEST_TIMEOUT);var t=this._partialChain.getBlockLocators();this.requestVector(new Gt(Gt.Type.BLOCK,t[0]));this._peer.channel.getBlocks(t,this._partialChain.numBlocksNeeded(),!1)}}},{key:"_requestBlocks",value:function _requestBlocks(){return this._syncing&&!this._onMainChain?(0,_get10["default"])((0,_getPrototypeOf2["default"])(LightConsensusAgent.prototype),"_requestBlocks",this).call(this,1):(0,_get10["default"])((0,_getPrototypeOf2["default"])(LightConsensusAgent.prototype),"_requestBlocks",this).call(this)}},{key:"_processBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee317(e,t){var n;return _regenerator["default"].wrap(function _callee317$(r){for(;;)switch(r.prev=r.next){case 0:if(!(t.height<this._chain.height-re.NUM_BLOCKS_VERIFICATION)||this._partialChain&&this._partialChain.state===bt.State.PROVE_BLOCKS){r.next=8;break}this._onMainChain=!1;r.next=4;return this._initChainProofSync();case 4:this.syncBlockchain()["catch"](a.e.tag(LightConsensusAgent));return r.abrupt("return");case 8:this._onMainChain=!0;case 9:r.next=11;return this._chain.pushBlock(t);case 11:n=r.sent;r.t0=n;r.next=r.t0===pt.ERR_INVALID?15:r.t0===pt.OK_EXTENDED?17:r.t0===pt.OK_REBRANCHED?17:r.t0===pt.OK_FORKED?19:r.t0===vt.ERR_ORPHAN?21:23;break;case 15:this._peer.channel.close(Wn.INVALID_BLOCK,"received invalid block");return r.abrupt("break",23);case 17:this._syncing&&this._numBlocksExtending++;return r.abrupt("break",23);case 19:if(this._syncing){this._numBlocksForking++;this._forkHead=t}return r.abrupt("break",23);case 21:this._onOrphanBlock(e,t);return r.abrupt("break",23);case 23:case"end":return r.stop()}},_callee317,this)}));return function _processBlock(t,n){return e.apply(this,arguments)}}()},{key:"_onKnownBlockAnnounced",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee318(e,t){return _regenerator["default"].wrap(function _callee318$(n){for(;;)switch(n.prev=n.next){case 0:if(!this._syncing||!this._catchup){n.next=11;break}if(!(t.height<this._chain.height-re.NUM_BLOCKS_VERIFICATION)||this._partialChain&&this._partialChain.state===bt.State.PROVE_BLOCKS){n.next=9;break}this._onMainChain=!1;n.next=5;return this._initChainProofSync();case 5:this.syncBlockchain()["catch"](a.e.tag(LightConsensusAgent));return n.abrupt("return");case 9:this._onMainChain=!0;case 10:gt.prototype._onKnownBlockAnnounced.call(this,e,t);case 11:case"end":return n.stop()}},_callee318,this)}));return function _onKnownBlockAnnounced(t,n){return e.apply(this,arguments)}}()},{key:"_onOrphanBlock",value:function _onOrphanBlock(e,t){this._syncing&&!this._catchup?this._orphanedBlocks.push(t):(0,_get10["default"])((0,_getPrototypeOf2["default"])(LightConsensusAgent.prototype),"_onOrphanBlock",this).call(this,e,t)}},{key:"getHeader",value:function getHeader(e){var t=this;R.that(!this._headerRequest);return new _promise["default"](function(n,r){var a=new Gt(Gt.Type.BLOCK,e);t._headerRequest={hash:e,resolve:n,reject:r};t._peer.channel.getHeader([a]);t._peer.channel.expectMessage(Rt.Type.HEADER,function(){t._headerRequest=null;t._peer.channel.close(Wn.GET_HEADER_TIMEOUT,"getHeader timeout");r(new Error("Timeout"))},ht.REQUEST_TIMEOUT)})}},{key:"_onHeader",value:function _onHeader(e){var t=e.header,n=t.hash();if(this._headerRequest){var r=this._headerRequest,i=r.hash,s=r.resolve,o=r.reject;this._headerRequest=null;if(i.equals(n))s(t);else{a.w(LightConsensusAgent,"Received wrong header from ".concat(this._peer.peerAddress));this._peer.channel.close(Wn.UNEXPECTED_HEADER,"Received wrong header");o(new Error("Received wrong header"))}}else a.w(Ct,"Unsolicited header ".concat(n," received from ").concat(this._peer.peerAddress,", discarding"))}},{key:"_onClose",value:function _onClose(){this._partialChain&&this._partialChain.abort()["catch"](a.w.tag(LightConsensusAgent));(0,_get10["default"])((0,_getPrototypeOf2["default"])(LightConsensusAgent.prototype),"_onClose",this).call(this)}},{key:"_chain",get:function get(){return this._syncing&&!this._catchup&&this._partialChain?this._partialChain:this._blockchain}},{key:"syncing",get:function get(){return this._syncing}}]);return LightConsensusAgent}(gt);kt.CHAINPROOF_REQUEST_TIMEOUT=45e3;kt.CHAINPROOF_CHUNK_TIMEOUT=1e4;kt.ACCOUNTS_TREE_CHUNK_REQUEST_TIMEOUT=8e3;kt.SYNC_ATTEMPTS_MAX=5;kt.GETBLOCKS_VECTORS_MAX=500;kt.WEAK_PROOFS_MAX=3;n.register(kt);var mt=function(e){(0,_inherits2["default"])(LightConsensus,e);var t=_createSuper(LightConsensus);function LightConsensus(e,n,r){var a;(0,_classCallCheck2["default"])(this,LightConsensus);(a=t.call(this,e,n,r))._blockchain=e;a._mempool=n;a._producer=new $e(e,e.accounts,n,r.time);return a}(0,_createClass2["default"])(LightConsensus,[{key:"getBlockTemplate",value:function getBlockTemplate(e,t){return this._producer.getNextBlock(e,t)}},{key:"submitBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee319(e){return _regenerator["default"].wrap(function _callee319$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this.blockchain.pushBlock(e);case 2:t.t0=t.sent;return t.abrupt("return",t.t0>=0);case 4:case"end":return t.stop()}},_callee319,this)}));return function submitBlock(t){return e.apply(this,arguments)}}()},{key:"getAccounts",value:function getAccounts(e){var t=this;return _promise["default"].all(e.map(function(e){return t._blockchain.accounts.get(e)}))}},{key:"getPendingTransactions",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee320(e){var t=this;return _regenerator["default"].wrap(function _callee320$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",e.map(function(e){return t._mempool.getTransaction(e)}).filter(function(e){return null!=e}));case 1:case"end":return n.stop()}},_callee320)}));return function getPendingTransactions(t){return e.apply(this,arguments)}}()},{key:"getPendingTransactionsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee321(e,t){return _regenerator["default"].wrap(function _callee321$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this._mempool.getTransactionsByAddresses([e],t));case 1:case"end":return n.stop()}},_callee321,this)}));return function getPendingTransactionsByAddress(t,n){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee322(e){var t,n=this;return _regenerator["default"].wrap(function _callee322$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._mempool.pushTransaction(e);case 2:t=r.sent;r.t0=t;r.next=r.t0===ct.ReturnCode.ACCEPTED?6:r.t0===ct.ReturnCode.KNOWN?14:r.t0===ct.ReturnCode.FEE_TOO_LOW?15:r.t0===ct.ReturnCode.FILTERED?15:r.t0===ct.ReturnCode.MINED?16:r.t0===ct.ReturnCode.EXPIRED?17:r.t0===ct.ReturnCode.INVALID?18:19;break;case 6:r.next=8;return new _promise["default"](function(t){var r;r=n.on("transaction-relayed",function(a){if(a.equals(e)){n.off("transaction-relayed",r);t(!0)}});setTimeout(function(){n.off("transaction-relayed",r);t(!1)},dt.TRANSACTION_RELAY_TIMEOUT)});case 8:if(!r.sent){r.next=13;break}return r.abrupt("return",dt.SendTransactionResult.RELAYED);case 13:return r.abrupt("return",dt.SendTransactionResult.PENDING_LOCAL);case 14:return r.abrupt("return",dt.SendTransactionResult.KNOWN);case 15:return r.abrupt("return",dt.SendTransactionResult.REJECTED_LOCAL);case 16:return r.abrupt("return",dt.SendTransactionResult.ALREADY_MINED);case 17:return r.abrupt("return",dt.SendTransactionResult.EXPIRED);case 18:return r.abrupt("return",dt.SendTransactionResult.INVALID);case 19:return r.abrupt("return",dt.SendTransactionResult.NONE);case 20:case"end":return r.stop()}},_callee322,this)}));return function sendTransaction(t){return e.apply(this,arguments)}}()},{key:"getMempoolContents",value:function getMempoolContents(){return this._mempool.getTransactions()}},{key:"subscribeMinFeePerByte",value:function subscribeMinFeePerByte(e){this.subscribe(Ue.fromMinFeePerByte(e));this.mempool.evictBelowMinFeePerByte(e)}},{key:"_newConsensusAgent",value:function _newConsensusAgent(e){return new kt(this._blockchain,this._mempool,this._network.time,e,this._invRequestManager,this._subscription)}},{key:"_onPeerJoined",value:function _onPeerJoined(e){var t=(0,_get10["default"])((0,_getPrototypeOf2["default"])(LightConsensus.prototype),"_onPeerJoined",this).call(this,e);this.bubble(t,"sync-chain-proof","verify-chain-proof","sync-accounts-tree","verify-accounts-tree","sync-finalize");return t}},{key:"minFeePerByte",get:function get(){return this._subscription.type===Ue.Type.MIN_FEE?this._subscription.minFeePerByte:0}},{key:"blockchain",get:function get(){return this._blockchain}},{key:"mempool",get:function get(){return this._mempool}}]);return LightConsensus}(dt);n.register(mt);var bt=function(e){(0,_inherits2["default"])(PartialLightChain,e);var t=_createSuper(PartialLightChain);function PartialLightChain(e,n,r,a,i){var s;(0,_classCallCheck2["default"])(this,PartialLightChain);var o=e.transaction(!1);(s=t.call(this,o,n,r))._proof=a;s._state=PartialLightChain.State.PROVE_CHAIN;s._partialTree=null;s._accountsTx=null;s._proofHead=null;s._commitSynchronizer=i;return s}(0,_createClass2["default"])(PartialLightChain,[{key:"pushProof",value:function pushProof(e){return this._synchronizer.push(0,this._pushProof.bind(this,e))}},{key:"_pushProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee323(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,b,w,C,S,T,E;return _regenerator["default"].wrap(function _callee323$(x){for(;;)switch(x.prev=x.next){case 0:t=[];n=0;case 2:if(!(n<e.prefix.length)){x.next=12;break}r=e.prefix.blocks[n];i=r.hash();x.next=7;return this._store.getBlock(i);case 7:x.sent||r.header._pow||t.push(r.header);case 9:++n;x.next=2;break;case 12:s=0;case 13:if(!(s<e.suffix.length)){x.next=23;break}o=e.suffix.headers[s];u=o.hash();x.next=18;return this._store.getBlock(u);case 18:x.sent||o._pow||t.push(o);case 20:++s;x.next=13;break;case 23:x.next=25;return Xe.manyPow(t);case 25:c=0;case 26:if(!(c<e.prefix.length)){x.next=44;break}l=e.prefix.blocks[c];h=l.hash();x.next=31;return this._store.getBlock(h);case 31:if(!(f=x.sent)){x.next=36;break}e.prefix.blocks[c]=f.toLight();x.next=41;break;case 36:x.next=38;return l.verify(this._time);case 38:if(x.sent){x.next=41;break}a.w(PartialLightChain,"Rejecting proof - prefix contains invalid block");return x.abrupt("return",!1);case 41:c++;x.next=26;break;case 44:d=0;case 45:if(!(d<e.suffix.length)){x.next=63;break}A=e.suffix.headers[d];_=A.hash();x.next=50;return this._store.getBlock(_);case 50:if(!(p=x.sent)){x.next=55;break}e.suffix.headers[d]=p.header;x.next=60;break;case 55:x.next=57;return A.verifyProofOfWork();case 57:if(x.sent){x.next=60;break}a.w(PartialLightChain,"Rejecting proof - suffix contains invalid header");return x.abrupt("return",!1);case 60:d++;x.next=45;break;case 63:x.next=65;return e.verify();case 65:if(x.sent){x.next=68;break}a.w(PartialLightChain,"Rejecting proof - verification failed");return x.abrupt("return",!1);case 68:if(e.suffix.length===re.K||e.suffix.length===e.head.height-1){x.next=71;break}a.w(PartialLightChain,"Rejecting proof - invalid suffix length");return x.abrupt("return",!1);case 71:if(!(e.prefix.denseSuffix().length<re.M&&e.prefix.length>0&&e.prefix.head.height>=re.M)){x.next=75;break}a.w(wt,"Rejecting proof - dense suffix too short");return x.abrupt("return",!1);case 75:g=[];y=e.prefix.head;v=!0;k=!1;m=undefined;x.prev=80;b=(0,_getIterator2["default"])(e.suffix.headers);case 82:if(v=(w=b.next()).done){x.next=96;break}C=w.value;x.next=86;return y.getNextInterlink(C.target,C.version);case 86:S=x.sent;T=S.hash();if(C.interlinkHash.equals(T)){x.next=91;break}a.w(PartialLightChain,"Rejecting proof - invalid interlink hash in proof suffix");return x.abrupt("return",!1);case 91:y=new Je(C,S);g.push(y);case 93:v=!0;x.next=82;break;case 96:x.next=102;break;case 98:x.prev=98;x.t0=x["catch"](80);k=!0;m=x.t0;case 102:x.prev=102;x.prev=103;v||null==b["return"]||b["return"]();case 105:x.prev=105;if(!k){x.next=108;break}throw m;case 108:return x.finish(105);case 109:return x.finish(102);case 110:x.t1=this._proof;if(x.t1){x.next=115;break}x.next=114;return this._getChainProof();case 114:x.t1=x.sent;case 115:E=x.t1;x.next=118;return Xe.isBetterProof(e,E,re.M);case 118:if(!x.sent){x.next=123;break}x.next=121;return this._acceptProof(e,g);case 121:x.next=126;break;case 123:x.next=125;return this.abort();case 125:this._state=PartialLightChain.State.WEAK_PROOF;case 126:return x.abrupt("return",!0);case 127:case"end":return x.stop()}},_callee323,this,[[80,98,102,110],[103,,105,109]])}));return function _pushProof(t){return e.apply(this,arguments)}}()},{key:"_acceptProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee324(e,t){var n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v;return _regenerator["default"].wrap(function _callee324$(k){for(;;)switch(k.prev=k.next){case 0:k.next=2;return this._store.truncate();case 2:n=e.prefix.denseSuffix();r=new rt;a=0;case 5:if(!(a<e.prefix.length-n.length)){k.next=20;break}i=e.prefix.blocks[a];s=i.hash();k.t0=De;k.next=11;return i.pow();case 11:k.t1=k.sent;o=k.t0.getHashDepth.call(k.t0,k.t1);r=r.copyAndAdd(o);u=new nt(i,new J(-1),new J(-1),r,!0);k.next=17;return this._store.putChainData(s,u);case 17:a++;k.next=5;break;case 20:c=n[0];this._headHash=c.hash();k.next=24;return nt.initial(c,r);case 24:this._mainChain=k.sent;k.next=27;return this._store.putChainData(this._headHash,this._mainChain);case 27:l=1;case 28:if(!(l<n.length)){k.next=37;break}h=n[l];k.next=32;return this._pushLightBlock(h);case 32:f=k.sent;R.that(f>=0);case 34:l++;k.next=28;break;case 37:d=!0;A=!1;_=undefined;k.prev=40;p=(0,_getIterator2["default"])(t);case 42:if(d=(g=p.next()).done){k.next=51;break}y=g.value;k.next=46;return this._pushLightBlock(y);case 46:v=k.sent;R.that(v>=0);case 48:d=!0;k.next=42;break;case 51:k.next=57;break;case 53:k.prev=53;k.t2=k["catch"](40);A=!0;_=k.t2;case 57:k.prev=57;k.prev=58;d||null==p["return"]||p["return"]();case 60:k.prev=60;if(!A){k.next=63;break}throw _;case 63:return k.finish(60);case 64:return k.finish(57);case 65:this._state=PartialLightChain.State.PROVE_ACCOUNTS_TREE;k.next=68;return this._accounts.partialAccountsTree();case 68:this._partialTree=k.sent;this._proofHead=this._mainChain;k.next=72;return this._store.setHead(this.headHash);case 72:this._proof=e;case 73:case"end":return k.stop()}},_callee324,this,[[40,53,57,65],[58,,60,64]])}));return function _acceptProof(t,n){return e.apply(this,arguments)}}()},{key:"_pushLightBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee325(e){var t,n;return _regenerator["default"].wrap(function _callee325$(r){for(;;)switch(r.prev=r.next){case 0:t=e.hash();r.next=3;return this._store.getBlock(t);case 3:if(!r.sent){r.next=6;break}return r.abrupt("return",wt.OK_KNOWN);case 6:r.next=8;return this._store.getChainData(e.prevHash);case 8:if((n=r.sent)&&!n.totalDifficulty.lte(0)){r.next=11;break}return r.abrupt("return",wt.ERR_ORPHAN);case 11:return r.abrupt("return",this._pushBlockInternal(e,t,n));case 12:case"end":return r.stop()}},_callee325,this)}));return function _pushLightBlock(t){return e.apply(this,arguments)}}()},{key:"_pushBlockInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee326(e,t,n){var r,a;return _regenerator["default"].wrap(function _callee326$(i){for(;;)switch(i.prev=i.next){case 0:i.next=2;return n.nextChainData(e);case 2:r=i.sent;if(!e.prevHash.equals(this.headHash)){i.next=20;break}r.onMainChain=!0;n.mainChainSuccessor=t;i.next=8;return this._store.putChainData(t,r);case 8:i.next=10;return this._store.putChainData(e.prevHash,n,!1);case 10:this._mainChain=r;this._headHash=t;if(!this._proof){i.next=18;break}a=this._proof.head.hash();if(!e.prevHash.equals(a)){i.next=18;break}i.next=17;return this._extendChainProof(this._proof,e.header);case 17:this._proof=i.sent;case 18:this.fire("head-changed",this.head,!1);return i.abrupt("return",wt.OK_EXTENDED);case 20:throw new Error("Invalid call to _pushBlockInternal");case 21:case"end":return i.stop()}},_callee326,this)}));return function _pushBlockInternal(t,n,r){return e.apply(this,arguments)}}()},{key:"_pushBlock",value:function _pushBlock(e){if(this._state===PartialLightChain.State.PROVE_BLOCKS){var t=e.hash();if(this._proofHead.head.prevHash.equals(t))return this._pushBlockBackwards(e);if(this._proofHead.head.hash().equals(t))return this._pushHeadBlock(e)}return pt.ERR_ORPHAN}},{key:"_pushHeadBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee327(e){var t,n,r,i,s;return _regenerator["default"].wrap(function _callee327$(o){for(;;)switch(o.prev=o.next){case 0:t=e.hash();if(e.isFull()){o.next=4;break}a.w(PartialLightChain,"Rejecting block - body missing");return o.abrupt("return",pt.ERR_INVALID);case 4:o.next=6;return e.verify(this._time);case 6:if(o.sent){o.next=8;break}return o.abrupt("return",pt.ERR_INVALID);case 8:o.next=10;return this._verifyInterlink(e);case 10:if(o.sent){o.next=13;break}a.w(PartialLightChain,"Rejecting block - interlink verification failed");return o.abrupt("return",pt.ERR_INVALID);case 13:o.next=15;return this._store.getChainData(e.prevHash);case 15:if(n=o.sent){o.next=19;break}a.w(PartialLightChain,"Rejecting block - unknown predecessor");return o.abrupt("return",pt.ERR_ORPHAN);case 19:r=n.head;o.next=22;return e.isImmediateSuccessorOf(r);case 22:if(o.sent){o.next=25;break}a.w(PartialLightChain,"Rejecting block - not a valid immediate successor");return o.abrupt("return",pt.ERR_INVALID);case 25:o.next=27;return this.getNextTarget(r);case 27:i=o.sent;if(!De.isValidTarget(i)){o.next=34;break}if(e.nBits===De.targetToCompact(i)){o.next=32;break}a.w(PartialLightChain,"Rejecting block - difficulty mismatch");return o.abrupt("return",pt.ERR_INVALID);case 32:o.next=35;break;case 34:a.w(PartialLightChain,"Skipping difficulty verification - not enough blocks available");case 35:o.next=37;return n.nextChainData(e);case 37:s=o.sent;o.next=40;return this._prepend(t,s);case 40:if(o.sent){o.next=42;break}return o.abrupt("return",pt.ERR_INVALID);case 42:this._mainChain=s;this._proofHead=s;this._headHash=t;if(this.needsMoreBlocks()){o.next=51;break}o.next=48;return this._complete();case 48:if(o.sent){o.next=51;break}return o.abrupt("return",pt.ERR_INVALID);case 51:return o.abrupt("return",pt.OK_EXTENDED);case 52:case"end":return o.stop()}},_callee327,this)}));return function _pushHeadBlock(t){return e.apply(this,arguments)}}()},{key:"_pushBlockBackwards",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee328(e){var t,n,r;return _regenerator["default"].wrap(function _callee328$(i){for(;;)switch(i.prev=i.next){case 0:t=e.hash();if(e.isFull()){i.next=4;break}a.w(PartialLightChain,"Rejecting block - body missing");return i.abrupt("return",pt.ERR_INVALID);case 4:i.next=6;return e.verify(this._time);case 6:if(i.sent){i.next=8;break}return i.abrupt("return",pt.ERR_INVALID);case 8:i.next=10;return this._verifyInterlink(e);case 10:if(i.sent){i.next=13;break}a.w(PartialLightChain,"Rejecting block - interlink verification failed");return i.abrupt("return",pt.ERR_INVALID);case 13:i.next=15;return this._proofHead.head.isImmediateSuccessorOf(e);case 15:if(i.sent){i.next=18;break}a.w(PartialLightChain,"Rejecting block - not a valid immediate predecessor");return i.abrupt("return",pt.ERR_INVALID);case 18:i.next=20;return this.getNextTarget(e);case 20:n=i.sent;if(!De.isValidTarget(n)){i.next=27;break}if(this._proofHead.head.nBits===De.targetToCompact(n)){i.next=25;break}a.w(PartialLightChain,"Rejecting block - difficulty mismatch");return i.abrupt("return",pt.ERR_INVALID);case 25:i.next=28;break;case 27:a.w(PartialLightChain,"Skipping difficulty verification - not enough blocks available");case 28:i.next=30;return this._proofHead.previousChainData(e);case 30:r=i.sent;i.next=33;return this._prepend(t,r);case 33:if(i.sent){i.next=35;break}return i.abrupt("return",pt.ERR_INVALID);case 35:return i.abrupt("return",pt.OK_EXTENDED);case 36:case"end":return i.stop()}},_callee328,this)}));return function _pushBlockBackwards(t){return e.apply(this,arguments)}}()},{key:"_prepend",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee329(e,t){var n;return _regenerator["default"].wrap(function _callee329$(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0;n=new qe;r.next=4;return this._accountsTx.revertBlock(t.head,n);case 4:r.next=10;break;case 6:r.prev=6;r.t0=r["catch"](0);a.w(PartialLightChain,"Rejecting block - failed to commit to AccountsTree: ".concat(r.t0.message||r.t0));return r.abrupt("return",!1);case 10:t.onMainChain=!0;t.mainChainSuccessor=t.head.hash().equals(this._proofHead.head.hash())?null:this._proofHead.head.hash();r.next=14;return this._store.putChainData(e,t);case 14:this._proofHead=t;if(this.needsMoreBlocks()){r.next=17;break}return r.abrupt("return",this._complete());case 17:return r.abrupt("return",!0);case 18:case"end":return r.stop()}},_callee329,this,[[0,6]])}));return function _prepend(t,n){return e.apply(this,arguments)}}()},{key:"pushAccountsTreeChunk",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee330(e){var t;return _regenerator["default"].wrap(function _callee330$(n){for(;;)switch(n.prev=n.next){case 0:if(this._state===PartialLightChain.State.PROVE_ACCOUNTS_TREE){n.next=2;break}return n.abrupt("return",Ne.Status.ERR_INCORRECT_PROOF);case 2:n.next=4;return this._partialTree.pushChunk(e);case 4:if((t=n.sent)===Ne.Status.OK_COMPLETE){this._state=PartialLightChain.State.PROVE_BLOCKS;this._accountsTx=new Oe(this._partialTree.transaction(!1))}return n.abrupt("return",t);case 7:case"end":return n.stop()}},_callee330,this)}));return function pushAccountsTreeChunk(t){return e.apply(this,arguments)}}()},{key:"_complete",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee331(){var e,t,n,r,i,s,o,u;return _regenerator["default"].wrap(function _callee331$(c){for(;;)switch(c.prev=c.next){case 0:this._transactionCache=new qe;e=this._proofHead;case 2:if(!e){c.next=41;break}t=!0;n=!1;r=undefined;c.prev=6;i=(0,_getIterator2["default"])(e.head.transactions);case 8:if(t=(s=i.next()).done){c.next=16;break}o=s.value;if(!this._transactionCache.containsTransaction(o)){c.next=13;break}a.w(PartialLightChain,"Rejecting block - Double Transaction Error!");return c.abrupt("return",!1);case 13:t=!0;c.next=8;break;case 16:c.next=22;break;case 18:c.prev=18;c.t0=c["catch"](6);n=!0;r=c.t0;case 22:c.prev=22;c.prev=23;t||null==i["return"]||i["return"]();case 25:c.prev=25;if(!n){c.next=28;break}throw r;case 28:return c.finish(25);case 29:return c.finish(22);case 30:this._transactionCache.pushBlock(e.head);if(!e.mainChainSuccessor){c.next=37;break}c.next=34;return this._store.getChainData(e.mainChainSuccessor,!0);case 34:c.t1=c.sent;c.next=38;break;case 37:c.t1=null;case 38:e=c.t1;c.next=2;break;case 41:this._state=PartialLightChain.State.COMPLETE;if(!this._accountsTx){c.next=46;break}c.next=45;return this._accountsTx.abort();case 45:this._accountsTx=null;case 46:c.t2=this._proof;if(c.t2){c.next=51;break}c.next=50;return this._getChainProof();case 50:c.t2=c.sent;case 51:u=c.t2;this.fire("complete",u,this._headHash,this._mainChain,this._transactionCache);return c.abrupt("return",!0);case 54:case"end":return c.stop()}},_callee331,this,[[6,18,22,30],[23,,25,29]])}));return function _complete(){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee332(){return _regenerator["default"].wrap(function _callee332$(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._commitSynchronizer.push(0,this._commit.bind(this)));case 1:case"end":return e.stop()}},_callee332,this)}));return function commit(){return e.apply(this,arguments)}}()},{key:"_commit",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee333(){var e,t,n;return _regenerator["default"].wrap(function _callee333$(r){for(;;)switch(r.prev=r.next){case 0:if(!this._accountsTx){r.next=4;break}r.next=3;return this._accountsTx.abort();case 3:this._accountsTx=null;case 4:r.next=6;return(e=JDB.JungleDB).commitCombined.apply(e,(0,_toConsumableArray2["default"])(this._store.txs).concat([this._partialTree.tx]));case 6:t=r.sent;this._partialTree=null;r.t0=this._proof;if(r.t0){r.next=13;break}r.next=12;return this._getChainProof();case 12:r.t0=r.sent;case 13:n=r.t0;t&&this.fire("committed",n,this._headHash,this._mainChain,this._transactionCache);return r.abrupt("return",t);case 16:case"end":return r.stop()}},_callee333,this)}));return function _commit(){return e.apply(this,arguments)}}()},{key:"abort",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee334(){return _regenerator["default"].wrap(function _callee334$(e){for(;;)switch(e.prev=e.next){case 0:if(this._state!==PartialLightChain.State.ABORTED){e.next=2;break}return e.abrupt("return");case 2:this._state=PartialLightChain.State.ABORTED;if(!this._accountsTx){e.next=7;break}e.next=6;return this._accountsTx.abort();case 6:this._accountsTx=null;case 7:if(!this._partialTree){e.next=11;break}e.next=10;return this._partialTree.abort();case 10:this._partialTree=null;case 11:e.next=13;return this._store.abort();case 13:this.fire("aborted");case 14:case"end":return e.stop()}},_callee334,this)}));return function abort(){return e.apply(this,arguments)}}()},{key:"getMissingAccountsPrefix",value:function getMissingAccountsPrefix(){return this._partialTree?this._partialTree.missingPrefix:""}},{key:"getBlockLocators",value:function getBlockLocators(){return this._proofHead?[this._proofHead.head.hash()]:[this.headHash]}},{key:"numBlocksNeeded",value:function numBlocksNeeded(){if(!this._proofHead)return re.NUM_BLOCKS_VERIFICATION;var e=re.NUM_BLOCKS_VERIFICATION-(this.height-this._proofHead.head.height+1);this._proofHead.head.isFull()||e++;return e}},{key:"needsMoreBlocks",value:function needsMoreBlocks(){return this.numBlocksNeeded()>0}},{key:"state",get:function get(){return this._state}},{key:"proofHeadHeight",get:function get(){return this._proofHead.head.height}}]);return PartialLightChain}(vt);bt.State={WEAK_PROOF:-2,ABORTED:-1,PROVE_CHAIN:0,PROVE_ACCOUNTS_TREE:1,PROVE_BLOCKS:2,COMPLETE:3};n.register(bt);var wt=function(e){(0,_inherits2["default"])(NanoChain,e);var t=_createSuper(NanoChain);function NanoChain(e){var n;(0,_classCallCheck2["default"])(this,NanoChain);(n=t.call(this,at.createVolatile()))._time=e;n._proof=new tt(new Ze([qn.GENESIS_BLOCK.toLight()]),new et([]));n._headHash=qn.GENESIS_HASH;n._synchronizer=new G(2,NanoChain.SYNCHRONIZER_THROTTLE_AFTER,NanoChain.SYNCHRONIZER_THROTTLE_WAIT);return(0,_possibleConstructorReturn2["default"])(n,n._init())}(0,_createClass2["default"])(NanoChain,[{key:"_init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee335(){return _regenerator["default"].wrap(function _callee335$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return nt.initial(qn.GENESIS_BLOCK);case 2:this._mainChain=e.sent;e.next=5;return this._store.putChainData(qn.GENESIS_HASH,this._mainChain);case 5:return e.abrupt("return",this);case 6:case"end":return e.stop()}},_callee335,this)}));return function _init(){return e.apply(this,arguments)}}()},{key:"pushProof",value:function pushProof(e){return this._synchronizer.push(0,this._pushProof.bind(this,e))}},{key:"_pushProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee336(e){var t,n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,k,m,b,w,C,S,T,E,x;return _regenerator["default"].wrap(function _callee336$(I){for(;;)switch(I.prev=I.next){case 0:t=[];n=0;case 2:if(!(n<e.prefix.length)){I.next=12;break}r=e.prefix.blocks[n];i=r.hash();I.next=7;return this._store.getBlock(i);case 7:I.sent||r.header._pow||t.push(r.header);case 9:++n;I.next=2;break;case 12:s=0;case 13:if(!(s<e.suffix.length)){I.next=23;break}o=e.suffix.headers[s];u=o.hash();I.next=18;return this._store.getBlock(u);case 18:I.sent||o._pow||t.push(o);case 20:++s;I.next=13;break;case 23:I.next=25;return Xe.manyPow(t);case 25:c=0;case 26:if(!(c<e.prefix.length)){I.next=47;break}if(c%1e3!=999){I.next=30;break}I.next=30;return v.webYield();case 30:l=e.prefix.blocks[c];h=l.hash();I.next=34;return this._store.getBlock(h);case 34:if(!(f=I.sent)){I.next=39;break}e.prefix.blocks[c]=f.toLight();I.next=44;break;case 39:I.next=41;return l.verify(this._time);case 41:if(I.sent){I.next=44;break}a.w(NanoChain,"Rejecting proof - prefix contains invalid block");return I.abrupt("return",!1);case 44:c++;I.next=26;break;case 47:d=0;case 48:if(!(d<e.suffix.length)){I.next=66;break}A=e.suffix.headers[d];_=A.hash();I.next=53;return this._store.getBlock(_);case 53:if(!(p=I.sent)){I.next=58;break}e.suffix.headers[d]=p.header;I.next=63;break;case 58:I.next=60;return A.verifyProofOfWork();case 60:if(I.sent){I.next=63;break}a.w(NanoChain,"Rejecting proof - suffix contains invalid header");return I.abrupt("return",!1);case 63:d++;I.next=48;break;case 66:I.next=68;return e.verify();case 68:if(I.sent){I.next=71;break}a.w(NanoChain,"Rejecting proof - verification failed");return I.abrupt("return",!1);case 71:if(e.suffix.length===re.K||e.suffix.length===e.head.height-1){I.next=74;break}a.w(NanoChain,"Rejecting proof - invalid suffix length");return I.abrupt("return",!1);case 74:if(!(e.prefix.denseSuffix().length<re.M&&e.prefix.length>0&&e.prefix.head.height>=re.M)){I.next=78;break}a.w(NanoChain,"Rejecting proof - dense suffix too short");return I.abrupt("return",!1);case 78:g=[];y=e.prefix.head;k=!0;m=!1;b=undefined;I.prev=83;w=(0,_getIterator2["default"])(e.suffix.headers);case 85:if(k=(C=w.next()).done){I.next=99;break}S=C.value;I.next=89;return y.getNextInterlink(S.target,S.version);case 89:T=I.sent;E=T.hash();if(S.interlinkHash.equals(E)){I.next=94;break}a.w(NanoChain,"Rejecting proof - invalid interlink hash in proof suffix");return I.abrupt("return",!1);case 94:y=new Je(S,T);g.push(y);case 96:k=!0;I.next=85;break;case 99:I.next=105;break;case 101:I.prev=101;I.t0=I["catch"](83);m=!0;b=I.t0;case 105:I.prev=105;I.prev=106;k||null==w["return"]||w["return"]();case 108:I.prev=108;if(!m){I.next=111;break}throw b;case 111:return I.finish(108);case 112:return I.finish(105);case 113:I.next=115;return v.webYield();case 115:I.t1=this._proof;if(I.t1){I.next=120;break}I.next=119;return this._getChainProof();case 119:I.t1=I.sent;case 120:x=I.t1;I.next=123;return Xe.isBetterProof(e,x,re.M);case 123:if(!I.sent){I.next=126;break}I.next=126;return this._acceptProof(e,g);case 126:return I.abrupt("return",!0);case 127:case"end":return I.stop()}},_callee336,this,[[83,101,105,113],[106,,108,112]])}));return function _pushProof(t){return e.apply(this,arguments)}}()},{key:"_acceptProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee337(e,t){var n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y,k,m,b,w;return _regenerator["default"].wrap(function _callee337$(C){for(;;)switch(C.prev=C.next){case 0:this._proof=e;n=e.prefix.head;r=n.hash();C.next=5;return this._store.getChainData(r);case 5:if((a=C.sent)&&!a.totalDifficulty.lte(0)){C.next=50;break}C.next=9;return this._store.truncate();case 9:i=e.prefix.denseSuffix();s=new rt;o=0;case 12:if(!(o<e.prefix.length-i.length)){C.next=30;break}if(o%100!=99){C.next=16;break}C.next=16;return v.webYield();case 16:u=e.prefix.blocks[o];c=u.hash();C.t0=De;C.next=21;return u.pow();case 21:C.t1=C.sent;l=C.t0.getHashDepth.call(C.t0,C.t1);s=s.copyAndAdd(l);h=new nt(u,new J(-1),new J(-1),s,!0);C.next=27;return this._store.putChainData(c,h);case 27:o++;C.next=12;break;case 30:f=i[0];this._headHash=f.hash();C.next=34;return nt.initial(f,s);case 34:this._mainChain=C.sent;C.next=37;return this._store.putChainData(this._headHash,this._mainChain);case 37:d=1;case 38:if(!(d<i.length)){C.next=50;break}if(d%50!=49){C.next=42;break}C.next=42;return v.webYield();case 42:A=i[d];C.next=45;return this._pushBlock(A);case 45:_=C.sent;R.that(_>=0);case 47:d++;C.next=38;break;case 50:p=!0;g=!1;y=undefined;C.prev=53;k=(0,_getIterator2["default"])(t);case 55:if(p=(m=k.next()).done){C.next=67;break}if((b=m.value).height%50!=49){C.next=60;break}C.next=60;return v.webYield();case 60:C.next=62;return this._pushBlock(b);case 62:w=C.sent;R.that(w>=0);case 64:p=!0;C.next=55;break;case 67:C.next=73;break;case 69:C.prev=69;C.t2=C["catch"](53);g=!0;y=C.t2;case 73:C.prev=73;C.prev=74;p||null==k["return"]||k["return"]();case 76:C.prev=76;if(!g){C.next=79;break}throw y;case 79:return C.finish(76);case 80:return C.finish(73);case 81:case"end":return C.stop()}},_callee337,this,[[53,69,73,81],[74,,76,80]])}));return function _acceptProof(t,n){return e.apply(this,arguments)}}()},{key:"_pushBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee338(e){var t,n;return _regenerator["default"].wrap(function _callee338$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return e.hash();case 2:t=r.sent;r.next=5;return this._store.getBlock(t);case 5:if(!r.sent){r.next=8;break}return r.abrupt("return",NanoChain.OK_KNOWN);case 8:r.next=10;return this._store.getChainData(e.prevHash);case 10:if((n=r.sent)&&!n.totalDifficulty.lte(0)){r.next=13;break}return r.abrupt("return",NanoChain.ERR_ORPHAN);case 13:return r.abrupt("return",this._pushBlockInternal(e,t,n));case 14:case"end":return r.stop()}},_callee338,this)}));return function _pushBlock(t){return e.apply(this,arguments)}}()},{key:"pushHeader",value:function pushHeader(e){return this._synchronizer.push(0,this._pushHeader.bind(this,e))}},{key:"_pushHeader",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee339(e){var t,n,r,i,s,o;return _regenerator["default"].wrap(function _callee339$(u){for(;;)switch(u.prev=u.next){case 0:t=e.hash();u.next=3;return this._store.getBlock(t);case 3:if(!u.sent){u.next=6;break}return u.abrupt("return",NanoChain.OK_KNOWN);case 6:u.next=8;return e.verifyProofOfWork();case 8:if(u.sent){u.next=11;break}a.w(NanoChain,"Rejecting header - PoW verification failed");return u.abrupt("return",NanoChain.ERR_INVALID);case 11:u.next=13;return this._store.getChainData(e.prevHash);case 13:if((n=u.sent)&&!n.totalDifficulty.lte(0)){u.next=17;break}a.w(NanoChain,"Rejecting header - unknown predecessor");return u.abrupt("return",NanoChain.ERR_ORPHAN);case 17:r=n.head;if(e.isImmediateSuccessorOf(r.header)){u.next=21;break}a.w(NanoChain,"Rejecting header - not a valid successor");return u.abrupt("return",NanoChain.ERR_INVALID);case 21:u.next=23;return this.getNextTarget(r);case 23:i=u.sent;if(!De.isValidTarget(i)){u.next=30;break}if(e.nBits===De.targetToCompact(i)){u.next=28;break}a.w(NanoChain,"Rejecting header - difficulty mismatch");return u.abrupt("return",NanoChain.ERR_INVALID);case 28:u.next=31;break;case 30:a.w(NanoChain,"Skipping difficulty verification - not enough blocks available");case 31:u.next=33;return r.getNextInterlink(e.target,e.version);case 33:s=u.sent;if(s.hash().equals(e.interlinkHash)){u.next=38;break}a.w(NanoChain,"Rejecting header - interlink verification failed");return u.abrupt("return",NanoChain.ERR_INVALID);case 38:o=new Je(e,s);return u.abrupt("return",this._pushBlockInternal(o,t,n));case 40:case"end":return u.stop()}},_callee339,this)}));return function _pushHeader(t){return e.apply(this,arguments)}}()},{key:"_pushBlockInternal",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee340(e,t,n){var r,i,s;return _regenerator["default"].wrap(function _callee340$(o){for(;;)switch(o.prev=o.next){case 0:o.next=2;return n.nextChainData(e);case 2:r=o.sent;if(!e.prevHash.equals(this.headHash)){o.next=26;break}r.onMainChain=!0;n.mainChainSuccessor=t;(i=this._store.synchronousTransaction()).putChainDataSync(t,r);i.putChainDataSync(e.prevHash,n);o.next=11;return i.commit();case 11:this._mainChain=r;this._headHash=t;if(!this._proof){o.next=19;break}s=this._proof.head.hash();if(!e.prevHash.equals(s)){o.next=19;break}o.next=18;return this._extendChainProof(this._proof,e.header);case 18:this._proof=o.sent;case 19:o.next=21;return this.fire("head-changed",this.head,!1);case 21:o.next=23;return this.fire("block",t);case 23:o.next=25;return this.fire("extended",this.head);case 25:return o.abrupt("return",NanoChain.OK_EXTENDED);case 26:if(!r.totalDifficulty.gt(this._mainChain.totalDifficulty)){o.next=30;break}o.next=29;return this._rebranch(t,r);case 29:return o.abrupt("return",NanoChain.OK_REBRANCHED);case 30:a.v(NanoChain,"Creating/extending fork with block ".concat(t,", height=").concat(e.height,", totalDifficulty=").concat(r.totalDifficulty,", totalWork=").concat(r.totalWork));o.next=33;return this._store.putChainData(t,r);case 33:o.next=35;return this.fire("block",t);case 35:return o.abrupt("return",NanoChain.OK_FORKED);case 36:case"end":return o.stop()}},_callee340,this)}));return function _pushBlockInternal(t,n,r){return e.apply(this,arguments)}}()},{key:"_rebranch",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee341(e,t){var n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k;return _regenerator["default"].wrap(function _callee341$(m){for(;;)switch(m.prev=m.next){case 0:a.v(NanoChain,"Rebranching to fork ".concat(e,", height=").concat(t.head.height,", totalDifficulty=").concat(t.totalDifficulty,", totalWork=").concat(t.totalWork));n=[];r=[];i=t;s=e;case 5:if(i.onMainChain){m.next=15;break}n.push(i);r.push(s);s=i.head.prevHash;m.next=11;return this._store.getChainData(s);case 11:i=m.sent;R.that(!!i,"Failed to find fork predecessor while rebranching");m.next=5;break;case 15:a.v(NanoChain,function(){return"Found common ancestor ".concat(s.toBase64()," ").concat(n.length," blocks up")});o=i;u=s;c=this._store.synchronousTransaction(!1);l=[];h=this._headHash;f=this._mainChain;case 22:if(h.equals(u)){m.next=34;break}f.onMainChain=!1;f.mainChainSuccessor=null;c.putChainDataSync(h,f);l.push(f);h=f.head.prevHash;m.next=30;return this._store.getChainData(h);case 30:f=m.sent;R.that(!!f,"Failed to find main chain predecessor while rebranching");m.next=22;break;case 34:o.mainChainSuccessor=r[r.length-1];c.putChainDataSync(u,o);for(d=n.length-1;d>=0;d--){(A=n[d]).onMainChain=!0;A.mainChainSuccessor=d>0?r[d-1]:null;c.putChainDataSync(r[d],A)}m.next=39;return c.commit();case 39:this._proof=null;_=[];p=0,g=l;case 42:if(!(p<g.length)){m.next=50;break}y=g[p];m.next=46;return this.fire("block-reverted",y.head);case 46:_.push(y.head);case 47:p++;m.next=42;break;case 50:v=[];k=n.length-1;case 52:if(!(k>=0)){m.next=61;break}this._mainChain=n[k];this._headHash=r[k];m.next=57;return this.fire("head-changed",this.head,k>0);case 57:v.push(this.head);case 58:k--;m.next=52;break;case 61:m.next=63;return this.fire("block",e);case 63:m.next=65;return this.fire("rebranched",_,v,e);case 65:case"end":return m.stop()}},_callee341,this)}));return function _rebranch(t,n){return e.apply(this,arguments)}}()},{key:"getChainProof",value:function getChainProof(){var e=this;return this._synchronizer.push(1,(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee342(){return _regenerator["default"].wrap(function _callee342$(t){for(;;)switch(t.prev=t.next){case 0:if(e._proof){t.next=4;break}t.next=3;return e._getChainProof();case 3:e._proof=t.sent;case 4:return t.abrupt("return",e._proof);case 5:case"end":return t.stop()}},_callee342)})))}},{key:"head",get:function get(){return this._mainChain.head}},{key:"headHash",get:function get(){return this._headHash}},{key:"height",get:function get(){return this._mainChain.head.height}}]);return NanoChain}(Xe);wt.ERR_ORPHAN=-2;wt.ERR_INVALID=-1;wt.OK_KNOWN=0;wt.OK_EXTENDED=1;wt.OK_REBRANCHED=2;wt.OK_FORKED=3;wt.SYNCHRONIZER_THROTTLE_AFTER=500;wt.SYNCHRONIZER_THROTTLE_WAIT=30;n.register(wt);var Ct=function(e){(0,_inherits2["default"])(NanoConsensusAgent,e);var t=_createSuper(NanoConsensusAgent);function NanoConsensusAgent(e,n,r,a,i,s){var o;(0,_classCallCheck2["default"])(this,NanoConsensusAgent);(o=t.call(this,e,n,r,a,i,s))._blockchain=e;o._mempool=n;o._syncing=!1;o._orphanedBlocks=[];o._requestedChainProof=!1;o._onToDisconnect(a.channel,"chain-proof",function(e){return o._onChainProof(e)});o._onToDisconnect(a.channel,"get-chain-proof",function(e){return o._onGetChainProof(e)});o._subscribeTarget();return o}(0,_createClass2["default"])(NanoConsensusAgent,[{key:"syncBlockchain",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee343(){return _regenerator["default"].wrap(function _callee343$(e){for(;;)switch(e.prev=e.next){case 0:if(this.providesServices(_.CHAIN_PROOF)){e.next=3;break}this._syncFinished();return e.abrupt("return");case 3:this._syncing=!0;e.next=6;return this._blockchain.getBlock(this._peer.headHash);case 6:if(e.sent)this._syncFinished();else{this._requestChainProof();this.fire("sync-chain-proof",this._peer.peerAddress)}case 8:case"end":return e.stop()}},_callee343,this)}));return function syncBlockchain(){return e.apply(this,arguments)}}()},{key:"_syncFinished",value:function _syncFinished(){this._syncing=!1;this._synced=!0;this.requestMempool();this.fire("sync")}},{key:"_requestChainProof",value:function _requestChainProof(){var e=this;if(!this._requestedChainProof){this._peer.channel.getChainProof();this._requestedChainProof=!0;this._peer.channel.expectMessage(Rt.Type.CHAIN_PROOF,function(){e._peer.channel.close(Wn.GET_CHAIN_PROOF_TIMEOUT,"getChainProof timeout")},NanoConsensusAgent.CHAINPROOF_REQUEST_TIMEOUT,NanoConsensusAgent.CHAINPROOF_CHUNK_TIMEOUT)}}},{key:"_onChainProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee344(e){return _regenerator["default"].wrap(function _callee344$(t){for(;;)switch(t.prev=t.next){case 0:a.d(NanoConsensusAgent,"[CHAIN-PROOF] Received from ".concat(this._peer.peerAddress,": ").concat(e.proof));if(this._requestedChainProof){t.next=4;break}a.w(NanoConsensusAgent,"Unsolicited chain proof received from ".concat(this._peer.peerAddress));return t.abrupt("return");case 4:this._requestedChainProof=!1;this._syncing&&this.fire("verify-chain-proof",this._peer.peerAddress);t.next=8;return this._blockchain.pushProof(e.proof);case 8:if(t.sent){t.next=12;break}a.w(NanoConsensusAgent,"Invalid chain proof received from ".concat(this._peer.peerAddress," - verification failed"));this._peer.channel.close(Wn.INVALID_CHAIN_PROOF,"Invalid chain proof");return t.abrupt("return");case 12:t.next=14;return this._applyOrphanedBlocks();case 14:this._syncing&&this._syncFinished();case 15:case"end":return t.stop()}},_callee344,this)}));return function _onChainProof(t){return e.apply(this,arguments)}}()},{key:"_applyOrphanedBlocks",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee345(){var e,t,n,r,a,i;return _regenerator["default"].wrap(function _callee345$(s){for(;;)switch(s.prev=s.next){case 0:e=!0;t=!1;n=undefined;s.prev=3;r=(0,_getIterator2["default"])(this._orphanedBlocks);case 5:if(e=(a=r.next()).done){s.next=16;break}i=a.value;s.next=9;return this._blockchain.pushHeader(i);case 9:if(s.sent!==wt.ERR_INVALID){s.next=13;break}this._peer.channel.close(Wn.INVALID_BLOCK,"received invalid block");return s.abrupt("break",16);case 13:e=!0;s.next=5;break;case 16:s.next=22;break;case 18:s.prev=18;s.t0=s["catch"](3);t=!0;n=s.t0;case 22:s.prev=22;s.prev=23;e||null==r["return"]||r["return"]();case 25:s.prev=25;if(!t){s.next=28;break}throw n;case 28:return s.finish(25);case 29:return s.finish(22);case 30:this._orphanedBlocks=[];case 31:case"end":return s.stop()}},_callee345,this,[[3,18,22,30],[23,,25,29]])}));return function _applyOrphanedBlocks(){return e.apply(this,arguments)}}()},{key:"_willRequestHeaders",value:function _willRequestHeaders(){return!0}},{key:"_getBlock",value:function _getBlock(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1],n=arguments.length>2&&arguments[2]!==undefined&&arguments[2];return this._blockchain.getBlock(e,t,n)}},{key:"_getRawBlock",value:function _getRawBlock(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return this._blockchain.getRawBlock(e,t)}},{key:"_getTransaction",value:function _getTransaction(e){return this._mempool.getTransaction(e)}},{key:"_processHeader",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee346(e,t){var n;return _regenerator["default"].wrap(function _callee346$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this._blockchain.pushHeader(t);case 2:if((n=e.sent)===wt.ERR_INVALID)this._peer.channel.close(Wn.INVALID_HEADER,"received invalid header");else if(n===wt.ERR_ORPHAN){this._orphanedBlocks.push(t);this._synced&&this._requestChainProof()}case 4:case"end":return e.stop()}},_callee346,this)}));return function _processHeader(t,n){return e.apply(this,arguments)}}()},{key:"_processTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee347(e,t){return _regenerator["default"].wrap(function _callee347$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this._mempool.pushTransaction(t);case 2:case"end":return e.stop()}},_callee347,this)}));return function _processTransaction(t,n){return e.apply(this,arguments)}}()},{key:"_onGetChainProof",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee348(e){var t;return _regenerator["default"].wrap(function _callee348$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this._blockchain.getChainProof();case 2:(t=e.sent)&&this._peer.channel.chainProof(t);case 4:case"end":return e.stop()}},_callee348,this)}));return function _onGetChainProof(t){return e.apply(this,arguments)}}()},{key:"_onClose",value:function _onClose(){this._synchronizer.clear();(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoConsensusAgent.prototype),"_onClose",this).call(this)}},{key:"syncing",get:function get(){return this._syncing}}]);return NanoConsensusAgent}(At);Ct.CHAINPROOF_REQUEST_TIMEOUT=45e3;Ct.CHAINPROOF_CHUNK_TIMEOUT=1e4;n.register(Ct);var St=function(e){(0,_inherits2["default"])(NanoConsensus,e);var t=_createSuper(NanoConsensus);function NanoConsensus(e,n,r){var a;(0,_classCallCheck2["default"])(this,NanoConsensus);(a=t.call(this,e,n,r))._blockchain=e;a._mempool=n;return a}(0,_createClass2["default"])(NanoConsensus,[{key:"_newConsensusAgent",value:function _newConsensusAgent(e){return new Ct(this._blockchain,this._mempool,this._network.time,e,this._invRequestManager,this._subscription)}},{key:"_onPeerJoined",value:function _onPeerJoined(e){var t=(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoConsensus.prototype),"_onPeerJoined",this).call(this,e);this.bubble(t,"sync-chain-proof","verify-chain-proof");return t}},{key:"blockchain",get:function get(){return this._blockchain}},{key:"mempool",get:function get(){return this._mempool}}]);return NanoConsensus}(_t);n.register(St);var Tt=function(e){(0,_inherits2["default"])(NanoMempool,e);var t=_createSuper(NanoMempool);function NanoMempool(e){var n;(0,_classCallCheck2["default"])(this,NanoMempool);(n=t.call(this))._blockchain=e;n._transactionsByHash=new b;n._transactionSetBySender=new b;n._transactionSetByRecipient=new b;return n}(0,_createClass2["default"])(NanoMempool,[{key:"pushTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee349(e){var t,n,r;return _regenerator["default"].wrap(function _callee349$(i){for(;;)switch(i.prev=i.next){case 0:t=e.hash();if(!this._transactionsByHash.contains(t)){i.next=4;break}a.v(ct,function(){return"Ignoring known transaction ".concat(t.toBase64())});return i.abrupt("return",ct.ReturnCode.KNOWN);case 4:if(!(this._blockchain.height>=e.validityStartHeight+re.TRANSACTION_VALIDITY_WINDOW)){i.next=7;break}a.v(ct,function(){return"Ignoring expired transaction ".concat(t.toBase64())});return i.abrupt("return",ct.ReturnCode.EXPIRED);case 7:if(e.verify()){i.next=9;break}return i.abrupt("return",ct.ReturnCode.INVALID);case 9:this._transactionsByHash.put(t,e);(n=this._transactionSetBySender.get(e.sender)||new ot).add(e);this._transactionSetBySender.put(e.sender,n);(r=this._transactionSetByRecipient.get(e.recipient)||new w).add(e);this._transactionSetByRecipient.put(e.recipient,r);this.fire("transaction-added",e);return i.abrupt("return",ct.ReturnCode.ACCEPTED);case 18:case"end":return i.stop()}},_callee349,this)}));return function pushTransaction(t){return e.apply(this,arguments)}}()},{key:"getTransaction",value:function getTransaction(e){return this._transactionsByHash.get(e)}},{key:"getTransactions",value:function getTransactions(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:5e3;return this._transactionsByHash.values().sort(function(e,t){return e.compare(t)}).slice(0,e)}},{key:"getPendingTransactions",value:function getPendingTransactions(e){return this.getTransactionsBySender(e)}},{key:"getTransactionsBySender",value:function getTransactionsBySender(e){var t=this._transactionSetBySender.get(e);return t?t.transactions:[]}},{key:"getTransactionsByRecipient",value:function getTransactionsByRecipient(e){var t=this._transactionSetByRecipient.get(e);return t?t.values():[]}},{key:"getTransactionsByAddresses",value:function getTransactionsByAddresses(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Infinity,n=[],r=!0,a=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(e);!(r=(s=o.next()).done);r=!0){var u=s.value,c=this.getTransactionsBySender(u),l=!0,h=!1,f=undefined;try{for(var d,A=(0,_getIterator2["default"])(c);!(l=(d=A.next()).done);l=!0){var _=d.value;if(n.length>=t)return n;n.push(_)}}catch(w){h=!0;f=w}finally{try{l||null==A["return"]||A["return"]()}finally{if(h)throw f}}var p=this.getTransactionsByRecipient(u),g=!0,y=!1,v=undefined;try{for(var k,m=(0,_getIterator2["default"])(p);!(g=(k=m.next()).done);g=!0){var b=k.value;if(n.length>=t)return n;n.push(b)}}catch(w){y=!0;v=w}finally{try{g||null==m["return"]||m["return"]()}finally{if(y)throw v}}}}catch(w){a=!0;i=w}finally{try{r||null==o["return"]||o["return"]()}finally{if(a)throw i}}return n}},{key:"changeHead",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee350(e,t){return _regenerator["default"].wrap(function _callee350$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this._evictTransactions(e,t);case 2:case"end":return n.stop()}},_callee350,this)}));return function changeHead(t,n){return e.apply(this,arguments)}}()},{key:"removeTransaction",value:function removeTransaction(e){this._transactionsByHash.remove(e.hash());var t=this._transactionSetBySender.get(e.sender);t.remove(e);0===t.length&&this._transactionSetBySender.remove(e.sender);var n=this._transactionSetByRecipient.get(e.recipient);n.remove(e);0===n.length&&this._transactionSetByRecipient.remove(e.recipient);this.fire("transaction-removed",e)}},{key:"evictExceptAddresses",value:function evictExceptAddresses(e){var t=new w;t.addAll(e);var n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(this._transactionsByHash.values());!(n=(i=s.next()).done);n=!0){var o=i.value;t.contains(o.sender)||t.contains(o.recipient)||this.removeTransaction(o)}}catch(u){r=!0;a=u}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}}},{key:"_evictTransactions",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee351(e,t){var n,r,a,i,s,o,u,c,l,h,f,d,A;return _regenerator["default"].wrap(function _callee351$(_){for(;;)switch(_.prev=_.next){case 0:n=!0;r=!1;a=undefined;_.prev=3;for(i=(0,_getIterator2["default"])(this._transactionsByHash.values());!(n=(s=i.next()).done);n=!0){o=s.value;if(e.height>=o.validityStartHeight+re.TRANSACTION_VALIDITY_WINDOW){this.removeTransaction(o);this.fire("transaction-expired",o)}}_.next=11;break;case 7:_.prev=7;_.t0=_["catch"](3);r=!0;a=_.t0;case 11:_.prev=11;_.prev=12;n||null==i["return"]||i["return"]();case 14:_.prev=14;if(!r){_.next=17;break}throw a;case 17:return _.finish(14);case 18:return _.finish(11);case 19:u=!0;c=!1;l=undefined;_.prev=22;for(h=(0,_getIterator2["default"])(t);!(u=(f=h.next()).done);u=!0){d=f.value;A=d.hash();if(this._transactionsByHash.contains(A)){this.removeTransaction(d);this.fire("transaction-mined",d,e)}}_.next=30;break;case 26:_.prev=26;_.t1=_["catch"](22);c=!0;l=_.t1;case 30:_.prev=30;_.prev=31;u||null==h["return"]||h["return"]();case 33:_.prev=33;if(!c){_.next=36;break}throw l;case 36:return _.finish(33);case 37:return _.finish(30);case 38:case"end":return _.stop()}},_callee351,this,[[3,7,11,19],[12,,14,18],[22,26,30,38],[31,,33,37]])}));return function _evictTransactions(t,n){return e.apply(this,arguments)}}()},{key:"length",get:function get(){return this._transactionsByHash.length}}]);return NanoMempool}(i);n.register(Tt);var Et=function(e){(0,_inherits2["default"])(PicoChain,e);var t=_createSuper(PicoChain);function PicoChain(e){var n;(0,_classCallCheck2["default"])(this,PicoChain);(n=t.call(this,at.createVolatile()))._time=e;n._synchronizer=new z;n._mainChain=null;return(0,_possibleConstructorReturn2["default"])(n,n._init())}(0,_createClass2["default"])(PicoChain,[{key:"reset",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee352(){return _regenerator["default"].wrap(function _callee352$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return nt.initial(qn.GENESIS_BLOCK);case 2:this._mainChain=e.sent;e.next=5;return this._store.putChainData(qn.GENESIS_HASH,this._mainChain);case 5:case"end":return e.stop()}},_callee352,this)}));return function reset(){return e.apply(this,arguments)}}()},{key:"_init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee353(){return _regenerator["default"].wrap(function _callee353$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.reset();case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},_callee353,this)}));return function _init(){return e.apply(this,arguments)}}()},{key:"pushBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee354(e){var t=this;return _regenerator["default"].wrap(function _callee354$(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this._synchronizer.push(function(){return t._pushBlock(e)}));case 1:case"end":return n.stop()}},_callee354,this)}));return function pushBlock(t){return e.apply(this,arguments)}}()},{key:"_pushBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee355(e){var t,n,r;return _regenerator["default"].wrap(function _callee355$(i){for(;;)switch(i.prev=i.next){case 0:i.next=2;return this._store.getChainData(e.hash());case 2:if(!i.sent){i.next=4;break}return i.abrupt("return",PicoChain.OK_KNOWN);case 4:i.next=6;return e.verify(this._time);case 6:if(i.sent){i.next=8;break}return i.abrupt("return",PicoChain.ERR_INVALID);case 8:i.next=10;return this._store.getChainData(e.prevHash);case 10:t=i.sent;if(!(this.height<=1)){i.next=26;break}i.next=14;return nt.initial(e);case 14:this._mainChain=i.sent;i.next=17;return this._store.putChainData(this._mainChain.head.hash(),this._mainChain);case 17:a.d(PicoChain,"Choosing initial block height=".concat(e.height,", hash=").concat(e.hash().toHex()));this.fire("head-changed",this.head);i.next=21;return this.fire("block",e.hash());case 21:i.next=23;return this.fire("extended",this.head);case 23:return i.abrupt("return",PicoChain.OK_EXTENDED);case 26:i.next=28;return e.isImmediateSuccessorOf(this.head);case 28:if(!i.sent){i.next=47;break}this._mainChain.mainChainSuccessor=e.hash();i.next=32;return this._store.putChainData(this._mainChain.head.hash(),this._mainChain);case 32:i.next=34;return this._mainChain.nextChainData(e);case 34:this._mainChain=i.sent;this._mainChain.onMainChain=!0;i.next=38;return this._store.putChainData(this._mainChain.head.hash(),this._mainChain);case 38:a.d(PicoChain,"Appending block height=".concat(e.height,", hash=").concat(e.hash().toHex()));this.fire("head-changed",this.head);i.next=42;return this.fire("block",e.hash());case 42:i.next=44;return this.fire("extended",this.head);case 44:return i.abrupt("return",PicoChain.OK_EXTENDED);case 47:i.next=49;return this.head.isImmediateSuccessorOf(e);case 49:if(!i.sent){i.next=68;break}i.next=52;return nt.initial(e);case 52:(n=i.sent).mainChainSuccessor=this.head.hash();i.next=56;return this._store.putChainData(n.head.hash(),n);case 56:i.next=58;return n.nextChainData(this.head);case 58:this._mainChain=i.sent;this._mainChain.onMainChain=!0;i.next=62;return this._store.putChainData(this._mainChain.head.hash(),this._mainChain);case 62:a.d(PicoChain,"Prepending block height=".concat(e.height,", hash=").concat(e.hash().toHex()));i.next=65;return this.fire("block",e.hash());case 65:return i.abrupt("return",PicoChain.OK_KNOWN);case 68:if(!t){i.next=89;break}i.next=71;return t.nextChainData(e);case 71:r=i.sent;i.next=74;return this._store.putChainData(e.hash(),r);case 74:a.d(PicoChain,"Storing block height=".concat(e.height,", hash=").concat(e.hash().toHex()));if(!r.totalWork.gt(this._mainChain.totalWork)){i.next=86;break}i.prev=76;i.next=79;return this._rebranch(e.hash(),r);case 79:i.next=85;break;case 81:i.prev=81;i.t0=i["catch"](76);a.w(PicoChain,"Error while rebranching",i.t0);return i.abrupt("return",PicoChain.ERR_INCONSISTENT);case 85:return i.abrupt("return",PicoChain.OK_REBRANCHED);case 86:i.next=88;return this.fire("block",e.hash());case 88:return i.abrupt("return",PicoChain.OK_FORKED);case 89:a.w(PicoChain,"Inconsistency between block height=".concat(e.height,", hash=").concat(e.hash().toHex()," and block height=").concat(this.height,", hash=").concat(this.headHash.toHex()));return i.abrupt("return",PicoChain.ERR_INCONSISTENT);case 91:case"end":return i.stop()}},_callee355,this,[[76,81]])}));return function _pushBlock(t){return e.apply(this,arguments)}}()},{key:"_rebranch",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee356(e,t){var n,r,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k;return _regenerator["default"].wrap(function _callee356$(m){for(;;)switch(m.prev=m.next){case 0:a.d(PicoChain,"Rebranching to fork ".concat(e,", height=").concat(t.head.height,", totalDifficulty=").concat(t.totalDifficulty,", totalWork=").concat(t.totalWork));n=[];r=[];i=t;s=e;case 5:if(i.onMainChain){m.next=15;break}n.push(i);r.push(s);s=i.head.prevHash;m.next=11;return this._store.getChainData(s);case 11:i=m.sent;R.that(!!i,"Failed to find fork predecessor while rebranching");m.next=5;break;case 15:a.v(PicoChain,function(){return"Found common ancestor ".concat(s.toBase64()," ").concat(n.length," blocks up")});o=i;u=s;c=this._store.synchronousTransaction(!1);l=[];h=this.headHash;f=this._mainChain;case 22:if(h.equals(u)){m.next=34;break}f.onMainChain=!1;f.mainChainSuccessor=null;c.putChainDataSync(h,f);l.push(f);h=f.head.prevHash;m.next=30;return this._store.getChainData(h);case 30:f=m.sent;R.that(!!f,"Failed to find main chain predecessor while rebranching");m.next=22;break;case 34:o.mainChainSuccessor=r[r.length-1];c.putChainDataSync(u,o);for(d=n.length-1;d>=0;d--){(A=n[d]).onMainChain=!0;A.mainChainSuccessor=d>0?r[d-1]:null;c.putChainDataSync(r[d],A)}m.next=39;return c.commit();case 39:_=[];for(p=0,g=l;p<g.length;p++){y=g[p];this.fire("block-reverted",y.head);_.push(y.head)}v=[];for(k=n.length-1;k>=0;k--){this._mainChain=n[k];this.fire("head-changed",this.head,k>0);v.push(this.head)}m.next=45;return this.fire("block",e);case 45:m.next=47;return this.fire("rebranched",_,v,e);case 47:case"end":return m.stop()}},_callee356,this)}));return function _rebranch(t,n){return e.apply(this,arguments)}}()},{key:"head",get:function get(){return this._mainChain.head}},{key:"headHash",get:function get(){return this.head.hash()}},{key:"height",get:function get(){return this.head.height}}]);return PicoChain}(Xe);Et.ERR_INCONSISTENT=-2;Et.ERR_INVALID=-1;Et.OK_KNOWN=0;Et.OK_EXTENDED=1;Et.OK_REBRANCHED=2;Et.OK_FORKED=3;n.register(Et);var xt=function(e){(0,_inherits2["default"])(PicoConsensusAgent,e);var t=_createSuper(PicoConsensusAgent);function PicoConsensusAgent(e,n,r){var a;(0,_classCallCheck2["default"])(this,PicoConsensusAgent);(a=t.call(this,e.blockchain,e.mempool,e.network.time,n,e.invRequestManager,r))._consensus=e;return a}(0,_createClass2["default"])(PicoConsensusAgent,[{key:"_processBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee357(e,t){var n;return _regenerator["default"].wrap(function _callee357$(r){for(;;)switch(r.prev=r.next){case 0:if(!this._peer.headHash.equals(e)){r.next=7;break}r.next=3;return this._blockchain.pushBlock(t);case 3:(n=r.sent)===Et.ERR_INVALID?this._peer.channel.close(Wn.INVALID_BLOCK,"received invalid block"):n===Et.ERR_INCONSISTENT?this.fire("consensus-failed"):this._syncing&&this._syncFinished();r.next=13;break;case 7:r.next=9;return this._blockchain.pushBlock(t);case 9:r.t0=r.sent;r.t1=Et.ERR_INVALID;if(r.t0!==r.t1){r.next=13;break}this._peer.channel.close(Wn.INVALID_BLOCK,"received invalid block");case 13:case"end":return r.stop()}},_callee357,this)}));return function _processBlock(t,n){return e.apply(this,arguments)}}()},{key:"syncBlockchain",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee358(){var e,t;return _regenerator["default"].wrap(function _callee358$(n){for(;;)switch(n.prev=n.next){case 0:this._syncing=!0;n.next=3;return this._getBlock(this._peer.headHash,!0);case 3:if(n.sent){n.next=19;break}n.prev=5;e=this._peer.headHash;n.next=9;return this.requestBlock(e);case 9:t=n.sent;n.next=12;return this._processBlock(e,t);case 12:n.next=17;break;case 14:n.prev=14;n.t0=n["catch"](5);this._peer.channel.close(Wn.ABORTED_SYNC,"aborted sync");case 17:n.next=20;break;case 19:this._syncFinished();case 20:case"end":return n.stop()}},_callee358,this,[[5,14]])}));return function syncBlockchain(){return e.apply(this,arguments)}}()},{key:"_syncFinished",value:function _syncFinished(){this._syncing=!1;this._synced=!0;this.requestMempool();this.fire("sync")}},{key:"_processTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee359(e,t){return _regenerator["default"].wrap(function _callee359$(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this._consensus.mempool.pushTransaction(t);case 2:case"end":return e.stop()}},_callee359,this)}));return function _processTransaction(t,n){return e.apply(this,arguments)}}()},{key:"_getBlock",value:function _getBlock(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1],n=arguments.length>2&&arguments[2]!==undefined&&arguments[2];return this._blockchain.getBlock(e,t,n)}},{key:"_getRawBlock",value:function _getRawBlock(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return this._blockchain.getRawBlock(e,t)}},{key:"_getTransaction",value:function _getTransaction(e){return this._consensus.mempool.getTransaction(e)}}]);return PicoConsensusAgent}(At);n.register(xt);var It=function(e){(0,_inherits2["default"])(PicoConsensus,e);var t=_createSuper(PicoConsensus);function PicoConsensus(e,n,r){var a;(0,_classCallCheck2["default"])(this,PicoConsensus);(a=t.call(this,e,n,r))._blockchain=e;a._mempool=n;a._failed=!1;return a}(0,_createClass2["default"])(PicoConsensus,[{key:"_newConsensusAgent",value:function _newConsensusAgent(e){return new xt(this,e,this._subscription)}},{key:"_onPeerJoined",value:function _onPeerJoined(e){var t=this,n=(0,_get10["default"])((0,_getPrototypeOf2["default"])(PicoConsensus.prototype),"_onPeerJoined",this).call(this,e);n.on("consensus-failed",function(){return t._onConsensusFailed()});this._agents.length>=3&&this._syncBlockchain();return n}},{key:"_onPeerLeft",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee360(e){return _regenerator["default"].wrap(function _callee360$(t){for(;;)switch(t.prev=t.next){case 0:(0,_get10["default"])((0,_getPrototypeOf2["default"])(PicoConsensus.prototype),"_onPeerLeft",this).call(this,e);if(0!==this._agents.length){t.next=4;break}t.next=4;return this._blockchain.reset();case 4:case"end":return t.stop()}},_callee360,this)}));return function _onPeerLeft(t){return e.apply(this,arguments)}}()},{key:"_syncBlockchain",value:function _syncBlockchain(){this._failed||(0,_get10["default"])((0,_getPrototypeOf2["default"])(PicoConsensus.prototype),"_syncBlockchain",this).call(this)}},{key:"_hasEnoughPeers",value:function _hasEnoughPeers(e,t){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(PicoConsensus.prototype),"_hasEnoughPeers",this).call(this,e,t)&&t>=PicoConsensus.MIN_SYNCED_NODES}},{key:"_onConsensusFailed",value:function _onConsensusFailed(){this._failed=!0;this._syncPeer=null;this.fire("consensus-failed")}},{key:"blockchain",get:function get(){return this._blockchain}},{key:"mempool",get:function get(){return this._mempool}}]);return PicoConsensus}(_t);It.MIN_SYNCED_NODES=3;n.register(It);var Bt=function(e){(0,_inherits2["default"])(ConsensusDB,e);var t=_createSuper(ConsensusDB);(0,_createClass2["default"])(ConsensusDB,null,[{key:"getFull",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee361(){var e,t=arguments;return _regenerator["default"].wrap(function _callee361$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:"";if(ConsensusDB._instance){n.next=5;break}n.next=4;return new ConsensusDB(e,!1);case 4:ConsensusDB._instance=n.sent;case 5:return n.abrupt("return",ConsensusDB._instance);case 6:case"end":return n.stop()}},_callee361)}));return function getFull(){return e.apply(this,arguments)}}()},{key:"getLight",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee362(){var e,t=arguments;return _regenerator["default"].wrap(function _callee362$(n){for(;;)switch(n.prev=n.next){case 0:e=t.length>0&&t[0]!==undefined?t[0]:"";if(ConsensusDB._instance){n.next=5;break}n.next=4;return new ConsensusDB(e,!0);case 4:ConsensusDB._instance=n.sent;case 5:return n.abrupt("return",ConsensusDB._instance);case 6:case"end":return n.stop()}},_callee362)}));return function getLight(){return e.apply(this,arguments)}}()}]);function ConsensusDB(e,n){var r;(0,_classCallCheck2["default"])(this,ConsensusDB);r=t.call(this,ConsensusDB._getDbName(e,n),ConsensusDB.VERSION,{maxDbSize:ConsensusDB.INITIAL_DB_SIZE,autoResize:!0,useWritemap:f.isNodeJs()&&f.isWindows(),minResize:ConsensusDB.MIN_RESIZE,onUpgradeNeeded:ConsensusDB._onUpgradeNeeded.bind(null,n)});return(0,_possibleConstructorReturn2["default"])(r,r._init())}(0,_createClass2["default"])(ConsensusDB,[{key:"_init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee363(){return _regenerator["default"].wrap(function _callee363$(e){for(;;)switch(e.prev=e.next){case 0:Se.initPersistent(this);at.initPersistent(this);je.initPersistent(this);e.next=5;return this.connect();case 5:return e.abrupt("return",this);case 6:case"end":return e.stop()}},_callee363,this)}));return function _init(){return e.apply(this,arguments)}}()}],[{key:"_getDbName",value:function _getDbName(e,t){return e+(t?"light":"full")+"-consensus"}},{key:"_onUpgradeNeeded",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee364(e,t,n,r){var i,s,o,u,c,l;return _regenerator["default"].wrap(function _callee364$(h){for(;;)switch(h.prev=h.next){case 0:if(0!==t){h.next=2;break}return h.abrupt("return");case 2:a.i(ConsensusDB,"Upgrade needed: version ".concat(t," -> ").concat(n));if(!(t<7)){h.next=24;break}if(e){h.next=10;break}a.i(ConsensusDB,"Upgrading database, this may take a while...");h.next=8;return Pt.recomputeTotals(r);case 8:h.next=24;break;case 10:i=r.getObjectStore("Accounts");s=i.transaction(!1);h.next=14;return s.truncate();case 14:o=r.getObjectStore("ChainData");u=o.transaction(!1);h.next=18;return u.truncate();case 18:c=r.getObjectStore("Block");l=c.transaction(!1);h.next=22;return l.truncate();case 22:h.next=24;return JDB.JungleDB.commitCombined(s,u,l);case 24:if(!(t<8)){h.next=29;break}if(e){h.next=29;break}a.i(ConsensusDB,"Upgrading transaction store, this may take a while...");h.next=29;return Pt.restoreTransactions(r);case 29:case"end":return h.stop()}},_callee364)}));return function _onUpgradeNeeded(t,n,r,a){return e.apply(this,arguments)}}()}]);return ConsensusDB}(JDB.JungleDB);Bt._instance=null;Bt.VERSION=8;Bt.INITIAL_DB_SIZE=524288e3;Bt.MIN_RESIZE=1<<30;n.register(Bt);var Pt=function(){function UpgradeHelper(){(0,_classCallCheck2["default"])(this,UpgradeHelper)}(0,_createClass2["default"])(UpgradeHelper,null,[{key:"recomputeTotals",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee365(e){var t,n;return _regenerator["default"].wrap(function _callee365$(r){for(;;)switch(r.prev=r.next){case 0:t=at.getPersistent(e);n=t.synchronousTransaction(!1);r.prev=2;r.next=5;return this._recomputeTotals(n,qn.GENESIS_BLOCK,new J(0),new J(0));case 5:return r.abrupt("return",n.commit());case 8:r.prev=8;r.t0=r["catch"](2);r.next=12;return n.abort();case 12:throw r.t0;case 13:case"end":return r.stop()}},_callee365,this,[[2,8]])}));return function recomputeTotals(t){return e.apply(this,arguments)}}()},{key:"_recomputeTotals",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee366(e,t,n,r){var a,i,s,o,u,c;return _regenerator["default"].wrap(function _callee366$(l){for(;;)switch(l.prev=l.next){case 0:a=t.hash();l.next=3;return e.getChainData(a);case 3:if(i=l.sent){l.next=6;break}return l.abrupt("return",_promise["default"].resolve());case 6:s=n.plus(t.difficulty);l.t0=r;l.t1=De;l.next=11;return t.pow();case 11:l.t2=l.sent;l.t3=l.t1.realDifficulty.call(l.t1,l.t2);o=l.t0.plus.call(l.t0,l.t3);i._totalDifficulty=s;i._totalWork=o;e.putChainDataSync(a,i,!1);l.next=19;return e.getSuccessorBlocks(t);case 19:u=l.sent;c=u.map(function(t){return UpgradeHelper._recomputeTotals(e,t,s,o)});return l.abrupt("return",_promise["default"].all(c));case 22:case"end":return l.stop()}},_callee366)}));return function _recomputeTotals(t,n,r,a){return e.apply(this,arguments)}}()},{key:"restoreTransactions",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee367(e){var t,n,r,i,s,o,u,c,l,h;return _regenerator["default"].wrap(function _callee367$(f){for(;;)switch(f.prev=f.next){case 0:t=at.getPersistent(e);n=je.getPersistent(e);r=1e3;i=n.transaction(!1);f.next=6;return t.getHead();case 6:s=f.sent;f.next=9;return t.getBlock(s);case 9:o=f.sent;u=o.height;f.prev=11;c=qn.GENESIS_HASH;l=0;case 14:if(!c){f.next=29;break}f.next=17;return t.getChainData(c,!0);case 17:h=f.sent;c=h.mainChainSuccessor;l=h.head.height;f.next=22;return i.put(h.head);case 22:if(l%r!=0){f.next=27;break}f.next=25;return i.commit();case 25:i=n.transaction(!1);a.i(UpgradeHelper,"Upgrade at ".concat(Math.round(l/u*100),"% (block ").concat(l,"/").concat(u,")"));case 27:f.next=14;break;case 29:if(l%r==0){f.next=33;break}f.next=32;return i.commit();case 32:a.i(UpgradeHelper,"Upgrade at ".concat(Math.round(l/u*100),"% (block ").concat(l,"/").concat(u,")"));case 33:a.i(UpgradeHelper,"Upgrade finished");f.next=41;break;case 36:f.prev=36;f.t0=f["catch"](11);f.next=40;return i.abort();case 40:throw f.t0;case 41:case"end":return f.stop()}},_callee367,null,[[11,36]])}));return function restoreTransactions(t){return e.apply(this,arguments)}}()}]);return UpgradeHelper}(),Nt=function(){function Consensus(){(0,_classCallCheck2["default"])(this,Consensus)}(0,_createClass2["default"])(Consensus,null,[{key:"full",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee368(){var e,t,n,r,a,i,s,o,u=arguments;return _regenerator["default"].wrap(function _callee368$(c){for(;;)switch(c.prev=c.next){case 0:(e=u.length>0&&u[0]!==undefined?u[0]:rr.getDefault()).services=new _(_.PROVIDES_FULL,_.ACCEPTS_FULL);c.next=4;return e.initPersistent();case 4:t=new y;c.next=7;return Bt.getFull("".concat(qn.NETWORK_NAME,"-"));case 7:n=c.sent;c.next=10;return Oe.getPersistent(n);case 10:r=c.sent;c.next=13;return je.getPersistent(n);case 13:a=c.sent;c.next=16;return pt.getPersistent(n,r,t,a);case 16:i=c.sent;s=new ct(i,r);o=new ur(i,e,t);return c.abrupt("return",new yt(i,s,o));case 20:case"end":return c.stop()}},_callee368)}));return function full(){return e.apply(this,arguments)}}()},{key:"light",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee369(){var e,t,n,r,a,i,s,o=arguments;return _regenerator["default"].wrap(function _callee369$(u){for(;;)switch(u.prev=u.next){case 0:(e=o.length>0&&o[0]!==undefined?o[0]:rr.getDefault()).services=new _(_.PROVIDES_LIGHT,_.ACCEPTS_LIGHT);u.next=4;return e.initPersistent();case 4:t=new y;u.next=7;return Bt.getLight("".concat(qn.NETWORK_NAME,"-"));case 7:n=u.sent;u.next=10;return Oe.getPersistent(n);case 10:r=u.sent;u.next=13;return vt.getPersistent(n,r,t);case 13:a=u.sent;i=new ct(a,r);s=new ur(a,e,t);return u.abrupt("return",new mt(a,i,s));case 17:case"end":return u.stop()}},_callee369)}));return function light(){return e.apply(this,arguments)}}()},{key:"nano",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee370(){var e,t,n,r,a,i=arguments;return _regenerator["default"].wrap(function _callee370$(s){for(;;)switch(s.prev=s.next){case 0:(e=i.length>0&&i[0]!==undefined?i[0]:rr.getDefault()).services=new _(_.PROVIDES_NANO,_.ACCEPTS_NANO);s.next=4;return e.initPersistent();case 4:t=new y;s.next=7;return new wt(t);case 7:n=s.sent;r=new Tt(n);a=new ur(n,e,t);return s.abrupt("return",new St(n,r,a));case 11:case"end":return s.stop()}},_callee370)}));return function nano(){return e.apply(this,arguments)}}()},{key:"pico",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee371(){var e,t,n,r,a,i=arguments;return _regenerator["default"].wrap(function _callee371$(s){for(;;)switch(s.prev=s.next){case 0:(e=i.length>0&&i[0]!==undefined?i[0]:rr.getDefault()).services=new _(_.PROVIDES_PICO,_.ACCEPTS_PICO);s.next=4;return e.initPersistent();case 4:t=new y;s.next=7;return new Et(t);case 7:n=s.sent;r=new Tt(n);a=new ur(n,e,t);return s.abrupt("return",new It(n,r,a));case 11:case"end":return s.stop()}},_callee371)}));return function pico(){return e.apply(this,arguments)}}()},{key:"volatileFull",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee372(){var e,t,n,r,a,i,s,o=arguments;return _regenerator["default"].wrap(function _callee372$(u){for(;;)switch(u.prev=u.next){case 0:(e=o.length>0&&o[0]!==undefined?o[0]:rr.getDefault()).services=new _(_.PROVIDES_FULL,_.ACCEPTS_FULL);u.next=4;return e.initVolatile();case 4:t=new y;u.next=7;return Oe.createVolatile();case 7:n=u.sent;u.next=10;return je.createVolatile();case 10:r=u.sent;u.next=13;return pt.createVolatile(n,t,r);case 13:a=u.sent;i=new ct(a,n);s=new ur(a,e,t);return u.abrupt("return",new yt(a,i,s));case 17:case"end":return u.stop()}},_callee372)}));return function volatileFull(){return e.apply(this,arguments)}}()},{key:"volatileLight",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee373(){var e,t,n,r,a,i,s=arguments;return _regenerator["default"].wrap(function _callee373$(o){for(;;)switch(o.prev=o.next){case 0:(e=s.length>0&&s[0]!==undefined?s[0]:rr.getDefault()).services=new _(_.PROVIDES_LIGHT,_.ACCEPTS_LIGHT);o.next=4;return e.initVolatile();case 4:t=new y;o.next=7;return Oe.createVolatile();case 7:n=o.sent;o.next=10;return vt.createVolatile(n,t);case 10:r=o.sent;a=new ct(r,n);i=new ur(r,e,t);return o.abrupt("return",new mt(r,a,i));case 14:case"end":return o.stop()}},_callee373)}));return function volatileLight(){return e.apply(this,arguments)}}()},{key:"volatileNano",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee374(){var e,t,n,r,a,i=arguments;return _regenerator["default"].wrap(function _callee374$(s){for(;;)switch(s.prev=s.next){case 0:(e=i.length>0&&i[0]!==undefined?i[0]:rr.getDefault()).services=new _(_.PROVIDES_NANO,_.ACCEPTS_NANO);s.next=4;return e.initVolatile();case 4:t=new y;s.next=7;return new wt(t);case 7:n=s.sent;r=new Tt(n);a=new ur(n,e,t);return s.abrupt("return",new St(n,r,a));case 11:case"end":return s.stop()}},_callee374)}));return function volatileNano(){return e.apply(this,arguments)}}()},{key:"volatilePico",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee375(){var e,t,n,r,a,i=arguments;return _regenerator["default"].wrap(function _callee375$(s){for(;;)switch(s.prev=s.next){case 0:(e=i.length>0&&i[0]!==undefined?i[0]:rr.getDefault()).services=new _(_.PROVIDES_PICO,_.ACCEPTS_PICO);s.next=4;return e.initVolatile();case 4:t=new y;s.next=7;return new Et(t);case 7:n=s.sent;r=new Tt(n);a=new ur(n,e,t);return s.abrupt("return",new It(n,r,a));case 11:case"end":return s.stop()}},_callee375)}));return function volatilePico(){return e.apply(this,arguments)}}()}]);return Consensus}();n.register(Nt);var Ot=function Protocol(){(0,_classCallCheck2["default"])(this,Protocol)};Ot.DUMB=0;Ot.WSS=1;Ot.RTC=2;Ot.WS=4;n.register(Ot);var Rt=function(){function Message(e){(0,_classCallCheck2["default"])(this,Message);if(!Y.isUint64(e))throw new Error("Malformed type");this._type=e}(0,_createClass2["default"])(Message,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);R.that(0===e.writePos,"Message.serialize() requires buf.writePos == 0");e.writeUint32(Message.MAGIC);e.writeVarUint(this._type);e.writeUint32(this.serializedSize);e.writeUint32(0);return e}},{key:"_setChecksum",value:function _setChecksum(e){var t=Q.compute(e);Message._writeChecksum(this._type,e,t)}},{key:"toString",value:function toString(){return"Message{type=".concat(this.type,", size=").concat(this.serializedSize,"}")}},{key:"serializedSize",get:function get(){return 4+U.varUintSize(this._type)+4+4}},{key:"type",get:function get(){return this._type}}],[{key:"peekType",value:function peekType(e){var t=e.readPos;e.readPos=4;var n=e.readVarUint();e.readPos=t;return n}},{key:"peekLength",value:function peekLength(e){var t=e.readPos;e.readPos=4;e.readVarUint();var n=e.readUint32();e.readPos=t;return n}},{key:"unserialize",value:function unserialize(e){R.that(0===e.readPos,"Message.unserialize() requires buf.readPos == 0");var t=e.readUint32(),n=e.readVarUint();e.readUint32();var r=e.readUint32();if(t!==Message.MAGIC)throw new Error("Malformed magic");Message._writeChecksum(n,e,0);if(r!==Q.compute(e))throw new Error("Invalid checksum");return new Message(n)}},{key:"_writeChecksum",value:function _writeChecksum(e,t,n){var r=t.writePos;t.writePos=4+U.varUintSize(e)+4;t.writeUint32(n);t.writePos=r}}]);return Message}();Rt.MAGIC=1107566658;Rt.Type={VERSION:0,INV:1,GET_DATA:2,GET_HEADER:3,NOT_FOUND:4,GET_BLOCKS:5,BLOCK:6,HEADER:7,TX:8,MEMPOOL:9,REJECT:10,SUBSCRIBE:11,ADDR:20,GET_ADDR:21,PING:22,PONG:23,SIGNAL:30,GET_CHAIN_PROOF:40,CHAIN_PROOF:41,GET_ACCOUNTS_PROOF:42,ACCOUNTS_PROOF:43,GET_ACCOUNTS_TREE_CHUNK:44,ACCOUNTS_TREE_CHUNK:45,GET_TRANSACTIONS_PROOF:47,GET_TRANSACTIONS_PROOF_BY_ADDRESSES:47,TRANSACTIONS_PROOF:48,GET_TRANSACTION_RECEIPTS:49,GET_TRANSACTION_RECEIPTS_BY_ADDRESS:49,TRANSACTION_RECEIPTS:50,GET_BLOCK_PROOF:51,BLOCK_PROOF:52,GET_TRANSACTIONS_PROOF_BY_HASHES:53,GET_TRANSACTION_RECEIPTS_BY_HASHES:54,GET_BLOCK_PROOF_AT:55,GET_HEAD:60,HEAD:61,VERACK:90};n.register(Rt);var Mt=function(e){(0,_inherits2["default"])(AddrMessage,e);var t=_createSuper(AddrMessage);function AddrMessage(e){var n;(0,_classCallCheck2["default"])(this,AddrMessage);n=t.call(this,Rt.Type.ADDR);if(!e||!Y.isUint16(e.length)||e.length>AddrMessage.ADDRESSES_MAX_COUNT||e.some(function(e){return!(e instanceof Pn)}))throw new Error("Malformed addresses");n._addresses=e;return n}(0,_createClass2["default"])(AddrMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(AddrMessage.prototype),"serialize",this).call(this,e);e.writeUint16(this._addresses.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._addresses);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}(0,_get10["default"])((0,_getPrototypeOf2["default"])(AddrMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"AddrMessage{size=".concat(this._addresses.length,"}")}},{key:"serializedSize",get:function get(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(AddrMessage.prototype),"serializedSize",this)+2,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._addresses);!(t=(a=i.next()).done);t=!0){e+=a.value.serializedSize}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"addresses",get:function get(){return this._addresses}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readUint16();if(t>AddrMessage.ADDRESSES_MAX_COUNT)throw new Error("Malformed count");for(var n=new Array(t),r=0;r<t;r++)n[r]=Pn.unserialize(e);return new AddrMessage(n)}}]);return AddrMessage}(Rt);Mt.ADDRESSES_MAX_COUNT=1e3;n.register(Mt);var Lt=function(e){(0,_inherits2["default"])(BlockMessage,e);var t=_createSuper(BlockMessage);function BlockMessage(e){var n;(0,_classCallCheck2["default"])(this,BlockMessage);(n=t.call(this,Rt.Type.BLOCK))._block=e;return n}(0,_createClass2["default"])(BlockMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(BlockMessage.prototype),"serialize",this).call(this,e);this._block.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(BlockMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"BlockMessage{height=".concat(this._block.height,", hash=").concat(this._block.hash(),"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(BlockMessage.prototype),"serializedSize",this)+this._block.serializedSize}},{key:"block",get:function get(){return this._block}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new BlockMessage(Je.unserialize(e))}}]);return BlockMessage}(Rt);n.register(Lt);var Dt=function(e){(0,_inherits2["default"])(RawBlockMessage,e);var t=_createSuper(RawBlockMessage);function RawBlockMessage(e){var n;(0,_classCallCheck2["default"])(this,RawBlockMessage);(n=t.call(this,Rt.Type.BLOCK))._block=e;return n}(0,_createClass2["default"])(RawBlockMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(RawBlockMessage.prototype),"serialize",this).call(this,e);e.write(this._block);(0,_get10["default"])((0,_getPrototypeOf2["default"])(RawBlockMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(RawBlockMessage.prototype),"serializedSize",this)+this._block.length}},{key:"block",get:function get(){return Je.unserialize(new U(this._block))}}]);return RawBlockMessage}(Rt);n.register(Dt);var Ut=function(e){(0,_inherits2["default"])(GetAddrMessage,e);var t=_createSuper(GetAddrMessage);function GetAddrMessage(e,n,r){var a;(0,_classCallCheck2["default"])(this,GetAddrMessage);a=t.call(this,Rt.Type.GET_ADDR);if(!Y.isUint8(e))throw new Error("Malformed protocolMask");if(!Y.isUint32(n))throw new Error("Malformed serviceMask");if(!Y.isUint16(r))throw new Error("Malformed maxResults");a._protocolMask=e;a._serviceMask=n;a._maxResults=r;return a}(0,_createClass2["default"])(GetAddrMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAddrMessage.prototype),"serialize",this).call(this,e);e.writeUint8(this._protocolMask);e.writeUint32(this._serviceMask);e.writeUint16(this._maxResults);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAddrMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"GetAddrMessage{protocol=".concat(this._protocolMask,", services=").concat(this._serviceMask,", maxResults=").concat(this._maxResults,"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAddrMessage.prototype),"serializedSize",this)+1+4+2}},{key:"protocolMask",get:function get(){return this._protocolMask}},{key:"serviceMask",get:function get(){return this._serviceMask}},{key:"maxResults",get:function get(){return this._maxResults}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readUint8(),n=e.readUint32(),r=Qn.NUM_ADDR_PER_REQUEST;e.readPos!==e.byteLength&&(r=e.readUint16());return new GetAddrMessage(t,n,r)}}]);return GetAddrMessage}(Rt);n.register(Ut);var zt=function(e){(0,_inherits2["default"])(GetBlocksMessage,e);var t=_createSuper(GetBlocksMessage);function GetBlocksMessage(e){var n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ft.VECTORS_MAX_COUNT,a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:GetBlocksMessage.Direction.FORWARD;(0,_classCallCheck2["default"])(this,GetBlocksMessage);n=t.call(this,Rt.Type.GET_BLOCKS);if(!e||!Y.isUint16(e.length)||e.length>GetBlocksMessage.LOCATORS_MAX_COUNT||e.some(function(e){return!ie.isHash(e)}))throw new Error("Malformed locators");if(!Y.isUint16(r))throw new Error("Malformed maxInvSize");if(!Y.isUint8(a))throw new Error("Malformed direction");n._locators=e;n._maxInvSize=r;n._direction=a;return n}(0,_createClass2["default"])(GetBlocksMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlocksMessage.prototype),"serialize",this).call(this,e);e.writeUint16(this._locators.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._locators);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}e.writeUint16(this._maxInvSize);e.writeUint8(this._direction);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlocksMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"GetBlocksMessage{direction=".concat(this._direction===GetBlocksMessage.Direction.FORWARD?"forward":"backward",", maxInvSize=").concat(this._maxInvSize,"}")}},{key:"serializedSize",get:function get(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlocksMessage.prototype),"serializedSize",this)+2+1+2,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._locators);!(t=(a=i.next()).done);t=!0){e+=a.value.serializedSize}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"locators",get:function get(){return this._locators}},{key:"direction",get:function get(){return this._direction}},{key:"maxInvSize",get:function get(){return this._maxInvSize}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readUint16();if(t>GetBlocksMessage.LOCATORS_MAX_COUNT)throw new Error("Malformed count");for(var n=new Array(t),r=0;r<t;r++)n[r]=ie.unserialize(e);return new GetBlocksMessage(n,e.readUint16(),e.readUint8())}}]);return GetBlocksMessage}(Rt);zt.Direction={FORWARD:1,BACKWARD:2};zt.LOCATORS_MAX_COUNT=128;n.register(zt);var Ht=function(e){(0,_inherits2["default"])(HeaderMessage,e);var t=_createSuper(HeaderMessage);function HeaderMessage(e){var n;(0,_classCallCheck2["default"])(this,HeaderMessage);(n=t.call(this,Rt.Type.HEADER))._header=e;return n}(0,_createClass2["default"])(HeaderMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(HeaderMessage.prototype),"serialize",this).call(this,e);this._header.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(HeaderMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"HeaderMessage{height=".concat(this._header.height,", hash=").concat(this._header.hash(),"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(HeaderMessage.prototype),"serializedSize",this)+this._header.serializedSize}},{key:"header",get:function get(){return this._header}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new HeaderMessage(Re.unserialize(e))}}]);return HeaderMessage}(Rt);n.register(Ht);var Gt=function(){(0,_createClass2["default"])(InvVector,null,[{key:"fromBlock",value:function fromBlock(e){var t=e.hash();return new InvVector(InvVector.Type.BLOCK,t)}},{key:"fromHeader",value:function fromHeader(e){var t=e.hash();return new InvVector(InvVector.Type.BLOCK,t)}},{key:"fromTransaction",value:function fromTransaction(e){var t=e.hash();return new InvVector(InvVector.Type.TRANSACTION,t)}}]);function InvVector(e,t){(0,_classCallCheck2["default"])(this,InvVector);if(!ie.isHash(t))throw new Error("Malformed hash");this._type=e;this._hash=t}(0,_createClass2["default"])(InvVector,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint32(this._type);this._hash.serialize(e);return e}},{key:"equals",value:function equals(e){return e instanceof InvVector&&this._type===e.type&&this._hash.equals(e.hash)}},{key:"hashCode",value:function hashCode(){return"".concat(this._type,"|").concat(this._hash.toBase64())}},{key:"toString",value:function toString(){return"InvVector{type=".concat(this._type,", hash=").concat(this._hash,"}")}},{key:"serializedSize",get:function get(){return 4+this._hash.serializedSize}},{key:"type",get:function get(){return this._type}},{key:"hash",get:function get(){return this._hash}}],[{key:"unserialize",value:function unserialize(e){var t=InvVector.Type.unserialize(e);return new InvVector(t,ie.unserialize(e))}}]);return InvVector}();Gt.Type={ERROR:0,TRANSACTION:1,BLOCK:2,unserialize:function unserialize(e){return e.readUint32()}};n.register(Gt);var Ft=function(e){(0,_inherits2["default"])(BaseInventoryMessage,e);var t=_createSuper(BaseInventoryMessage);function BaseInventoryMessage(e,n){var r;(0,_classCallCheck2["default"])(this,BaseInventoryMessage);r=t.call(this,e);if(!(0,_isArray["default"])(n)||!Y.isUint16(n.length)||n.length>BaseInventoryMessage.VECTORS_MAX_COUNT||n.some(function(e){return!(e instanceof Gt)}))throw new Error("Malformed vectors");r._vectors=n;return r}(0,_createClass2["default"])(BaseInventoryMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(BaseInventoryMessage.prototype),"serialize",this).call(this,e);e.writeUint16(this._vectors.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._vectors);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}(0,_get10["default"])((0,_getPrototypeOf2["default"])(BaseInventoryMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"InventoryMessage";return"".concat(e,"{transactions=").concat(this._vectors.filter(function(e){return e.type===Gt.Type.TRANSACTION}).length,", blocks=").concat(this._vectors.filter(function(e){return e.type===Gt.Type.BLOCK}).length,"}")}},{key:"serializedSize",get:function get(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(BaseInventoryMessage.prototype),"serializedSize",this)+2,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._vectors);!(t=(a=i.next()).done);t=!0){e+=a.value.serializedSize}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"vectors",get:function get(){return this._vectors}}]);return BaseInventoryMessage}(Rt);Ft.VECTORS_MAX_COUNT=1e3;n.register(Ft);var Kt=function(e){(0,_inherits2["default"])(InvMessage,e);var t=_createSuper(InvMessage);function InvMessage(e){(0,_classCallCheck2["default"])(this,InvMessage);return t.call(this,Rt.Type.INV,e)}(0,_createClass2["default"])(InvMessage,[{key:"toString",value:function toString(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(InvMessage.prototype),"toString",this).call(this,"InvMessage")}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readUint16();if(t>Ft.VECTORS_MAX_COUNT)throw new Error("Malformed count");for(var n=new Array(t),r=0;r<t;r++)n[r]=Gt.unserialize(e);return new InvMessage(n)}}]);return InvMessage}(Ft);n.register(Kt);var qt=function(e){(0,_inherits2["default"])(GetDataMessage,e);var t=_createSuper(GetDataMessage);function GetDataMessage(e){(0,_classCallCheck2["default"])(this,GetDataMessage);return t.call(this,Rt.Type.GET_DATA,e)}(0,_createClass2["default"])(GetDataMessage,[{key:"toString",value:function toString(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetDataMessage.prototype),"toString",this).call(this,"GetDataMessage")}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readUint16();if(t>Ft.VECTORS_MAX_COUNT)throw new Error("Malformed count");for(var n=new Array(t),r=0;r<t;r++)n[r]=Gt.unserialize(e);return new GetDataMessage(n)}}]);return GetDataMessage}(Ft);n.register(qt);var Wt=function(e){(0,_inherits2["default"])(GetHeaderMessage,e);var t=_createSuper(GetHeaderMessage);function GetHeaderMessage(e){(0,_classCallCheck2["default"])(this,GetHeaderMessage);return t.call(this,Rt.Type.GET_HEADER,e)}(0,_createClass2["default"])(GetHeaderMessage,[{key:"toString",value:function toString(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetHeaderMessage.prototype),"toString",this).call(this,"GetHeaderMessage")}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readUint16();if(t>Ft.VECTORS_MAX_COUNT)throw new Error("Malformed count");for(var n=new Array(t),r=0;r<t;r++)n[r]=Gt.unserialize(e);return new GetHeaderMessage(n)}}]);return GetHeaderMessage}(Ft);n.register(Wt);var jt=function(e){(0,_inherits2["default"])(NotFoundMessage,e);var t=_createSuper(NotFoundMessage);function NotFoundMessage(e){(0,_classCallCheck2["default"])(this,NotFoundMessage);return t.call(this,Rt.Type.NOT_FOUND,e)}(0,_createClass2["default"])(NotFoundMessage,[{key:"toString",value:function toString(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(NotFoundMessage.prototype),"toString",this).call(this,"NotFoundMessage")}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readUint16();if(t>Ft.VECTORS_MAX_COUNT)throw new Error("Malformed count");for(var n=new Array(t),r=0;r<t;r++)n[r]=Gt.unserialize(e);return new NotFoundMessage(n)}}]);return NotFoundMessage}(Ft);n.register(jt);var Vt=function(e){(0,_inherits2["default"])(MempoolMessage,e);var t=_createSuper(MempoolMessage);function MempoolMessage(){(0,_classCallCheck2["default"])(this,MempoolMessage);return t.call(this,Rt.Type.MEMPOOL)}(0,_createClass2["default"])(MempoolMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(MempoolMessage.prototype),"serialize",this).call(this,e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(MempoolMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"MempoolMessage{}"}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(MempoolMessage.prototype),"serializedSize",this)}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new MempoolMessage}}]);return MempoolMessage}(Rt);n.register(Vt);var Qt=function(e){(0,_inherits2["default"])(PingMessage,e);var t=_createSuper(PingMessage);function PingMessage(e){var n;(0,_classCallCheck2["default"])(this,PingMessage);n=t.call(this,Rt.Type.PING);if(!Y.isUint32(e))throw new Error("Malformed nonce");n._nonce=e;return n}(0,_createClass2["default"])(PingMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(PingMessage.prototype),"serialize",this).call(this,e);e.writeUint32(this._nonce);(0,_get10["default"])((0,_getPrototypeOf2["default"])(PingMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"PingMessage{nonce=".concat(this._nonce,"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(PingMessage.prototype),"serializedSize",this)+4}},{key:"nonce",get:function get(){return this._nonce}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new PingMessage(e.readUint32())}}]);return PingMessage}(Rt);n.register(Qt);var Jt=function(e){(0,_inherits2["default"])(PongMessage,e);var t=_createSuper(PongMessage);function PongMessage(e){var n;(0,_classCallCheck2["default"])(this,PongMessage);n=t.call(this,Rt.Type.PONG);if(!Y.isUint32(e))throw new Error("Malformed nonce");n._nonce=e;return n}(0,_createClass2["default"])(PongMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(PongMessage.prototype),"serialize",this).call(this,e);e.writeUint32(this._nonce);(0,_get10["default"])((0,_getPrototypeOf2["default"])(PongMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"PongMessage{nonce=".concat(this._nonce,"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(PongMessage.prototype),"serializedSize",this)+4}},{key:"nonce",get:function get(){return this._nonce}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new PongMessage(e.readUint32())}}]);return PongMessage}(Rt);n.register(Jt);var Yt=function(e){(0,_inherits2["default"])(RejectMessage,e);var t=_createSuper(RejectMessage);function RejectMessage(e,n,r){var a,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new Uint8Array(0);(0,_classCallCheck2["default"])(this,RejectMessage);a=t.call(this,Rt.Type.REJECT);if(!Y.isUint64(e))throw new Error("Malformed type");if(!Y.isUint8(n))throw new Error("Malformed code");if(ne.isMultibyte(r)||r.length>255)throw new Error("Malformed reason");if(!(i instanceof Uint8Array&&Y.isUint16(i.byteLength)))throw new Error("Malformed extraData");a._messageType=e;a._code=n;a._reason=r;a._extraData=i;return a}(0,_createClass2["default"])(RejectMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(RejectMessage.prototype),"serialize",this).call(this,e);e.writeVarUint(this._messageType);e.writeUint8(this._code);e.writeVarLengthString(this._reason);e.writeUint16(this._extraData.byteLength);e.write(this._extraData);(0,_get10["default"])((0,_getPrototypeOf2["default"])(RejectMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"RejectMessage{type=".concat(this._messageType,", code=").concat(this._code,", reason=").concat(this._reason,"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(RejectMessage.prototype),"serializedSize",this)+U.varUintSize(this._messageType)+1+U.varLengthStringSize(this._reason)+2+this._extraData.byteLength}},{key:"messageType",get:function get(){return this._messageType}},{key:"code",get:function get(){return this._code}},{key:"reason",get:function get(){return this._reason}},{key:"extraData",get:function get(){return this._extraData}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readVarUint(),n=e.readUint8(),r=e.readVarLengthString(),a=e.readUint16();return new RejectMessage(t,n,r,e.read(a))}}]);return RejectMessage}(Rt);Yt.Code={REJECT_MALFORMED:1,REJECT_INVALID:16,REJECT_OBSOLETE:17,REJECT_DOUBLE:18,REJECT_DUST:65,REJECT_INSUFFICIENT_FEE:66};n.register(Yt);var Xt=function(e){(0,_inherits2["default"])(SignalMessage,e);var t=_createSuper(SignalMessage);function SignalMessage(e,n,r,a){var i,s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0,o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:new Uint8Array(0),u=arguments.length>6?arguments[6]:undefined,c=arguments.length>7?arguments[7]:undefined;(0,_classCallCheck2["default"])(this,SignalMessage);i=t.call(this,Rt.Type.SIGNAL);if(!(e instanceof Bn))throw new Error("Malformed senderId");if(!(n instanceof Bn))throw new Error("Malformed recipientId");if(!Y.isUint32(r))throw new Error("Malformed nonce");if(!Y.isUint8(a))throw new Error("Malformed ttl");if(!Y.isUint8(s))throw new Error("Malformed flags");if(!(o instanceof Uint8Array&&Y.isUint16(o.byteLength)))throw new Error("Malformed payload");var l=o.byteLength>0;if(l&&!(c instanceof de))throw new Error("Malformed signature");if(l&&!(u instanceof ue))throw new Error("Malformed public key");i._senderId=e;i._recipientId=n;i._nonce=r;i._ttl=a;i._flags=s;i._payload=o;i._senderPubKey=l?u:undefined;i._signature=l?c:undefined;return i}(0,_createClass2["default"])(SignalMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(SignalMessage.prototype),"serialize",this).call(this,e);this._senderId.serialize(e);this._recipientId.serialize(e);e.writeUint32(this._nonce);e.writeUint8(this._ttl);e.writeUint8(this._flags);e.writeUint16(this._payload.byteLength);e.write(this._payload);if(this._payload.byteLength>0){this._senderPubKey.serialize(e);this._signature.serialize(e)}(0,_get10["default"])((0,_getPrototypeOf2["default"])(SignalMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"verifySignature",value:function verifySignature(){return!!this._signature&&(this._signature.verify(this._senderPubKey,this._payload)&&this._senderId.equals(this._senderPubKey.toPeerId()))}},{key:"hasPayload",value:function hasPayload(){return this._payload.byteLength>0}},{key:"isUnroutable",value:function isUnroutable(){return 0!=(this._flags&SignalMessage.Flag.UNROUTABLE)}},{key:"isTtlExceeded",value:function isTtlExceeded(){return 0!=(this._flags&SignalMessage.Flag.TTL_EXCEEDED)}},{key:"toString",value:function toString(){return"SignalMessage{sender=".concat(this._senderId,", recipient=").concat(this._recipientId,", nonce=").concat(this._nonce,", ttl=").concat(this._ttl,", flags=").concat(this._flags,"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(SignalMessage.prototype),"serializedSize",this)+this._senderId.serializedSize+this._recipientId.serializedSize+4+1+1+2+this._payload.byteLength+(this._payload.byteLength>0?this._senderPubKey.serializedSize:0)+(this._payload.byteLength>0?this._signature.serializedSize:0)}},{key:"senderId",get:function get(){return this._senderId}},{key:"recipientId",get:function get(){return this._recipientId}},{key:"nonce",get:function get(){return this._nonce}},{key:"ttl",get:function get(){return this._ttl}},{key:"flags",get:function get(){return this._flags}},{key:"payload",get:function get(){return this._payload}},{key:"signature",get:function get(){return this._signature}},{key:"senderPubKey",get:function get(){return this._senderPubKey}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=Bn.unserialize(e),n=Bn.unserialize(e),r=e.readUint32(),a=e.readUint8(),i=e.readUint8(),s=e.readUint16();return new SignalMessage(t,n,r,a,i,e.read(s),s>0?ue.unserialize(e):undefined,s>0?de.unserialize(e):undefined)}}]);return SignalMessage}(Rt);Xt.Flag={UNROUTABLE:1,TTL_EXCEEDED:2};n.register(Xt);var Zt=function(e){(0,_inherits2["default"])(SubscribeMessage,e);var t=_createSuper(SubscribeMessage);function SubscribeMessage(e){var n;(0,_classCallCheck2["default"])(this,SubscribeMessage);(n=t.call(this,Rt.Type.SUBSCRIBE))._subscription=e;return n}(0,_createClass2["default"])(SubscribeMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(SubscribeMessage.prototype),"serialize",this).call(this,e);this._subscription.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(SubscribeMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"SubscribeMessage{".concat(this._subscription,"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(SubscribeMessage.prototype),"serializedSize",this)+this._subscription.serializedSize}},{key:"subscription",get:function get(){return this._subscription}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new SubscribeMessage(Ue.unserialize(e))}}]);return SubscribeMessage}(Rt);n.register(Zt);var $t=function(e){(0,_inherits2["default"])(TxMessage,e);var t=_createSuper(TxMessage);function TxMessage(e,n){var r;(0,_classCallCheck2["default"])(this,TxMessage);(r=t.call(this,Rt.Type.TX))._transaction=e;r._accountsProof=n;return r}(0,_createClass2["default"])(TxMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(TxMessage.prototype),"serialize",this).call(this,e);this._transaction.serialize(e);e.writeUint8(this._accountsProof?1:0);this._accountsProof&&this._accountsProof.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(TxMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"TxMessage{hash=".concat(this._transaction.hash(),"}")}},{key:"serializedSize",get:function get(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(TxMessage.prototype),"serializedSize",this)+this._transaction.serializedSize+1;this._accountsProof&&(e+=this._accountsProof.serializedSize);return e}},{key:"transaction",get:function get(){return this._transaction}},{key:"hasAccountsProof",get:function get(){return!!this._accountsProof}},{key:"accountsProof",get:function get(){return this._accountsProof}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=ze.unserialize(e);if(1===e.readUint8()){return new TxMessage(t,xe.unserialize(e))}return new TxMessage(t)}}]);return TxMessage}(Rt);n.register($t);var en=function(e){(0,_inherits2["default"])(VersionMessage,e);var t=_createSuper(VersionMessage);function VersionMessage(e,n,r,a,i,s){var o;(0,_classCallCheck2["default"])(this,VersionMessage);o=t.call(this,Rt.Type.VERSION);if(!Y.isUint32(e))throw new Error("Malformed version");if(!(n instanceof Pn))throw new Error("Malformed peerAddress");if(!ie.isHash(r))throw new Error("Malformed genesisHash");if(!ie.isHash(a))throw new Error("Malformed headHash");if(!(i instanceof Uint8Array)||32!==i.byteLength)throw new Error("Malformed challenge nonce");if(s&&("string"!=typeof s||ne.isMultibyte(s)||!Y.isUint8(s.length)))throw new Error("Malformed user agent");o._version=e;o._peerAddress=n;o._genesisHash=r;o._headHash=a;o._challengeNonce=i;o._userAgent=s;return o}(0,_createClass2["default"])(VersionMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(VersionMessage.prototype),"serialize",this).call(this,e);e.writeUint32(this._version);this._peerAddress.serialize(e);this._genesisHash.serialize(e);this._headHash.serialize(e);e.write(this._challengeNonce);this._userAgent&&e.writeVarLengthString(this._userAgent);(0,_get10["default"])((0,_getPrototypeOf2["default"])(VersionMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"VersionMessage{version=".concat(this._version,", peer=").concat(this._peerAddress,", genesis=").concat(this._genesisHash,", head=").concat(this._headHash,", userAgent=").concat(this._userAgent,"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(VersionMessage.prototype),"serializedSize",this)+4+this._peerAddress.serializedSize+this._genesisHash.serializedSize+this._headHash.serializedSize+VersionMessage.CHALLENGE_SIZE+(this._userAgent?U.varLengthStringSize(this._userAgent):0)}},{key:"version",get:function get(){return this._version}},{key:"peerAddress",get:function get(){return this._peerAddress}},{key:"genesisHash",get:function get(){return this._genesisHash}},{key:"headHash",get:function get(){return this._headHash}},{key:"challengeNonce",get:function get(){return this._challengeNonce}},{key:"userAgent",get:function get(){return this._userAgent}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new VersionMessage(e.readUint32(),Pn.unserialize(e),ie.unserialize(e),ie.unserialize(e),e.read(VersionMessage.CHALLENGE_SIZE),e.readPos!==e.byteLength?e.readVarLengthString():undefined)}}]);return VersionMessage}(Rt);en.CHALLENGE_SIZE=32;n.register(en);var tn=function(e){(0,_inherits2["default"])(VerAckMessage,e);var t=_createSuper(VerAckMessage);function VerAckMessage(e,n){var r;(0,_classCallCheck2["default"])(this,VerAckMessage);(r=t.call(this,Rt.Type.VERACK))._publicKey=e;r._signature=n;return r}(0,_createClass2["default"])(VerAckMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(VerAckMessage.prototype),"serialize",this).call(this,e);this.publicKey.serialize(e);this.signature.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(VerAckMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"VerAckMessage{}"}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(VerAckMessage.prototype),"serializedSize",this)+this._publicKey.serializedSize+this._signature.serializedSize}},{key:"publicKey",get:function get(){return this._publicKey}},{key:"signature",get:function get(){return this._signature}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new VerAckMessage(ue.unserialize(e),de.unserialize(e))}}]);return VerAckMessage}(Rt);n.register(tn);var nn=function(e){(0,_inherits2["default"])(AccountsProofMessage,e);var t=_createSuper(AccountsProofMessage);function AccountsProofMessage(e){var n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;(0,_classCallCheck2["default"])(this,AccountsProofMessage);n=t.call(this,Rt.Type.ACCOUNTS_PROOF);if(!(e instanceof ie))throw new Error("Malformed blockHash");if(r&&!(r instanceof xe))throw new Error("Malformed proof");n._blockHash=e;n._accountsProof=r;return n}(0,_createClass2["default"])(AccountsProofMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(AccountsProofMessage.prototype),"serialize",this).call(this,e);this._blockHash.serialize(e);e.writeUint8(this.hasProof()?1:0);this.hasProof()&&this._accountsProof.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(AccountsProofMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"hasProof",value:function hasProof(){return!!this._accountsProof}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(AccountsProofMessage.prototype),"serializedSize",this)+1+this._blockHash.serializedSize+(this.hasProof()?this._accountsProof.serializedSize:0)}},{key:"blockHash",get:function get(){return this._blockHash}},{key:"proof",get:function get(){return this._accountsProof}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=ie.unserialize(e),n=null;0!==e.readUint8()&&(n=xe.unserialize(e));return new AccountsProofMessage(t,n)}}]);return AccountsProofMessage}(Rt);n.register(nn);var rn=function(e){(0,_inherits2["default"])(GetAccountsProofMessage,e);var t=_createSuper(GetAccountsProofMessage);function GetAccountsProofMessage(e,n){var r;(0,_classCallCheck2["default"])(this,GetAccountsProofMessage);r=t.call(this,Rt.Type.GET_ACCOUNTS_PROOF);if(!(e&&e instanceof ie))throw new Error("Malformed block hash");if(!n||!Y.isUint16(n.length)||n.length<1||n.length>GetAccountsProofMessage.ADDRESSES_MAX_COUNT||n.some(function(e){return!(e instanceof ge)}))throw new Error("Malformed addresses");r._blockHash=e;r._addresses=n;return r}(0,_createClass2["default"])(GetAccountsProofMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAccountsProofMessage.prototype),"serialize",this).call(this,e);this._blockHash.serialize(e);e.writeUint16(this._addresses.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._addresses);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAccountsProofMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAccountsProofMessage.prototype),"serializedSize",this)+this._blockHash.serializedSize+2+this._addresses.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"addresses",get:function get(){return this._addresses}},{key:"blockHash",get:function get(){return this._blockHash}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);for(var t=ie.unserialize(e),n=e.readUint16(),r=[],a=0;a<n;a++)r.push(ge.unserialize(e));return new GetAccountsProofMessage(t,r)}}]);return GetAccountsProofMessage}(Rt);rn.ADDRESSES_MAX_COUNT=256;n.register(rn);var an=function(e){(0,_inherits2["default"])(ChainProofMessage,e);var t=_createSuper(ChainProofMessage);function ChainProofMessage(e){var n;(0,_classCallCheck2["default"])(this,ChainProofMessage);n=t.call(this,Rt.Type.CHAIN_PROOF);if(!(e instanceof tt))throw new Error("Malformed chainProof");n._proof=e;return n}(0,_createClass2["default"])(ChainProofMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(ChainProofMessage.prototype),"serialize",this).call(this,e);this._proof.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(ChainProofMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(ChainProofMessage.prototype),"serializedSize",this)+this._proof.serializedSize}},{key:"proof",get:function get(){return this._proof}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new ChainProofMessage(tt.unserialize(e))}}]);return ChainProofMessage}(Rt);n.register(an);var sn=function(e){(0,_inherits2["default"])(GetChainProofMessage,e);var t=_createSuper(GetChainProofMessage);function GetChainProofMessage(){(0,_classCallCheck2["default"])(this,GetChainProofMessage);return t.call(this,Rt.Type.GET_CHAIN_PROOF)}(0,_createClass2["default"])(GetChainProofMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetChainProofMessage.prototype),"serialize",this).call(this,e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetChainProofMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetChainProofMessage.prototype),"serializedSize",this)}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new GetChainProofMessage}}]);return GetChainProofMessage}(Rt);n.register(sn);var on=function(e){(0,_inherits2["default"])(AccountsTreeChunkMessage,e);var t=_createSuper(AccountsTreeChunkMessage);function AccountsTreeChunkMessage(e){var n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;(0,_classCallCheck2["default"])(this,AccountsTreeChunkMessage);n=t.call(this,Rt.Type.ACCOUNTS_TREE_CHUNK);if(!(e instanceof ie))throw new Error("Malformed blockHash");if(r&&!(r instanceof Ie))throw new Error("Malformed chunk");n._blockHash=e;n._accountsTreeChunk=r;return n}(0,_createClass2["default"])(AccountsTreeChunkMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(AccountsTreeChunkMessage.prototype),"serialize",this).call(this,e);this._blockHash.serialize(e);e.writeUint8(this.hasChunk()?1:0);this.hasChunk()&&this._accountsTreeChunk.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(AccountsTreeChunkMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"hasChunk",value:function hasChunk(){return!!this._accountsTreeChunk}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(AccountsTreeChunkMessage.prototype),"serializedSize",this)+1+this._blockHash.serializedSize+(this.hasChunk()?this._accountsTreeChunk.serializedSize:0)}},{key:"blockHash",get:function get(){return this._blockHash}},{key:"chunk",get:function get(){return this._accountsTreeChunk}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=ie.unserialize(e),n=null;0!==e.readUint8()&&(n=Ie.unserialize(e));return new AccountsTreeChunkMessage(t,n)}}]);return AccountsTreeChunkMessage}(Rt);n.register(on);var un=function(e){(0,_inherits2["default"])(GetAccountsTreeChunkMessage,e);var t=_createSuper(GetAccountsTreeChunkMessage);function GetAccountsTreeChunkMessage(e,n){var r;(0,_classCallCheck2["default"])(this,GetAccountsTreeChunkMessage);r=t.call(this,Rt.Type.GET_ACCOUNTS_TREE_CHUNK);if(!(e&&e instanceof ie))throw new Error("Malformed block hash");if(ne.isMultibyte(n)||!Y.isUint8(n.length))throw new Error("Malformed start prefix");r._blockHash=e;r._startPrefix=n;return r}(0,_createClass2["default"])(GetAccountsTreeChunkMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAccountsTreeChunkMessage.prototype),"serialize",this).call(this,e);this._blockHash.serialize(e);e.writeVarLengthString(this._startPrefix);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAccountsTreeChunkMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetAccountsTreeChunkMessage.prototype),"serializedSize",this)+this._blockHash.serializedSize+U.varLengthStringSize(this._startPrefix)}},{key:"blockHash",get:function get(){return this._blockHash}},{key:"startPrefix",get:function get(){return this._startPrefix}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new GetAccountsTreeChunkMessage(ie.unserialize(e),e.readVarLengthString())}}]);return GetAccountsTreeChunkMessage}(Rt);n.register(un);var cn=function(e){(0,_inherits2["default"])(TransactionsProofMessage,e);var t=_createSuper(TransactionsProofMessage);function TransactionsProofMessage(e){var n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;(0,_classCallCheck2["default"])(this,TransactionsProofMessage);n=t.call(this,Rt.Type.TRANSACTIONS_PROOF);if(!(e instanceof ie))throw new Error("Malformed blockHash");if(r&&!(r instanceof Ke))throw new Error("Malformed proof");n._blockHash=e;n._proof=r;return n}(0,_createClass2["default"])(TransactionsProofMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(TransactionsProofMessage.prototype),"serialize",this).call(this,e);this._blockHash.serialize(e);e.writeUint8(this.hasProof()?1:0);this.hasProof()&&this._proof.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(TransactionsProofMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"hasProof",value:function hasProof(){return!!this._proof}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(TransactionsProofMessage.prototype),"serializedSize",this)+1+this._blockHash.serializedSize+(this.hasProof()?this._proof.serializedSize:0)}},{key:"blockHash",get:function get(){return this._blockHash}},{key:"proof",get:function get(){return this._proof}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=ie.unserialize(e),n=null;0!==e.readUint8()&&(n=Ke.unserialize(e));return new TransactionsProofMessage(t,n)}}]);return TransactionsProofMessage}(Rt);n.register(cn);var ln=function(e){(0,_inherits2["default"])(GetTransactionsProofByAddressesMessage,e);var t=_createSuper(GetTransactionsProofByAddressesMessage);function GetTransactionsProofByAddressesMessage(e,n){var r;(0,_classCallCheck2["default"])(this,GetTransactionsProofByAddressesMessage);r=t.call(this,Rt.Type.GET_TRANSACTIONS_PROOF_BY_ADDRESSES);if(!(e&&e instanceof ie))throw new Error("Malformed block hash");if(!(0,_isArray["default"])(n)||!Y.isUint16(n.length)||n.length>GetTransactionsProofByAddressesMessage.ADDRESSES_MAX_COUNT||n.some(function(e){return!(e instanceof ge)}))throw new Error("Malformed addresses");r._blockHash=e;r._addresses=n;return r}(0,_createClass2["default"])(GetTransactionsProofByAddressesMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionsProofByAddressesMessage.prototype),"serialize",this).call(this,e);this._blockHash.serialize(e);e.writeUint16(this._addresses.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._addresses);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionsProofByAddressesMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionsProofByAddressesMessage.prototype),"serializedSize",this)+this._blockHash.serializedSize+2+this._addresses.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"addresses",get:function get(){return this._addresses}},{key:"blockHash",get:function get(){return this._blockHash}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=ie.unserialize(e),n=e.readUint16();if(n>GetTransactionsProofByAddressesMessage.ADDRESSES_MAX_COUNT)throw new Error("Malformed count");for(var r=new Array(n),a=0;a<n;a++)r[a]=ge.unserialize(e);return new GetTransactionsProofByAddressesMessage(t,r)}}]);return GetTransactionsProofByAddressesMessage}(Rt);ln.ADDRESSES_MAX_COUNT=255;n.register(ln);var hn=function(e){(0,_inherits2["default"])(GetTransactionsProofByHashesMessage,e);var t=_createSuper(GetTransactionsProofByHashesMessage);function GetTransactionsProofByHashesMessage(e,n){var r;(0,_classCallCheck2["default"])(this,GetTransactionsProofByHashesMessage);r=t.call(this,Rt.Type.GET_TRANSACTIONS_PROOF_BY_HASHES);if(!(e&&e instanceof ie))throw new Error("Malformed block hash");if(!(0,_isArray["default"])(n)||0===n.length||!Y.isUint16(n.length)||n.length>GetTransactionsProofByHashesMessage.HASHES_MAX_COUNT||n.some(function(e){return!(e instanceof ie)}))throw new Error("Malformed hashes");r._blockHash=e;r._hashes=n;return r}(0,_createClass2["default"])(GetTransactionsProofByHashesMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionsProofByHashesMessage.prototype),"serialize",this).call(this,e);this._blockHash.serialize(e);e.writeUint16(this._hashes.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._hashes);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionsProofByHashesMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionsProofByHashesMessage.prototype),"serializedSize",this)+this._blockHash.serializedSize+2+this._hashes.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"hashes",get:function get(){return this._hashes}},{key:"blockHash",get:function get(){return this._blockHash}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=ie.unserialize(e),n=e.readUint16();if(n>GetTransactionsProofByHashesMessage.HASHES_MAX_COUNT)throw new Error("Malformed count");for(var r=new Array(n),a=0;a<n;a++)r[a]=ie.unserialize(e);return new GetTransactionsProofByHashesMessage(t,r)}}]);return GetTransactionsProofByHashesMessage}(Rt);hn.HASHES_MAX_COUNT=255;n.register(hn);var fn=function(e){(0,_inherits2["default"])(GetTransactionReceiptsByAddressMessage,e);var t=_createSuper(GetTransactionReceiptsByAddressMessage);function GetTransactionReceiptsByAddressMessage(e){var n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;(0,_classCallCheck2["default"])(this,GetTransactionReceiptsByAddressMessage);n=t.call(this,Rt.Type.GET_TRANSACTION_RECEIPTS_BY_ADDRESS);if(!(e instanceof ge))throw new Error("Malformed address");if(!Y.isUint32(r))throw new Error("Malformed offset");n._address=e;n._offset=r;return n}(0,_createClass2["default"])(GetTransactionReceiptsByAddressMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionReceiptsByAddressMessage.prototype),"serialize",this).call(this,e);this._address.serialize(e);e.writeUint32(this._offset);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionReceiptsByAddressMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionReceiptsByAddressMessage.prototype),"serializedSize",this)+this._address.serializedSize+4}},{key:"address",get:function get(){return this._address}},{key:"offset",get:function get(){return this._offset}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new GetTransactionReceiptsByAddressMessage(ge.unserialize(e),e.readUint32())}}]);return GetTransactionReceiptsByAddressMessage}(Rt);n.register(fn);var dn=function(e){(0,_inherits2["default"])(GetTransactionReceiptsByHashesMessage,e);var t=_createSuper(GetTransactionReceiptsByHashesMessage);function GetTransactionReceiptsByHashesMessage(e){var n;(0,_classCallCheck2["default"])(this,GetTransactionReceiptsByHashesMessage);n=t.call(this,Rt.Type.GET_TRANSACTION_RECEIPTS_BY_HASHES);if(!(0,_isArray["default"])(e)||0===e.length||!Y.isUint16(e.length)||e.length>GetTransactionReceiptsByHashesMessage.HASHES_MAX_COUNT||e.some(function(e){return!(e instanceof ie)}))throw new Error("Malformed hashes");n._hashes=e;return n}(0,_createClass2["default"])(GetTransactionReceiptsByHashesMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionReceiptsByHashesMessage.prototype),"serialize",this).call(this,e);e.writeUint16(this._hashes.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._hashes);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionReceiptsByHashesMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetTransactionReceiptsByHashesMessage.prototype),"serializedSize",this)+2+this._hashes.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"hashes",get:function get(){return this._hashes}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=e.readUint16();if(t>GetTransactionReceiptsByHashesMessage.HASHES_MAX_COUNT)throw new Error("Malformed count");for(var n=new Array(t),r=0;r<t;r++)n[r]=ie.unserialize(e);return new GetTransactionReceiptsByHashesMessage(n)}}]);return GetTransactionReceiptsByHashesMessage}(Rt);dn.HASHES_MAX_COUNT=255;n.register(dn);var An=function(e){(0,_inherits2["default"])(TransactionReceiptsMessage,e);var t=_createSuper(TransactionReceiptsMessage);function TransactionReceiptsMessage(){var e,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;(0,_classCallCheck2["default"])(this,TransactionReceiptsMessage);e=t.call(this,Rt.Type.TRANSACTION_RECEIPTS);if(n&&(!(0,_isArray["default"])(n)||!Y.isUint16(n.length)||n.length>TransactionReceiptsMessage.RECEIPTS_MAX_COUNT||n.some(function(e){return!(e instanceof Qe)})))throw new Error("Malformed receipts");e._receipts=n;return e}(0,_createClass2["default"])(TransactionReceiptsMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(TransactionReceiptsMessage.prototype),"serialize",this).call(this,e);e.writeUint8(this.hasReceipts()?1:0);if(this.hasReceipts()){e.writeUint16(this._receipts.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._receipts);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}(0,_get10["default"])((0,_getPrototypeOf2["default"])(TransactionReceiptsMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"hasReceipts",value:function hasReceipts(){return!!this._receipts}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(TransactionReceiptsMessage.prototype),"serializedSize",this)+1+(this.hasReceipts()?2+this._receipts.reduce(function(e,t){return e+t.serializedSize},0):0)}},{key:"receipts",get:function get(){return this._receipts}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);var t=null;if(0!==e.readUint8()){var n=e.readUint16();if(n>TransactionReceiptsMessage.RECEIPTS_MAX_COUNT)throw new Error("Malformed count");t=new Array(n);for(var r=0;r<n;r++)t[r]=Qe.unserialize(e)}return new TransactionReceiptsMessage(t)}}]);return TransactionReceiptsMessage}(Rt);n.register(An);An.RECEIPTS_MAX_COUNT=500;var _n=function(e){(0,_inherits2["default"])(GetBlockProofMessage,e);var t=_createSuper(GetBlockProofMessage);function GetBlockProofMessage(e,n){var r;(0,_classCallCheck2["default"])(this,GetBlockProofMessage);r=t.call(this,Rt.Type.GET_BLOCK_PROOF);if(!(e instanceof ie))throw new Error("Malformed blockHashToProve");if(!(n instanceof ie))throw new Error("Malformed knownBlockHash");r._blockHashToProve=e;r._knownBlockHash=n;return r}(0,_createClass2["default"])(GetBlockProofMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlockProofMessage.prototype),"serialize",this).call(this,e);this._blockHashToProve.serialize(e);this._knownBlockHash.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlockProofMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlockProofMessage.prototype),"serializedSize",this)+this._blockHashToProve.serializedSize+this._knownBlockHash.serializedSize}},{key:"blockHashToProve",get:function get(){return this._blockHashToProve}},{key:"knownBlockHash",get:function get(){return this._knownBlockHash}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new GetBlockProofMessage(ie.unserialize(e),ie.unserialize(e))}}]);return GetBlockProofMessage}(Rt);n.register(_n);var pn=function(e){(0,_inherits2["default"])(GetBlockProofAtMessage,e);var t=_createSuper(GetBlockProofAtMessage);function GetBlockProofAtMessage(e,n){var r;(0,_classCallCheck2["default"])(this,GetBlockProofAtMessage);r=t.call(this,Rt.Type.GET_BLOCK_PROOF_AT);if(!Y.isUint32(e))throw new Error("Malformed blockHeightToProve");if(!(n instanceof ie))throw new Error("Malformed knownBlockHash");r._blockHeightToProve=e;r._knownBlockHash=n;return r}(0,_createClass2["default"])(GetBlockProofAtMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlockProofAtMessage.prototype),"serialize",this).call(this,e);e.writeUint32(this._blockHeightToProve);this._knownBlockHash.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlockProofAtMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetBlockProofAtMessage.prototype),"serializedSize",this)+4+this._knownBlockHash.serializedSize}},{key:"blockHeightToProve",get:function get(){return this._blockHeightToProve}},{key:"knownBlockHash",get:function get(){return this._knownBlockHash}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new GetBlockProofAtMessage(e.readUint32(),ie.unserialize(e))}}]);return GetBlockProofAtMessage}(Rt);n.register(pn);var gn=function(e){(0,_inherits2["default"])(BlockProofMessage,e);var t=_createSuper(BlockProofMessage);function BlockProofMessage(e){var n;(0,_classCallCheck2["default"])(this,BlockProofMessage);n=t.call(this,Rt.Type.BLOCK_PROOF);if(e&&!(e instanceof Ze))throw new Error("Malformed proof");n._proof=e;return n}(0,_createClass2["default"])(BlockProofMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(BlockProofMessage.prototype),"serialize",this).call(this,e);if(this._proof){e.writeUint8(1);this._proof.serialize(e)}else e.writeUint8(0);(0,_get10["default"])((0,_getPrototypeOf2["default"])(BlockProofMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"hasProof",value:function hasProof(){return!!this._proof}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(BlockProofMessage.prototype),"serializedSize",this)+1+(this._proof?this._proof.serializedSize:0)}},{key:"proof",get:function get(){return this._proof}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);if(1===e.readUint8()){return new BlockProofMessage(Ze.unserialize(e))}return new BlockProofMessage}}]);return BlockProofMessage}(Rt);n.register(gn);var yn=function(e){(0,_inherits2["default"])(GetHeadMessage,e);var t=_createSuper(GetHeadMessage);function GetHeadMessage(){(0,_classCallCheck2["default"])(this,GetHeadMessage);return t.call(this,Rt.Type.GET_HEAD)}(0,_createClass2["default"])(GetHeadMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetHeadMessage.prototype),"serialize",this).call(this,e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(GetHeadMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"GetHeadMessage{}"}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new GetHeadMessage}}]);return GetHeadMessage}(Rt);n.register(yn);var vn=function(e){(0,_inherits2["default"])(HeadMessage,e);var t=_createSuper(HeadMessage);function HeadMessage(e){var n;(0,_classCallCheck2["default"])(this,HeadMessage);(n=t.call(this,Rt.Type.HEAD))._header=e;return n}(0,_createClass2["default"])(HeadMessage,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(HeadMessage.prototype),"serialize",this).call(this,e);this._header.serialize(e);(0,_get10["default"])((0,_getPrototypeOf2["default"])(HeadMessage.prototype),"_setChecksum",this).call(this,e);return e}},{key:"toString",value:function toString(){return"HeadMessage{height=".concat(this._header.height,", hash=").concat(this._header.hash(),"}")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(HeadMessage.prototype),"serializedSize",this)+this._header.serializedSize}},{key:"header",get:function get(){return this._header}}],[{key:"unserialize",value:function unserialize(e){Rt.unserialize(e);return new HeadMessage(Re.unserialize(e))}}]);return HeadMessage}(Rt);n.register(vn);var kn=function(){function MessageFactory(){(0,_classCallCheck2["default"])(this,MessageFactory)}(0,_createClass2["default"])(MessageFactory,null,[{key:"peekType",value:function peekType(e){return Rt.peekType(e)}},{key:"parse",value:function parse(e){var t=Rt.peekType(e),n=MessageFactory.CLASSES[t];if(!n||!n.unserialize)throw new Error("Invalid message type: ".concat(t));return n.unserialize(e)}}]);return MessageFactory}();kn.CLASSES={};kn.CLASSES[Rt.Type.VERSION]=en;kn.CLASSES[Rt.Type.INV]=Kt;kn.CLASSES[Rt.Type.GET_DATA]=qt;kn.CLASSES[Rt.Type.GET_HEADER]=Wt;kn.CLASSES[Rt.Type.NOT_FOUND]=jt;kn.CLASSES[Rt.Type.BLOCK]=Lt;kn.CLASSES[Rt.Type.HEADER]=Ht;kn.CLASSES[Rt.Type.TX]=$t;kn.CLASSES[Rt.Type.GET_BLOCKS]=zt;kn.CLASSES[Rt.Type.MEMPOOL]=Vt;kn.CLASSES[Rt.Type.REJECT]=Yt;kn.CLASSES[Rt.Type.SUBSCRIBE]=Zt;kn.CLASSES[Rt.Type.ADDR]=Mt;kn.CLASSES[Rt.Type.GET_ADDR]=Ut;kn.CLASSES[Rt.Type.PING]=Qt;kn.CLASSES[Rt.Type.PONG]=Jt;kn.CLASSES[Rt.Type.SIGNAL]=Xt;kn.CLASSES[Rt.Type.GET_CHAIN_PROOF]=sn;kn.CLASSES[Rt.Type.CHAIN_PROOF]=an;kn.CLASSES[Rt.Type.GET_ACCOUNTS_PROOF]=rn;kn.CLASSES[Rt.Type.ACCOUNTS_PROOF]=nn;kn.CLASSES[Rt.Type.GET_ACCOUNTS_TREE_CHUNK]=un;kn.CLASSES[Rt.Type.ACCOUNTS_TREE_CHUNK]=on;kn.CLASSES[Rt.Type.GET_TRANSACTIONS_PROOF_BY_ADDRESSES]=ln;kn.CLASSES[Rt.Type.TRANSACTIONS_PROOF]=cn;kn.CLASSES[Rt.Type.GET_TRANSACTION_RECEIPTS_BY_ADDRESS]=fn;kn.CLASSES[Rt.Type.TRANSACTION_RECEIPTS]=An;kn.CLASSES[Rt.Type.GET_BLOCK_PROOF]=_n;kn.CLASSES[Rt.Type.BLOCK_PROOF]=gn;kn.CLASSES[Rt.Type.GET_TRANSACTIONS_PROOF_BY_HASHES]=hn;kn.CLASSES[Rt.Type.GET_TRANSACTION_RECEIPTS_BY_HASHES]=dn;kn.CLASSES[Rt.Type.GET_BLOCK_PROOF_AT]=pn;kn.CLASSES[Rt.Type.GET_HEAD]=yn;kn.CLASSES[Rt.Type.HEAD]=vn;kn.CLASSES[Rt.Type.VERACK]=tn;n.register(kn);var mn=function(e){(0,_inherits2["default"])(WebRtcConnector,e);var t=_createSuper(WebRtcConnector);function WebRtcConnector(e){var n;(0,_classCallCheck2["default"])(this,WebRtcConnector);(n=t.call(this))._networkConfig=e;n._connectors=new b;n._timers=new p;return n}(0,_createClass2["default"])(WebRtcConnector,[{key:"connect",value:function connect(e,t){var n=this;if(e.protocol!==Ot.RTC)throw new Error("Malformed peerAddress");var r=e.peerId;if(this._connectors.contains(r))return!1;if(this._connectors.length>=WebRtcConnector.CONNECTORS_MAX)return!1;var a=new wn(this._networkConfig,e,t);a.on("connection",function(e){return n._onConnection(e,r)});this._connectors.put(r,a);this._timers.setTimeout("connect_".concat(r),function(){n._connectors.remove(r);n._timers.clearTimeout("connect_".concat(r));a.close();n.fire("error",e,"timeout")},WebRtcConnector.CONNECT_TIMEOUT);return!0}},{key:"isValidSignal",value:function isValidSignal(e){return this._connectors.contains(e.senderId)&&this._connectors.get(e.senderId).nonce===e.nonce}},{key:"onSignal",value:function onSignal(e,t){var n=this;if(t.isUnroutable()||t.isTtlExceeded()){if(this.isValidSignal(t)&&this._connectors.get(t.senderId)instanceof wn){var r=this._connectors.get(t.senderId),i=r.peerAddress;this._connectors.remove(t.senderId);this._timers.clearTimeout("connect_".concat(t.senderId));r.close();var s=t.isUnroutable()?"unroutable":"ttl exceeded";this.fire("error",i,s)}}else{var o;try{o=JSON.parse(M.toAscii(t.payload))}catch(_){a.e(WebRtcConnector,"Failed to parse signal payload from ".concat(t.senderId));return}if(o)if("offer"===o.type){var u=this._connectors.get(t.senderId);if(u){if(t.recipientId.compare(t.senderId)>0){a.d(WebRtcConnector,"Simultaneous connection, discarding offer from ".concat(t.senderId," (<").concat(t.recipientId,")"));return}if(u instanceof Cn){a.w(WebRtcConnector,"Duplicate offer received from ".concat(t.senderId));u.onSignal(o);return}a.d(WebRtcConnector,"Simultaneous connection, accepting offer from ".concat(t.senderId," (>").concat(t.recipientId,")"));this._timers.clearTimeout("connect_".concat(t.senderId));u.close();this.fire("error",u.peerAddress,"simultaneous inbound connection")}if(this._connectors.length>=WebRtcConnector.CONNECTORS_MAX){a.d(WebRtcConnector,"Rejecting offer from ".concat(t.senderId," - max connectors exceeded"));return}if(this._connectors.length>=WebRtcConnector.INBOUND_CONNECTORS_MAX){var c=0,l=!0,h=!1,f=undefined;try{for(var d,A=(0,_getIterator2["default"])(this._connectors.valueIterator());!(l=(d=A.next()).done);l=!0){d.value instanceof Cn&&c++}}catch(p){h=!0;f=p}finally{try{l||null==A["return"]||A["return"]()}finally{if(h)throw f}}if(c>=WebRtcConnector.INBOUND_CONNECTORS_MAX){a.d(WebRtcConnector,"Rejecting offer from ".concat(t.senderId," - max inbound connectors exceeded"));return}}(u=new Cn(this._networkConfig,e,t.senderId,o)).on("connection",function(e){return n._onConnection(e,t.senderId)});this._connectors.put(t.senderId,u);this._timers.setTimeout("connect_".concat(t.senderId),function(){n._timers.clearTimeout("connect_".concat(t.senderId));n._connectors.remove(t.senderId);u.close()},WebRtcConnector.CONNECT_TIMEOUT)}else this._connectors.contains(t.senderId)&&this._connectors.get(t.senderId).onSignal(o);else a.d(WebRtcConnector,"Discarding signal from ".concat(t.senderId," - empty payload"))}}},{key:"_onConnection",value:function _onConnection(e,t){var n=this;this._timers.clearTimeout("connect_".concat(t));e.on("close",function(){return n._onClose(t)});this.fire("connection",e)}},{key:"_onClose",value:function _onClose(e){this._connectors.remove(e);this._timers.clearTimeout("connect_".concat(e))}}]);return WebRtcConnector}(i);mn.CONNECT_TIMEOUT=8e3;mn.CONNECTORS_MAX=6;mn.INBOUND_CONNECTORS_MAX=3;n.register(mn);var bn=function(e){(0,_inherits2["default"])(PeerConnector,e);var t=_createSuper(PeerConnector);function PeerConnector(e,n,r,a){var i;(0,_classCallCheck2["default"])(this,PeerConnector);(i=t.call(this))._networkConfig=e;i._signalChannel=n;i._peerId=r;i._peerAddress=a;i._nonce=Y.randomUint32();i._rtcConnection=c.newPeerConnection(i._networkConfig.rtcConfig);i._rtcConnection.onicecandidate=function(e){return i._onIceCandidate(e)};i._rtcConnection.onconnectionstatechange=function(e){return i._onConnectionStateChange(e)};i._rtcConnection.onicegatheringstatechange=function(e){return i._onIceGatheringStateChange(e)};i._lastIceCandidate=null;i._iceCandidateQueue=[];i._localIceCandidates=[];i._timers=new p;return i}(0,_createClass2["default"])(PeerConnector,[{key:"onSignal",value:function onSignal(e){var t=this;if(this._rtcConnection)if(e.sdp)this._rtcConnection.setRemoteDescription(c.newSessionDescription(e)).then(function(){"offer"===e.type&&t._rtcConnection.createAnswer().then(function(e){return t._onDescription(e)})["catch"](a.e.tag(PeerConnector));t._handleCandidateQueue()["catch"](a.w.tag(PeerConnector))})["catch"](a.e.tag(PeerConnector));else if(e.candidate){if(e.otherCandidates){var n=!0,r=!1,i=undefined;try{for(var s,o=(0,_getIterator2["default"])(e.otherCandidates);!(n=(s=o.next()).done);n=!0){var u=s.value;this._addIceCandidate(u)["catch"](a.w.tag(PeerConnector))}}catch(l){r=!0;i=l}finally{try{n||null==o["return"]||o["return"]()}finally{if(r)throw i}}}this._addIceCandidate(e)["catch"](a.w.tag(PeerConnector))}}},{key:"_onConnectionStateChange",value:function _onConnectionStateChange(e){if(this._rtcConnection)switch(this._rtcConnection.connectionState){case"failed":case"disconnected":case"closed":this.close()}}},{key:"close",value:function close(){if(this._rtcConnection){this._rtcConnection.onicecandidate=null;this._rtcConnection.onconnectionstatechange=null;this._rtcConnection.onicegatheringstatechange=null;this._rtcConnection.close();this._rtcConnection=null;this._signalChannel=null;this._timers.clearAll();this._offAll()}}},{key:"_addIceCandidate",value:function _addIceCandidate(e){if(!this._rtcConnection)return _promise["default"].resolve();this._lastIceCandidate=c.newIceCandidate(e);if(!this._rtcConnection.remoteDescription||!this._rtcConnection.remoteDescription.type){this._iceCandidateQueue.push(e);return _promise["default"].resolve()}return this._rtcConnection.addIceCandidate(this._lastIceCandidate)["catch"](a.e.tag(PeerConnector))}},{key:"_handleCandidateQueue",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee376(){var e,t,n,r,a,i;return _regenerator["default"].wrap(function _callee376$(s){for(;;)switch(s.prev=s.next){case 0:if(this._rtcConnection){s.next=2;break}return s.abrupt("return");case 2:e=!0;t=!1;n=undefined;s.prev=5;r=(0,_getIterator2["default"])(this._iceCandidateQueue);case 7:if(e=(a=r.next()).done){s.next=14;break}i=a.value;s.next=11;return this._addIceCandidate(i);case 11:e=!0;s.next=7;break;case 14:s.next=20;break;case 16:s.prev=16;s.t0=s["catch"](5);t=!0;n=s.t0;case 20:s.prev=20;s.prev=21;e||null==r["return"]||r["return"]();case 23:s.prev=23;if(!t){s.next=26;break}throw n;case 26:return s.finish(23);case 27:return s.finish(20);case 28:this._iceCandidateQueue=[];case 29:case"end":return s.stop()}},_callee376,this,[[5,16,20,28],[21,,23,27]])}));return function _handleCandidateQueue(){return e.apply(this,arguments)}}()},{key:"_signal",value:function _signal(e){if(this._rtcConnection){var t=M.fromAscii((0,_stringify["default"])(e)),n=this._networkConfig.keyPair,r=this._networkConfig.peerId;this._signalChannel.signal(r,this._peerId,this._nonce,ur.SIGNAL_TTL_INITIAL,0,t,n.publicKey,de.create(n.privateKey,n.publicKey,t))}}},{key:"_onIceCandidate",value:function _onIceCandidate(e){if(this._rtcConnection&&null!==e.candidate){this._localIceCandidates.push(e.candidate);this._timers.timeoutExists("ice-gathering")||this._timers.setTimeout("ice-gathering",this._sendIceCandidates.bind(this),PeerConnector.ICE_GATHERING_TIMEOUT)}}},{key:"_onIceGatheringStateChange",value:function _onIceGatheringStateChange(e){this._rtcConnection&&"complete"===this._rtcConnection.iceGatheringState&&this._sendIceCandidates()}},{key:"_sendIceCandidates",value:function _sendIceCandidates(){this._timers.clearTimeout("ice-gathering");if(this._localIceCandidates.length>0){var e=this._localIceCandidates.pop();(e=e.toJSON?e.toJSON():JSON.parse((0,_stringify["default"])(e))).otherCandidates=this._localIceCandidates;this._signal(e);this._localIceCandidates=[]}}},{key:"_onDescription",value:function _onDescription(e){var t=this;this._rtcConnection&&this._rtcConnection.setLocalDescription(e).then(function(){return t._signal(t._rtcConnection.localDescription)})["catch"](a.e.tag(PeerConnector))}},{key:"_onDataChannel",value:function _onDataChannel(e){var t=this;if(this._rtcConnection){var n=new Sn(e.channel||e.target);n.on("close",function(){t._rtcConnection&&t.close()});var r=null;if(this._lastIceCandidate)try{r=Tn.candidateToNetAddress(this._lastIceCandidate)}catch(s){a.w(PeerConnector,"Failed to parse IP from ICE candidate: ".concat(this._lastIceCandidate))}else a.d(PeerConnector,"No ICE candidate seen for RTC connection");var i=new jn(n,Ot.RTC,r,this._peerAddress);this.fire("connection",i)}}},{key:"nonce",get:function get(){return this._nonce}},{key:"peerAddress",get:function get(){return this._peerAddress}}]);return PeerConnector}(i);bn.ICE_GATHERING_TIMEOUT=1e3;bn.CONNECTION_OPEN_DELAY=200;n.register(bn);var wn=function(e){(0,_inherits2["default"])(OutboundPeerConnector,e);var t=_createSuper(OutboundPeerConnector);function OutboundPeerConnector(e,n,r){var i;(0,_classCallCheck2["default"])(this,OutboundPeerConnector);(i=t.call(this,e,r,n.peerId,n))._peerAddress=n;i._channel=i._rtcConnection.createDataChannel("data-channel");i._channel.binaryType="arraybuffer";i._channel.onopen=function(e){return i._onDataChannel(e)};i._rtcConnection.createOffer().then(function(e){return i._onDescription(e)})["catch"](a.e.tag(OutboundPeerConnector));return i}(0,_createClass2["default"])(OutboundPeerConnector,[{key:"close",value:function close(){(0,_get10["default"])((0,_getPrototypeOf2["default"])(OutboundPeerConnector.prototype),"close",this).call(this);if(this._channel){this._channel.onopen=null;this._channel=null}}}]);return OutboundPeerConnector}(bn);n.register(wn);var Cn=function(e){(0,_inherits2["default"])(InboundPeerConnector,e);var t=_createSuper(InboundPeerConnector);function InboundPeerConnector(e,n,r,a){var i;(0,_classCallCheck2["default"])(this,InboundPeerConnector);(i=t.call(this,e,n,r,null))._rtcConnection.ondatachannel=function(e){e.channel.onopen=function(e){return i._onDataChannel(e)}};i.onSignal(a);return i}return InboundPeerConnector}(bn);n.register(Cn);var Sn=function(e){(0,_inherits2["default"])(WebRtcDataChannel,e);var t=_createSuper(WebRtcDataChannel);function WebRtcDataChannel(e){var n;(0,_classCallCheck2["default"])(this,WebRtcDataChannel);n=t.call(this);R.that(e.ordered,"WebRtc data channel not ordered");n._channel=e;n._channel.onmessage=function(e){return n._onMessage(e.data||e)};n._channel.onclose=function(){return n.close()};n._channel.onerror=function(e){return n.fire("error",e,(0,_assertThisInitialized2["default"])(n))};return n}(0,_createClass2["default"])(WebRtcDataChannel,[{key:"_onMessage",value:function _onMessage(e){var t=this;if(e instanceof Blob){var n=new FileReader;n.onloadend=function(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(WebRtcDataChannel.prototype),"_onMessage",t).call(t,n.result)};n.readAsArrayBuffer(e)}else(0,_get10["default"])((0,_getPrototypeOf2["default"])(WebRtcDataChannel.prototype),"_onMessage",this).call(this,e)}},{key:"sendChunk",value:function sendChunk(e){if(!this._channel)throw new Error("Channel is dead");this._channel.send(e)}},{key:"_close",value:function _close(){this._channel.onmessage=null;this._channel.onclose=null;this._channel.onerror=null;this._channel.close();this._channel=null}},{key:"readyState",get:function get(){return s.ReadyState.fromString(this._channel.readyState)}}]);return WebRtcDataChannel}(s);n.register(Sn);var Tn=function(){function WebRtcUtils(){(0,_classCallCheck2["default"])(this,WebRtcUtils)}(0,_createClass2["default"])(WebRtcUtils,null,[{key:"candidateToNetAddress",value:function candidateToNetAddress(e){var t=e.candidate.split(" ");return t.length<6?null:In.fromIP(t[4],!0)}}]);return WebRtcUtils}();n.register(Tn);var En=function(e){(0,_inherits2["default"])(WebSocketConnector,e);var t=_createSuper(WebSocketConnector);function WebSocketConnector(e,n,r){var i;(0,_classCallCheck2["default"])(this,WebSocketConnector);(i=t.call(this))._protocol=e;i._protocolPrefix=n;i._networkConfig=r;if(r.peerAddress.protocol===i._protocol){i._wss=l.newWebSocketServer(r);i._wss.on("connection",function(e,t){return i._onConnection(e,t)});a.d(WebSocketConnector,"".concat(i._protocolPrefix.toUpperCase(),"-Connector listening on port ").concat(r.peerAddress.port))}i._sockets=new b;i._timers=new p;return i}(0,_createClass2["default"])(WebSocketConnector,[{key:"connect",value:function connect(e){var t=this;if(e.protocol!==this._protocol)throw new Error("Malformed peerAddress");var n="connect_".concat(e);if(this._timers.timeoutExists(n)){a.w(WebSocketConnector,"Already connecting to ".concat(e));return!1}var r=l.newWebSocket("".concat(this._protocolPrefix,"://").concat(e.host,":").concat(e.port),{handshakeTimeout:WebSocketConnector.CONNECT_TIMEOUT},this._networkConfig);r.binaryType="arraybuffer";r.onopen=function(){t._timers.clearTimeout(n);t._sockets.remove(e);r.onerror=function(){};var a=r._socket&&r._socket.remoteAddress?In.fromIP(r._socket.remoteAddress,!0):null,i=new jn(new xn(r),t._protocol,a,e);t.fire("connection",i)};r.onerror=function(r){t._timers.clearTimeout(n);t._sockets.remove(e);t.fire("error",e,r)};this._sockets.put(e,r);this._timers.setTimeout(n,function(){t._timers.clearTimeout(n);t._sockets.remove(e);r.onerror=function(){};r.onopen=function(){a.d(WebSocketConnector,function(){return"Connection to ".concat(e," succeeded after timeout - closing it")});r.close()};t.fire("error",e,"timeout")},WebSocketConnector.CONNECT_TIMEOUT);return!0}},{key:"abort",value:function abort(e){var t=this._sockets.get(e);if(t){this._timers.clearTimeout("connect_".concat(e));this._sockets.remove(e);t.onerror=function(){};t.onopen=function(){a.d(WebSocketConnector,function(){return"Connection to ".concat(e," succeeded after aborting - closing it")});t.close()};t.close();this.fire("error",e,"aborted")}}},{key:"_onConnection",value:function _onConnection(e,t){var n=t.connection.remoteAddress;if(n){if(this._networkConfig.reverseProxy.enabled){var r=this._networkConfig.reverseProxy.addresses;if(!r.includes(n)){a.e(WebSocketConnector,"Received connection from ".concat(n," when all connections were expected from the reverse proxy at ").concat(r,": closing the connection"));e.close();return}var i=this._networkConfig.reverseProxy.header;if(!t.headers[i]){a.e(WebSocketConnector,"Expected header '".concat(i,"' to contain the real IP from the connecting client: closing the connection"));e.close();return}n=t.headers[i].split(/\s*,\s*/)[0]}try{var s=In.fromIP(n,!0),o=new jn(new xn(e),this._protocol,s,null);this.fire("connection",o)}catch(u){a.e(WebSocketConnector,"Error on connection from ".concat(n,": ").concat(u.message||u));e.close()}}else{a.e(WebSocketConnector,"Expected req.connection.remoteAddress to be set and it is not: closing the connection");e.close()}}}]);return WebSocketConnector}(i);En.CONNECT_TIMEOUT=5e3;n.register(En);var xn=function(e){(0,_inherits2["default"])(WebSocketDataChannel,e);var t=_createSuper(WebSocketDataChannel);function WebSocketDataChannel(e){var n;(0,_classCallCheck2["default"])(this,WebSocketDataChannel);(n=t.call(this))._ws=e;n._ws.onmessage=function(e){return n._onMessage(e.data||e)};n._ws.onclose=function(){return n.close()};n._ws.onerror=function(e){return n.fire("error",e)};return n}(0,_createClass2["default"])(WebSocketDataChannel,[{key:"_close",value:function _close(){this._ws.onmessage=null;this._ws.onclose=null;this._ws.onerror=null;this._ws.close();this._ws=null}},{key:"sendChunk",value:function sendChunk(e){this._ws.send(e)}},{key:"readyState",get:function get(){return this._ws.readyState}}]);return WebSocketDataChannel}(s);n.register(xn);var In=function(){(0,_createClass2["default"])(NetAddress,null,[{key:"fromIP",value:function fromIP(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1],n=cr.ipToBytes(e);return new NetAddress(cr.isIPv4Address(n)?NetAddress.Type.IPv4:NetAddress.Type.IPv6,n,t)}}]);function NetAddress(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null,n=arguments.length>2&&arguments[2]!==undefined&&arguments[2];(0,_classCallCheck2["default"])(this,NetAddress);switch(e){case NetAddress.Type.IPv4:if(!(t instanceof Uint8Array)||t.length!==cr.IPv4_LENGTH)throw new Error("Malformed ip");break;case NetAddress.Type.IPv6:if(!(t instanceof Uint8Array)||t.length!==cr.IPv6_LENGTH)throw new Error("Malformed ip");break;case NetAddress.Type.UNKNOWN:case NetAddress.Type.UNSPECIFIED:t=null;break;default:throw new Error("Malformed type")}this._type=e;this._ip=t;this._reliable=n}(0,_createClass2["default"])(NetAddress,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).writeUint8(this._type);this._ip&&e.write(this._ip);return e}},{key:"equals",value:function equals(e){return e instanceof NetAddress&&this._type===e._type&&M.equals(this._ip,e.ip)}},{key:"hashCode",value:function hashCode(){return this.toString()}},{key:"toString",value:function toString(){return this._type===NetAddress.Type.UNKNOWN?"<unknown>":this._type===NetAddress.Type.UNSPECIFIED?"":cr.bytesToIp(this._ip)}},{key:"isPseudo",value:function isPseudo(){return!this._ip}},{key:"isPrivate",value:function isPrivate(){return this.isPseudo()||cr.isPrivateIP(this._ip)}},{key:"isIPv6",value:function isIPv6(){return this._ip&&cr.isIPv6Address(this._ip)}},{key:"isIPv4",value:function isIPv4(){return this._ip&&cr.isIPv4Address(this._ip)}},{key:"subnet",value:function subnet(e){var t=this._ip?cr.ipToSubnet(this._ip,e):null;return new NetAddress(this._type,t,this._reliable)}},{key:"serializedSize",get:function get(){return 1+(this._ip?this._ip.length:0)}},{key:"ip",get:function get(){return this._ip}},{key:"type",get:function get(){return this._type}},{key:"reliable",get:function get(){return this._reliable}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint8(),n=null;switch(t){case NetAddress.Type.IPv4:n=e.read(cr.IPv4_LENGTH);break;case NetAddress.Type.IPv6:n=e.read(cr.IPv6_LENGTH)}return new NetAddress(t,n)}}]);return NetAddress}();In.Type={IPv4:0,IPv6:1,UNSPECIFIED:2,UNKNOWN:3};In.UNSPECIFIED=new In(In.Type.UNSPECIFIED);In.UNKNOWN=new In(In.Type.UNKNOWN);n.register(In);var Bn=function(e){(0,_inherits2["default"])(PeerId,e);var t=_createSuper(PeerId);(0,_createClass2["default"])(PeerId,null,[{key:"copy",value:function copy(e){return e?new PeerId(new Uint8Array(e._obj)):e}}]);function PeerId(e){var n;(0,_classCallCheck2["default"])(this,PeerId);n=t.call(this);if(!(e instanceof Uint8Array))throw new Error("Primitive: Invalid type");if(e.length!==PeerId.SERIALIZED_SIZE)throw new Error("Primitive: Invalid length");n._obj=e;return n}(0,_createClass2["default"])(PeerId,[{key:"serialize",value:function serialize(e){(e=e||new U(this.serializedSize)).write(this._obj);return e}},{key:"subarray",value:function subarray(e,t){return this._obj.subarray(e,t)}},{key:"equals",value:function equals(e){return e instanceof PeerId&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(PeerId.prototype),"equals",this).call(this,e)}},{key:"toString",value:function toString(){return this.toHex()}},{key:"serializedSize",get:function get(){return PeerId.SERIALIZED_SIZE}}],[{key:"unserialize",value:function unserialize(e){return new PeerId(e.read(PeerId.SERIALIZED_SIZE))}},{key:"fromBase64",value:function fromBase64(e){return new PeerId(M.fromBase64(e))}},{key:"fromHex",value:function fromHex(e){return new PeerId(M.fromHex(e))}}]);return PeerId}(ae);Bn.SERIALIZED_SIZE=16;n.register(Bn);var Pn=function(){function PeerAddress(e,t,n,r,a,i,s){(0,_classCallCheck2["default"])(this,PeerAddress);if(!Y.isUint8(i))throw new Error("Malformed distance");if(null!==a&&!(a instanceof ue))throw new Error("Malformed publicKey");this._protocol=e;this._services=t;this._timestamp=n;this._netAddress=r||In.UNSPECIFIED;this._publicKey=a;this._distance=i;this._signature=s}(0,_createClass2["default"])(PeerAddress,[{key:"serialize",value:function serialize(e){if(!this._publicKey)throw new Error("PeerAddress without publicKey may not be serialized.");if(!this._signature)throw new Error("PeerAddress without signature may not be serialized.");(e=e||new U(this.serializedSize)).writeUint8(this._protocol);e.writeUint32(this._services);e.writeUint64(this._timestamp);this._netAddress.isPrivate()?In.UNSPECIFIED.serialize(e):this._netAddress.serialize(e);this._publicKey.serialize(e);e.writeUint8(this._distance);this._signature.serialize(e);return e}},{key:"serializeContent",value:function serializeContent(e){(e=e||new U(this.serializedContentSize)).writeUint8(this._protocol);e.writeUint32(this._services);e.writeUint64(this._timestamp);return e}},{key:"equals",value:function equals(e){return e instanceof PeerAddress&&this.protocol===e.protocol&&(!this.publicKey||!e.publicKey||this.publicKey.equals(e.publicKey))&&(!this.peerId||!e.peerId||this.peerId.equals(e.peerId))}},{key:"hashCode",value:function hashCode(){throw new Error("unimplemented")}},{key:"verifySignature",value:function verifySignature(){this._signatureVerified===undefined&&(this._signatureVerified=this.signature.verify(this.publicKey,this.serializeContent()));return this._signatureVerified}},{key:"isSeed",value:function isSeed(){return 0===this._timestamp}},{key:"exceedsAge",value:function exceedsAge(){if(this.isSeed())return!1;var e=(0,_now["default"])()-this.timestamp;switch(this.protocol){case Ot.WSS:return e>Kn.MAX_AGE_WEBSOCKET;case Ot.RTC:return e>Kn.MAX_AGE_WEBRTC;case Ot.WS:return e>Kn.MAX_AGE_WEBSOCKET;case Ot.DUMB:return e>Kn.MAX_AGE_DUMB}return!1}},{key:"serializedSize",get:function get(){return 13+this._netAddress.serializedSize+this._publicKey.serializedSize+1+this._signature.serializedSize}},{key:"serializedContentSize",get:function get(){return 13}},{key:"protocol",get:function get(){return this._protocol}},{key:"services",get:function get(){return this._services}},{key:"timestamp",get:function get(){return this._timestamp}},{key:"netAddress",get:function get(){return this._netAddress.isPseudo()?null:this._netAddress},set:function set(e){this._netAddress=e||In.UNSPECIFIED}},{key:"publicKey",get:function get(){return this._publicKey}},{key:"peerId",get:function get(){return this._publicKey?this._publicKey.toPeerId():null}},{key:"distance",get:function get(){return this._distance},set:function set(e){this._distance=e}},{key:"signature",get:function get(){return this._signature},set:function set(e){if(0===this._distance){this._signature=e;this._signatureVerified=undefined}}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint8();switch(t){case Ot.WSS:return On.unserialize(e);case Ot.RTC:return Mn.unserialize(e);case Ot.WS:return Rn.unserialize(e);case Ot.DUMB:return Ln.unserialize(e);default:throw"Malformed PeerAddress protocol ".concat(t)}}}]);return PeerAddress}();n.register(Pn);var Nn=function(e){(0,_inherits2["default"])(WsBasePeerAddress,e);var t=_createSuper(WsBasePeerAddress);function WsBasePeerAddress(e,n,r,a,i,s,o,u,c){var l;(0,_classCallCheck2["default"])(this,WsBasePeerAddress);if(e!==Ot.WS&&e!==Ot.WSS)throw new Error("Malformed protocol");l=t.call(this,e,n,r,a,i,s,c);if(!o)throw new Error("Malformed host");if(!Y.isUint16(u))throw new Error("Malformed port");l._host=o;l._port=u;return l}(0,_createClass2["default"])(WsBasePeerAddress,[{key:"toSeedString",value:function toSeedString(){return"".concat(this.protocolPrefix,"://").concat(this._host,":").concat(this._port,"/").concat(this.publicKey?this.publicKey.toHex():"")}},{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(WsBasePeerAddress.prototype),"serialize",this).call(this,e);e.writeVarLengthString(this._host);e.writeUint16(this._port);return e}},{key:"serializeContent",value:function serializeContent(e){e=e||new U(this.serializedContentSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(WsBasePeerAddress.prototype),"serializeContent",this).call(this,e);e.writeVarLengthString(this._host);e.writeUint16(this._port);return e}},{key:"globallyReachable",value:function globallyReachable(){return cr.hostGloballyReachable(this.host)}},{key:"equals",value:function equals(e){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(WsBasePeerAddress.prototype),"equals",this).call(this,e)&&(!!this.peerId&&!!e.peerId||this._host===e.host&&this._port===e.port)}},{key:"hashCode",value:function hashCode(){return this.peerId?"".concat(this.protocolPrefix,":///").concat(this.peerId):"".concat(this.protocolPrefix,"://").concat(this._host,":").concat(this._port,"/")}},{key:"toString",value:function toString(){return"".concat(this.protocolPrefix,"://").concat(this._host,":").concat(this._port,"/").concat(this.peerId?this.peerId:"")}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(WsBasePeerAddress.prototype),"serializedSize",this)+U.varLengthStringSize(this._host)+2}},{key:"serializedContentSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(WsBasePeerAddress.prototype),"serializedContentSize",this)+U.varLengthStringSize(this._host)+2}},{key:"host",get:function get(){return this._host}},{key:"port",get:function get(){return this._port}},{key:"protocolPrefix",get:function get(){return this.protocol===Ot.WS?"ws":"wss"}}],[{key:"fromSeedString",value:function fromSeedString(e){var t=/^(wss?:)\/\/([^:/?#]+):([0-9]{1,5})\/?([a-f0-9]*)$/i.exec(e);if(!t)throw new Error("Malformed PeerAddress ".concat(e));try{var n=(0,_slicedToArray2["default"])(t,5),r=(n[0],n[1]),a=n[2],i=n[3],s=n[4];return("ws:"===r?Rn:On).seed(a,(0,_parseInt2["default"])(i),s)}catch(o){throw new Error("Malformed PeerAddress ".concat(e))}}}]);return WsBasePeerAddress}(Pn);n.register(Nn);var On=function(e){(0,_inherits2["default"])(WssPeerAddress,e);var t=_createSuper(WssPeerAddress);(0,_createClass2["default"])(WssPeerAddress,null,[{key:"seed",value:function seed(e,t,n){var r=n?new ue(M.fromHex(n)):null;return new WssPeerAddress(_.PROVIDES_FULL,0,In.UNSPECIFIED,r,0,e,t)}}]);function WssPeerAddress(e,n,r,a,i,s,o,u){(0,_classCallCheck2["default"])(this,WssPeerAddress);return t.call(this,Ot.WSS,e,n,r,a,i,s,o,u)}(0,_createClass2["default"])(WssPeerAddress,[{key:"equals",value:function equals(e){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(WssPeerAddress.prototype),"equals",this).call(this,e)&&e instanceof WssPeerAddress}},{key:"withoutId",value:function withoutId(){return new WssPeerAddress(this.services,this.timestamp,this.netAddress,null,this.distance,this.host,this.port)}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint32(),n=e.readUint64(),r=In.unserialize(e),a=ue.unserialize(e),i=e.readUint8(),s=de.unserialize(e);return new WssPeerAddress(t,n,r,a,i,e.readVarLengthString(),e.readUint16(),s)}}]);return WssPeerAddress}(Nn);n.register(On);var Rn=function(e){(0,_inherits2["default"])(WsPeerAddress,e);var t=_createSuper(WsPeerAddress);(0,_createClass2["default"])(WsPeerAddress,null,[{key:"seed",value:function seed(e,t,n){var r=n?new ue(M.fromHex(n)):null;return new WsPeerAddress(_.PROVIDES_FULL,0,In.UNSPECIFIED,r,0,e,t)}}]);function WsPeerAddress(e,n,r,a,i,s,o,u){(0,_classCallCheck2["default"])(this,WsPeerAddress);return t.call(this,Ot.WS,e,n,r,a,i,s,o,u)}(0,_createClass2["default"])(WsPeerAddress,[{key:"globallyReachable",value:function globallyReachable(){return(cr.isIPv4Address(this.host)||cr.isIPv6Address(this.host))&&!cr.isPrivateIP(this.host)||cr.hostGloballyReachable(this.host)}},{key:"equals",value:function equals(e){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(WsPeerAddress.prototype),"equals",this).call(this,e)&&e instanceof WsPeerAddress}},{key:"withoutId",value:function withoutId(){return new WsPeerAddress(this.services,this.timestamp,this.netAddress,null,this.distance,this.host,this.port)}}],[{key:"unserialize",value:function unserialize(e){var t=e.readUint32(),n=e.readUint64(),r=In.unserialize(e),a=ue.unserialize(e),i=e.readUint8(),s=de.unserialize(e);return new WsPeerAddress(t,n,r,a,i,e.readVarLengthString(),e.readUint16(),s)}}]);return WsPeerAddress}(Nn);n.register(Rn);var Mn=function(e){(0,_inherits2["default"])(RtcPeerAddress,e);var t=_createSuper(RtcPeerAddress);function RtcPeerAddress(e,n,r,a,i,s){(0,_classCallCheck2["default"])(this,RtcPeerAddress);return t.call(this,Ot.RTC,e,n,r,a,i,s)}(0,_createClass2["default"])(RtcPeerAddress,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(RtcPeerAddress.prototype),"serialize",this).call(this,e);return e}},{key:"equals",value:function equals(e){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(RtcPeerAddress.prototype),"equals",this).call(this,e)&&e instanceof RtcPeerAddress}},{key:"hashCode",value:function hashCode(){return this.toString()}},{key:"toString",value:function toString(){return"rtc:///".concat(this.peerId)}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(RtcPeerAddress.prototype),"serializedSize",this)}}],[{key:"unserialize",value:function unserialize(e){return new RtcPeerAddress(e.readUint32(),e.readUint64(),In.unserialize(e),ue.unserialize(e),e.readUint8(),de.unserialize(e))}}]);return RtcPeerAddress}(Pn);n.register(Mn);var Ln=function(e){(0,_inherits2["default"])(DumbPeerAddress,e);var t=_createSuper(DumbPeerAddress);function DumbPeerAddress(e,n,r,a,i,s){(0,_classCallCheck2["default"])(this,DumbPeerAddress);return t.call(this,Ot.DUMB,e,n,r,a,i,s)}(0,_createClass2["default"])(DumbPeerAddress,[{key:"serialize",value:function serialize(e){e=e||new U(this.serializedSize);(0,_get10["default"])((0,_getPrototypeOf2["default"])(DumbPeerAddress.prototype),"serialize",this).call(this,e);return e}},{key:"equals",value:function equals(e){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(DumbPeerAddress.prototype),"equals",this).call(this,e)&&e instanceof DumbPeerAddress}},{key:"hashCode",value:function hashCode(){return this.toString()}},{key:"toString",value:function toString(){return"dumb:///".concat(this.peerId)}},{key:"serializedSize",get:function get(){return(0,_get10["default"])((0,_getPrototypeOf2["default"])(DumbPeerAddress.prototype),"serializedSize",this)}}],[{key:"unserialize",value:function unserialize(e){return new DumbPeerAddress(e.readUint32(),e.readUint64(),In.unserialize(e),ue.unserialize(e),e.readUint8(),de.unserialize(e))}}]);return DumbPeerAddress}(Pn);n.register(Ln);var Dn=function(){function PeerAddressState(e){(0,_classCallCheck2["default"])(this,PeerAddressState);this.peerAddress=e;this.state=PeerAddressState.NEW;this.lastConnected=-1;this.bannedUntil=-1;this.banBackoff=Kn.INITIAL_FAILED_BACKOFF;this._signalRouter=new Un(e);this._failedAttempts=0;this._closeTypes=new _map2["default"];this._addedBy=new w}(0,_createClass2["default"])(PeerAddressState,[{key:"close",value:function close(e){if(e){this._closeTypes.has(e)?this._closeTypes.set(e,this._closeTypes.get(e)+1):this._closeTypes.set(e,1);this.state!==PeerAddressState.BANNED&&(Wn.isBanningType(e)?this.state=PeerAddressState.BANNED:Wn.isFailingType(e)?this.state=PeerAddressState.FAILED:this.state=PeerAddressState.TRIED)}}},{key:"equals",value:function equals(e){return e instanceof PeerAddressState&&this.peerAddress.equals(e.peerAddress)}},{key:"hashCode",value:function hashCode(){return this.peerAddress.hashCode()}},{key:"toString",value:function toString(){return"PeerAddressState{peerAddress=".concat(this.peerAddress,", state=").concat(this.state,", ")+"lastConnected=".concat(this.lastConnected,", failedAttempts=").concat(this.failedAttempts,", ")+"bannedUntil=".concat(this.bannedUntil,"}")}},{key:"signalRouter",get:function get(){return this._signalRouter}},{key:"maxFailedAttempts",get:function get(){switch(this.peerAddress.protocol){case Ot.RTC:return Kn.MAX_FAILED_ATTEMPTS_RTC;case Ot.WS:case Ot.WSS:return Kn.MAX_FAILED_ATTEMPTS_WS;default:return 0}}},{key:"failedAttempts",get:function get(){return this._signalRouter.bestRoute?this._signalRouter.bestRoute.failedAttempts:this._failedAttempts},set:function set(e){if(this._signalRouter.bestRoute){this._signalRouter.bestRoute.failedAttempts=e;this._signalRouter.updateBestRoute()}else this._failedAttempts=e}},{key:"addedBy",get:function get(){return this._addedBy}}]);return PeerAddressState}();Dn.NEW=1;Dn.ESTABLISHED=2;Dn.TRIED=3;Dn.FAILED=4;Dn.BANNED=5;n.register(Dn);var Un=function(){function SignalRouter(e){(0,_classCallCheck2["default"])(this,SignalRouter);this.peerAddress=e;this._bestRoute=null;this._routes=new w}(0,_createClass2["default"])(SignalRouter,[{key:"addRoute",value:function addRoute(e,t,n){var r=this._routes.get(e),a=new zn(e,t,n);r&&(a.failedAttempts=r.failedAttempts);this._routes.add(a);if(!this._bestRoute||a.score>this._bestRoute.score||a.score===this._bestRoute.score&&n>this._bestRoute.timestamp){this._bestRoute=a;this.peerAddress.distance=this._bestRoute.distance;return!0}return!1}},{key:"deleteBestRoute",value:function deleteBestRoute(){this._bestRoute&&this.deleteRoute(this._bestRoute.signalChannel)}},{key:"deleteRoute",value:function deleteRoute(e){this._routes.remove(e);this._bestRoute&&this._bestRoute.signalChannel.equals(e)&&this.updateBestRoute()}},{key:"deleteAllRoutes",value:function deleteAllRoutes(){this._bestRoute=null;this._routes=new w}},{key:"hasRoute",value:function hasRoute(){return this._routes.length>0}},{key:"updateBestRoute",value:function updateBestRoute(){var e=null,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._routes.valueIterator());!(t=(a=i.next()).done);t=!0){var s=a.value;(null===e||s.score>e.score||s.score===e.score&&s.timestamp>e.timestamp)&&(e=s)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}this._bestRoute=e;this._bestRoute?this.peerAddress.distance=this._bestRoute.distance:this.peerAddress.distance=Kn.MAX_DISTANCE+1}},{key:"equals",value:function equals(e){return e instanceof Dn&&this.peerAddress.equals(e.peerAddress)}},{key:"hashCode",value:function hashCode(){return this.peerAddress.hashCode()}},{key:"toString",value:function toString(){return"PeerAddressState{peerAddress=".concat(this.peerAddress,", state=").concat(this.state,", ")+"lastConnected=".concat(this.lastConnected,", failedAttempts=").concat(this.failedAttempts,", ")+"bannedUntil=".concat(this.bannedUntil,"}")}},{key:"bestRoute",get:function get(){return this._bestRoute}}]);return SignalRouter}();n.register(Un);var zn=function(){function SignalRoute(e,t,n){(0,_classCallCheck2["default"])(this,SignalRoute);this.failedAttempts=0;this.timestamp=n;this._signalChannel=e;this._distance=t}(0,_createClass2["default"])(SignalRoute,[{key:"equals",value:function equals(e){return e instanceof SignalRoute&&this._signalChannel.equals(e._signalChannel)}},{key:"hashCode",value:function hashCode(){return this._signalChannel.hashCode()}},{key:"toString",value:function toString(){return"SignalRoute{signalChannel=".concat(this._signalChannel,", distance=").concat(this._distance,", timestamp=").concat(this.timestamp,", failedAttempts=").concat(this.failedAttempts,"}")}},{key:"signalChannel",get:function get(){return this._signalChannel}},{key:"distance",get:function get(){return this._distance}},{key:"score",get:function get(){return(Kn.MAX_DISTANCE-this._distance)/2*(1-this.failedAttempts/Kn.MAX_FAILED_ATTEMPTS_RTC)}}]);return SignalRoute}();n.register(zn);var Hn=function(){(0,_createClass2["default"])(SeedList,null,[{key:"retrieve",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee377(e,t){return _regenerator["default"].wrap(function _callee377$(n){for(;;)switch(n.prev=n.next){case 0:n.t0=SeedList;n.next=3;return h.get(e,SeedList.REQUEST_TIMEOUT,SeedList.MAX_SIZE);case 3:n.t1=n.sent;n.t2=t;return n.abrupt("return",n.t0.parse.call(n.t0,n.t1,n.t2));case 6:case"end":return n.stop()}},_callee377)}));return function retrieve(t,n){return e.apply(this,arguments)}}()},{key:"parse",value:function parse(e,t){for(var n=[],r=e.split(/\r\n|\n|\r/).filter(function(e){return e.length>0&&!e.startsWith("#")}),i=0;i<r.length-1;i++){var s=r[i];try{n.push(Nn.fromSeedString(s.trim()))}catch(l){a.w(SeedList,"Ignoring malformed seed address ".concat(s))}}var o=r[r.length-1],u=null;try{u=new de(M.fromHex(o.trim()))}catch(l){}if(!u)try{n.push(Nn.fromSeedString(o.trim()))}catch(l){a.w(SeedList,"Ignoring malformed signature/seed address ".concat(o))}if(!t)return new SeedList(n,null,u);if(!u)throw new Error("Missing signature");var c=SeedList._serializeSeeds(n);if(!u.verify(t,c))throw new Error("Invalid signature");return new SeedList(n,t,u)}},{key:"_serializeSeeds",value:function _serializeSeeds(e){return M.fromAscii(e.map(function(e){return e.toSeedString()}).join("\n"))}}]);function SeedList(e,t,n){(0,_classCallCheck2["default"])(this,SeedList);this._seeds=e;this._publicKey=t;this._signature=n}(0,_createClass2["default"])(SeedList,[{key:"serializeContent",value:function serializeContent(){return SeedList._serializeSeeds(this._seeds)}},{key:"seeds",get:function get(){return this._seeds}},{key:"publicKey",get:function get(){return this._publicKey}},{key:"signature",get:function get(){return this._signature}}]);return SeedList}();Hn.MAX_SIZE=131072;Hn.REQUEST_TIMEOUT=8e3;n.register(Hn);var Gn=function(){function SeedListUrl(e,t){(0,_classCallCheck2["default"])(this,SeedListUrl);this._url=e;this._publicKey=t?new ue(M.fromHex(t)):null}(0,_createClass2["default"])(SeedListUrl,[{key:"url",get:function get(){return this._url}},{key:"publicKey",get:function get(){return this._publicKey}}]);return SeedListUrl}();n.register(Gn);var Fn=function(e){(0,_inherits2["default"])(PeerAddressSeeder,e);var t=_createSuper(PeerAddressSeeder);function PeerAddressSeeder(){(0,_classCallCheck2["default"])(this,PeerAddressSeeder);return t.apply(this,arguments)}(0,_createClass2["default"])(PeerAddressSeeder,[{key:"collect",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee378(){var e,t,n,r,i,s,o,u=this;return _regenerator["default"].wrap(function _callee378$(c){for(;;)switch(c.prev=c.next){case 0:if(qn.SEED_LISTS){c.next=3;break}this.fire("end");return c.abrupt("return");case 3:e=[];t=!0;n=!1;r=undefined;c.prev=7;i=function _loop16(){var t=o.value;e.push(Hn.retrieve(t.url,t.publicKey).then(function(e){a.i(PeerAddressSeeder,"Got ".concat(e.seeds.length," seed peers from ").concat(t.url)+(e.publicKey&&e.signature?" (signed)":""));u.fire("seeds",e.seeds)})["catch"](function(e){return a.w(PeerAddressSeeder,"Failed to retrieve seed list from ".concat(t.url,": ").concat(e.message||e))}))};for(s=(0,_getIterator2["default"])(qn.SEED_LISTS);!(t=(o=s.next()).done);t=!0)i();c.next=16;break;case 12:c.prev=12;c.t0=c["catch"](7);n=!0;r=c.t0;case 16:c.prev=16;c.prev=17;t||null==s["return"]||s["return"]();case 19:c.prev=19;if(!n){c.next=22;break}throw r;case 22:return c.finish(19);case 23:return c.finish(16);case 24:c.next=26;return _promise["default"].all(e);case 26:this.fire("end");case 27:case"end":return c.stop()}},_callee378,this,[[7,12,16,24],[17,,19,23]])}));return function collect(){return e.apply(this,arguments)}}()}]);return PeerAddressSeeder}(i);n.register(Fn);var Kn=function(e){(0,_inherits2["default"])(PeerAddressBook,e);var t=_createSuper(PeerAddressBook);function PeerAddressBook(e){var n;(0,_classCallCheck2["default"])(this,PeerAddressBook);(n=t.call(this))._networkConfig=e;n._store=new w;n._wsStates=new w;n._wssStates=new w;n._rtcStates=new w;n._stateByPeerId=new b;n._statesByNetAddress=new b;n._seeded=!1;n.add(null,qn.SEED_PEERS);var r=function seededCallback(){n._seeded=!0;n.fire("seeded")},i=new Fn;i.on("seeds",function(e){return n.add(null,e)});i.on("end",r);i.collect()["catch"](a.e.tag(PeerAddressBook));setTimeout(r,PeerAddressBook.SEEDING_TIMEOUT);setInterval(function(){return n._housekeeping()},PeerAddressBook.HOUSEKEEPING_INTERVAL);return n}(0,_createClass2["default"])(PeerAddressBook,[{key:"iterator",value:function iterator(){return this._store.valueIterator()}},{key:"wsIterator",value:function wsIterator(){return this._wsStates.valueIterator()}},{key:"wssIterator",value:function wssIterator(){return this._wssStates.valueIterator()}},{key:"rtcIterator",value:function rtcIterator(){return this._rtcStates.valueIterator()}},{key:"_get",value:function _get(e){if(e instanceof On||e instanceof Rn){var t=this._store.get(e.withoutId());if(t)return t}return this._store.get(e)}},{key:"getState",value:function getState(e){return this._get(e)}},{key:"get",value:function get(e){var t=this._get(e);return t?t.peerAddress:null}},{key:"getByPeerId",value:function getByPeerId(e){var t=this._stateByPeerId.get(e);return t?t.peerAddress:null}},{key:"getChannelByPeerId",value:function getChannelByPeerId(e){var t=this._stateByPeerId.get(e);return t&&t.signalRouter.bestRoute?t.signalRouter.bestRoute.signalChannel:null}},{key:"query",value:function query(e,t){var n,r,i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Qn.MAX_ADDR_PER_MESSAGE;switch(e){case Ot.WSS:n=this.wssIterator();r=this.knownWssAddressesCount;break;case Ot.WS:n=this.wsIterator();r=this.knownWsAddressesCount;break;case Ot.WS|Ot.WSS:n=k.alternate(this.wsIterator(),this.wssIterator());r=this.knownWsAddressesCount+this.knownWssAddressesCount;break;case Ot.RTC:n=this.rtcIterator();r=this.knownRtcAddressesCount;break;case Ot.RTC|Ot.WS:n=k.alternate(this.rtcIterator(),this.wsIterator());r=this.knownRtcAddressesCount+this.knownWsAddressesCount;break;case Ot.RTC|Ot.WSS:n=k.alternate(this.rtcIterator(),this.wssIterator());r=this.knownRtcAddressesCount+this.knownWssAddressesCount;break;default:n=this.iterator();r=this.knownAddressesCount}var s=0,o=r;r>i&&(o=((s=Math.floor(Math.random()*r))+i)%r);var u=s>o,c=[],l=-1,h=!0,f=!1,d=undefined;try{for(var A,p=(0,_getIterator2["default"])(n);!(h=(A=p.next()).done);h=!0){var g=A.value;l++;if(u||!(l<s)){if(!u&&l>=o)break;if(!(u&&l>=o&&l<s)&&g.state!==Dn.BANNED&&g.state!==Dn.FAILED){var y=g.peerAddress;if(!y.isSeed()&&0!=(y.protocol&e)){var v=t&_.ALL_LEGACY;if(!(v>0&&0==(y.services&v))){var m=t&_.ALL_CURRENT;0===v&&m>0&&(y.services&m)!==m||y.protocol===Ot.RTC&&y.distance>=PeerAddressBook.MAX_DISTANCE||y.exceedsAge()||c.push(y)}}}}}}catch(b){f=!0;d=b}finally{try{h||null==p["return"]||p["return"]()}finally{if(f)throw d}}a.v(PeerAddressBook,function(){return"Returned ".concat(c.length," valid addresses from ").concat(r," that were considered")});return c}},{key:"add",value:function add(e,t){var n=(0,_isArray["default"])(t)?t:[t],r=[],a=!0,i=!1,s=undefined;try{for(var o,u=(0,_getIterator2["default"])(n);!(a=(o=u.next()).done);a=!0){var c=o.value;this._add(e,c)&&r.push(c)}}catch(l){i=!0;s=l}finally{try{a||null==u["return"]||u["return"]()}finally{if(i)throw s}}r.length&&this.fire("added",r,this)}},{key:"_add",value:function _add(e,t){if(this._networkConfig.peerAddress.equals(t))return!1;if(e&&t.exceedsAge()){a.v(PeerAddressBook,function(){return"Ignoring address ".concat(t," - too old (").concat(new Date(t.timestamp),")")});return!1}if(t.timestamp>(0,_now["default"])()+PeerAddressBook.MAX_TIMESTAMP_DRIFT){a.v(PeerAddressBook,function(){return"Ignoring addresses ".concat(t," - timestamp in the future")});return!1}if(t.protocol===Ot.RTC){t.distance++;if(t.distance>PeerAddressBook.MAX_DISTANCE){a.v(PeerAddressBook,function(){return"Ignoring address ".concat(t," - max distance exceeded")});var n=this._get(t);n&&n.signalRouter.deleteRoute(e);return!1}}var r=e&&e.netAddress&&e.netAddress.reliable?e.netAddress:null,i=this._get(t),s=null,o=!1;if(i){s=i.peerAddress;if(i.state===Dn.BANNED)return!1;if(s.isSeed())return!1;!s.netAddress||t.netAddress&&!s.netAddress.reliable||(t.netAddress=s.netAddress)}else{if(this._store.length>=PeerAddressBook.MAX_SIZE)return!1;switch(t.protocol){case Ot.WSS:if(this._wssStates.length>=PeerAddressBook.MAX_SIZE_WSS)return!1;break;case Ot.WS:if(this._wsStates.length>=PeerAddressBook.MAX_SIZE_WS)return!1;break;case Ot.RTC:if(this._rtcStates.length>=PeerAddressBook.MAX_SIZE_RTC)return!1}if(r){var u=this._statesByNetAddress.get(r);if(u&&u.size>=PeerAddressBook.MAX_SIZE_PER_IP){a.v(PeerAddressBook,function(){return"Ignoring address ".concat(t," - max count per IP ").concat(r," reached")});return!1}}i=new Dn(t);this._addToStore(i);o=!0}if(!s||s.timestamp<t.timestamp){i.peerAddress=t;o=!0}t.protocol===Ot.RTC&&(o=i.signalRouter.addRoute(e,t.distance,t.timestamp)||o);this._trackByNetAddress(i,r);return o}},{key:"_addToStore",value:function _addToStore(e){this._store.add(e);e.peerAddress.peerId&&this._stateByPeerId.put(e.peerAddress.peerId,e);switch(e.peerAddress.protocol){case Ot.WSS:this._wssStates.add(e);break;case Ot.WS:this._wsStates.add(e);break;case Ot.RTC:this._rtcStates.add(e)}}},{key:"_trackByNetAddress",value:function _trackByNetAddress(e,t){if(t){e.addedBy.add(t);var n=this._statesByNetAddress.get(t);if(!n){n=new _set5["default"];this._statesByNetAddress.put(t,n)}n.add(e)}}},{key:"established",value:function established(e,t){var n=this._get(t);if(!n){n=new Dn(t);this._addToStore(n)}var r=e&&e.netAddress&&e.netAddress.reliable?e.netAddress:null;this._trackByNetAddress(n,r);n.state=Dn.ESTABLISHED;n.lastConnected=(0,_now["default"])();n.failedAttempts=0;n.bannedUntil=-1;n.banBackoff=PeerAddressBook.INITIAL_FAILED_BACKOFF;n.peerAddress.isSeed()||(n.peerAddress=t);t.protocol===Ot.RTC&&n.signalRouter.addRoute(e,t.distance,t.timestamp)}},{key:"close",value:function close(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null,r=this._get(t);if(r){r.close(n);e&&this._removeBySignalChannel(e);if(Wn.isBanningType(n))this._ban(t);else if(Wn.isFailingType(n)){r.failedAttempts++;if(r.failedAttempts>=r.maxFailedAttempts)if(r.banBackoff>=PeerAddressBook.MAX_FAILED_BACKOFF)this._removeFromStore(t);else{r.bannedUntil=(0,_now["default"])()+r.banBackoff;r.banBackoff=Math.min(PeerAddressBook.MAX_FAILED_BACKOFF,2*r.banBackoff)}}t.protocol===Ot.DUMB&&this._removeFromStore(t)}}},{key:"unroutable",value:function unroutable(e,t){if(t){var n=this._get(t);if(n)if(n.signalRouter.bestRoute&&n.signalRouter.bestRoute.signalChannel.equals(e)){n.signalRouter.deleteBestRoute();n.signalRouter.hasRoute()||this._removeFromStore(n.peerAddress)}else a.d(PeerAddressBook,function(){return"Got unroutable for ".concat(t," on a channel other than the best route.")})}}},{key:"_ban",value:function _ban(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:PeerAddressBook.DEFAULT_BAN_TIME,n=this._get(e);if(!n){n=new Dn(e);this._store.add(n)}n.state=Dn.BANNED;n.bannedUntil=(0,_now["default"])()+t;n.signalRouter.deleteAllRoutes()}},{key:"isBanned",value:function isBanned(e){var t=this._get(e);return t&&t.state===Dn.BANNED&&!t.peerAddress.isSeed()}},{key:"_removeFromStore",value:function _removeFromStore(e){var t=this._get(e);if(t)if(t.peerAddress.isSeed())this._ban(e,t.banBackoff);else{e.peerId&&this._stateByPeerId.remove(e.peerId);var n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(t.addedBy);!(n=(i=s.next()).done);n=!0){var o=i.value,u=this._statesByNetAddress.get(o);if(u){u["delete"](t);0===u.size&&this._statesByNetAddress.remove(o)}}}catch(c){r=!0;a=c}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}switch(t.peerAddress.protocol){case Ot.WSS:this._wssStates.remove(t);break;case Ot.WS:this._wsStates.remove(t);break;case Ot.RTC:this._rtcStates.remove(t)}if(t.state!==Dn.BANNED){this._store.remove(e);this.fire("removed",e,this)}}}},{key:"_removeBySignalChannel",value:function _removeBySignalChannel(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._store.valueIterator());!(t=(a=i.next()).done);t=!0){var s=a.value;if(s.peerAddress.protocol===Ot.RTC){s.signalRouter.deleteRoute(e);s.signalRouter.hasRoute()||this._removeFromStore(s.peerAddress)}}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"_housekeeping",value:function _housekeeping(){var e=(0,_now["default"])(),t=[],n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(this._store.valueIterator());!(n=(i=s.next()).done);n=!0){var o=i.value,u=o.peerAddress;switch(o.state){case Dn.NEW:case Dn.TRIED:case Dn.FAILED:if(u.exceedsAge()){this._removeFromStore(u);continue}if(o.state===Dn.FAILED&&o.failedAttempts>=o.maxFailedAttempts&&o.bannedUntil>0&&o.bannedUntil<=e){o.bannedUntil=-1;o.failedAttempts=0;t.push(u)}break;case Dn.BANNED:if(o.bannedUntil<=e)if(u.isSeed()){o.state=Dn.NEW;o.failedAttempts=0;o.bannedUntil=-1;t.push(u)}else this._removeFromStore(u);break;case Dn.ESTABLISHED:o.signalRouter.bestRoute&&(o.signalRouter.bestRoute.timestamp=e)}}}catch(c){r=!0;a=c}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}t.length&&this.fire("added",t,this)}},{key:"knownAddressesCount",get:function get(){return this._store.length}},{key:"knownWsAddressesCount",get:function get(){return this._wsStates.length}},{key:"knownWssAddressesCount",get:function get(){return this._wssStates.length}},{key:"knownRtcAddressesCount",get:function get(){return this._rtcStates.length}},{key:"seeded",get:function get(){return this._seeded}}]);return PeerAddressBook}(i);Kn.MAX_AGE_WEBSOCKET=18e5;Kn.MAX_AGE_WEBRTC=9e5;Kn.MAX_AGE_DUMB=6e4;Kn.MAX_DISTANCE=4;Kn.MAX_FAILED_ATTEMPTS_WS=3;Kn.MAX_FAILED_ATTEMPTS_RTC=2;Kn.MAX_TIMESTAMP_DRIFT=6e5;Kn.HOUSEKEEPING_INTERVAL=6e4;Kn.DEFAULT_BAN_TIME=6e5;Kn.INITIAL_FAILED_BACKOFF=3e4;Kn.MAX_FAILED_BACKOFF=6e5;Kn.MAX_SIZE_WS=f.isBrowser()?1e3:1e4;Kn.MAX_SIZE_WSS=f.isBrowser()?1e3:1e4;Kn.MAX_SIZE_RTC=f.isBrowser()?1e3:1e4;Kn.MAX_SIZE=f.isBrowser()?2500:20500;Kn.MAX_SIZE_PER_IP=250;Kn.SEEDING_TIMEOUT=3e3;n.register(Kn);var qn=function(){function GenesisConfig(){(0,_classCallCheck2["default"])(this,GenesisConfig)}(0,_createClass2["default"])(GenesisConfig,null,[{key:"main",value:function main(){GenesisConfig.init(GenesisConfig.CONFIGS.main)}},{key:"test",value:function test(){GenesisConfig.init(GenesisConfig.CONFIGS.test)}},{key:"dev",value:function dev(){GenesisConfig.init(GenesisConfig.CONFIGS.dev)}},{key:"init",value:function init(e){if(GenesisConfig._config)throw new Error("GenesisConfig already initialized");if(!e.NETWORK_ID)throw new Error("Config is missing network id");if(!e.NETWORK_NAME)throw new Error("Config is missing network name");if(!e.GENESIS_BLOCK)throw new Error("Config is missing genesis block");if(!e.GENESIS_ACCOUNTS)throw new Error("Config is missing genesis accounts");if(!e.SEED_PEERS)throw new Error("Config is missing seed peers");GenesisConfig._config=e}},{key:"networkIdToNetworkName",value:function networkIdToNetworkName(e){for(var t=0,n=(0,_keys6["default"])(GenesisConfig.CONFIGS);t<n.length;t++){var r=n[t],a=GenesisConfig.CONFIGS[r];if(e===a.NETWORK_ID)return a.NETWORK_NAME}throw new Error("Unable to find networkName for networkId ".concat(e))}},{key:"networkIdFromAny",value:function networkIdFromAny(e){if("number"==typeof e)return e;if(GenesisConfig.CONFIGS[e])return GenesisConfig.CONFIGS[e].NETWORK_ID;throw new Error("Unable to find networkId for ".concat(e))}},{key:"NETWORK_ID",get:function get(){if(!GenesisConfig._config)throw new Error("GenesisConfig not initialized");return GenesisConfig._config.NETWORK_ID}},{key:"NETWORK_NAME",get:function get(){if(!GenesisConfig._config)throw new Error("GenesisConfig not initialized");return GenesisConfig._config.NETWORK_NAME}},{key:"GENESIS_BLOCK",get:function get(){if(!GenesisConfig._config)throw new Error("GenesisConfig not initialized");return GenesisConfig._config.GENESIS_BLOCK}},{key:"GENESIS_HASH",get:function get(){if(!GenesisConfig._config)throw new Error("GenesisConfig not initialized");GenesisConfig._config.GENESIS_HASH||(GenesisConfig._config.GENESIS_HASH=GenesisConfig._config.GENESIS_BLOCK.hash());return GenesisConfig._config.GENESIS_HASH}},{key:"GENESIS_ACCOUNTS",get:function get(){if(!GenesisConfig._config)throw new Error("GenesisConfig not initialized");return GenesisConfig._config.GENESIS_ACCOUNTS}},{key:"SEED_PEERS",get:function get(){if(!GenesisConfig._config)throw new Error("GenesisConfig not initialized");return GenesisConfig._config.SEED_PEERS}},{key:"SEED_LISTS",get:function get(){if(!GenesisConfig._config)throw new Error("GenesisConfig not initialized");return GenesisConfig._config.SEED_LISTS}}]);return GenesisConfig}();n.register(qn);qn.CONFIGS={main:{NETWORK_ID:42,NETWORK_NAME:"main",SEED_PEERS:[On.seed("seed-1.nimiq.com",8443,"b70d0c3e6cdf95485cac0688b086597a5139bc4237173023c83411331ef90507"),On.seed("seed-2.nimiq.com",8443,"8580275aef426981a04ee5ea948ca3c95944ef1597ad78db9839f810d6c5b461"),On.seed("seed-3.nimiq.com",8443,"136bdec59f4d37f25ac8393bef193ff2e31c9c0a024b3edbf77fc1cb84e67a15"),On.seed("seed-4.nimiq-network.com",8443,"aacf606335cdd92d0dd06f27faa3b66d9bac0b247cd57ade413121196b72cd73"),On.seed("seed-5.nimiq-network.com",8443,"110a81a033c75976643d4b8f34419f4913b306a6fc9d530b8207ddbd5527eff6"),On.seed("seed-6.nimiq-network.com",8443,"26c1a4727cda6579639bdcbaecb1f6b97be3ac0e282b43bdd1a2df2858b3c23b"),On.seed("seed-7.nimiq.network",8443,"82fcebdb4e2a7212186d1976d7f685cc86cdf58beffe1723d5c3ea5be00c73e1"),On.seed("seed-8.nimiq.network",8443,"b7ac8cc1a820761df4e8a42f4e30c870e81065c4e29f994ebb5bdceb48904e7b"),On.seed("seed-9.nimiq.network",8443,"4429bf25c8d296c0f1786647d8f7d4bac40a37c67caf028818a65a9cc7865a48"),On.seed("seed-10.nimiq.network",8443,"e8e99fb8633d660d4f2d48edb6cc294681b57648b6ec6b28af8f85b2d5ec4e68"),On.seed("seed-11.nimiq.network",8443,"a76f0edabacfe701750036bad473ff92fa0e68ef655ab93135f0572af6e5baf8"),On.seed("seed-12.nimiq.network",8443,"dca57704191306ac1315e051b6dfef6c174fb2af011a52a3d922fbfaec2be41a"),On.seed("seed-13.nimiq-network.com",8443,"30993f92f148da125a6f8bc191b3e746fab39e109220daa0966bf6432e909f3f"),On.seed("seed-14.nimiq-network.com",8443,"6e7f904fabfadb194d6c74b16534bacb69892d80909cf959e47d3c8f5f330ad2"),On.seed("seed-15.nimiq-network.com",8443,"7cb662a686144c17ae4153fbf7ce359f7e9da39dc072eb11092531f9104fbdf6"),On.seed("seed-16.nimiq.com",8443,"0dfd11939947101197e3c3768a086e65ef1e893e71bfcf4bd5ed222957825212"),On.seed("seed-17.nimiq.com",8443,"c7120f4f88b70a38daa9783e30e89c1c55c3d80d0babed44b4e2ddd09052664a"),On.seed("seed-18.nimiq.com",8443,"c15a2d824a52837fa7165dc232592be35116661e7f28605187ab273dd7233711"),On.seed("seed-19.nimiq.com",8443,"98a24d4b05158314b36e0bd6ce3b42ac5ac061f4bb9664d783eb930caa9315b6"),On.seed("seed-20.nimiq.com",8443,"1fc33f93273d94dd2cf7470274c27ecb1261ec983e43bdbb281803c0a09e68d5")],SEED_LISTS:[new Gn("https://nimiq.community/seeds.txt","8b4ae04557f490102036ce3e570b39058c92fc5669083fb9bbb6effc91dc3c71")],GENESIS_BLOCK:new Je(new Re(new ie(null),new ie(null),ie.fromBase64("fNqaf98GZVkFrl29nFNUUUcbB4+m898OKH5bD7R6Vzo="),ie.fromBase64("H+/UTx+pcYX9oh6VdUXJfcdkP6fk792G4KpCRNHgvFw="),De.difficultyToCompact(1),1,1523727e3,137689,Re.Version.V1),new Me([],new ie(null)),new Le(ge.fromBase64("AAAAAAAAAAAAAAAAAAAAAAAAAAA="),[],M.fromBase64("bG92ZSBhaSBhbW9yIG1vaGFiYmF0IGh1YnVuIGNpbnRhIGx5dWJvdiBiaGFsYWJhc2EgYW1vdXIga2F1bmEgcGknYXJhIGxpZWJlIGVzaHEgdXBlbmRvIHByZW1hIGFtb3JlIGthdHJlc25hbiBzYXJhbmcgYW5wdSBwcmVtYSB5ZXU="))),GENESIS_ACCOUNTS:"BXQP6DJYG/agiSQSrPuWUbRRxQmDHQAAAAAF2/KlRxjOcKZctsfgir1rJDc7M1dOFucNAAAAAARkWKRAMGEIuQcr/LWZhPrQ7LpebB3kYYcBAAAAIE+qFOAgACDQKQvjUPndEmPJ2RXL4jv7OwAAAAEAAfpAAAAAECfVCnAAAAAgT6oU4FqGT/vMwX1XZ07g22eMw0fskoHqAAAAAAAuoDAQhhvJ39JLpqnCXaqIO2RDsEtWbAMAAAAAAAg9hxCItdtDSvA4XiTc8SZ2okGR9PBiwAAAAAABH2oD+KHGLvyhzKpotDO+dRikL1JF4dLbAAAAAATjspIApt0GGBRqQArhsPlqcx3aLD61cgMAAAAAAxn5S2j4oBTAQRu6fkRwfYzj7NL2x48m0AAAAAAH0bUABhGUdOEECf6HAU8PNzKZQvJk1B5DAAAAAAAF9eEAEzDJsAfbsuquQ7B4gsI0eERLC/EAAAAAADq+IDIh/nPeSKVyjryg33EX1lzOu95fEQAAAAAAdTr8gCjXjzONl/+2PUcddEA6O8JlGhAKAAAAAAFrf4y1KTNYzGYsScrZ1FKyaNQV7uj5NbUAAAAAAaPyx381GhQi6QebQBQ2bbN2ln8dOOD+2gAAAAAU9GsEADoBEcCjv8uoWrt/wVxwzHbZxhP4AAAAAADNOALyWKUQu5O7Qy8/IPd1ul0kzWwiAcMAAAAAAS2TXoBZCuTUV/1qLW/xoCraX2Jv9XUK4AAAAAAER9Flj2F9+ZRM1KWMIUMFrR+E/YMogAWuAAAAAASOmvvgd9ucqO/K73xO5z33Q04Mn1WrpMEAAAAAHAJev86Ckcs9bc1qV+Qcm1pX0+Ek9NPhDAAAAAAMOT5tAIY+MD4j7Vx6pcKmWrfmLAV/eB+HAAAAAAgmKZ4AtSpJmecTzccCWIUeUna2nAHdhvQAAAAAA9jV64BlM7tVnlMn4rSTVuBrGd/rc3LEWQEAAAACTYyuwLxA3NNyqJySg9OvuK+zQDxcCLWeAAAAAQAB+kAAAAABJsZXYAAAAAJNjK7A2ojzYWi7PGsNZ2QrnwZF0YWZ4gwAAAAAAkR9WMDbGZ3g0hzz+ZDBqbHOr7MV6Mc8OgAAAAACxB3Y6OFhpAbpXKTJsngcVryISMP2ph2TAAAAAABqZPBA/8H6Ndvkl+uBXVdN81U8igZhMlsAAAAAAVMOjbAOfIZDbkvc3A9Tm6bBvbxfIb2KPwAAAAAAaE7hgBvONkYFyxcWNrWuSszaXQWNJnpZAAAAAEAJGmRYIDpIPQPthk7FP8hQNSKchk+TbNsAAAAAAxw69rUn1x/KoirmOwb1VaNyQLz0qW7aoQAAAAAAaguUpCy2zHWyiLqY9ck2Knq1+kmpIkY4AAAAAABVoxCwRoTV8sZ+c5Hz3h9NhYzXLR1DDokAAAAAAf8cHcBGxpCvb/1yLjmIEJ4rglDFLFOx2gAAAAACCYpngGvbqPKY+bN3c7jIpBFsP/M/QfkjAAAAAAAaE7hgc0Zf375YUsXC0d+tncI0X6RlqUUAAAAAASCMQ4CBNEMJOG90CFKRAyOfDIMQaMylPQAAAAAFpLqBHZFiRK5ASY3PfZOEKGU0WqiQLl5/AAAAAAQTFM8AlhV73DcjjfUjNWVo2z8hoj5k/1gAAAAAAYxe8oCtVJ6hZEduKuMOuAvyUMnx/Gj8PgAAAAABZaC8AOqY2XqSH5XeVxPpNdrO+WiuUuGUAAAAAAukO3QA9oiDBRLWgn7Tbr7roYbSdd2GxLwAAAAAAU3JOAASJmSsEswZHmevydrROlWjwwGZKAAAAAAAhyXBTyWjUVSBLgXs/89DE3+XvpLxNLa9AAAAAAHVYvbAPAEuS0r8tJop5K5KbCkTX5S4ZPUAAAAAATotE8BMietfyhCwcpFR4PV49Rtcucx40gAAAABFvWcxAGA/EmgHq7ZQtKBh/DmXDlmfF24NAAAAAAOlXb+cbx8jXvA/fxzzLbZ6MV/6I0ejkQkAAAAAAExagkAc0AzEdzdoRgKtfTtlM5HnsVgbzAEAAAGXdCDcAG+w+UExRfut8gFGthlImKYgQq5eAAAAAQAD9IAAAABD6LAkqwAAAZd0INwAdMn2fqUMqw3JzYVZCwa5jVq/V3gAAAAAAGempxiCcHNsFwdc1XhMjOqrJgh2AXJ3wAAAAAAAOsxNvpTk2KGPeovysqU+hB7BtmJNP9f0AAAAAAAuYYyCluk9tmHW5NWzV1th8r4irStTqF0AAAAAAaE7hgDH7Ie78axtcP1Wma23f+5IgxkM0wAAAAABDzN9gOkVFantKnQNmROvfRODXSl5XsP3AAAAAAFHsFQy8vZKgy0XKFdJP21+8iwJE/qP8L0AAAAABQL9b0AHf4b4nZr+T6Wt0yNLPE47WENakwAAAAACCYpngBUiyNIB7fOkkQfApVuhBqWb+DmjAAAAAAABMS0AF0OyTc7e81kJOa5YrvE7unefdWUAAAAAAIrfnE1JwQz5BndIzrH6D4EZWW5ErUeA4AAAAAAA/7yFPVE7F9SQJi+5H3ix9IqhZVaz35zeAAAAAABx2EmAXVwR9uccLyWANgANtPpCZEB+VYkAAAAAAYpPI6Jjl1WEynZMWqqkB+E0k4DQtlCdkAAAAAABoTuGAHS4jo1JVVycYGl8CXU0nee82Cu7AAAAAABoTuGAereFP6l3pPLGXtE1g/axb+pPyG0AAAAAAACYloB9xzt7uBipx0GD7hK006DEpK669QAAAAAMQJzHWYEm9YYnmqW+169XCpmtbEO3RfGcAAAAAABG8lOYhWpnK90aMzgR83f2/IgdRlt7vOYAAAAAAYAswp+H2AinILDPyxB2qjRZCP0ewWm1IwAAAAAEExTPAN3adKUUCkLLN6EWndNItAdzl+s9AQAAABFgHCAgjbtMhy3nJnljk5LVSC4m7+b0SF4AAAABAAH6QAAAAAiwDhAQAAAAEWAcICCQCsooRxBXgtiIL7P0PqBa3pxk7wAAAAAAFSIiCaDPCEG7MDrkdUByESqVnXLNe0AKAAAAAADuT7DA0dGzTVsvKzNiaBCWQxE8ZTZCaSkAAAAAAHx6dIDsFfcWirZDtnNiA4WL80DLaQoYnwAAAAABKrqMMu2g1TgGJgGtuPc/kXQIcTLlH4d9AAAAAAFZZgTqIeg1kQE3f0EIrhyCsXqij0HARLgAAAAAADQncMBQjggzDtHn3751PTERlbvHAAjlRgAAAAACcan7oFc/b76ZNqmRfG+ucmVyP4Ii4nyUAAAAAAAxW0M0Y3Fkyhqd4z/tW3FHQ5Rq3S3ZJi0AAAAAATe7d4B+/dAGT0o79Q35pncTIn4gs4gj4wAAAAAFMSY3tI/RYT1Y81PwDwHges0TgZCH8MyVAAAAAAbDZtUJkoh6ZBlpZ5HodJeE/gVWjF5A4cwAAAAAAGHzJbqbIEWrzff4Or1QbSAzhB8oPP3YRgAAAAABoTuGAL0hW/hz1ZvTRRXxNYms0jHoisGUAAAAAAYcnzaAwaHojiy+P4VVU50myij3MtJCrvoAAAAAA/44O4DHTOg3ne4wgI3+wHyL5dMPOIvZcQAAAAAAn9zE2cfWEDGeWHsx1+jGWA+EFi5K5d0pAAAAAADGL3lA9wTfUaCVBaoUq2hAvFbG8sAR97IAAAAAAGempxj68idB+LdO1kgFiy6bMJ7LeqpegwAAAAAAIR17kQzK7aAajjg4ibtBYT5SYsuJQwy7AAAAAADQncMAEFnF7Oay4k00xmP6msPCdL5epuQAAAAAD0/YOYARZR+yMfK9BJ6Z/QDDe04O+i4ubgAAAAABjtMp6hLkJZhtX8p2jumSh4Kpq+csi7c7AAAAAAaupz8AFt16S3HPi/GyXIctHoJ0WekQrcMAAAAAAGlJEo0XuFhSizsvYgkGuYnjk721z8PtJQAAAAAA73BiUCcmGWW5t0DB17reYUdI4lwwqoi2AAAAAAGhO4YAyByPwMIQxqzt6ram101EshjCttEBAAAAExyEIYBSt4dGCADSJ0TcqwBM9vo+bOHuoQAAAAEAAfpAAAAACY5CEMAAAAATHIQhgF3HmG72xGIZ3XOaa3rxP1sZ477hAAAAAAOqxe2Aah+Y9dYScXR+jn/ISclPhl75gl4AAAAAC5C8Wj2C6jSdcLl2RaAmHaUp8nrRJDwHLQAAAAADQncMAJAGXWu8PODQ9FECJeKl0bBEXU/TAAAAAAA5uvvWoBTIuWbqaV7R0vXkf/UMlbqHGVMAAAAAAaDcudShfE3QDAkqiiAExfdRjJrLRkOxSQAAAAAAGUFDLqsBAFzy529v/o5VtPcN1CZGO4ydAAAAAAASejmA13UqmEAcXBia4HFMnQj9Jupr4rMAAAAAAD1X3ZTZdfTfRNSoVt6wOE45WRlTAww24gAAAAAfVVI9xO0t4N2Z6zP4S50cjXeSTQ4e4H1IAAAAAADIS6KA9qtkF91G2UcMyvGlToEQZQSd/owAAAAAAD/G54D8CrKYJEjE2OMi5j1eOnc9ThELDQAAAAAMOT5tAPw8UCWAf7g+glcrMewhlpFUXJBvAAAAAACSq9WtH++SR8Zr1AwXkyLVrRS+4THS7NwAAAAAAPYBWTYg1/jclb2EAdFNWZB8wBwc3ref8wAAAAAAFJTcIC3AlicwaGaS4KhvXDOdKYMHzpCIAAAAAAgmKZ4AQZfC9B5J+MHxTa7p3CcF6iUQBfgAAAAAAVDikBdjS93ekI/o6BGtNj9PJDUz+fRtlAAAAAACXCTZHKOlf15BXuEjP27s4YS/eucg18XkAAAAAAB6SEtqq3nvmfH8cKNgVeIRfiwIfY9JxPEAAAAAAAvrwgDDY1tOJEfilKo4eAP/hb0Kl1baAwAAAAAA0wykR+PquDXLO497rxOnokyDxjmogciHAAAAAAZ/GcjA5sCI6X3OaNGDAlkoMRHgEMJD8R8AAAAAC60sRYD7Rj+OhPerzGbQ5zCCvq5ED0inNgAAAAACOEFNlwYMKQKIRQ19GVaIz8HVueAbEFJnAAAAAADwvjaZFAWahV9DBwMhBT/vdT301tng3soAAAAAAGhO4YAlkAIHv6plfslaiKtzdNHNvzoeXgAAAABGIHRWizDRSN3ZfO5j8Peyh/ule62jPEgaAAAAAAAR4aMAM2eLjeG1iZuBbQZ3V5gES+/q8IkAAAAAAYe0LyA7h5pKlWbESlxFCnsD/P848houkgAAAAAFlkn0zEncK2DDq1LCcw3JRi7poP2eRG7+AAAAAAML6xT1StmpJNJbT4uHK6zBRciMrrJRM+gAAAAAAI8NGABNTUUPX9bsZRa1sil7Qt0aIqnyCwAAAAABY9b4gGolT7+1xaEmP4+ApoaIlTum8oxjAAAAAABIPlx2ajJfnsii1+UGiWAZpT+RhxWxXugAAAAACno1ggB1y6sOnm5GM8fcP12pc13i+2cPMQAAAAAByuuWx4gOo0G9eIxWy3tBWGzXxksH5etJAAAAAAC1fwNAqIGYKCQbQBPmZzCA3o2F7T9Ca0YAAAAAATaQZQCrrPaC5gR8fWMiqexuFOd04rTBkAAAAAAAqxC5gK2J/OGbKU6xCYvsqfvvdX9Zw/2HAAAAAAFkb48A4JT1Yfr3RO/5STcOyEaWlo3GqdYAAAAAAAExLQDQ8Ol29l24w6kpvgSXUUTgcbfIOgEAAApoDv94IO4Jfo4ozTSGMmVSBEgJhqstuV2yAAAAAQAB+kAAAAU0B3+8EAAACmgO/3ggMxdVSo6qgupOEDhgHDmqKyuiTeYAAAAAAF4KKc49h3hfxED9UOpj9bv5IJnwYI+YeAAAAAACAClN/UDvEPrcHqPlgJXiKQiiMjZnxv/+AAAAAAEz3rKA2OqCrB+MYzlQaVEeTt4bJkho9eQBAAAAVuCJk2BC64a45gg3QHEZwy0MPL/1bDFZDQAAAAEAAfpAAAAAK3BEybAAAABW4ImTYGo7/+Jg7f7Q6M6ULdUIZqbgzQujAAAAAAElyQugbRpUUqykggqBfxpJHmYcKQzqykwAAAAAAEXeWkCS1hloC6Fi4iT2GkFy+MFfSnrVfQAAAAAGGw6rcJ7J8I4usaiC4y9WIq4q0LQJPbI/AAAAAAG6v/awoLyfT8BlDcynhgIbBFvio2Ye2+AAAAAADBRn+nOm9GrfEmSbyfGbY9DNh3RkKOJ1DwAAAAAAAjBW6MHXRjpVg32Tzhkqg11esdt6t4TMAAAAAAJUC+QAwiSK8SK3betXxYMjRP5Op5CA4cUAAAAACazb6GvTCqOI27p5t5t/Z9AYettHvmU4gAAAAAAFYEVwgNZQEcp2VTzKsI/tPR0xHWkhPn0iAAAAAGvrHcUI6lQWRUSZUjOCVxM8b69i/dFrjKEAAAAAARC0SrYMTemU0dXbH8vLbO3oAgI7JMbyXwAAAAADlelaACBZJizBpfuj5PS+hev3uLyqLYgBAAAAAABfXhAAIWFcGh8nvD0ZTzVBK5YVRLcBAckAAAAAAZ8kgj1rJEVTb7XfSMhgFkSPemmYss9uIgAAAAABLn5awG9OTNYHXwYUs4BItCPCuYig8FHeAAAAAAE47KSAmY3H4hu8QNRxnZQR1tnvR3f8/xMAAAAAAnyXX1jaUxWlDe8Rta5UzvRtnBJMVxs6VQAAAAAAPSeEgOB7uBcED+cSaJryyfGVjfCWZGLCAAAAAAN+EdYA6w1a6DOXOar2z3ZPDKH7m0Rz9BEAAAAAAMXHtyT6uFii47Vo57nOq/jEAaUBzSkkoAAAAAAAC/4+HB+adiuHF+7CpadvbYdkyLO7bw80AAAAAAAPpW6gMo4Lg0vjiMcHDsjqEG+ERBPE110AAAAAGHqk12bL81Dy7h0G7XEKtSfYcOYIHwdaLAEAAAAECfSwIF0ChtnDy8jOy5Dwn+unbNS7k8uKAAAAAQAB+kAAAAACBPpYEAAAAAQJ9LAggG8cRl3MybZy7dTm1wUtEb/urmQAAAAAAFe+wuaMftON+6q4NmoJLjOb7GGXeqDcNQAAAAAAZnQ1DqdnqclzqxupFPrEGi5DTzPeq14fAAAAADfxfbowr5bZRvPrg2hmyV8o6jUh4m/T+4UAAAAAAGzpLzfDE1yGZFrJZck9PR4anwwexYahUAAAAAAHlCGVgN5xz8NIeiGJCFdJnWzma/rEIOZFAAAAAAunNmSA77Lm36hkuPM2o9RglnI4VTXYwmAAAAAAAT5J7wAAh4uMzA+j7uf+Kjj1wHORL0MuUgAAAAACiws2PUg+31GmD47OnjWMFDFQ88zl4WKvAQAAABFPkc/ABXgilYS3kbMbsHD0cwOoMy4SpYQAAAABAAH6QAAAAAinyOfgAAAAEU+Rz8Aulyf31NcP3UWmoEYILwfsQWXErAAAAAAAbzGbyDMeeWkL8oxG4561pboJPpp5rkfeAAAAAAFg/bsDSpZXLrQBCYN54RRsdIPh+ANfWNUAAAAAEICIDNtMLHWjr7lnQzfw+vUpPfa5YIIufQAAAAACIwD1gE31KHRV9cA5odwO2RX2uKgksacWAAAAAACn8SoATtUae5NPFZEMIpnUuaomCzSEcQoAAAAAANAFLIBRK6srN7v7lfizO5jvR8eOZgZNYwAAAAAG0TNKMmMxER/xXb9Tt7n1zXP9DI8EXqAhAAAAAAAAmJaAcx8I0dE3x/JzwPiImp8iY+IK3l0AAAAAHAh/T0igvIIkrN6k3peo8XJGAphgbmQ6tAAAAAAIvAI2gK9nYN2sIsfs54DxhtT8pl1tDoveAAAAAAAX14QAysVG+6rQv+NEUa77Tu1pwZOcVwEAAAAAATe2lGzlCUWIYZKvjeqHIGMnmOTlBfnsuAAAAAAALTRhNPcw3t6n2Seh5fvn6348Vr060+BBAAAAAAEzlqRU/tNBJtfAq0lwEApboSq3d5mMObkAAAAAAaQj02oBg/CuqvFBjFnQP4Dv7mJ8G2P+JAAAAAAAM0ipgAV52XMS4j0sQG/dY7VmRkXCviSxAAAAAAAlWmlHDrV//ZydpE6kHjg6MHLSqkxrLxEAAAAB0zue84AaAnj2oC9nzDS00UG9ENy4PgNgZgAAAAAAZoUeADCglc+IE18l2MyUut4oD4sZJ79zAAAAAABoTuGAN7xKULE1tUCe4gPFOkmT2ghlQ5YAAAAAGAU/TlA+QTSAvhFket1/zPht3jZDH4rgDgAAAAAEee8qC0DQYSFbDDpAnQWdzgJIzCZeRJgwAAAAAABCKbXfYYPZKcOP9EUUmvYMLXadvXX+PN8AAAAAEGPttwBi+JHsO9DttaO2kbSJk2aBgzSU7wAAAAAEqBfIAITf1HMI+8veQ26p5d3w28Jy//B6AAAAAABdQ21grP0G4b4KmM8130MnjCdk0sjawGoAAAAAAAL68IDSr3UQK1eXPD0Ehwhdz8oHALRDuAAAAAAA0J3DADPdVyDo0q86YI0I5Tq3o77n5xGcAAAAAACseb7KNd9EEoRlHaeWxcZgFQIPaz2ZH9QAAAAAAFxE4vgqLY7Y65NL2XTweCPft2wEApSriQEAAAARYBwgIDsRGsSB2Z1mwUyCSZ1BVVNkqHkrAAAAAQAB+kAAAAAIsA4QEAAAABFgHCAgYSBYHopT3+TRVHZx0hwspeX9xzcAAAAAB1WL2wByZ9uzoigpcn8Jl/DWZJZRhHxTdwAAAAAulsjTwYNVFLixtZuWB3s3B7tMwFgQkXkYAAAAAAf6GD2BuYuM7Or6S2+RCTsNd38uABX//zQAAAAAAALkDSDMWV/4Z5Ee+EaqfwIAnBrE0FPIqQAAAAAAaE7hgNOxCDg2GonCbXUsXJtevJodXS+6AAAAAAIJimeA1G2vMllRVOBQQrgqDfGYSwVONCEAAAAAADUyeCDZkX0IV6PEeAwBn/WeHUP+lNuI8gAAAAB4MuXagA2ljSnUdQm0D6VHXsDds0SQGedTAAAAAABmaaBWJvKEiTVjVkzNwN4+qua48RG2fE8AAAAAAM4f8cA3QEH5QFLqCyXjWmjnVlWKBSk2eAAAAAALpDt0AEaQYgjro6DUnQce8e47JU7epfNnAAAAAABhoSFGdQD0lQ8VI/ODH36gQcN5jUVMzOQAAAAAGRHETaCwoXywgm5TJMFQtzMY46QebiFvaAAAAAAAJApINbtelU8DGJ02ZGI3Sp8bfgp5kc/hAAAAAAkGiAVF4lkhySzm61y3KYk+tjtjg7qwlZoAAAAAAJOFgMD9zSa0i1YM3NcchML/Y2hlzOze6gAAAAACQe+RO/+jGV4o+ieUqxqk/sZmB6dc4017AAAAAAAAmJaAFZAup+xBqYC1ShVkdvJ8rumjPSQAAAAAADMcaWAe3T1/4t27OTt03zcLAbz+sKUnvQAAAAAAQJrFyCQ+rUALZ8VKNtYeC2IoIJiQeXniAAAAAAAAmJaAPLDomQ+CYRkpvEdEl8pbrPXDMOgAAAAABSrIb0yATiiSBamVc69e/cv8Z4zSD52tCwAAAAAAD6VuoJfiX5BnDyyiCYsdzAtBWgwzxWpoAAAAAAAjw0YA2Gq/6H3iCvWr4JWRU8+cTqP6PgIAAAAAAGeuqeDZ83FcB2ddGwMklsiJxV9tvfguXAAAAAAT2MzXmdyiN6g4r3uWf1upeXY5/OUYGVvXAAAAAAB4eh6D868ADWMw/SCbQHE4sERYuX3XF6MAAAAAAeSV9IACT84yMGw0vH+OGpLRC5wqUkYLKQAAAAAAyAgdWAgTNnDbtAPyoH3iw5xj+VOdSfH9AAAAAAA3zs3gIAAAZOsi91YM6XJD1wJuiI6zuCwAAAAAASoF8gAfcLAllNDxhaXtGZq6SD7NpnBXGAEAAAAI1BnQwJ1RS59Q5V67R1QlekaiouUXoktPAAAAAQAB+kAAAAAEagzoYAAAAAjUGdDApe9Bc7emHEbezzTC6ynOsYy76IMAAAAAAHK9K0CmigrSsSDurXLSlRvD3u1XN9aS4AAAAAAA3bqyALz4J23WfxrT4ELVR8Nu5qD0ztBDAAAAAAAVLK9Q09sk5O3vApKxqMgwWVeL7a3Nk/QAAAAABBMUzwDXBOcdFghZRUcGIAbexQJ9V/snAAAAAAAEIQiZfuRxsiwlmzXhWo/AYiOb3ZoURSxIAAAAAADsWxe05/PXQHf8/Z4GRBS6/a46l6NwipEAAAAAAUxLv8ACBiAPMdEkx8E+0ZPBKMn3X+kgqAAAAAABOOykgAwfQwlvZlJMrzw13SPR5sBubhBrAAAAAALnMj+UEkQKTFnQ5DVx1AkwgsSfKyAWcI0AAAAAAGhO4YAZi39ekyj75PrrsaYOV5X0VoNOQgAAAAABCj7VYxwUuhtwzxYVJ+cHkvVfH3E3tmsfAAAAAEDI/g6AQH0pRBlPhUVWuL6KTBcMMekFJIQAAAAAAJx2UkBP5LXcx4HcDfy8h9SFSre7ne1qpQAAAAA7k61Pi1MIWuC4pZCiwcGirNn1LJGhNn0vAAAAAAFA9wN5ZKE4zdtpTgwNn4oESCffW7BAfjAAAAAAAyB9iYBl4xKkftaBVGvrZxrL2bMD/U+shgAAAAAAcctmq2bfraIhdSUq02ds5jnR3o+kyZjUAAAAAABoTuGALI0MybifrIaBJbdT7dDoRAJ9WCwBAAAACBPq5uBypjJGVsUlowVm1TjbDVg3qLkWLwAAAAEAAfpAAAAABAn1c3AAAAAIE+rm4JKdyCA10jfskbHUwivK0vxNmNGpAAAAAAI1Z6d2qlB4dvmwHdfBb329FMf3pxQoeM4AAAAAADlelaAK/FDpOaSQ3VL8gsLYLuw4xQ3M4AEAAACLsslwAN7CXQJCB0aDhGWcjpNT5yzvwtGKAAAAAQAB+kAAAABF2WS4AAAAAIuyyXAA7qq6tmxNmApHsIQXzneGSvYoMKMAAAAAAgmKZ4D0NAT/jorO50rnay0G8FvQR0JcXQAAAAAAXGMfgPX2cp9VJmaQAOF2e8zh2R8sIV8wAAAAAALFI+rACKoF+3UTRLbv4M8kfbsfQx09rBwAAAAAAD6VuoAeLi9MQRljJN8+NyRQMojD2EoufAAAAAB0alKIACrgGaneSjG7WFJwfVVxteiBg8VJAAAAAAw8EEZYLpuSd8UvXmRsGWW2lxTuOUOG9UQAAAAAAJurwXRCNlwlfYdu0pX0dhPcnNuVASxR3QAAAAAAO0bdoHm0YUQVhvuYEtQE7MFbTni3mr4fAAAAAAPRUqJLfzOW2PJv/2z5EcuCh+NJa3eL76MAAAAAAJTKO7qw5LcP4kZV+W7rCEUKB4rZ8b5Y7QAAAAADsj4C/7Zte1Bt5FhMOuFnkSruPVLFtHP8AAAAAABJ9RsAwVwH5/VSx+jhc7JlgzU/EYDzZfYAAAAAATKqeEDRKsahY3IZy2HK9K26rOWsCcOkeQAAAAAAaE7hgNE9Y35EtqahaNTIFIPey6JDzq8cAAAAAASoF8gA0Z5fbIKe6RREnHFuQMaFybGGGugAAAAAAA+KurDnnFufWCQG8EviguiZ4gTUT8zgxgAAAAAAaE7hgP8i7iigUbnU2CoHGjq1wfkyzZMyAAAAACeVxs1BBd5Q7dWQOGrP1E1QIOft3pnnTYYAAAAAAaVgo80GIByQjXn6g2LaXQS34V8aWghylAAAAAABOOykgArf0nyVXS2QU03/Yq+7Q1DD9E7aAAAAAAAPSVUkIfPCwI2Gf4/TP2tizWO23ZrFz+4AAAAAAJLdqABXjaWzqEuG9+7NBlPl9jYHwBm1+gAAAAACVQMVQH/oAHW8LfzK1/VO2DcNz4ShvxQYAAAAAASS2W60m1X1uKcoMHB6AiRbYFPaYHvZC4wAAAAAAACYloCeA5rQG+GuY1xyYiZW97i82CCZ5QAAAABl3Qg3AKlTzGlzkMQy/OaeqmHjM3G1qVnmAAAAAel4IjpJrGOEp9t27pxkZG9gi3msZjIkbXQAAAAAAS5+WsC3KTPxIZ7cdWzq8UIUq1Pu6ehDfgAAAAACx3fFe8K/tyfbqrHQ/Jz7LodGrHW4QH98AAAAAAmM+4cAxUrq07WsHuIF2iVrQYBEN/eAJA4AAAAAEExTPADU9UsBOpncCMzm0q1kLTV4el5CuQAAAAAA0qpyVvJRgePPMb0hm4dnkfwy/Rgg5crYAAAAAAOcLpOA9LeuTIA9xMB7vGx+ktUXi/liwNgAAAAAABoTuGCPtA0sdhlvcFbQJbX/8iwIhoSpSgEAAAARYBwgIPVu8ChItazx+UNbySJOiX0Sh9SbAAAAAQAB+kAAAAAIsA4QEAAAABFgHCAgCIggXpt8eJbc3rw4vH5BZXXx8rwAAAAAAJx2UkAPgKTBTlPNq6TNecNqCQF9t6/IugAAAAAAAmz4lxCDGMMJ623L9PqFNGdz1kNBJa2pAAAAAAEJIQ4EFck7GerFK/oE2IDUy4IjZmnbUu8AAAAAAKR1g27CPleEST9+StJSGecMbkSHrL2HAQEAAAC2cSH6IDhds3pSZ1iicjZ9YdpIbhZUudluAAAAAQAB+kAAAABbOJD9EAAAALZxIfogPUEmpo2G/1PlkI0CGiLFP5jCH9UAAAAAABLGhMBIyjmB58UvK5NT/hFjg1za/l8vEgAAAAABpd6EZktw7mS3TObPcT6vjhFlUWcL4+b6AAAAAABl8qIAe84Ubxc906HoQnbWJbdhdxd27lsAAAAAADA8CjigTlWkADeZ5DXUe/6qOz5qalejSgAAAAAXEpyXIKMTB0vHpapDVxshRXvW0BKdeDb3AAAAAIBGbrNmpWNFsDy0yGDBkro94fqOVk7IUeAAAAAAAHzDRLG8BrmwY6tMTL1BcYkqdmmnBbJDnAAAAAAAAJiWgL1Pb/FrZGwS/IQWrtr9SyilDeZYAAAAAABkI8If0WFokq1pWY/M+hN7LphHvVYzmm4AAAAAAA5fUQ0Xv2Y+e+a4wsfRH1i3QmsZHspROAAAAAABoTuGABltDJUJ+z6zPPU+5YbJgN+5OSn1AAAAAAQTFM8AJUqGrrHugw4qvogUZem0SqoGFvkAAAAAA1y/RM6M1MWFGBq2EflDjErdfB12K8oMvAEAAAAi7LJcAHBBEPfSCpDdmJVuzahOTQbFBS9SAAAAAQAB+kAAAAARdlkuAAAAACLsslwAm8mef7EUmV1h3ZcC1loKBgTvTMAAAAAAAAW42ACnFzbEa9w1t/NMoRC3oMW8dGLbWQAAAAADQncMAKiaH5mrhjK188SSm0zW4TTl7RInAAAAAASJoxrKz/DBV/2V9A5PVfwzeRZLqJ+3A1gAAAAABEy9lkPSMTuFav7kZeozTU2ToBfUK7zdOQAAAAADAAF/QOtXtd209rSybckE60d0+1TBA8UEAAAAAAABMS0A9rHijnL/PCoYNd5jo/OdD9DwI50AAAAAAB3NZQD/56QOYHUTzzGK7/05KdNYTv+3bgAAAAASoF8gAA0FnL6U2Vu6AaJA1S1UazQ3MyJ1AAAAAABoTuGAI4DwCm3qnE7TAlsiheV4KUbaZUwAAAAAADlkO1gvBTLj+oEe+juTKi3a7b1w6T4J9wAAAAAATQ+LgTXW23aPlzKTKG5vtfvjPrOa06zuAAAAAAD4jr3ZQ4aIv79y4FNiNThwSb49YWmZY6EAAAAABg7j8+lFDK+JkWUAC3YIdacykx6HIZshOwAAAAAACm5JwE5LftlDarTof3S8mcX9KGwJOQADAAAAAAHcTsFcbYcm4zaGR7q2wnf8q+VM5jciR/kAAAAAABl0TZWitrCZSmOErO+MOAZnnAfhKzeougAAAAAAIuL4ILlmrquxqpn/VhYao7LoHFXwgIcxAAAAAADQncMA0xU2UfCqJL8/yT82bOD1GuqgpOYAAAAAATjspID+SR11QTImsYhBmJvUtU/tG5UytwAAAABMK3oFnQJm5O799ZLTxwPW/mJjn3g7Wcx3AAAAAAA4U45Ae2bZjSafmhZ6QNWXs/YNr6piEeAAAAAAAADaM2B9y5x6w/T5GqxPylApfMe7zzuxeAAAAAAAaE7hgILBG8AG+D5BcGmoqC9GuKXlxc19AAAAAEhHoSCOiQoUIDiGyaIBfIyPU4OUjF3x/owAAAAABiJpCDTIZ66SOPNsYaiSiyii1M+F6h/r3QAAAAABoTuGAM3kgEXoJ+RE43xulMd6uZoJx58HAAAAAAGPdQStz/2Yxo27Z92vHfPpPNI0jiZZJfkAAAAAAGjUZTDs4V93S1nbEGenYw2DvW0rZgkTlgAAAAAAnHZSQALyjUqjj7Q8SJ9geflmGyyCgUpBAAAAAAgmVQNC/ApCG350YYaLIuo8qXkE4+ANAqwBAAAmMuMUoAAHoKVVnvfEkZZBqsP64m7eODzuhAAAAAEAA/SAAAAB6PHBCAAAACYy4xSgABWUAfGKhyn7HLj5sQnTofl716SZAAAAAAA1DFKAVN+tFqLOsipJT3U2M8o+ya7mg6oAAAAAABoTuGBdtcG56yHxr4+RG/L9gJZTWNQbvQAAAAAAAWd/QIQNsBw7FWHrg6iM31RKT6niODMOAAAAAAE47KSAmnQn+d03FK9xRnlVI6Ui8vBoK0oAAAAAG1iQxoCvzTE3W5xM/zxqiu8xcuuo0a0KDAAAAAABYk0L47U0P/OVCpss33GuMglm/mAQ0b3gAAAAAAKgo5qzxLmg7KYIrJThxoH+M7EGNVmHPlAAAAAAAJIICIDJP1SlDcNi6eHmVzW/IAhlxKJL7wAAAAAAdk6L8P5dqvAz50OcgWq8sJp61Th+02l1AAAAAAAAmJaAAT+VqcjeLZgKfCcnPs+Dw2KLsrsAAAAAAsbIZAoob7QBmRNT35GEpC0xI8yp4QgrmwAAAAAAlkSAFHtS2j5qACr3EKUpSKL4CQohDkwaAAAAACi9nukAi+uSRxEXX/ToEqb8IeCP7G8ihOEAAAAAAA+lbqCUBiDp2sKaJqC4Q8uvKt5DqwbhdQAAAAABoTuGAJ1LISplTTp/UpGujgHgR+3mQjV7AAAAACIT3MFZu5RFu+l7TGCYeq076jR7wcxmPUsAAAAAABZaC8C+6Ppod9ZjjGkboWo4MhVTJkFJrgAAAAAGupMBAMOQWoDIWbUe+sZDnGBI6U8wIFE/AAAAAACy0F4AznUkV4Dq7As9bqHBRfvU/PcI59sAAAAACcZt1sp8THwGJ7VxGJpuG6BQRYtgKyPoMQEAAABW4ImTYNDMUnYX2P8/CK5z+BFWrS49GStGAAAAAQAB+kAAAAArcETJsAAAAFbgiZNg0xiXg08sy1rzvZTjnlK7ZSO0XOwAAAAAAndQK3DaNw2YFtml01jmqnffmFz6t8zNWAAAAAAB0kHcuOKvVVPckUvf71M+exiQxBh/+7KIAAAAAKdKWZCQfZiibudnJvk0RcZX1zAlAk2Mt7YBAAAA2GKmRgDoJbLOZdYZhAwSj/k5d/Ff7cOsqwAAAAEAAfpAAAAAbDFTIwAAAADYYqZGAC3DFJ1kPXMLDszkWeuHj8gnWdDuAAAAAAFrJGTwcTAA2RCtYF6C0NjCY7mPdfQQc8EAAAAAB2iqQI51GWl0tj3SdKtkR2qF5GXt0oOjKQAAAAAARBs0zqPCkFXkCuNMvvUjEVVDi7fdKs9GAAAAAAO+oSt51likF9Ok1fYRTZcjKvOXgGhF3dUAAAAAAAX2qT/ZkfnLCDmIDYdlrpxB8gFWMkdimgAAAAALcYwbcN5Q/OM/1wthkKlmXVXIFrK4xIrUAAAAABNa7yKA3vEVbRPKB9ekJf5okgmwEmi236YAAAAAAO3GytrkVOFL4GFbmyqzY+4dv0rZAJYsxQAAAAAAZjLYLwg91lygmm9ppZ7cK8mNOeptYht2AAAAAACw/XLAD6rJR34iEq7216rmCsvoa2W7SMYAAAAAApphQwARUAzdaFKjOD+w9mLkhHpFE5TaPgAAAAABwPotKxTswKmbsK/28SJKY60ZnMvVgI6iAAAAABDJ1isOFwvPsoEpBwrvmQyjEHAeXYNC9dsAAAAAAACmUiAX3f5EJYgRwRJ/M/uBbCBCOAWQfQAAAABII6Fohx3FjULD3W5a2oCBJpMT2Nnb3G9jAAAAAABoTuGAIj13CWZISV8aTmfwDqZrLSqep/EAAAAAADMcaWAO6ZQeEtEeznMmG2l/NKKA0srv1AEAAAAIp8jn4DHXvxisoV/Y5vp0ea9T5DHfph8eAAAAAQAB+kAAAAAEU+Rz8AAAAAinyOfgNGFX86IilC57CcoYsRkeTalPCY0AAAAAABEw7fw01EQ7OanwDC7Tv/mqoCE9gpQ7fgAAAAAAlQL5AFqhiBe0dQ+oKZ9evua4ttnj6wVQAAAAAAQTFM8AbsgA6II3ZY1WOUBMk7XTMWwmKRsAAAAAAnQdojRyqS1QPybsoeJApvu6Ij2fKilpkwAAAAAAaE7hgIcoZYz/59SFLqD6rRv6tiu8/drgAAAAACKwL92Y3O8r9u+xCGtj+IVWhzno3v3KLqQBAAABl3Qg3ACXnPcPh+wsgHDVyxLgXytqRmtxPAAAAAEAA/SAAAAAQ+iwJKsAAAGXdCDcAKcM4lD/xmXau3ryMTVzXarQNZYyAAAAAAA/xueAuHovWaz3mpj8w0PCzvIPoMZfMIkAAAAAAA7sDVjeOKPuqAtU0dX1mwpGcTyxbkElpgAAAAABOOykgN6IqVa4LbuB4KohEnfaRkXJY/bYAAAAAAA7pXhg3xhaMwp4Mcyx1/+/dVi1s29XEbkAAAAAAACYloDfQxGZNG4KxnKitG5cMmTkeFOZQQAAAAADqsXtgDzYQcPoLLbJhT4nEbk0P4oNHXcwAQAAAFbgiZNg+UFtfv8ctLPy5NhebIKf8hHmWyAAAAABAAH6QAAAACtwRMmwAAAAVuCJk2AAHwh5cPNKRNAH5szraGEXCDEioAAAAAAThYJV0AFiKmM5uHciHp8kiQc//Qq+zQFEAAAAADo1wdqADjjSxYV+ldZJ1ZiOtrTlanr8+e8AAAAAFPdl9IAQtrL+5pg8A+l4iFxl6FrX9A0DywAAAAAAPy5RAIR4FjCczDILzX7KG6SQWnDTt/E5AQAAAAOGq63gE1bNDnqzQuRlX8L1wLrpjKp6UFkAAAABAAH6QAAAAAHDVdbwAAAAA4arreAeNCkdN0ig58DorfaXAK0hs4jvqAAAAAACHmb7ACtg7Y42gKcQTeLeZc9R2VCt0GRRAAAAAACAZ6S5Lz337a9vf21GDdysur5nsi1Q+N0AAAAAAAOZoYAym1/UHCNgxaqUbjFnK+tB8GHnIAAAAAAEZelw5zgTnVX2fgGLvDbV0WXNsy9ES/ddAAAAAEPwVkqhQBivrgUJfqTl3KWc9+bIyyMKqUEAAAAAAGhO4YBAbYvqplqxGm5+hmJa9P+prO1n7AAAAAAEOS7tH0rGo+mc89/hAkqEzeFeErk0Ftg0AAAAABj+7vskUb97Zt1uGZW3p7M5VqhjLtxQ6mMAAAAADEPuU6BnRrV8OoyhLM26jiWaVdmnwk1XUgAAAAAA4kRJDJM9kDWS/RDd9jAdioorFPv+aqW0AAAAAAEBL2pCol4vSejhD1yIuJIR/gsXgvFjm5UAAAAAAHTTOgCxf87XTpYB0ajapO7erxOJu4WpsgAAAAAIJimeAL0fT8ZrE21l8XP1LpAm67K767BwAAAAAAADkBgY2aaeHvvEF2YWFeqXTvB4hgPrqYgAAAAAEEdiKNPxxY8070GWzOi4nVDOQUtLQSZL2QAAAAAGwMhZ5hLtKhQTX7ZhovQcphg8+pwxJHCZAAAAAAc73+UgFkkaaOb1UbCIAlTZc4m/0RvvR4IAAAAAADaP5UBY7CYqpGEU9WjM00CLhubUjJbHSgEAAAFhQCrEABtGui7sbwJTKMuHO3vOQXvphj0kAAAAAQAB+kAAAACwoBViAAAAAWFAKsQALERmhA7H9NWM86QV9P7Zu7ipoQYAAAAAAhP4sUCSTTXnDqRRBKbhw0ZSWYpu5plccwEAAAAi7LJcACz+V6k/c+TlU9wnn9DyeioQDYNEAAAAAQAB+kAAAAARdlkuAAAAACLsslwALWjSIiZ0Rl2HjaJjaXcG4wRK0EQAAAAAANCdwwAt0WaMqIT2ZKA5SsnrCd8OUjxvRwAAAAAAaE7hgGlA7sAoSU+R+GaLiNNh07nHnwv5AAAAAAZCsocAcGM9vEMH1rterEOHv7TkxXClU2sAAAAABrRYMIdyfEsi1uP+C1EcocPxF+zLfCQu4AAAAAADPR/cAHUxVjjO3paFEQgZTqGIKrrxyiL5AAAAABbGQIhMhwWt+hOpx3jhV+e9Bc5aF0x2OwgAAAAABsCI4gCHSL3lP4BV1JRbHNtkI2zgf4o3cQAAAAAANxZ7N5KT5qeyuuS6MPrWJdj4mLKPv9fdAAAAADEf++eAvQuwb7B9ojSLLO3Rw5Nx4jT0VwEAAAAAACrELmDGMnEWViiaKEr17rkzIAAm90BirgAAAAAFokqIMMc3DacHtOWS2qzTRqDo/+NNXNnkAAAAABjtSW3G0Y5cFl7LogFaPJlK0lDdKnIC/8oAAAAAAJx2UkDZCB786mkX4LMp1tapzm6aUmGV5gAAAAAAn9PtGOjWqzhPmWH/SRQj8eV535er30vxAAAAAACBV5KA+NrQw9jSs5qYiqHoSKPDxhwpAp8AAAAAAGempxgQj+ojh3kCVX5Y+/mVfXb6UDvFeQAAAAABoTuGABf2vN8gQRLlXF8B2lh82N7BzthGAAAAAADXaHiVJZ4JpVtVnXVkDcDljqLtmFZPE34AAAAAACiH+gArumS6dlIrjE3Ze2eTSLZtHEY56QAAAAARqpEYtkXdaTsRGkYLq4mGVjCar/BrQDkqAAAAAABGRPJtesJPQIGZbRrO+4VVioV1AGYiiHYAAAAAAACYloB+DuWGrEZ8RmLlC2w4mrf66TwgvQAAAAADVlu7NX9t8dYtdZ/CaHps0+A+bUCF7DwGAAAAAAAqUb2AlASuwWwYulj5tPWFHzOd7mRCMRsAAAAAAA0YDRunE8szjTiA/Ut13qLojqDa4bvxJgAAAAABq2PLtbd3FR5ANud5gnPkeG4MxJhHLlRoAAAAAAGMXvKA2U0FR1JQeqyyYzeeryN3PUThzQUAAAAAAOarg4AKuMOiCOJs+5PD8XjJSqIZw3OnWwAAAAABeUwigCqlN2CHRRcRAyjGP7dIfdIsvm3JAAAAABbYqMjuOzzDtmXjJZtNm8u/UaINn00D1FoAAAAAAWKly4BFPURZI7cw5E3HIo+Y3QCvfXsvOQAAAAAAnHZSQG+x2ztdD2/grIiGWefQWvJoRbP5AAAAAAEN8w5Ajz/0mAQmmEFVdBy1wlrAHok/72IAAAAAABc+7YCqaR/WxpcnbhDvsoL0gwQH5/GQygAAAAAAaE7hgKshqM8D0yGg9PG+8EcJZ6lYepc/AAAAAAIIcVxzBtHKSl937L3e2/FvUI+oIuLGdgYBAAAA2GKmRgC164aTWw4MuslRIkp1R1rUoR6wNwAAAAEAAfpAAAAAbDFTIwAAAADYYqZGAL+15GoCQl+JY3PrySK0qzDSWMS7AAAAAEohZ1UA+BQ8TgPB6q8vwjBByPUrqUUzNCoAAAAAAJvOF9j7p43Q+LEzPzjW1lQgd+tQc7VoJgAAAAAAFpbkgP62yC+lZ8nSoNgexjkXY2Sew9pTAAAAAAAexVmQB6KfHV2XSDQmxsQA0qGMKshSJxkAAAAABBfGGYYHpEXRrJjqyWt3NILt/xrVh+lcoQAAAAABoTuGABX2DPbkIFYRQJ1uZcDCW/m/wIoQAAAAAAIJimeAJsvwsvkk9yddDVjQdgD8PaP8xhAAAAAABjF7ygBEoW9UDh8+EBmGyY+EMSQOAfmvzAAAAAAF6YELnEbCnL2BVbRsp5qGn309c5vJDm+nAAAAAAFaoW5hlwI1G0HBXUBgzO3a+Hf+IIDvq6oBAAAAIuyyXACdQDI74lexHrMHyTfL3aruaueB0gAAAAEAAfpAAAAAEXZZLgAAAAAi7LJcAJ+c4MA3bfw1hyypF9qtWfEdjepbAAAAAAALtlogsKUHIyyO0dQ42W0RRRYgPHWojRcAAAAAAGlZ6OCzkQOzkCGN+RJmJnwYZMup/r21ogAAAAAD/aWoxL67zvl5WcnAQdS7qyr8TlbRFhrfAAAAAAQTFM8AyjNaMeYJnA0PwAhcHqJTX4HcDRIAAAAAA8kFw2DOML8ndcUnOu9euU+y7Rg8M7MysAAAAAALpDt0AKzNGRgoAywinUr0OTaoFKDao6fdAQAAABFPmveA1HuxltqyapyAHQMw5oEPHHY+cy4AAAABAAH6QAAAAAinzXvAAAAAEU+a94DgL7IuanGPiOTeCFKkptpq4tjBRwAAAAACCYpngOXzSo5awrHNgMNVblMkJpNRNEYAAAAAAABmONLAFJ6sXqyVMKN3jx0zR3bk21K0si8AAAAAAUrOR4AdZ0n+tQ8BI8KjEsS3lPC/6lpsigAAAAAAaE7hgB4PrkU8jcaLUJaitOKnHfluHEgfAAAAAACxLMAgSLsZvDBRw5BbIfeGrPGgpirY7KgAAAAAADIALXBYocStsNr+ebOFiGeGaO3RWmMeiAAAAAADAQkQa15PwMRWgynixxsg0cn4M+CU7hCpAAAAAADQvc4gajwOZlrx6mh/2PbDI/fAIrnIS+QAAAAAAEnx7sB/BiCyKcexQ31Tti6eRMd5SK7GFAAAAAAAHoVNW5tzWr8m9PRqHzSYpseGFQc3bpuPAAAAAAaE7hgApiTOYlMKJO0qDCjp94Lovbg/pG4AAAAA9HjghAC4oT7cCq/L/MKwNydCqM/1RUnSXAAAAAAAWkGbmsJNAIkOC+ORsyWysHdd7Rrb4xNVAAAAAABGtLN+y43Vni0D3euaVzCjLBKRWQU5cNkBAAAAKwApS2DZJF61hnKzpGrQMXuLmVe2eq3uYAAAAAEAAfpAAAAAFYAUpbAAAAArAClLYNtpiFCZdSzB7Wj3jIUlKUlbiayEAAAAAAEqBfIA57kNHsBQLFahU7/RZn+VtsKl0IYAAAAAABUQ8QwL7LmiJezrvaPDTBdkeKJrZ31uBQAAAAAAjiOiYFxAhOHZOjHEp+W0h51VfLTshEUQAAAAAAFY0xDaZLOrlmAIeSuXOR/RuZw9Ebta20QAAAAAAUfTVwBv72wgEbfhoh8qSDIgRg26QWa40QAAAAAThw40t3OZ3iUVFK5CdMUxBJsDkNMdM8WHAAAAAAACBsyAgPwT/VG1gT69JUi9K8NbbItSjU0AAAAAAD/G54CC8owlG5D0khP1pcgyYoNSTW8t0QAAAAAAH6Tajo6tIX2z7Z2TUCsEE1jT5FPWQTVVAAAAAAE47KSAnTXP1BNHvGXn00vyZWKOts6VcNUAAAAAA3ZGo5qmk8n5SKMzV/g/yqoobhNQBuwzuwAAAAAAATEtAK88xWwfu7PmFLMOqV1x0zCHO9KoAAAAAAB7+kgAv3RM6358Uj+qkI2cPW2tzxbjkPoAAAAAAACYloDDE4dsA/ogGsQKIiVFPgMonrKOYgAAAAAAJr42gOXdHpBMOtfLcIiCfMwJrsjfQY8zAAAAAAFvH3Wg9DlP891oZaQzatDlw6Q6DwjxtbMAAAAAAFWIXMBY0iZ+jpBsCPX8thFBbpfguthcuAAAAAAAnMKdgGtwdc6FdEYI9wCck0wY1Y9+VHZPAAAAAAJBcZ9ggdYE1EhqZmEMenDxw24L5nHD5pwAAAAAAqGIaGKKw5EOsaEyebhuOuUTQq5YXX1VbgAAAAACHTmXGaQhdx0GFq4mGf+Rn7enP/DmFq/lAAAAAADQncMAqrtbayuVggLKjY4lGDNYVRExtb4AAAAAAB1PX3roaqGogtTNZIpqxXSP8j8Ry7aQdQAAAAAA2wwMwOnY7BA9aHMt440NNo1KJgYJACLFAAAAAAEVAcOb9w96V1s8xOo+9wr4Ux9KpSX7hRkAAAAAAAfSt1D9GW8K7P48nvdYLAD3Kx/w3l08YwAAAAAABMrOgP60Szml9ieho9DB7RaS1kRXVzOOAAAAAAFjo8h0AVNirhxbDfG0Z19SoP6jzaNEKpIAAAAAAGdD2iAVvWfN5TqKbIY7jDA7KvJvsAiFOAAAAAAB2j1y/RwIRcApXwsJPtXKnj00Kp2GAPvOAAAAAAB9K3UAHBVcnUEPyNCxWfpexke6sCiLoOMAAAABvmUrPbseRftdbr1uplgmJPqaM4dEA0jtagAAAAACF8WXwCDnqh/1tddXPFz0fUQ1L3XA6E7qAAAAAAcEVVlULJujGh/Y1QlJ92BIGz+XzVjLs50AAAAAbyIV5JovWPYcGVze8mM/9zOWeOkfGB5gbwAAAAAdIQ3aKT2qAGk13xeazX+z8E44/0v6wbZdAAAAAAlMnAkAPuaCMTJvuY7V3r8VP//9PgeqIQgAAAAAAD6VuoBMme6Wzdy5VuYGMmYHLmSjJ0d2yQAAAAAH2Z03lFKJ6D8nJuAaBGgymrCORAc0tYF3AAAAAAN2+zpRW9Iin3FvHGsJTGORtQisZA+KixkAAAAAABZri5RovaD59ysJnCubH7nqrYTkJtgA2QAAAAADLQHiAGoPdsEy9RWIaWFrY03KejBQU3ndAAAAAA83fFJNm2jeVK498YdrI0u1ukDWphz1zXMAAAAAAJx2UkCmrAodqMZGWOztZLlUipbNJGLQAQAAAAAMOT5tAMCzSeIWTCYny+IX2vvdkDWGo2A1AAAAAAAL68IAw/9DnhZ/K7pb6AMkCsE9BMb6jbwAAAAAAGUphY/auSeS1RMoV/8Jt2PGBXcAvoWepwAAAAAAFGoioNwHm0kLkycNqORvRYkTDW8b6jGaAAAAAAGoYpQA3yDQB4XUINheVo5mVg7K4Kd3CyAAAAAAABfdnoDib4+4k/FOVdd00IjyMoGzJALpWgAAAAAGKAKRW/xGPFYd/T9pJXRvSaVbXxkR3AkeAAAAAABTNWZMQXzuWAdO/KjMePak+x+asi89bzIAAAAAADQncMBDGMkiS4yyvPIObpEJoXqPwJRqtwAAAAACjIveYoKDhyx0WqczGGK9MiR8jLXIqFnvAAAAAAA8f6vAjMyQSgbzfjVATL8waDmw/SEaIzkAAAAAABrd6QK+UOgi2mjxapahG/2AO0hD51jNowAAAAABOOykgOckJEh8Fm9fEquZlyLK7LWxBrFbAAAAAAMD4VGA6wnDIT1Z6Q1iQYOalX+3aYi8B6IAAAAAGYKsHKDyoihFfZgAtwVaJz0Z6EJqG7HIHAAAAAAANCdwwAoa3q33fQijcK5UzIAn16p+ANpcAAAAAAAAmJaAKzQZ/iSgzV2HE7oRvrKBL7JHfZQAAAAAAAVmckA5hzuz4e1roNOuYDCWdYRJFmS8bgAAAAAALS4pgEWZz75i/OOl78PHiYEjNJMRQ3esAAAAAAVuvo1hWrZFcgH/f8x6ekObLfxXl3+3Id0AAAAAAA/xXmCBWeaEgp18ATph62hWZ+5mznjBUgAAAAAACmOFz6GF0a/mX62ewHvtzKMDYbybty/0AAAAAACpKfggpCG6RAGUXG/brz/GDwJyPl+2ohMAAAAABUDS5wC3FQEWbxEJd/ZHdm/PGMnNhHDBYgAAAAABCANHwL2cG+Ld2RJIE9FE3x+vTo4ArQcKAAAAAAE47KSAyJlzjExRF/nYuwV5gGNb/7NmiR0AAAAAAACYloDMJfbqZ+J06HjHzIHmI8tCqkU/bgAAAAAByaaCINRWkHkndN3ShixCrvrotJU10UBJAAAAAA7k4qIA4Vp8O9+NTc/KltJaFf/f+XHrYvAAAAAAAJWjGs7iw4TO6NjuDbwtK119T21FeP7yXAAAAAAAaOd4APYQSBFncvr6qtc1wHZjugi08KerAAAAAARgM9qkCwj3gb5CJAxMNqDWpZDnseggqDQAAAAAACXHBUAeYF5qzCN2hNiHknbVVqRDdOMIAAAAAAAAFXtEgDdA02H9mIfjNShjC50rdtP71pwEAAAAAAC7WvOgS8trPO91iTqWSoNaqIh3LagpIFQAAAAAAJA+RQBmgU9XzFW2Md9kxgmPrdWreMGM+gAAAAAACm5JwHCO5/bLWAkhPGPbt9MY59Ax5GQbAAAAAABk3Fyuk9+9kbBuddCAtYrnHW9HIvt/dwUAAAAAAD03B7DEgDRLN0+Mri201wMEVU233XrSrwAAAAAA0J3DAMnaQ3tai5B+7VXeErriryIh0K5QAAAAAAFVJ5u6zotxGz8hA8R2NGrnvG+gYvnYczsAAAAABEdoiTHjIaoTra3asaxiAfzw117B2QSo6gAAAAAO9hPpgx40nswe+BK+9vwf5kwK1Bm6Pdt6AAAAAAX6xmr3HxOsI0qKY0JSgxa9BcmzH6cvKisAAAAAAlcG1IAhZCjA7B2WKlyHql4PyLKl2Iuf6AAAAAAHFvYggCxFaZUguOE+GGaS48PixxENHgguAAAAAACj0fGgLhMbAt4TduPnZMXjzJ6GUrR87w4AAAAABSDLCZ9hxLFF82f4wh9hGEDfreme9/0z7gAAAAABlP08rGVdVpkA8wUPnWa+TVdVAH3GdKKoAAAAAABBkKsAmAbSD3HW24aUeUACj9brLfaQMb8AAAAAASE+rCKehnWKzNfYMRXdoo4hFmzes0iT0AAAAAAAY3edRp/oYH0MqOlr8fKUwUJMXgg+nsHVAAAAAAA/LlEAv7B1ZDXA5ak5bEQRpU8xRFO/QzkAAAAAAPpW6gDU4IMVlYRDp2/lI3o2dDron+xP8AAAAAB6PHBCAAh4Ohpv4lJrJMCaY6IVgrI3zv3VAAAAAA42RHwAN5QUR4CR042ogvB6oRyoRX+dhGYAAAAACxWE/Fox6VOYt+EVZcYc9gnYuUCzwY1+dwEAAAARdlkuAEdWM17egJS4Wd792TfHIe7ueBPpAAAAAQAB+kAAAAAIuyyXAAAAABF2WS4AS/FxIt3vMJHtcR/yBNQHTpo+iHsAAAAAAljaiENsanccYPqPf1JCobg8j5jiZvG/yQAAAAAEH8LAdYbcJ4rN0aKmL+/JjxZ8ukDzXgnAAAAAAAIDSpNGqD9BkkxyMJAig+AytQTi2mwUqm0AAAAAAYhoPOC5V5ftzn52fzE1a/SAjEAzN90XtgAAAAAglffSwM4afOMfGp5V6/hlpD5TntSrFDs+AAAAAAApuScA5uiQdvC5Jiew+6tiLOII0lUDLJMAAAAABBMUzwDIuZw81KM982jZbiZm2Sl3a8uK/wEAAAExlxilAPyyXrSISE7rf9BNuU3/4mS9UFQwAAAAAQAB+kAAAACYy4xSgAAAATGXGKUACnbTMYXpj8rO8PxGAPgqMR9bn3MAAAAAAAewAJhRwX3McUef38JGTvaIFvalPhZpPwAAAAAAnHZSQCyqgL9Ca9wZ3JwA2aQ+LaY1D8c9AQAAABW4IsaAYqFTpe6r5Xr2kEliUdnCMEFo21AAAAABAAH6QAAAAArcEWNAAAAAFbgixoB8uzHzdb59Ap5gxYguCKDjLdnHEgAAAAAEYSzoqYsPoNok3JIJAjkJncUVc5QqZ2e3AAAAAAF3l7vAnrTTRyfgdxODbNEPhxGqEuZLu9cAAAAAAGhO4YCvleShFfzC46fzrbBervJIXdZ9rgAAAAAAZ0PaINIE3/7pY45J5IgX+xChVQnL4klFAAAAAAAPJziE0wnaiivx4cTv5ItpjTzH0e7xobQAAAAAATjspIDf8JJIhuUrHzJyGudR8oeEkCx/fAAAAAAALm8NM/2RHEFd1iqWhj65VhkayE+DLbVHAAAAAABnHbSAGsFNbuqwCaNNzZvEHu8gjZOEhzwAAAAAAApuScAa4n1yxUgR13KkZlQlFSxq1kC2dgAAAAADqsXtgDCNbdKpIw+U7j+e+xnTLrQLR+p/AAAAAABOnlfAMK6MTo8L/IepXVbkGBtywyksc+cAAAAAE9x7RgpC0OQFFRrI/66O63rHXwLoz8ilSQAAAAAALFS5cE0/aiUuDfRCLw+0hXgPsav73Yp/AAAAAAAVe0SAXFKWXddhzOQZHD9yTKLqk83Qk94AAAAAAGhO4YBhbaQHI5AiLKT3TfKZaOIOhDqWNwAAAAAANCdwwGpGlArhxNhvNQ/wFlQLUVWwga2WAAAAAB4dcdoqdw6zs9tPZVr2RS0VIEZKZJD6lfIAAAAAAEOkV3WWsSfZBSrHB3tBXGqMydzlb3ZWYwAAAAAALLQXgKwn9T5u2Mm6mAxHe6rabqwzXcv7AAAAAAAAmJaArz/QdRpnJWDkmhoXhIN08xowNVAAAAAAAe4fAc3Hl6sP15thBCGJ2Ueu1c50N7l1qwAAAAAF0GFI69KYVFCATb392c/lhYsVj3pwEmtgAAAAAABoTuGA1o56550fdmY+g+9869GASBg3snIAAAAAAITiNl75+Xy5GoMKJyBwcwGAnUaMIMiVBgAAAAAAEbt9YA/TqKQhzYJ0DWPyINlo4571IVw3AAAAAABP9apgSrJOFBbL1vuDYIWqZKleN8r/incAAAAAGFxB4C9do0HjDndiDOIsgn6nReVTI/KtyQAAAAAJ8k94AHAqU0+grE13Ni/0u3oG04HwS+HBAAAAAAZA3UL0j/FoZ2WeJ5M/1KGCkCaIOdf30RkAAAAAAGj0VPOoQeIPGttH1AznFxvTnc1YBYPSGAAAAAABoTuGAKnXW5gu9fLp77t3t+F5+Il1fjZqAAAAAAJ9xQsAz4amsmN6xhXTWUCmuxOaxBSMdF0AAAAAANB2PdDx4FJpnC0bz43Lh/8OlrITyYiVnQAAAAAANbf70PkidwCCMLLLTOd+My2uljlXn4aMAAAAAC3LnGSXL2u+/+cwbPGl6vwbpcA55dVHS74BAAAAK3BFjQAH185LGbeVJU9RCcIQ/4kvlXSKNwAAAAEAAfpAAAAAFbgixoAAAAArcEWNABydf/KNpB1Cta4PCHETG+x4vn/HAAAAAAAGx6/wJpT3fvC2yDCxUYhhFW6tdELT5l8AAAAAA3iSkSotoxg2NqriHCcQtb1EhpA/hUH7gAAAAAAJYARMADcf4DYo9hRqRdyuIs4BC0vccknCAAAAAAIxXOyDVqPQ3Up/1oVTsdhCURMWqxmsnjIAAAAAACS2MktfzyOthsTnwsrvlxh4vjteumbVpgAAAAABSSD1KXRpUkjFeYEBUn/o1gGKfFLYNMGvAAAAAAAwxlWphQ07SkPKuJVWLlCa8Pw3XFO5NDIAAAAAE+I8lgCoF5b3o2KBy/7Zyt60HhOxQfbeJgAAAAAAAJiWgLIlMn+vMt0JUvbTgLXce8AaFT2jAAAAAAuicbCAxkD/4UpPR2KUlCJici14qYBj164AAAAAAD9mRUzGRBzo5gptqP1Qpid45iDDQM/+WgAAAAACMFv2+Nmn/wgnusGa19qUctyOYHAh9WzfAAAAAAFz8WKh3CwQWGgq2eK3XrWmt36qbn+89ysAAAAAAIeZvsD5zy6f/+z3YLc/yJ2Yy1CkAA96VQAAAAAYcLMWgP1FZwlwWUl/cSAYFVkyE1y8I2X3AAAAAAoxBYvAhV/ZaxPMmEQ8u7V3/BR2LUxJLhoBAAAAATKo8aAHOXF0KQoaWH/pVeDk9ZrzflqrhwAAAAEAAfpAAAAAAJlUeNAAAAABMqjxoBcYZtttnYD2EISuQeOCBV0YNfLRAAAAAAAZ8HEHIMxUCGPmIKY5pzwkODCoMQqz29oAAAAAGNrLu4D2r9PuPhJDswG7pFThTtfw+Gl1lgEAAAGXdCDcAE3PCwxwSGQxInsy7rQqL2yjDFuaAAAAAQAD9IAAAABD6LAkqwAAAZd0INwAXuL/d1QvY89GF3+c5k8d3eHKeegAAAAAImyQUV9mqM5BMIA+UNpefyHuG4yfJyNYjQAAAABVB53EAGz4MSjbXglzGWdyU9xSO267KMw9AAAAAABXUWqwcWadabGkCVFh6gTm5i4UejR6G0YAAAAAGHttq4B6JXEjiISBmmFvzV2/e8p0FC5rLQAAAAALxQtTXYKOiOANvDpzXq9oBHSetadRWmnWAAAAAABtbY1ihVoHtnpMd/bjB6oaS4t2KywNt4kAAAAAAF5gxECeqOaTWp43iC54PtVlPEChp80N2wAAAABX6AVfLcbpfwA6/ez14K/u+xTe0sKc9IzLAAAAAASp3M+XzEE2r9uFEn0C13dyhhQFIAbskSUAAAAAA3WMY/3TwPCKfXpINLHpcxO+bls2A1ZWkgAAAAAATEtAANrDtLqugRadWZPB+pl+aQUi7Ic8AAAAAAH/HB3A6KX/W1Jkqw2BkE0tdxytzdYPKZ4AAAAAAB9K3UD4loJdgwoQSiF6mIUWtVGVpTNP8gAAAAAAcvEMgAmYcmo14W8sgQIpZb3WOVo6rlj6AAAAAAIKlW7gCl+NmdwS6UB5SGzRFHrPJZ8tQm0AAAAAAR4aMAAVdqJVi4VUXs0NjQtWjTZs0gROFgAAAAAA0J3DABYNhnoX0gMPTKqWdfxwZuyIsPCzAAAAAAAAmJaALJWNzDJeXmORfRWdmgymeGrcq1QAAAAAAHm8NnBGHO4rwBsH36QxU74sUU6aYArdkQAAAAACb3bvAFgAoo8xj/Rk4dP9z4M6/m7+lmKzAAAAAABOOykgWTM+lWCkoAmMR6AqDfQcrjbGtccAAAAAAEDfqoBynUHnH83UA9whR6GZL1L6wvLQCgAAAAZ18CaSgHf+cbRcws5mSSKxY4Hx4YMoKv/RAAAAAAGyPGi4eyuLgNP9hfXHtUu+fHdROYnDmQUAAAAAJiwbFyOFwBsz71iQhrGS0GszpDOO7UOskgAAAAAAAJiWgJavQySjkTOcwTCVL3admLcWiJoCAAAAAFpbok6fmPV2e3/pCR9xRu8GfbwGhgeAmXwAAAAAA8Wopc2+PJEHY84MyQ5rvrSGIm+5mxsNnAAAAAAAATEtAOMMm/Vw0VL4fM8jwRPrSax2dCDgAAAAAAQTFM8A5bXqKJkRwKe+ZbOxysOc+R9Rf+0AAAAAF5teWyCSMJAXPtp283NEe/OP1Du4JUO0EAEAAACLsslwAAimGNMbf9bEB54k21iYBxuWcEGdAAAAAQAB+kAAAABF2WS4AAAAAIuyyXAAEjLpGc8jfIGqE6mm7zCHwE94ZmMAAAAAATDbxHAd64z6FDupl1q9kSoZdUI1YFMxVgAAAAACVAvkAB9WWCyLShb3fie8fK16pgwkkb6NAAAAAABoTuGAMwTvShCa/FCnrSsth9K7wXz6glgAAAAAADiuBUc+P110voNEoR+NlgIIKiPiRE5hjgAAAAAAU3JOAETAI8PM49sIfQkcX2CMXX+Rnv6QAAAAAABoTuGATEBVz0cqVCQBiyqh3tN9+IaWWQcAAAABQlYpDEBWEw/yWvwdalX8hCUfpafNDmn/EAAAAAAAmvjaAFp1bTFxYk5myM4LaPRXQPldKLsHAAAAAABlmve3YZT7ZyuumehgE0zezoZBjV0X+zAAAAAAAJx2UkBs80x+F/pRw+s9af7BjNtd2i5dfQAAAAABkJW+YICCucu6o8ENEZZX+A/l9Cuvh35SAAAAAACDIFR7JVml1Z+/RexIIzIYyZ64jqDmQiQBAAAAVuCJk2CgBJYA/svHszEsoAUNZgWmf9jVBwAAAAEAAfpAAAAAK3BEybAAAABW4ImTYKurl2D5WKFj6q/9memNlmJmox/NAAAAAAErJ9zAsOXclxBxWsFRUPkEpQ6B3TYiE58AAAAAAAX14QCy39AECkdcHVWFE6N60V/8pVhOpgAAAAAAUv5z1rtyK1pOX3CzDMhheIjr25b18jXgAAAAAAbscxniBTHOByJVvT3o4lLOJdgxLTAhZ2MBAAAAi7LJcADFURNkEobyVHZrROaAi4eHukofzgAAAAEAAfpAAAAARdlkuAAAAACLsslwAMjVkjQLZNGjSi6haKLQv2BaYXX8AAAAAAAewYkAyQr56ToZWsgHjoyTf3UERNvPTGEAAAAABnx7lkfNnCWdQP18rkv+AWQQ8cgVKOXpqwAAAAAEqBfIANlXmsVrHNb/9vEj0J25ZCVLbrEYAAAAACi+0BYA7GiU96LN6Ku/VlJLPUy8xYpaO/0AAAAAAHMPkQD2pNvrfeIhzi2mOdPXgnmMNr0O0AAAAAAC78yq8C3/RVz8mHF8x7yBtHHA/YFSKV8zAAAAAAkOe+QQNxuNiTspWWCrnR4FcW+UTmkv4nkAAAAABzwu5o9Xbwm95RfdAy8mwqLLD7Gfa4aHPQAAAAAAvzpkOFsttPgfh49toN47qQTDEeFsgR3uAAAAAADJNp7AjdeTQawktVQjoBemxxLIKL559rEBAAAAdGpSiABgmQFpc/JTZ1heP5Rli9ZPAaf7DgAAAAEAAfpAAAAAOjUpRAAAAAB0alKIALJFHz6UncBQWEXFWaEgZO21hOYcAAAAAAVqAUuUvoePAfRccTf3mvCpUfWZBfvG7poAAAAAAAjw0YDwgHxwzNh6K8gmp8spiyIU5tRHaAAAAAAUCulT/BlSdLKkTUFUh8yElr53cWlrhqfcAAAAAAA+UTEiI6bg86xNRyka3IVE+nsFZNDrKzYAAAAACAsG8/WUeoh9kgb5gSlGEZU6nSuUGOXjiQEAAAArRu4OAFjvcgF6lWVCEPfL/+eRs5QwMs5dAAAAAQAB+kAAAAAVo3cHAAAAACtG7g4AWeMS8yArJqaS5AsJAb2REBpT6rQAAAAABhyfNoBl3QrJaPw2MU6CkISSCR85VuBWjgAAAAAIBUU8Lne96Z1K+cNnHwfrlTIkYRb5KBumAAAAAAAzVjUfxrtW9sl3sxI+taCVcXsx5Iglok4AAAAAAgmKZ4ACjY2FiHxCe2qKfPcGODhcPWC/DwAAAAAEe2OwgBXx1+syrli7lTfqNudFqGbX6nLqAAAAAABnGSCgL3Nxn0OquZiezZTmGhMOUildLnAAAAAAAAjw0YA6XD/VZXaw+f7B06DU8mI05nCwbAAAAAAAFNyTgGlUnzRg2yG3FkV3V3F4fofUQQ7cAAAAAAAINYRIkhdLNnErmx3DXBtXltdlbHKsE1MAAAAAAAJbbaGUqj00iBWx4aHY/BEKRwaJJ4Tr3QAAAAAddZeBuKQvoGI3DCItB9dtUtMexdhcqM3dAAAAACi+0BYAt/mR10BL/TrCdEvudtQK1Ez6YaYAAAAAAMqC48jISmDKtl6ViWXLWYfS6dgLr3kn+QAAAAAB/F42QNHR7PMJOWxrTVDcYZOOkOB3jcLhAAAAAABoTuGA3BxTYhtmd1qJxtmeQdaOETiK+dcAAAAAAP8aE6lMdXqQ7psRovyuLGk/pfmOyT3XuwAAAAAALm+yWV0aPXBz7jDBylZghcHkO9fFTX5QAAAAAABoTuGAfbIWdJN+oP01fZYriRXf39Aw8R8AAAAAAOYS7QCkJi7xVAsOvvoDSufbo6OR8S8fAgAAAAAEExTPALRrpRP0cvqFtgxxDvAQ44Ji5FYqAAAAAAF551Sixqeo/MshNhw9+Ge2E3xrGHwRfr4AAAAAARhGQHP4ySiEuyH+wktF8Z2HYmTsxjgDJwAAAAABKMGyMAUkr7wasLCpAjstPnZVEckynhopAAAAANvXFHcQP4cKfjasS7DlOANuZVOjZVDRZ/cAAAAAAxxDMsVHOg6Esnw7YUefhWSBhCzhtCf91AAAAAADQncMAFXTiwF2u0M5rkg9LkiHAIag7wY2AAAAAAEo1MUAWc1dgVGKy8tUqT0Urx7BSMi0xAIAAAAACCYpngBgNmbDkJf9OveJe+ngq0ORSwc6ZgAAAAAE2SGRiKW3mAudNZjmlhhVXlYCpWCrWxTOAAAAAAuFs+bA1xFjP7Tdv9pGEJ4uYRyuU+NVxIsAAAAACyw4WETbWFGtCevWyvw3sFrPfjNslnLNtwAAAAAEdPjVBfK56rgmbdT0S/RMuuGfGvGZQMhaAAAAAAQTFM8A+V8oGpK9i07PbNTpHjRnisvuIooAAAAAAaFgjZs38GoApJ717rvmFlNB6vA4GGTdyQAAAAAA0J3DAFcgfYRcH7QbLisFRip/krikoShgAAAAAAAu1Vetb5nH0FsUWmfj3vlvvTUlp/Yf/1oAAAAAABsf0JqMkuo7v+xdlVshZ8vb1x0VAzaLWAAAAAAZq2l+gJ9kwP7SGKCexQKieJet/XQD2a8nAAAAADubYpaApAGLLrFTTiddt2Jm5Ll5ytfje/AAAAAAAGZ0lRqnisrli2+Fkp+NXwYGX/n87W8ycAAAAAAIJimeAKpX7g9f79sgUGathXezRZOU5Xw/AAAAAAef/rx6wpSbSbsbtmYlJilFYFgd8sXy/wgAAAAAdNsCBPDaPJfqEQPouPa2MxPHLT3dowOU5gAAAAAAhhxKzdwxnXm+A4YPzkl4EIbk18oCRJ3wAAAAAABoTuGA5tqXLeG6d9BwMvIVmichSmzHsvEAAAAAAGhO4YDvLw6UL43cFYWvIiqRhKSh0FaguQAAAAAAVevlyfZV/gSK0eSZFc6TMpf30zl55aF3AAAAAAApuScA//kq9AwX2JkMXAtbIL9zUIOJAzwAAAAAAH0J3H8ATfUSRJERq2C5ch8VuybeSE9DEgAAAAAeR3j5cgkg0JzycFxczOQNF+/tm9QBv71BAAAAAAL/l5dGCyjad/rEUjIaqtmeuUUSQfoSBOoAAAAAAZljd4AVRkE3ZId38DqJeZu6PnD3goTDPgAAAAAFP0MfQB5KNYtl1CEyP6p50HKP1MTxmltIAAAAAAL2ktyJPwn4jH8cGF/8fQ8oQz0asrL7c1AAAAAAACozOQBdYYUHKXa9IhzGmd8lZY7zI+snZAAAAAGLz+VoAHyZH+ztQQnoC2tOANS+Ty2yeoIMAAAAAABnXo4Qi4u2wmCJK8Yv0M1KsR0VVgpcAAQAAAAAO1/HzICZBGc1R0lYOVAmjxvckyuvLh8utAAAAAAAZVoLgJm+eO+Ws/HcruiNnHN+lm8vKd5xAQAAAZd0INwAtTJqxH83X7ncuSQijEm3k4uzd3AAAAABAAP0gAAAAEPosCSrAAABl3Qg3ADHK7s+xr1Q9ni0X1Z8SXUXc3rA5wAAAAAAaE7hgJGEownhLU6biEVObmQrvdTu/j9oAQAAAAN+EdYA25xq5QlFk6f0jmtmn3BgOkINtcgAAAABAAH6QAAAAAG/COsAAAAAA34R1gDw8koVyWw7esB3oLLgPsCliCIM/wAAAAANJfFGySheDCTJ9QFXsu17ep8WEe/Dv+miAAAAAABjCRagL/W6hG1iMGyOI7gDJIpNU75bakQAAAAAAJYQM+NBmajf8QUJOGsqoXbmOBl38WY3ZAAAAAAK89Hw5EdWd4B8mtUX9H63GTk3xUZOy97wAAAAAAA0J3DATy247duYN72KNWsB3mBTJpRfXUQAAAAAAqZIcSBPY7QSFrqxMx1OK4bRGBTY1VjKIgAAAAAH+MgtzVezFOzvYMi28uLBx6douff0BlfnAAAAAAApuScA/DaH+RuLuxzCS1XdZA48m7IyYakBAAAACY5CEMBj3dmrTl0/t7Qf8qBmR77KL6H1KgAAAAEAAfpAAAAABMchCGAAAAAJjkIQwGnV1jZTlwhT4rAZ/r6ucujd1gClAAAAAAAAmJaAa61pIftFU2H2qXLrs94KbWfkpPAAAAAAAAL68ICCpZRzybHLwKPxGd/Z05RF1XsSsgAAAAACkEUfCokwa0GJeABhxyGkOqXxgBtyBjqdAAAAAAGCYaDqiuV1jeOCWK6Xg+1ha54ZWQ++B0QAAAAAAtooKoCSTt3BACO+NbcLquWd4Tcx29iOBQAAAAAA4hSWQKx9ves9mtVvrn8eNjOPoIcN4oL+AAAAAAC7nBeirnFfSZVX9aZt99PTlcoPgrWt9+AAAAAAAACYloDPSDpIaRoQUS+eRYL1qPAAf9C5pgAAAAACE1PlwOLcN/61GxRqhv9FOBXGP0rkwkuvAAAAAAUsWYIgNJkcx9X201kj4QHhmI6KY2HRN0kBAAAAC6Q7dADsVnd0vECuW4MrN42HkfTVZg0zoAAAAAEAAfpAAAAABdIdugAAAAALpDt0AO/FUBI3om/ElXIpqg9qge0bKW5UAAAAAAAgL78A9sevD4xiE5ACNflcAHRcqwyEN2kAAAAABhX0kU73yANLutem9i9E7SKOj+Eg6j9LAwAAAAAAATEtAAOCJ8bpHMMhRMFkobohg/clbldnAAAAACYYz1xAKBOi/946rLAzkK7las3P1I0AmhoAAAAAAgmKZ4Aw0rT5NYRvJgCSHBnuKRqSVeCt/gAAAAE94MnEkVMo9mBP1y7Dii6mcr83kMO5XmM5AAAAAAAJiKbvel41NnFX5DSx88A+VjKt9B9zsvYAAAAAz7r6aNmBzLi9RcVzZvxvmhqK8pHeO/2kuAAAAAACzg4R8Kv/C1cKAO5FkkZ+4XDXau6IXQhAAAAAAAON/A4ArQONoDFMwQGFP/3TsX3aeS9i7cgAAAAAAgRzRzSuTKFfvte4eMfXJ3A+eBUNtQu3/gAAAAAA0GD+qcx0+fwHlP073/w7UEtViTxGhUiPAAAAAAAVDMnfzYLDeQfxoFyc/bdrVRGkDpTb7zcAAAAAAHzApUCxHTB0vOR1ctsOHwbKhEZVsbbJDAEAAAAi7LJcANEzYpe0920EwpIeqR3+8jKQ3qeaAAAAAQAB+kAAAAARdlkuAAAAACLsslwA0fqSRhEEAAkJ147vz5n87t7XXdoAAAAABBMUzwDXIq/lQPMuAVK7Zd97FPiw0rwcrwAAAAAE9GMIAIh6igk9C0vYYrdB7Ca6i/VXJhgWAQAAACLsslwA3fetsNClR69F/XX1uqoBXSChv1kAAAABAAH6QAAAABF2WS4AAAAAIuyyXADslWGA3PN3HKShLRqFFDKpYEyIBAAAAAAMLZ6hf/xmDrw11N49rmXfdE0v6yXTFefUAAAAABKgXyAAPqsR0yU8LTqzCyKl0aW/TGN+TMsAAAAAAGhO4YBBCJMspi0a4e/hRDhS1+ko1cd4/AAAAAACIYgI9GdByaqh7yZCcUWmaVmf0J1KdHGeAAAAAAAU3JOAbSi09DWy/neiuTktkIEB3GzFFMQAAAAAAA27oABuR7+3zfHy6jLqvIom7Jd3C61LugAAAAAFmX3ggJUjVp2pNh8n1F2LsBxG5aUq81VJAAAAAADQncMAmFVPUm4bTC93Hx1aUDtGrH/xm/QAAAAAALaKCqCdbKBXgjgcA3Q3UqM76jOUIwQfzwAAAAAAk1zfRVDKo/k2VbVJC6No4Z6vjK0KnNDIAQAAABFgHCAgriawgH7I3UbuzAZXXY/5dPNDVAUAAAABAAH6QAAAAAiwDhAQAAAAEWAcICC0PVjvEbXjCZxF69wa7Th3QOHd2gAAAAABeMHPU7XScLYZ+w70HzSo6eFC2q1Hd91gAAAAAAEtSVSK1wFM8wWV/pPb/2TXX5W+nO92jtoAAAAACCYpngDkdqWcY1Q7Z0z8Cvb2P1S/2Smx0QAAAAAP47gPQOcK6Rb9qqgx2kiJMtXFpVyHuJWTAAAAAGI62YVc99Sq5PhyFWUqXVIH4PaqiWza7lcAAAAAAJx2UkD4FZrjLwqa1pLUP/Ni2r5tQcR0fwAAAAAAHCnHIBkSTzWbNlOF5ROkvSC6XCgJuIuiAAAAAAIEhmZiK3I0Wa1wk5o84/NbOaf0Ikwx3KwAAAAAAP0aq31YthrGJFUuQiyrS8fXp7ZI9uNk3wAAAAAVJhOSIWL7ybt6PVcsaE3B5rGa4OHlTh7VAAAAAAD0kqCmeha10PGWhw9xC1XqTt7RKfYoKCEAAAAAAThEahiDoj3c/1hKiRUrkv7a/ZfrDM7ASQAAAAAA8XGxaY4UOeVeCHX4KZKe+p6cyIuST9gIAAAAAAFoLQwwq0U7+iP0SrV1q1+F3VYXT1WyBl8AAAAAAdJEXC62YJT9gtkiFB9U9V7Z3TLl3PxpnQAAAAAAOCO20dYif9uVb1AUYpgim4G9o2P9XQ7VAAAAAAR5XFxTWTK4xxkkEol77+v0BheJS+nYToEBAAAGXdCDcADfRJYubFTVZ8a/PAa7VScbKf9nMwAAAAEAA/SAAAABD6LAkqsAAAZd0INwAO5pck7Y3wJC3/YGnAfQ2zc5lkTQAAAAABRgBrwA/QyuubeE9t99IopXggXQQ3UqoHsAAAAAA/+30y/ry/Defa5qQtHBKWfbmyKHvy9/DwEAAC+/m9nIAP00q3JloOSMRUzL9MnGHf32j5oiAAAAAQAD9IAAAAJjLjFKAAAAL7+b2cgABPGY7SNbihLFRG8Y3K27cHuKuWwAAAAAADqC81kFBsxXnSTr07en8HosJmE/ZBCzfgAAAAAJhEqwJwa15ukBHaP+v8fpUOCWCjh/SM3HAAAAAABXePpuGPkKGZBI4NetcmR7f8bsfVdykZkAAAAAAGEDNw1XAP2vuUQrfG4BRtODNf+3nWckTgAAAAAE1pqGy19SNaNa9RxTupiFKFAaC/QRYu6XAAAAAAUzChZ3G52Y8Qyb7fygsideGH//zS7wOwIBAAAABdIdugBqkKrRrsAllAHg7yTvCNmJD0x0zwAAAAEAAfpAAAAAAukO3QAAAAAF0h26ALm3pgkELa+45x8KqXhWRBYB8LcWAQAAABg7vy4AjzeZOXQRG+RMAK5RvPUWeWc/SBkAAAABAAH6QAAAAAwd35cAAAAAGDu/LgCRP51DFWrCIiPYQXqUF3rqagFsXQAAAAAACPDRgMaPS1vB4UfznQ8NCweEykyuIQntAAAAAAVMAXOAyYOoogtpw+fTGg+QDzKzPOn1uXkAAAAAAc1vrzj74ED0f3B6tVp8mIdGVQxqnL9BhwAAAAAE6yFXYP4CEqca1SZz+DQ11delLWqHj1p+AAAAAABbie0qAq33oshMorgikKVG4rd9Yk5nU1sAAAAAAMXFcUcDsaA0ZECCPvEgkGh8nC8gan7KPQAAAAABw75cwI1pKkjDshtbKEYWau5uDP/k1buPAAAAAAAjdvrAlo/iz6xGP2nlcxu8LCg/4cuDk60AAAAAACy1nYauC9xgbmweFDvJ0A+/9gGeRMGwIQAAAAAEa+RngLWi0b/Xi496UecI9B4dQWKu5UZkAAAAAAAaewESxbsCRHOpmcf4fSYEqi/Is+qKuZEAAAAAA173axjF7oLe7BiYHpbHgueponiUSGxMbQAAAAAEtN5XEdsOH85OtA6gpO4Ys11O8Rx4uZF2AAAAAAIJimeA4/Lw3beFbEBacMRwr+SYrHPjKW8AAAAABBJ8OIDvMLArT/CCnn70k6EdYWdTXrDIAgAAAAACdBiKoBNUNOHpLHMidNCdKNphM3wXUeg9AAAAAAA0H8+gFrxI2Hqk9oEZ9cH/8XXtXUdzPIEAAAAAERM9L846NTGufazmWFPMINSjH8Lm8x0YgAAAAAAAtxwcE2BHr1dokM7IOAIWwprSpt/NeRKXAAAAAACDhL5GeOXBOP5MVuQkfcZmQC9aykHAOKYAAAAAAmdq/0CKcWLTR/cr68NbH66R93eTGOp4fAAAAAAA/RyseYqRqhYQN6Cy9TAtSkCjmKJfaoJDAAAAAANCdwwAmHG1YHwHPr6cC8j9zrfiWRSX/3EAAAAAAAX14QCy43NhzdbUN8RdcyAwuV3lmw75dQAAAAAADQqf7L8P+PRNJhrXNV77fEIQrJAD1YBBAAAAAAXCSF1gwmFZp0zGjPx+wuj9Q7+wAdl1/PMAAAAAAGdD2iDO8712Mq4OmoBoRTlaJHhdgFfm3AAAAAAEYzrEuuPKL1OzijB18ux0iadRZ5Xpl9wDAAAAAAYCpEgp+CWDnm27yH+Eeje/QqSH1NsgcQ0AAAAAAACYloD9bPe5qBE4+MM8/h9zAaaFdWl1ZwAAAAABLeMvrw+F12gNO/RR/a0yVgMePI7wICNHAAAAAAO3uRU+EBkh+VHO1seI/3Tx8gQFFB1wc5oAAAAAAC309RD1+E4h5ZU9RfaiC1/Xtl1Q4j/KAAEAAAExlxilABEzmtPR+7Xxt2N/sainJYRef6e9AAAAAQAB+kAAAACYy4xSgAAAATGXGKUAJDzXNGc4bvMrMfjN4LELPMP0iHQAAAAAASqABAAsAgB6AmlJ1aQO7Up4dNoiUI0iyAAAAAACkFBomDK3F+RHYngvk9aHrXsHlivapnwRAAAAAAAQZzgASMV8cnHLNYU3J8i8TXYPKZLxZn4AAAAAAB3NZQBO5t75kZqj3K5LxrVXpCz1yKw9XgAAAAAAPzRrgGEkMNstixulCnQOlnUrRbOuUeGdAAAAAAQ72QHng+GQ1HyOvJY7BWufWxqUJufKwD4AAAAAAJx2UkCWjXumr3QOJ9NoWFTciZhSINzUxAAAAAAAKbknALmOSnQtCcBj34WTLcVvohEvkrQkAAAAAAAdzWUAfHRQooa4Xt660+iQrMoNRT3hAXoBAAAAUX2gLAD9p2iZElWtZs/k5dDUCoFAXhw4tQAAAAEAAfpAAAAAKL7QFgAAAABRfaAsAAApv39pcR6F8V8fawA7ZIq0sKmHAAAAAAJSQiCAJMHV1iStwTtB/5Hm5yu3ipST05YAAAAAAFshpRApw0BNFnlisrpO9jCHL+MzNwjJYAAAAAAAURMbb0+bnWMhR9B/okxrI9m1GdZApmhKAAAAAAIJimeAYsCPvM0mvSN0i33h0ecYWaZxijkAAAAAAFeea4BpR5wsBcnJYcFsDj28ExaHRPnIkwAAAAABX69nmm0OZ88IoYeWc/lBK/Ek1WaLQnQtAAAAAAAJBCKbfiDuqDUzlmbcQBGCLwJF9BH3P9cAAAAAARzyKsCOjc02Eq3IGN4zwxAKfFBvnsxsSgAAAAAE811xG9wkrFU4uFe6uPKzBjW0s215nonXAQAAAFbgiZNgmz5v2Z+qIS629KrnVtHUzhmXurcAAAABAAH6QAAAACtwRMmwAAAAVuCJk2CgII9RgUGPj1WNAJcZQQzdoOGGTwAAAAAAEno5gKJZBzkC5Cy0N3la0y+7nt1qf23GAAAAAAEyyvd0qA2PjkfB5wd0Vhkk5Xg0OfcorUMAAAAAB4mzS8CxJbY7+s0YDvGf7P3WnB+6sQNvygAAAAAAaE7hgOJ+FOq2wLKt5WnRgotZt5n6uSMUAAAAAAIJimeABIbC/AWAzlo/gaSySYoVIVF6LYgAAAAAo0gqL8gKsvEtoxzB8It0HJjfeO5PPjxaGgAAAAADtXRP2xiSR3UA6vuBktver2DPXUTOA5XPAAAAAAVThxxAMzFXZUA9M2tzxmP8IMCDZZO0RFAAAAAAACYloAA1jgbLcJHSHZy5DzBTdG875RDdOAAAAAAAHc1lCDmR1MC+O/fJmAkYWuBHblw//8L0AAAAAAO05+wAO3VphHgu8GAnmFkdWDjsIvdrxz4AAAAAC9GZ5W9DZ+hWXsMTPXg+po+9ieNkJjI7EwAAAAACCYpngEPnuSzCmla2e7SU7ePycEk/mLLFAAAAAAIX9PT3VkSj8OHmvmqitZL1msXoJV9W8jkAAAAAAd4EKvNXnf0KLZ5cpXMitseCeyydhSHDRQAAAAAF0h26AGT+s+JQ2x2Snq9jxqT3p8p9yWWaAAAAAABTUkE9bft6npBL+lcm+Ri31Vn98wBadTcAAAAAAJx2UkB8iA+PpQS6bzx84rN6z3Hm6yZOQAAAAAAAMgmknYU2uE+rJ4bt2bVonTLri8DcFkqkAAAAAAAw+uiApzAbM1PnypbW9RNCReJwBrzsry0AAAAAAd1/04e22QXWtbaF1Uqrwx6O2BqwJVH7BgAAAAACJHI7krtcZQMpu52U471FiDS0A0BsCtmxAAAAAAQTFM8AufVmqTuY+OIB1YyVQ3JoyRj4Q5QBAAAAGfdcPkDK8lJdYhFtH/2fJhZvsnOJOxHWHwAAAAEAAfpAAAAADPuuHyAAAAAZ91w+QNQldXVjL1vuhPHalkI+xSWi6HwsAAAAAArwnJvR2Tvc6ygYVSA/FU1VmGO7b6P6X1IAAAAAABTxrwvwSV/HWCXabRlTjNyoecdSnt8F8QAAAAAA0J3DAACLHAncO1qfNSLjyf84vlwjsYlUAAAAAAAUTLNmDZaQbKVHkm7sE3jHIXPXOv/29n4AAAAABhyfNoAPLn2QugI8xLvEZgQrVEi4rod/MwAAAAAAah/U8RX3xWYExZYrKZBZQm+0q5tmAmDGAAAAAAGCLgDTIHoVOPGggLagBOszdsufUqPqxnMAAAAAAL5CDgA3BPbovxM2iA9GiAu5bmJE+fN4JgAAAAAADcdVz0qIqq0Dj5uCSIZcS5JJ78VUlg4WAAAAJk62LLPvZK91w6rFs7Qo0rofBOGU01ZgpYIAAAAACCYpngBlfYZczoB6yCPaFaT7HfMK74PrHQAAAAABiMrBaW4pEQTmWPWAc8uMkhN7w41ZOL35AAAAAAAmyWIJjRZ0NbHeIj9JM1Mvzq+g8kYBpnwAAAAAAptKj7qPSeeegob/WMvBFEFsDfQHiA2ibAAAAAADibL6cKleNWcteRxU5Pz9rlKIi9Lj6s5XAAAAAAAF8U0g3Kkm6obvppkfp+rIRmuEi09RgqUBAAAACBPq5uCvzDc6zXhO33iqUgZj9xE9QOjX5gAAAAEAAfpAAAAABAn1c3AAAAAIE+rm4LRfhzkdfb78aNSOJSbIeoTyZIqaAAAAAACQipBA1TwMzZRkACgILTplC+tENhs6n54AAAAABUNNqwDWrDsZC5TSKQIic7QjyuvAdqozLwAAAAAAAJiWgN65jjY/qlRbd3yls4evReoHYqmJAAAAAAA7msoA7jnkQwNzvFdRJohbXPcYW17gWWAAAAAAHaixEVLzfG5kNVFbzkOgeSgixidaSvdp9wAAAAAAATEtABLrOEhJ87cXoMw0b6yg4nvuO3U4AAAAAAQTFM8AGcu3cAQfTrUr9kmX4zFIVAGmXMgAAAAAAGaFHgAocMR5lBNk/X716xnwWpumyHcPaQAAAAAAa6JSQDnUmhTDVdMoZXAZLuCIRgv92MqVAAAAAABmS4PoU8IpmJ26MNwBpHnsWu8UETClZZIAAAAAEhztCW5cM+wCaQP/8sQn1eNaZk4EgyUIQQAAAAAHJTbRYpf+CwMLDju54obF+UfPu00olz2lAAAAAAByR60grHlGIMFpaAe3s08XAgQddTJrNlIAAAAACf5ta3Ti2AsWAXpCIgjsLehb/yK3cYXDMwAAAAABlB6XAO/7O9cz8EinBV1To/lSnL5PYLTLAAAAAAA3CfdA+qGhaZxpE2zJj9MQYkMHg98koo8AAAAAAAX14QAiA4lGyTqVy1NnoNSxfW8VZhdGbAAAAAAAAJiWgCyJwA0LJHDvbU7PkYVrK7d7G5aaAAAAAAE47KSANqnbEnO05DEmoe5lzUJJ/fN4D+MAAAAAAT5J7wBWa8Fdyd5Y+3Uf4VXWYi3PjHKD4AAAAAAAPE1tEHBL9mNA09iE7Gr0BuNUaSxJvO54AAAAAAh/exCxdGQRAGytB1zm+MZqxCBI74HGYSsAAAAAAM/1iJiFiax2XLdju4xTaabnLxRtgNRBIgAAAAAAAJiWgJoefs3DFniG4TgDc/zKw15DU3O0AAAAAABoTuGAozhZ46pR8lNZIejA/1U+az3RG/wAAAAAAHnbJHmqVD8LJIoNcGBtwgg70W7kR4+v5QAAAAAAZ3Gg4MmPE1MXc9qucerknxn5tQTrPQb/AAAAAAUoOXjz5Ijuni/2M1ZSJ+Bk+yuMVQgLd2wAAAAAAVypXJj16YTA4XS9hjIrHIXXrpIY+bf1vAAAAAAAP8bngPdjo2hx5T5KhTqnqGvtJB3x2LtMAAAAAWkJ8h7G+LDk6FEsh+iCodAKWXkCJ4nXfzwAAAAAy7oQbgAMySCGyyIFqDpQyrmFOrw2fvH/OAAAAAAAKuvaoBSBbyBb+grvRyV46shtKA+R1AcMAAAAAAJ7+0eAA4uwesz1lef0YWq2JAXuupCoq+8BAAAAEWAcICAmFJtHf/wy9fF/FZhbnfc5dvxhRQAAAAEAAfpAAAAACLAOEBAAAAARYBwgICyDvTAOzcA8nchTIzc21suA9W7uAAAAAAg6pruwN4rKlfM4r0ExREm+jo9OoKjgpS0AAAAABBMUzwBAlNwMg3bWUU+XEIlNY3IoNVvuUQAAAAAA0J3DAEY92ENl05rruOufrlkYKlZEWLv7AAAAAAAstBeAT6kvqpsrxmQNMNRNR551vasx6C0AAAAAONiA+qByhs0r+q1WqWsImS+jAbPWJEoWCwAAAAAGGtVzAHNOVQ8C8UNMis3pT+5RVsGOc+LxAAAAAANeNgNg2nnSqBQE4k9WxYytLV4Q/35APT0BAAABMZcYpQDdRogUul4x4ZHKbEYhBTx19s56fQAAAAEAAfpAAAAAmMuMUoAAAAExlxilAN2tSXDcuJ27kvKDJgPaApnOujNNAAAAAAPlZyfDFcsDXsmMkwjWG4Hwg7DdJlirIOIAAAAACi+0BYAgihilF2kP2uy2oVmGhA1gU0QgaAAAAAACcW5SMC7fifN3sr4jPuUtmWFrKipyuOn8AAAAAASF0fpANdYWi6Ro0mR9wScIzAXt6NbKn4YAAAAABUMZM1o/XAQmGNx/kJMExWklLTJPTtpvUgAAAAAXSHboAEPCdoakUkK0Z2qSHNfANaoTXMeqAAAAAAMrDCloU6h/kiHElLWlGvyeIYMBawdT3qsAAAAABBMUzwBb3xrq44SnP131F4Efm930l4GI0AAAAAABoTuGAGUdv/5/GpHLqbVDpMA+BKmlXXRoAAAAAALaKCqAdF4xEihsILGy532rRPEvLKOd87QAAAAAAlQL5AC7UEnBYg7sJSheka0Sc3E+uJLe+QEAAAAA9J+YoIpBfXzOtBsAhDViR9K8DMP3+zRkAAAAAQAB+kAAAAAAek/MUAAAAAD0n5igkiyHzlh87m4v4mfZaiaUCHyVMfAAAAAAAWny/yCZ1PWRSeknMJ6ns0URcyAh1YHgCAAAAAAA0J3DALPoYkLRlP9+g3en2cfgsesybjXoAAAAAATNqOm7utuz2TFg6QYSCJCAZ2y/M1cJTuUAAAAABPaJyw/HZCOfd+gHlgS8Kcq/JOCnA/w17QAAAAAACGRwAPSW2jQXBntg9X8nheJjA08RpzkxAAAAAEXZZLgAFMgExNgLtjmzLwHU0ttaT7KcrW4AAAAABUwBc4AYqsJtvlxU1v5QL/3AsuT9Gd+d3gAAAAA4h7SMaE7zmkaMQGk55d/dMzbBDy1ps2IyAAAAAAAGMHkAU17chde10OsMLUM71/QrjMvQ4EcAAAAAAGVT8QBe0tUbnLO+2Ql2bszxPBUoJFykmgAAAAAAaE7hgGwlUF6Swqe8MKYYbn00vKjfQk3lAAAAAAAAmJaAe6iQS/T9Sby8zMp2ggzvy5830xwAAAAABKgXyACLqA1rvz99pfolxaO3czsnIJiDpAAAAAAC2igqgJ850ubT03jM6Ry87vom3BMi/Jn8AAAAAACXWVuF08bPaLuNe4bcr4B++sPli67r3JYAAAAAANCdwwDj85HpYe/iW3KZOD8BoPB9i+mDxwAAAAAPF3vRoOtEJrb7RpV7Oi8hUeauB3fNI5JfAAAAADPpJ1DA8UIgF20CkWw6N3DYXz6tPyRpMw0AAAAAEFVYxwb7tg9zxeHg59HmQT+O6ijLYqRJaQAAAAAAt4RpMgMnRxXusNr8yS1Js9WiQrldLvewAAAAAAFYN4HACX7kdYvHgADyf9+/kdHnC2Ij1JMAAAAABUmwNvobPKvPdwB1ZTT6etqMuSpYmq4aAQAAAAAAaE7hgBh/aluqR+8Jicdh6pWBmu2HagHMAQAAACLsslwAKVeEc5Cx9VbzdjwVQW6MbszX+AYAAAABAAH6QAAAABF2WS4AAAAAIuyyXABUxn2GlSj1MW+P4THN5HYDU6vghgAAAAAHqvu2U2ObgsQjO3coah9Wv8I2a6+8gfveAAAAAALTARyAgnVPRI+BApp8MfeSeXRBa2BY7qoAAAAAAA5OHACHIs5QritMgmPKhkSgkFYz/n0pAQAAAAATjspIAIlEXdoBPH5h0I9RUlzHwQoNhIIhAAAAAAcMyfE1i5qht3p/Q6wvTZRPdPlMshbCvYQAAAAAADz4Wl4256pYVnNz5RbkkJoBPPNa3xffgwEAAAADfhHWAJEDQDkQBh6JQWorCZZ7gIVRPWqZAAAAAQAB+kAAAAABvwjrAAAAAAN+EdYAl5F8bF/uBV3xUs49oPgP8SxcXWMAAAAAAUh7L8Cclz0X8ksfwdZqioq0qB15VlSMHQAAAAACtx2ebNzUkp7e1zBk9mg4PAZmOUBLs37hAAAAAAAs0RVg3SKInvfn6BCbfQLBVHosF1eB/7wAAAAADgVMAxjgPI7S54n57a6PzzWQYzuysKVl9wAAAAAJKSje0Pyx7H+ZP1YaBO+6aDsWUVKOO4ysAAAAAATQkXFG/haxaFZzwW4jzX08w33Fd0jOAloAAAAAEurgnIAN6h4saaxUBuO9lqe5SUsnRn7j3AAAAAAAx9q4QC430o1owFHtBfvHf5ARnszB3jCkAAAAAAA9JoFZUZX3p2pirvmQpsX1dHFGHrtQev0AAAAAEExTPABxGHfo9WmP60M+CP4TCNzDAhSuYQAAAAAAjw0YAIYg7bfjet9NLQCbHYmcjiwxZvYhAAAAAAOBDMaAlC+8gh/IONi0xwn5byy60HeNz7cAAAAAAGd77Zi6tBJJ/U9dk8atxLnJD7mZZC9QRgAAAAAAzd952OkNKRDVRweVQG4gig4jguAHJ+V1AAAAAAcs69yQAGPZe7Pv/f7eNTGrqf0IgQNkZYoAAAAAAJGwl6IScCQ8AYD5C+VdEI0ZMfUWcd1X6QAAAAAAXeWY9SndxDPgCn/xtfPHKTExouA3y9lXAAAAAAAjw0YALc0sYE/P6WkxYyEMBs/OlQyihmcAAAAAAALSHTw0BbiW5mk44x6ntPfyQBqewQp4dQAAAAABkxIotkmqRVmftUkbn717dvISFCke+gC6AAAAAAHfLNzHcGfoPe849Y13ABCkKuGlr1axbC8AAAAAZOrH46V3+Nj1joSyxn2iJigJUf0APwW36wAAAAAAstBeAHzuQYtRnBrXCCqP4+EafhOtk8O+AAAAAAAQpSZukgcJcM1OWFMTK6p9igzkhogkoo8AAAAAAGhO4YCdJBuZ5y5eLXnnggMYm/QLO3lSuQAAAAASVqEauAS5li3uNC63wEs0YnqyoOQt+N6nAAAAAADHCMeXDEQAk6lWV6FoEhL6VHLH/CxVodYAAAAAAEy0llMYRwURudcgJ0j9yknd5gBTS3jLQgAAAAAAJ6MYQB9CGSaATgZOpoiR7MtDnTFoiGTVAAAAAACLh0ygIizpOJlf7iSGXVOii7wN68KrcO8AAAAAAayf6A0tLUjxly0zU8KkRp1r8LlsP02EjQAAAAAA0J3DAEQrSciJ2cp2EAzgFW8qaajEsf+vAAAAAAHc1lAARZqIxmDyoEuBmhpeMYyKu0HJVfIAAAAAAFn1kzpIHGZawUtSRDzixBkoPHjHtrZEQAAAAAAFnkKUgEmZputqLmz6iARey27U1fbjLsihAAAAAAJx2UkATHlhEfPP9DMNSmxSlk2sdIIuKiwAAAAAAV4rIeNc7+/xNH8k+nyH2OiYzb+hKTeXHwAAAAAAZr5WcGR0mbFQcC6HLRmQ+l0o72Tv5bl6AAAAAAAAmJaAWsXS0B+KuJGugoEmK0BoY8Ib094BAAAADOwOywC4CkANVpwemhZK8zTlPd7lX3hxcAAAAAEAAfpAAAAABnYHZYAAAAAM7A7LALu4BbC9l2JgehXyMb1ykfbq6AaTAAAAAAA4LBzqvRy3ljV3xRBysaMWk9Z04oKj1DMBAAAAIuyyXADWaEP7bKXX+eRpBG8r+Q1pGhp61AAAAAEAAfpAAAAAEXZZLgAAAAAi7LJcAN8Z8d6AiBPypFVY/UjjWnjK0RebAAAAAAC+xs5gJtG6GvKXFWV/RZ9PqyUITIaAELAAAAAAAjAm1W4+qw0MxBJwWkJAnr9bf+tliaL6cgAAAAADlB+hkF1u+hujGIfeQsL84oA1wwDzpb/+AAAAAAAKbknAX6TEdjEbkbKPPSFFI4TZJIvUFUUAAAAAAtk02u5jhM138atuI97c6bRc+vn4ocbe1gAAAAAAK2xTU2pmT0ampJGn5IdsGp+JN8PRyRCKAAAAABlr27IGfp+bsS4AgFNoEwYtAw2NtogsZ8IAAAAAAB7+kgCK3cko1PcvASzlmjM1FeYCeXLr4AAAAAAF5Akz3aOjdH0zyfJz/z716v0hkrg0glnXAAAAAADmconGqG2a+0C/MzwszQrtgE85arI9vrUAAAAAANCdwwC8q3TVe9e1wz+h9s0Y1yI1uLft2AAAAAAA0J3DANjPeDqWXQ+NazbdUL5ydI5l9NkRAAAAAAANVwgM9/33uHQ7MUmqw557MVwUWMbZYQEAAAAAGSc5eW//NvbGkNJLirqldITvMlXSw1guYwAAAAB6sT3oef9q96Ll3HAQX3D0CKjrWaML66iIAAAAABWKiglaBrrzphdNvzb7AXu2n6D68/4CD1kAAAAAAGfJXdAZqYBoNkY5EhBRQUQUEwjXPpdjJQAAAAAAZykmMDUYgMHlzEjWW/hOZfkmiBl7X1ERAAAAAADQncMAQfVdS48jhto/2cpdTCVGRDZ15i8AAAAAAACn2MBCQZT5J/fglwG03sr4biFntER6KwAAAAAAoa13IFb2XZjJxXDQGQPzgFLZDgNxSUOMAAAAAABthgZgZPTpD2Fa9a1EdWoYAmwtUSP2RqoAAAAABbEU9y+Tef6K2BWx59LSZW1LLXDDcpjpnQAAAAAAyGHWLJ9ELdLVmEp7SjueJqCO3qUhTuuuAAAAAAa/1NwQq+KYrp2X/8496iKSJpu3O9I0Z4kAAAAAAMBpIJyugFqTmEbzWjp4GTE7mfwIu2EvSwAAAAACpgC5wLVjXQnLSqTlPhPIqDo8vnh3Cy7wAAAAAAovtAWA3QGmFKpaExKIUNcPnjARiX+rbugAAAAAAMYveUDmn2B8dHayrVUK+9BzRhRF+MVCdAAAAAAAIjaLgBV8SR4C0gXH80JNipsmwqHArIY0AAAAAAJb6PxgMf3A6zYQxx3czHw+cNzAff5ecwwAAAAADIwYJIA78BNrcd7zZjPBYoLTU7IaI8sE6AAAAAAMDFkcLkSbfGw/QvZrlZDz7D7X1Ymhk2MxAAAAAAQTFM8AV99ZymVS8C5xb8Jotgz5a7ZFo7kAAAAAAGa+8PhaQqkF60uShSoIvwqaDZCfmz5JfgAAAAAAstBeAF0oBFou2Bfepoor/p/K7wv4XTgvAAAAAAJRr6SAfVt/C/+ghxIr9FvdchxCNL3nnesAAAAAAcqq5KFhn+67AxwikolDz+9JotQ9EixvLAEAAAGXdCDcAH3FrjUyLSAg6e+JZ3gblnqZqVu4AAAAAQAD9IAAAABD6LAkqwAAAZd0INwAq0CbTE+UDx3e6CPRSq5EJziyDB0AAAAAHYN/zLquc/YF3Xgp7DTakwALKUr/Bst7EAAAAAABK9snMLZ+KdYTu/I8Iq7BkIOh99l+SsDnAAAAAA97kNoAwIGGUDxZaOT5bDF3w3MIT9Ggef8AAAAAAIK7FxvJUulKGJ8Ni5dS5EwZFs2t4aPllwAAAAACCYpngNbt4UEnT+qve1n73nTsuVPHH9aIAAAAABwN3r0u6mL5PdwtWrdU/uTNzIpjgzbs0ekAAAAAAQl/wRnym856echp0SYe0mFLjC+IJ8NA1wAAAAAG96tDQPMM/oxQJ2nBZUQNsMx8X3vEsTyuAAAAAABEurwqHHslSv3lBBQe/BJ43X4buuYxd84AAAAAADXgWnolCFrTMwNsiP73ZrC/hFuCN8CdcgAAAAAA0UX9aCs5G7mXVX7lvN2AbxSYtMuoje+4AAAAAAE0iTXeMj85sIpp4H3KZRCLxG3twEGWXo0AAAAAAcjVWHU2LqMbrwEDD2gzCa6Rpy9UQZJDawAAAAAA1MfaJWAP6N5gwSBFlBqPjinfgJ0aWUX8AAAAAAGSaKmgcPLY9JjykCK0XNmNuM3hozG+whQAAAAAAAj7h3+PUZCShZOTBtU/XdegEM/IcU8T8AAAAAABcdUTWqmYmCFoVGYmLmwfvAm7HBwtXLlCAAAAAIRsJEeAw9henbay6lJNdB92jx+dOH1iI2YAAAAAAEhsLTnaFp2yTr5GOy8/OZ0lBqKB4mSQQQAAAAAA2WOq9ukx5zYFuOAVqvpGwFm0yTilVl6QAAAAAAAyluWw7DVALgyiKx6oUpju4Xe8SekK0QYAAAAAArx12ODw/1jmrXM2uidpoOPWYRT0tTY8DwAAAAAAUImtAAk+Q6j1rDxbGvpjiQInRWpkcsbEAAAAAACvPNcAOE9fS92li37jPhQeVWVFtejzhOwAAAAAACYC4cNIsBjzUy1+mbRogkRYdB7qmeFFdAAAAAAL/WDpbVz6oPmwfAFTn0dWI+Qf+XDG1oghAAAAAALubCeAd9IsKzA9RavSd2QPR0OUNEgd9RoAAAAAABXnmuCVYW+W9/uqCFormziQUe/Pvbrt2QAAAAACPbHYQKKq/uzwiDn3uhWv/hN7FB7Ndu/AAAAAAAJUpHqArxD04vVD5zhxcC9IFGSeX4LqQGIAAAAAAHTTOgCwRIRZ5buxiUE4EBPPShXdqNDWBwAAAAAF2ZkvdLw9X4GLsoni0CQ/qVe8HBkm9fYjAAAAADJ5sOGAzWJMtmYfZLe7IEqSep0QcrucJPkAAAAAAIJimeAEnVjtJqRS5uXdbWLkBFFUS7UEkAAAAAAAaE7hgEWUB7J2PL9Ld7MDWI4Zp/D082AcAAAAAAAU3JOAVn/+dVVCux7LR75h0D7IRB6InGsAAAAABWAuUCRYKuMSF33KOtrjjOWCpJiL7QiSGQAAAAAAZ6anGI0J9bltKAwdqzDvYXaDgHL16DW3AAAAAADQncMAo8a3VLp2DC6gX1eH6CQfPtdgo2sAAAAAAA6aZ0CnVM0+kvYdJPSHpj1JFa7NCVltTQAAAAADQncMAKr514x9KsEOlYzlQ7lZHa5XUtLiAAAAAAQ8zfYAq23+5Lvmi5g6tHxLRYjY42BpLusAAAAAAFnIzAfKOvs4aF9odXZwwbKbhMleBx1THwAAAAAAIXqwItsb5fa7rrbseHNqdQs9aDZ/9fgrAAAAAAAAmJaA3gCGsYgDJ1j69N3eySHj8WvNeYoAAAAAAg/0CkrxlI/lO7atzxM7YPHtqGkbHlyDLQEAAAGXdCDcAOM2FlvGoJS6OgLZ8zDzoYFaSZoUAAAAAQAD9IAAAABD6LAkqwAAAZd0INwAYVLAgaPEJ4S5+OxR8xIKlRLKEuIBAAAAFbgixoDw2Qz7msNwtEXMSzsQYy1uLL2J2QAAAAEAAfpAAAAACtwRY0AAAAAVuCLGgP1l5XRP5PZtxNUE4PuYjT3Tr8KwAAAAAAASxoTABB5XOmiq9vY9Yid6k0cKLbVGxCwAAAAACsS2/oAQqoGhhYLP6gVOmXtfZc9OGneYPwAAAAABKhLDQBolWpcrUvTpkL9g74vUXt+yxdiDAAAAAAJbJ4BQIm01f0oxMQgnyBYMbci9xqFRW84AAAAAAGhO4YAv4cJ4mgyMnJYYoFJG1vWaPJkZUwAAAAAHxjL3gDUx4Udkri7+gMXDFVYXRTj0pdSSAAAAACL4nh4ARgy2EzJ+z+2WnyW5Qk44ZOufTmQAAAAAAGgClkBHPYpXx0E5aQKzx0VLJ73Q1qE0zgAAAAAAIJsrAGOjSp+87x5i7aRxGmLyyDnonUuHAAAAAAAAmJaAZFrmQqr9PmJ4fnW4v/mAupUTrkoAAAAAAZwlGMVqMO4AULnD9+Kay+YVvOqUmMn1IAAAAAAANZ78aHC1i0PipE0Agm261dVDwdD0HgyBAAAAAAJn1e8QeHYSgsN2grgBRz6/xkmoQFNJP6AAAAAAA4EMxoB50gL2LI0FyJ8TpGH/3iXwxwX/WQAAAAAI0MI1fIsGSPJWoIbd3Mv1MSrO2o3rgR0rAAAAAAFQDQ2At4FrZC/Px/o70EA8Zh7KhVcQ+soAAAAABBMUzwDH+c2UkjtBs61PJ0EATe684SoF6gAAAAAAPpW6gNfTQPfre2XK7iOrsVTyA/PpJG5DAAAAAAGRg2Bp5LERSoardGFuqbe4Jc4Vkxvx4zsAAAAAADnRBoD0+rKr5KoejH2n+CEE+FFNSKlfRAAAAAAAaE7hgA/Us+q5unJSOA2zV5UWWXEv/18FAAAAAAASlr9CJZF4kzrSX4RaAy8QIEz8HVWpuI8AAAAAAFeea4ApkHje58LcRI8cbja1BBoLnvZ0xwAAAAAAy7a58D/dEU/dsxaTwcgeg58/1ymaY/AWAAAAAAC2vEUiYYNgTKzRg0YGp3GrNwDumAT6M1oAAAAAAAnoxhBoB3elzeXP4BMNygxzyPBjSlLyiQAAAAAAaE7hgG9JTmsqcX/EzpD6ylIOdauu+qSVAAAAAAAL68IAed5ElWGeg+1jYH1x3WW9pB6IUIUAAAAAAHo/xsCad/B4f3j8s1tVcyDLjmf6gCG3IwAAAAAADOkNwKVQe9bHmQp8vX1is0uqs57Qr3U3AAAAAAAC+vCAqjsjNCoMveBDrAxPNymYSIG6an0AAAAAAGv1e1DVwZrTMaBI8AMFyoBM0t0uQiYpRAAAAAABK9snMOskJq+j7ZCRBb1aKQUNmeZGrELpAAAAAAUTSTAAqz3FcVv7MASTyskemfn5sjnGgJ4BAAAAEWAcICDsdAZP1SuYeqORyPES1bX7/RPlowAAAAEAAfpAAAAACLAOEBAAAAARYBwgIPtmU8hcpJbNDq1nVJukOwH6GSsAAAAAAAAM1HRQlWwQpF+TpvFVHS1DNsp7eu8XE9sBAAAAUX2gLABGbl+JG1aT7ua3UUzQ1LQbHJyBYQAAAAEAAfpAAAAAKL7QFgAAAABRfaAsAFZGizZmo3lPVE+LSA1zBlyFFNV5AAAAAAF5TCKAXUXnx/WZ8vv66VV1S0IMmuzdieQAAAAAAB9K3UBogSr2tGG4/iSxBFgSXF9qZO6y0wAAAAAEstHNzGqtUvT9ITtrVnJDKe/S/KFnvsvlAAAAAABdgf0Ad5MbRMlsar6KW7kr5wNo2Rt8mr8AAAAAFUNuXyCF7Pe0fiNs4Tl3hY3X0g7yaAjPxwAAAAAAA3UCgJ0dhH1TtTkbkvyBSGCHC1AUbmq8AAAAAAQrCRu+ni3vwB8Qnzkljsmex88fQNafyJcAAAAAC6Q7dADrzUPu4bw+ZSVtt2k7+FRbZGCm+QAAAAABbAkN4OwGZDJR68MgqWeZkJH1/W2SHZV8AAAAAABSoIZ69NpWol8ja+aicuArhkufWeBKHywAAAAADXIrEYD7wfZIo6M5f+nnrJJ8u3Wgpb98zwAAAAAAaVno4P05NwJ/8JxcKV062fH5z4SmMiZAAAAAAAAAp9jAAugQWCLztwOdPa5a/DSu3rKwGG0AAAAAABMdfmAD57/WOzc7Tr/WsuB4KHy1XR3Y0gAAAAAOZmkCIBefnfUoFw+MGRqeGooJSH+A/JcqAQAAABWjdwcADk7+zrIRFCgBK6VG7oAciM2HRigAAAABAAH6QAAAAArRu4OAAAAAFaN3BwASqEBYy6PloFfyDuDqlXGmm5VMyAAAAAABl4HrQhUj3OUv7F2vlm4qYBQ36Im19xE/AAAAABcy8cWUGEdaGEpIDuimbiYSzhKQzvFsVpMAAAAAAACYloAZqWFose4/aYhovMeeuvgbub7HtAAAAAAApD/Hayic5it8ME0DNzoRn60xcLbxIwTRAAAAAAABvLcoKUTTPJWEVctTQacwVkssekk/VQEAAAAABlIaQkUtYxdnKMmUFoQ2fI3yImnUNr1TDAAAAAABDDiNADLrjTQwP+qgB92rUdTrNBcfCbGVAAAAAAC+IZg8X+iLd+iJYWqg21+Dyza/AZSrhbQAAAAAA0J3DABiKM20bMHiIlQ8HcTrLRdFtYGeqQAAAAAAaE7hgGNXoEwcLMIMWBSNUt/Rd6FgYYoqAAAAAABhHyTMf1OFjrdM0b96K02HTFGyC86vX7UAAAAAC9SUb3CIB/JOfGRFJka9YoVxOV/4K/GZCAAAAAAACm5JwIupQnwoc0VTSDqi6+jThSfxXXixAAAAAHo8cEIAkSpoYSLpDbMdEdi3F/QVhcPIEPwAAAAAAmBDLQOsTjr+THXLE+FPPSxFbAxmePifTwAAAAAA0J3DALI/ITXk76zta07Qumc9YgbGHscZAAAAABe+LQZH2KNkezGNQVx78PkJxd0xFJWEfHsAAAAAAeBp1wD6D6hZgsj7DV8W2Pvp40PH3d9aTwAAAAAD2KB8J9EuDyTOC6kCr9ct0C2YR5jaiHoUAQAAAAAT3cEgJo7py3oqG0+xCjkxY+vxuyU9ypQAAAABAAH6QAAAAAAJ7uCQAAAAABPdwSAtntGGsgLuQ4F2s3CZRLNXv5LfLwAAAAACcdlJADKvbmLBIssIiEV1pl/0PvI5sl6KAAAAAABhsTZ8Oby2rLxu7g8GNePcXVyCmJ/WEdcAAAAAA5q7daJZwczBhc60XqQrBhbz5DQRQsHr0wAAAAAAvEb5f1vAmV2rlD8Jmzx9P/qvMm2kHW9AAAAAAAFgSOOwY8Ii2Xdzg9hKPgXrJtHlsQKqM9EBAAAAATXxtABwu4Ukg68+L8VltXohLpV47JlKCgAAAAEAAfpAAAAAAJr42gAAAAABNfG0AHedB4yX45n/PlLgZqqnpDBfrxF0AAAAAADQncMAhxDYae5S9ciWxq9I24hfuzaG5qwAAAAABWAJld9oCT9XJQcMavDlgXxhyQD+wLfXAgEAAACLsslwAKaPxRctlLK8F7c0ZpnFJrj3iY16AAAAAQAB+kAAAABF2WS4AAAAAIuyyXAArQsEdX8bEbK88KO9nQWFUlCr52AAAAAAAgmKZ4DVIgTftFr0fZruBA1N/U7mWfWdoQAAAAACeGPv8OTO+KKhb6wc4m9YJRz1JsLRYD2pAAAAAAA0J3DA/+SLSTLr+Y/+0Hkgk8Y6yeOS14wAAAAAAJtVwcEKWAO+6K2N6gduK4ILQFDMB8EbgQAAAAAAstBplytFxuvmm8IQkYMFyjMmY8jVtgFXAAAAAAD+JO+eLNpj8dzQwpznhYyLC1tZkr5yipMAAAAARdlkuABUEecNd5TPOFirCyrej1Z2AexdrgAAAAABSNQH9lXPfK1NA4Hemkg3Mw78wgMfoj02AAAAAAYcnzaAj/CSIQK9x8wWwZ0b2K7rRsbW2TwAAAAAAYBGB1qVu/C200Ie5V6SoPmNHrUJaNtKGwAAAAAAXCIb17MWOBLa+yJUgdHhDBre/T7Oz+6JAAAAAAXSHboA55Sxb2w1fHCesfem12HmmzQGbmMAAAAAAAwJ66nu6pROw/OceBrlzYZ4KPa5RRA2vQAAAAABBMUzwBYtMGt+JGeSXQHlZ0erNcofNc4vAAAAAAI7qx2TGMUu97W9uyDG+C0C5+A34TLQQ7gAAAAAAIEJFFEa4V/HQsz4fKgKtjrC4hkv1GtOCQAAAAAaqOtz7DI6R1hKUpfSuyJASZpgZcij5PDoAAAAAALaKCqAN7mToGCzhPgP95Qvw+DdPWb1CN4AAAAAAS6jKiFPq7/b7D4V6tH+IKvCHWSa0HiNowAAAAABZoWdwFUgU0GQqG1Yv+i/I8JIVYxLojheAAAAAAlQNywjXrFj2wJlMZ8RWTJQ2wMSmy9wEpoAAAAAAeNLYrtkFb282q7eaJ/NZ6x4Dkk2Gu01UwAAAAABkt/ttmg7vVuu7d9wYJYXSop232tA+/M7AAAAAAuicbCAkzE5oaV19+9SZrlOsAvhiyPCXGQAAAAAABe1au7AJHEchj3fiBMpNgEZxYY2IfEVlAAAAAAA70CbwMSMtnJoqFW3qSRrLyCVgznhoBQ6AAAAAAED1OBQ/SJwLf8yzbtIEXbMNuG57Kz2eG4BAAAArcEUrWAP4gAPXtu9RZx4YE7JuSO1b8eZOwAAAAEAAfpAAAAAVuCKVrAAAACtwRStYB9L+L4jNoJ8iodJVNVdNjiIXUF9AAAAAAAKV2X8JaEaT/MI/fKzs4JGKlNIvJKMlncAAAAAC+CUXeAyOWwAV2daVbv7TwqNa5P2A2UAHQAAAAAAHya5QCoQsaQG66H+l7cOIr5o5UvOs++PAQAAAAbna7eANqdqy0FoeqG6RzY2i3Vffpl89k0AAAABAAH6QAAAAANztdvAAAAABudrt4BHOiWjKC80jF9Ch2sHMiISP7/37AAAAAABfw+o4HRJ8Hbyh9WPB8+OGTP1FmHGDhO1AAAAAAVxXCs4gpT0W2y6Xz71yETk/LOXRTDpFFEAAAAAAaE7hgCq77Xli1AQoZ0aNlqICeGarILedAAAAAABKuebnLJso7BZ36HUUQkgNM7gfFLFUiMMAAAAAAI240qA0nsOpBn/b2hivJIYgSCh5FbTHyEAAAAAHhcEzDPdxD91L49ZbSs6XGoV2EM/Vfyu+QAAAAANChvndlHnZ+5mUH4jfhhMvuGhYufRiEVIAQAAACtG7g4A+WLSVftsi6BrEZL39zEJ9d+EPe0AAAABAAH6QAAAABWjdwcAAAAAK0buDgAD0v736KaDElx101Wm1CMX26Bz8QAAAAAADuLoFPCVIZcnrtRUFeNqK1wZ+1Ap6J53AQAAAZd0INwAEUT7D1mh732gOtdkCPx9V+qw5+AAAAABAAP0gAAAAEPosCSrAAABl3Qg3AAnlUbNOlMn0VT/iGCz50x0jmPvrAAAAAAAdETFpCgnh+V/A60Jk9iO9wTW+LY9Sh3TAAAAAAEkiiMAO8chaSLbFXxd0hlOeX5mX2jXGpsAAAAAANCdwwBAdvS9ygKWG+L91gd4DZQcBFCbjgAAAAAAvVzBYO0yS842t4xmvZrqDgAdvkzx640FAQAAAAlZDItgR0iNPsHFIbRISV0nEXy2C//Q/dIAAAABAAH6QAAAAASshkWwAAAACVkMi2BMbBOTfplBAgyEBM2bwpkpB5K8QAAAAAAK4oRjgGCTk3JdGjLG756Ai1N2Lx7xCAWgAAAAAAE47KSAYiQ86OeOf8MeXi0V40PFFNPqNuIAAAAAAGhO4YBkQjfaQT9A9UFrMB29IaMckbzciwAAAAAGHJ82gG7mEZ4LZYUpKtNKcSmTFqSC9JCHAAAAAAkxxd8eb7O0zWBS2lYn747wCQ7JeQpDKx8AAAAAAW11gy07yidsQ3wcF6QL7A0sUb26T1A4rAEAAAA8ln/dwHKiovl814ZPbPRx2s5ZmBdHyxOxAAAAAQAB+kAAAAAeSz/u4AAAADyWf93Af/t2TEfBFV0rh756/NV9om1nPPAAAAAAAPoLWfuEEmFK2BE6XVTF7zOwemc52Zs9EwAAAAAAPUu4IqiqZU6VBuR9KRohm6YyfGr2oYxPAAAAAAAt5ssgsxGzPJ38XfDoF4SHkZQCzUUjoooAAAAAAYi+A27AEZ/iHoNTmc0FNXEXW9mVqoroywAAAAAJ55tumsdUkQ2kL+4A64QhDmiYnuPAWiuFAAAAAAGfccKAP94z5Tq+QbXDxjxstkHeY57jrEgBAAAAGhApbOAIDqqaofoXXO6EpisTW4HFIRPy9wAAAAEAAfpAAAAADQgUtnAAAAAaECls4BAXw8be/oigImYNrwH0qhJFBrvHAAAAAAVMcWWBIS4OcWxSwPVP233Yuwtz1ZBafH0AAAAAAFGoioBIDe92+SCeWGD/us+IJlCBQKqZMQAAAAAAH0rdQFkwY/Rk+9Z0TXj2IBVfYYX+4iNjAAAAABkhubEAbRup6s3lzUHkHbrzlbwJyqJ/0RQAAAAAAgh/YCB7DPYxPhoY6oyAt/IkbZ2hERWjmwAAAAADCDarRInc83w5pZP76Tt9rZvlvO6V8kS3AAAAAABTXCj7jo9+2t1sgWI3K99p+MKvWdd0n+cAAAAAC0clUQ/NX7WWh/oh8J+C0sOS3WSWXkVHqAAAAAABlZuyoOWjlMT7uZc55hJeW8nDcIrqEIgBAAAAAAEND4vtCoWfs9zoqCSiUVHzidCnKlNif5UAAAAAAAH7WtAUnviq9tJ1X2/tmhDKEj7JmZUq9wAAAAABccW2cCFeJz8p9vDqDwSNYOxgJhStNNYSAQAAACLsslwAKF+jlbe9GxMD8+XnXQFCs8pfOTUAAAABAAH6QAAAABF2WS4AAAAAIuyyXAAtDyyk/7Ii4LRb98rFZv2rgQDopwAAAAAANCdwwEC9T2L3zsnCWIzngJCfmyJmH/0rAAAAAABoTuGAQ1tU9AEhyP+0UA/smwsccvNhpkkAAAAABBMUzwBJNwef9Jdpo6SmQGCerXwZLz09ggAAAATlr45dSE6XaFbAibXoVdRWvvS7VWLForNmAAAAAAsIoCTzW3koUkIaLDz9G8LLdpve30xTXBAAAAAAAFPvrSGFWksiBpjU9qsJawHzerQwUwfMOQAAAAAKWNHUFoZ7L/iaDv/NmzJzaK6AzZlb4WqkAAAAAAi/etu/htz6VkZNANXC1cHCU1l0GoVvFfUAAAAAAIC+/ACOCo4vaOgITUvd07qEIUKGcPGvGAAAAAAAAJiWgI5wE7f0RzLNyKsuXLMeJzfgInixAAAAAAH8ctXMkWJENgb+60tXcF2Q7zJOAROdvcsAAAAAADTfzam9dZ5xRhi1rUJRygc+NeE0q/YpvAAAAAAA0J3DABb5q7crphQbOxXVYzEU+kkzgph9AQAAATGXGKUAx/UL61EGbl3vKOH0nZj+tyrgpjEAAAABAAH6QAAAAJjLjFKAAAABMZcYpQDJGty+VDC/nZ9c2JMR/WUVG28HbgAAAAAAGtL7pdBkGFEdoW+MtEP0uZmaNq7B0prrAAAAAADZpChPwJORElVzh043nx8KkpfKdK5/teIBAAAAK3BFjQAJWONZCiaZFlaefenGMfytbGvXOwAAAAEAAfpAAAAAFbgixoAAAAArcEWNABKpZ8dJ7qYApDKYjkGUiYDsA+yeAAAAAALSHd3WFcEIFIlau+J9rjmDEax6eV5vybUAAAAAAXH7HlAaNWtijFevO+2JcC2QSGTYoNTcmAAAAAABk4qUYDPAsmDswqhxXPe3B41gWFrHB6NPAAAAAACx/G8APgmyAgK8pKfkX0dogIxtLJJ9/8gAAAAABKgXyABHbwL8pjXeDcusrFVQLqdeHcg2YgAAAAAAezR6ZUgJ6fDol3LGvZlnlODDHMheKFSIAAAAAAG2GBmAaO4cmhSoXsLZYMW1Cvl+R7yJ09MAAAAAABtxJYBqOhoXtH+GnxJQosYmUI3eyG6E8gAAAAAEJCKnQHJWMZNPfFm9uHLWP0zrNGcshONrAAAAAAAVycNHdPxE0GxTYHIc8VcOA8eReA7zFZ8AAAAAAapaqaGIAJc0Rsq+QjxrMndC9R2lWx+APgAAAAAA0J3DAORG1KWtb3KZE4trKj/VbxjqIxScAAAAAAB7j7hq6Qm6sgXOn4bCbzYm8fyRZCu+zKEAAAAAAAExLQAE0uOno4PCXqNEvREuTUjMKEuDPQAAAAAAhJFOCxIamvXEHhkhyrIxnueWqGlXFnHSAAAAABumbZyLdBLEzha8H8v5YyDwT5NVpqBOS38AAAAAAJx2UkDoQqlJI+Dy8grbCH9ST4GusQVXmwEAAAGXdCDcAJdIkna6RP6mcb5TlD5tBxL8pYfeAAAAAQAD9IAAAABD6LAkqwAAAZd0INwAoB+7ekrYsxU+DX66BF0/fgwJR1QAAAAAAH+NzwC9DAp0oXoTguaWDifw2VzlRcoH5wAAAAAEDR7uAMiWVvXtPkrBPxATxtpfw2Rys4w8AAAAAAKVskB3zGBqS7Jz5JpkYD0Dfwg9l8Iv3RMAAAAAB9b15pz6WxnQp7FJqtljFbtDLl4Veyu4WwAAAAAAXxC/UQA5dRqDP0ZB9M+kxC0b1Ura/tvnAAAAAABoTuGANNaqPwZFLR4iHg0l40RzrUERcPkAAAAAAAX14QA98+4sG38zR4VjkA/ogDebRnQ+jQAAAAAkMiY2r0q8UCmj9Gl8FkHmx3crQCOkIyFbAAAAAAAzmKsuW3YOtQ8dh0BQj04v7wSI+7HoC9YAAAAAAS/70wB+HWsjdSu/1CO0JvV9IWkX+K4AZQAAAAAFjswMc4zP+VyEfyaImf/2q994rafxUk9XAAAAAABQoVOwlkMW0TtzZViUSO+i3UTUxduerCQAAAAAAXWfB+SwsnXcypqVmn6cTDzMDmE0Tv+e0wAAAAAEExTPANFsDuQNTv78NJGC1aV3lvXsMaTWAAAAAACVlXUA07oyOHfBnnb+XvYJix5b2ekTST8AAAAAAfxeNkBY7JIoxRTvrKCFQ7oJabFF8asDlgEAAAART5HPwOvU7JFL7PhcQVhdUKgdzA9Lrk09AAAAAQAB+kAAAAAIp8jn4AAAABFPkc/A72BVjTM+d4OQJvobBXThsPHk0HkAAAAAKepeSBTzpTFQnUbfh+BYwnYmcqUTZsPOOwAAAAAAFDRZGA=="},test:{NETWORK_ID:1,NETWORK_NAME:"test",SEED_PEERS:[On.seed("seed1.nimiq-testnet.com",8080,"175d5f01af8a5911c240a78df689a76eef782d793ca15d073bdc913edd07c74b"),On.seed("seed2.nimiq-testnet.com",8080,"2c950d2afad1aa7ad12f01a56527f709b7687b1b00c94da6e0bd8ae4d263d47c"),On.seed("seed3.nimiq-testnet.com",8080,"03feec9d5316a7b5ebb69c4e709547a28afe8e9ef91ee568df489d29e9845bb8")],SEED_LISTS:[],GENESIS_BLOCK:new Je(new Re(new ie(null),new ie(null),ie.fromBase64("9rorv34UeKIJBXAARx1z+9wo3wtxd0fZKc/egpxBIPY="),ie.fromBase64("LgLaPRYuIPqYICnb3pzCD2tDGrBd8XZPNK9MYqTysz8="),De.difficultyToCompact(1),1,1522735199,79001,Re.Version.V1),new Me([],new ie(null)),new Le(ge.fromBase64("AAAAAAAAAAAAAAAAAAAAAAAAAAA="),[],M.fromBase64("VGVzdE5ldA=="))),GENESIS_ACCOUNTS:"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"},dev:{NETWORK_ID:2,NETWORK_NAME:"dev",SEED_PEERS:[Rn.seed("dev.nimiq-network.com",8080,"e65e39616662f2c16d62dc08915e5a1d104619db8c2b9cf9b389f96c8dce9837")],SEED_LISTS:[],GENESIS_BLOCK:new Je(new Re(new ie(null),new ie(null),ie.fromBase64("JvMr9c9l2m8HWNdFAGTEastKH+aDZvln9EopXelhVIg="),ie.fromBase64("1t/Zm91tN0p178+ePcxyR5bPxvC6jFLskqiidFFO3wY="),De.difficultyToCompact(1),1,1522338300,12432,Re.Version.V1),new Me([],new ie(null)),new Le(ge.fromBase64("AAAAAAAAAAAAAAAAAAAAAAAAAAA="),[],M.fromBase64("RGV2TmV0"))),GENESIS_ACCOUNTS:"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"}};var Wn=function(){function CloseType(){(0,_classCallCheck2["default"])(this,CloseType)}(0,_createClass2["default"])(CloseType,null,[{key:"isBanningType",value:function isBanningType(e){return e>=100&&e<200}},{key:"isFailingType",value:function isFailingType(e){return e>=200}}]);return CloseType}();Wn.GET_BLOCKS_TIMEOUT=1;Wn.GET_HEADER_TIMEOUT=2;Wn.GET_CHAIN_PROOF_TIMEOUT=3;Wn.GET_ACCOUNTS_PROOF_TIMEOUT=4;Wn.GET_ACCOUNTS_TREE_CHUNK_TIMEOUT=5;Wn.GET_TRANSACTIONS_PROOF_TIMEOUT=6;Wn.GET_TRANSACTION_RECEIPTS_TIMEOUT=7;Wn.SENDING_PING_MESSAGE_FAILED=10;Wn.SENDING_OF_VERSION_MESSAGE_FAILED=11;Wn.SIMULTANEOUS_CONNECTION=20;Wn.DUPLICATE_CONNECTION=21;Wn.INVALID_CONNECTION_STATE=22;Wn.PEER_BANNED=30;Wn.IP_BANNED=31;Wn.MAX_PEER_COUNT_REACHED=40;Wn.PEER_CONNECTION_RECYCLED=41;Wn.PEER_CONNECTION_RECYCLED_INBOUND_EXCHANGE=42;Wn.INBOUND_CONNECTIONS_BLOCKED=43;Wn.MANUAL_NETWORK_DISCONNECT=50;Wn.MANUAL_WEBSOCKET_DISCONNECT=51;Wn.MANUAL_PEER_DISCONNECT=52;Wn.INCOMPATIBLE_VERSION=100;Wn.DIFFERENT_GENESIS_BLOCK=101;Wn.INVALID_PEER_ADDRESS_IN_VERSION_MESSAGE=102;Wn.UNEXPECTED_PEER_ADDRESS_IN_VERSION_MESSAGE=103;Wn.INVALID_PUBLIC_KEY_IN_VERACK_MESSAGE=104;Wn.INVALID_SIGNATURE_IN_VERACK_MESSAGE=105;Wn.ADDR_MESSAGE_TOO_LARGE=110;Wn.ADDR_NOT_GLOBALLY_REACHABLE=111;Wn.INVALID_ADDR=112;Wn.INVALID_SIGNAL_TTL=113;Wn.INVALID_BLOCK=120;Wn.INVALID_HEADER=121;Wn.INVALID_ACCOUNTS_TREE_CHUNCK=122;Wn.INVALID_ACCOUNTS_PROOF=123;Wn.INVALID_CHAIN_PROOF=124;Wn.INVALID_TRANSACTION_PROOF=125;Wn.INVALID_BLOCK_PROOF=126;Wn.INVALID_TRANSACTION_RECEIPTS=127;Wn.RATE_LIMIT_EXCEEDED=130;Wn.BLOCKCHAIN_SYNC_FAILED=140;Wn.MANUAL_PEER_BAN=150;Wn.CONNECTION_FAILED=200;Wn.CLOSED_BY_REMOTE=201;Wn.NETWORK_ERROR=202;Wn.CHANNEL_CLOSING=203;Wn.VERSION_TIMEOUT=210;Wn.VERACK_TIMEOUT=211;Wn.PING_TIMEOUT=212;Wn.CONNECTION_LIMIT_PER_IP=220;Wn.CONNECTION_LIMIT_DUMB=221;Wn.FAILED_TO_PARSE_MESSAGE_TYPE=230;Wn.UNEXPECTED_ACCOUNTS_TREE_CHUNK=231;Wn.UNEXPECTED_HEADER=232;Wn.TRANSACTION_NOT_MATCHING_SUBSCRIPTION=233;Wn.ABORTED_SYNC=240;Wn.MANUAL_PEER_FAIL=250;n.register(Wn);var jn=function(e){(0,_inherits2["default"])(NetworkConnection,e);var t=_createSuper(NetworkConnection);function NetworkConnection(e,n,r,a){var i;(0,_classCallCheck2["default"])(this,NetworkConnection);(i=t.call(this))._channel=e;i._protocol=n;i._netAddress=r;i._peerAddress=a;i._bytesSent=0;i._bytesReceived=0;i._inbound=!a;i._closed=!1;i._lastError=null;i._id=NetworkConnection._instanceCount++;i._channel.on("message",function(e){return i._onMessage(e)});i._channel.on("error",function(e){return i._onError(e)});i._channel.on("close",function(){return i._close(Wn.CLOSED_BY_REMOTE,"Closed by remote")});return i}(0,_createClass2["default"])(NetworkConnection,[{key:"_onMessage",value:function _onMessage(e){if(!this._closed){this._bytesReceived+=e.byteLength||e.length;this.fire("message",e,this)}}},{key:"_onError",value:function _onError(e){if(!this._closed){this._lastError=e;this.fire("error",e,this)}}},{key:"_close",value:function _close(e,t){if(!this._closed){this._closed=!0;this._channel.close();this._channel=null;if(e===Wn.CLOSED_BY_REMOTE&&this._lastError){e=Wn.NETWORK_ERROR;t=this._lastError}t&&"string"!=typeof t&&(t="string"==typeof t.message?t.message:"");this.fire("close",e,t,this);this._offAll()}}},{key:"close",value:function close(e,t){if(!this._closed){var n=this._inbound?"inbound":"outbound";a.d(NetworkConnection,"Closing ".concat(n," connection #").concat(this._id," ").concat(this._peerAddress||this._netAddress)+(t?" - ".concat(t):"")+" (".concat(e,")"))}this._close(e,t)}},{key:"_isChannelOpen",value:function _isChannelOpen(){return this._channel&&this._channel.readyState===s.ReadyState.OPEN}},{key:"_isChannelClosing",value:function _isChannelClosing(){return this._channel&&this._channel.readyState===s.ReadyState.CLOSING}},{key:"_isChannelClosed",value:function _isChannelClosed(){return!this._channel||this._channel.readyState===s.ReadyState.CLOSED}},{key:"send",value:function send(e){var t=this,n=this._peerAddress||this._netAddress;if(this._closed)return!1;if(this._isChannelClosing()||this._isChannelClosed()){a.d(NetworkConnection,function(){return"Not sending data to ".concat(n," - channel closing/closed (").concat(t._channel.readyState,")")});this._close(Wn.CHANNEL_CLOSING,"channel closing");return!1}if(!this._isChannelOpen()){a.d(NetworkConnection,function(){return"Not sending data to ".concat(n," - channel not open (").concat(t._channel.readyState,")")});return!1}try{this._channel.send(e);this._bytesSent+=e.byteLength||e.length;return!0}catch(r){a.e(NetworkConnection,"Failed to send data to ".concat(n,": ").concat(r.message||r));return!1}}},{key:"expectMessage",value:function expectMessage(e,t,n,r){this._closed?setTimeout(t):this._channel.expectMessage(e,t,n,r)}},{key:"isExpectingMessage",value:function isExpectingMessage(e){return!this._closed&&this._channel.isExpectingMessage(e)}},{key:"confirmExpectedMessage",value:function confirmExpectedMessage(e,t){this._closed||this._channel.confirmExpectedMessage(e,t)}},{key:"equals",value:function equals(e){return e instanceof NetworkConnection&&this._id===e.id}},{key:"hashCode",value:function hashCode(){return this._id.toString()}},{key:"toString",value:function toString(){return"NetworkConnection{id=".concat(this._id,", protocol=").concat(this._protocol,", peerAddress=").concat(this._peerAddress,", netAddress=").concat(this._netAddress,"}")}},{key:"id",get:function get(){return this._id}},{key:"protocol",get:function get(){return this._protocol}},{key:"peerAddress",get:function get(){return this._peerAddress},set:function set(e){this._peerAddress=e}},{key:"netAddress",get:function get(){return this._netAddress},set:function set(e){this._netAddress=e}},{key:"bytesSent",get:function get(){return this._bytesSent}},{key:"bytesReceived",get:function get(){return this._bytesReceived}},{key:"inbound",get:function get(){return this._inbound}},{key:"outbound",get:function get(){return!this._inbound}},{key:"closed",get:function get(){return this._closed}},{key:"lastMessageReceivedAt",get:function get(){return this._closed?0:this._channel.lastMessageReceivedAt}}]);return NetworkConnection}(i);jn._instanceCount=0;n.register(jn);var Vn=function(e){(0,_inherits2["default"])(PeerChannel,e);var t=_createSuper(PeerChannel);function PeerChannel(e){var n;(0,_classCallCheck2["default"])(this,PeerChannel);(n=t.call(this))._conn=e;n._conn.on("message",function(e){return n._onMessage(e)});n.bubble(n._conn,"close","error");return n}(0,_createClass2["default"])(PeerChannel,[{key:"_onMessage",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee379(e){var t,n,r,i,s=this;return _regenerator["default"].wrap(function _callee379$(o){for(;;)switch(o.prev=o.next){case 0:t=(0,_now["default"])();n=null,r=null;o.prev=2;i=new U(e);r=kn.peekType(i);n=kn.parse(i);o.next=17;break;case 8:o.prev=8;o.t0=o["catch"](2);a.d(PeerChannel,function(){return"Failed to parse '".concat(PeerChannel.Event[r],"' message from ").concat(s.peerAddress||s.netAddress)},o.t0.message||o.t0);this._conn.confirmExpectedMessage(r,!1);if(null!==r&&r!==Rt.Type.REJECT){o.next=15;break}this.close(Wn.FAILED_TO_PARSE_MESSAGE_TYPE,"Failed to parse message type");return o.abrupt("return");case 15:this.reject(r,Yt.Code.REJECT_MALFORMED,o.t0.message||o.t0);return o.abrupt("return");case 17:if(n){o.next=19;break}return o.abrupt("return");case 19:this._conn.confirmExpectedMessage(r,!0);o.prev=20;o.next=23;return this.fire(PeerChannel.Event[n.type],n,this);case 23:this.fire("message-log",n,this,(0,_now["default"])()-t,e.byteLength);o.next=29;break;case 26:o.prev=26;o.t1=o["catch"](20);a.w(PeerChannel,"Error while processing '".concat(PeerChannel.Event[n.type],"' message from ").concat(this.peerAddress||this.netAddress,": ").concat(o.t1));case 29:case"end":return o.stop()}},_callee379,this,[[2,8],[20,26]])}));return function _onMessage(t){return e.apply(this,arguments)}}()},{key:"expectMessage",value:function expectMessage(e,t,n,r){this._conn.expectMessage(e,t,n,r)}},{key:"isExpectingMessage",value:function isExpectingMessage(e){return this._conn.isExpectingMessage(e)}},{key:"_send",value:function _send(e){return this._conn.send(e.serialize())}},{key:"close",value:function close(e,t){this._conn.close(e,t);this._offAll()}},{key:"version",value:function version(e,t,n,r){return this._send(new en(g.CODE,e,qn.GENESIS_HASH,t,n,g.createUserAgent(r)))}},{key:"verack",value:function verack(e,t){return this._send(new tn(e,t))}},{key:"inv",value:function inv(e){return this._send(new Kt(e))}},{key:"notFound",value:function notFound(e){return this._send(new jt(e))}},{key:"getData",value:function getData(e){return this._send(new qt(e))}},{key:"getHeader",value:function getHeader(e){return this._send(new Wt(e))}},{key:"block",value:function block(e){return this._send(new Lt(e))}},{key:"rawBlock",value:function rawBlock(e){return this._send(new Dt(e))}},{key:"header",value:function header(e){return this._send(new Ht(e))}},{key:"tx",value:function tx(e,t){return this._send(new $t(e,t))}},{key:"getBlocks",value:function getBlocks(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ft.VECTORS_MAX_COUNT,n=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2];return this._send(new zt(e,t,n?zt.Direction.FORWARD:zt.Direction.BACKWARD))}},{key:"mempool",value:function mempool(){return this._send(new Vt)}},{key:"reject",value:function reject(e,t,n,r){return this._send(new Yt(e,t,n,r))}},{key:"subscribe",value:function subscribe(e){return this._send(new Zt(e))}},{key:"addr",value:function addr(e){return this._send(new Mt(e))}},{key:"getAddr",value:function getAddr(e,t,n){return this._send(new Ut(e,t,n))}},{key:"ping",value:function ping(e){return this._send(new Qt(e))}},{key:"pong",value:function pong(e){return this._send(new Jt(e))}},{key:"signal",value:function signal(e,t,n,r,a,i,s,o){return this._send(new Xt(e,t,n,r,a,i,s,o))}},{key:"getAccountsProof",value:function getAccountsProof(e,t){return this._send(new rn(e,t))}},{key:"accountsProof",value:function accountsProof(e,t){return this._send(new nn(e,t))}},{key:"getChainProof",value:function getChainProof(){return this._send(new sn)}},{key:"chainProof",value:function chainProof(e){return this._send(new an(e))}},{key:"getAccountsTreeChunk",value:function getAccountsTreeChunk(e,t){return this._send(new un(e,t))}},{key:"accountsTreeChunk",value:function accountsTreeChunk(e,t){return this._send(new on(e,t))}},{key:"getTransactionsProof",value:function getTransactionsProof(e,t){return this.getTransactionsProofByAddresses(e,t)}},{key:"getTransactionsProofByAddresses",value:function getTransactionsProofByAddresses(e,t){return this._send(new ln(e,t))}},{key:"getTransactionsProofByHashes",value:function getTransactionsProofByHashes(e,t){return this._send(new hn(e,t))}},{key:"transactionsProof",value:function transactionsProof(e,t){return this._send(new cn(e,t))}},{key:"getTransactionReceipts",value:function getTransactionReceipts(e){return this.getTransactionReceiptsByAddress(e)}},{key:"getTransactionReceiptsByAddress",value:function getTransactionReceiptsByAddress(e){return this._send(new fn(e))}},{key:"getTransactionReceiptsByHashes",value:function getTransactionReceiptsByHashes(e){return this._send(new dn(e))}},{key:"transactionReceipts",value:function transactionReceipts(e){return this._send(new An(e))}},{key:"getBlockProof",value:function getBlockProof(e,t){return this._send(new _n(e,t))}},{key:"getBlockProofAt",value:function getBlockProofAt(e,t){return this._send(new pn(e,t))}},{key:"blockProof",value:function blockProof(e){return this._send(new gn(e))}},{key:"getHead",value:function getHead(){return this._send(new yn)}},{key:"head",value:function head(e){return this._send(new vn(e))}},{key:"equals",value:function equals(e){return e instanceof PeerChannel&&this._conn.equals(e.connection)}},{key:"hashCode",value:function hashCode(){return this._conn.hashCode()}},{key:"toString",value:function toString(){return"PeerChannel{conn=".concat(this._conn,"}")}},{key:"connection",get:function get(){return this._conn}},{key:"id",get:function get(){return this._conn.id}},{key:"protocol",get:function get(){return this._conn.protocol}},{key:"peerAddress",get:function get(){return this._conn.peerAddress},set:function set(e){this._conn.peerAddress=e}},{key:"netAddress",get:function get(){return this._conn.netAddress},set:function set(e){this._conn.netAddress=e}},{key:"closed",get:function get(){return this._conn.closed}},{key:"lastMessageReceivedAt",get:function get(){return this._conn.lastMessageReceivedAt}}]);return PeerChannel}(i);n.register(Vn);Vn.Event={};Vn.Event[Rt.Type.VERSION]="version";Vn.Event[Rt.Type.INV]="inv";Vn.Event[Rt.Type.GET_DATA]="get-data";Vn.Event[Rt.Type.GET_HEADER]="get-header";Vn.Event[Rt.Type.NOT_FOUND]="not-found";Vn.Event[Rt.Type.GET_BLOCKS]="get-blocks";Vn.Event[Rt.Type.BLOCK]="block";Vn.Event[Rt.Type.HEADER]="header";Vn.Event[Rt.Type.TX]="tx";Vn.Event[Rt.Type.MEMPOOL]="mempool";Vn.Event[Rt.Type.REJECT]="reject";Vn.Event[Rt.Type.SUBSCRIBE]="subscribe";Vn.Event[Rt.Type.ADDR]="addr";Vn.Event[Rt.Type.GET_ADDR]="get-addr";Vn.Event[Rt.Type.PING]="ping";Vn.Event[Rt.Type.PONG]="pong";Vn.Event[Rt.Type.SIGNAL]="signal";Vn.Event[Rt.Type.GET_CHAIN_PROOF]="get-chain-proof";Vn.Event[Rt.Type.CHAIN_PROOF]="chain-proof";Vn.Event[Rt.Type.GET_ACCOUNTS_PROOF]="get-accounts-proof";Vn.Event[Rt.Type.ACCOUNTS_PROOF]="accounts-proof";Vn.Event[Rt.Type.GET_ACCOUNTS_TREE_CHUNK]="get-accounts-tree-chunk";Vn.Event[Rt.Type.ACCOUNTS_TREE_CHUNK]="accounts-tree-chunk";Vn.Event[Rt.Type.GET_TRANSACTIONS_PROOF_BY_ADDRESSES]="get-transactions-proof";Vn.Event[Rt.Type.TRANSACTIONS_PROOF]="transactions-proof";Vn.Event[Rt.Type.GET_TRANSACTION_RECEIPTS_BY_ADDRESS]="get-transaction-receipts";Vn.Event[Rt.Type.TRANSACTION_RECEIPTS]="transaction-receipts";Vn.Event[Rt.Type.GET_BLOCK_PROOF]="get-block-proof";Vn.Event[Rt.Type.BLOCK_PROOF]="block-proof";Vn.Event[Rt.Type.GET_TRANSACTIONS_PROOF_BY_HASHES]="get-transactions-proof-by-hashes";Vn.Event[Rt.Type.GET_TRANSACTION_RECEIPTS_BY_HASHES]="get-transaction-receipts-by-hashes";Vn.Event[Rt.Type.GET_BLOCK_PROOF_AT]="get-block-proof-at";Vn.Event[Rt.Type.GET_HEAD]="get-head";Vn.Event[Rt.Type.HEAD]="head";Vn.Event[Rt.Type.VERACK]="verack";var Qn=function(e){(0,_inherits2["default"])(NetworkAgent,e);var t=_createSuper(NetworkAgent);function NetworkAgent(e,n,r,a){var i;(0,_classCallCheck2["default"])(this,NetworkAgent);(i=t.call(this))._blockchain=e;i._addresses=n;i._networkConfig=r;i._channel=a;i._peer=null;i._timers=new p;i._versionReceived=!1;i._verackReceived=!1;i._versionSent=!1;i._verackSent=!1;i._versionAttempts=0;i._peerAddressVerified=!1;i._peerChallengeNonce=null;i._pingTimes=new _map2["default"];i._addressRequest=null;i._getAddrLimit=new F(NetworkAgent.GETADDR_RATE_LIMIT);i._challengeNonce=new Uint8Array(en.CHALLENGE_SIZE);q.lib.getRandomValues(i._challengeNonce);a.on("version",function(e){return i._onVersion(e)});a.on("verack",function(e){return i._onVerAck(e)});a.on("addr",function(e){return i._onAddr(e)});a.on("get-addr",function(e){return i._onGetAddr(e)});a.on("ping",function(e){return i._onPing(e)});a.on("pong",function(e){return i._onPong(e)});a.on("close",function(){return i._onClose()});return i}(0,_createClass2["default"])(NetworkAgent,[{key:"handshake",value:function handshake(){var e=this;if(!this._versionSent)if(this._channel.version(this._networkConfig.peerAddress,this._blockchain.headHash,this._challengeNonce,this._networkConfig.appAgent)){this._versionSent=!0;this._versionReceived?this._peerAddressVerified&&this._sendVerAck():this._timers.setTimeout("version",function(){e._timers.clearTimeout("version");e._channel.close(Wn.VERSION_TIMEOUT,"version timeout")},NetworkAgent.HANDSHAKE_TIMEOUT);this._timers.setTimeout("verack",function(){e._timers.clearTimeout("verack");e._channel.close(Wn.VERACK_TIMEOUT,"verack timeout")},2*NetworkAgent.HANDSHAKE_TIMEOUT)}else{this._versionAttempts++;if(this._versionAttempts>=NetworkAgent.VERSION_ATTEMPTS_MAX||this._channel.closed){this._channel.close(Wn.SENDING_OF_VERSION_MESSAGE_FAILED,"sending of version message failed");return}setTimeout(this.handshake.bind(this),NetworkAgent.VERSION_RETRY_DELAY)}}},{key:"_onVersion",value:function _onVersion(e){var t=this;a.v(NetworkAgent,function(){return"[VERSION] ".concat(e.peerAddress," ").concat(e.headHash.toBase64())});var n=(0,_now["default"])();if(this._canAcceptMessage(e))if(this._versionReceived)a.d(NetworkAgent,function(){return"Ignoring duplicate version message from ".concat(t._channel.peerAddress)});else{this._timers.clearTimeout("version");if(g.isCompatible(e.version))if(qn.GENESIS_HASH.equals(e.genesisHash))if(e.peerAddress.verifySignature()){var r=e.peerAddress;if(this._channel.peerAddress){if(!this._channel.peerAddress.equals(r)){this._channel.close(Wn.UNEXPECTED_PEER_ADDRESS_IN_VERSION_MESSAGE,"unexpected peerAddress in version message");return}this._peerAddressVerified=!0}if(!r.netAddress){var i=this._addresses.get(r);i&&i.netAddress&&(r.netAddress=i.netAddress)}this._channel.peerAddress=r;this._peer=new fr(this._channel,e.version,e.headHash,r.timestamp-n,e.userAgent);this._peerChallengeNonce=e.challengeNonce;this._versionReceived=!0;this.fire("version",this._peer,this);if(!this._channel.closed)if(this._versionSent){this._peerAddressVerified&&this._sendVerAck();this._verackReceived&&this._finishHandshake()}else this.handshake()}else this._channel.close(Wn.INVALID_PEER_ADDRESS_IN_VERSION_MESSAGE,"invalid peerAddress in version message");else this._channel.close(Wn.DIFFERENT_GENESIS_BLOCK,"different genesis block (".concat(e.genesisHash,")"));else{this._channel.reject(Rt.Type.VERSION,Yt.Code.REJECT_OBSOLETE,"incompatible version (ours=".concat(g.CODE,", theirs=").concat(e.version,")"));this._channel.close(Wn.INCOMPATIBLE_VERSION,"incompatible version (ours=".concat(g.CODE,", theirs=").concat(e.version,")"))}}}},{key:"_sendVerAck",value:function _sendVerAck(){R.that(this._peerAddressVerified);var e=M.concatTypedArrays(this._channel.peerAddress.peerId.serialize(),this._peerChallengeNonce),t=de.create(this._networkConfig.keyPair.privateKey,this._networkConfig.keyPair.publicKey,e);this._channel.verack(this._networkConfig.keyPair.publicKey,t);this._verackSent=!0}},{key:"_onVerAck",value:function _onVerAck(e){var t=this;a.v(NetworkAgent,function(){return"[VERACK] from ".concat(t._channel.peerAddress)});if(this._canAcceptMessage(e))if(this._verackReceived)a.d(NetworkAgent,function(){return"Ignoring duplicate verack message from ".concat(t._channel.peerAddress)});else{this._timers.clearTimeout("verack");if(e.publicKey.toPeerId().equals(this._channel.peerAddress.peerId)){var n=M.concatTypedArrays(this._networkConfig.peerAddress.peerId.serialize(),this._challengeNonce);if(e.signature.verify(e.publicKey,n)){if(!this._peerAddressVerified){this._peerAddressVerified=!0;this._sendVerAck()}this._verackReceived=!0;this._verackSent&&this._finishHandshake()}else this._channel.close(Wn.INVALID_SIGNATURE_IN_VERACK_MESSAGE,"Invalid signature in verack message")}else this._channel.close(Wn.INVALID_PUBLIC_KEY_IN_VERACK_MESSAGE,"Invalid public key in verack message")}}},{key:"_finishHandshake",value:function _finishHandshake(){var e=this;this._timers.setInterval("connectivity",function(){return e._checkConnectivity()},NetworkAgent.CONNECTIVITY_CHECK_INTERVAL);this._timers.setInterval("announce-addr",function(){return e._channel.addr([e._networkConfig.peerAddress])},NetworkAgent.ANNOUNCE_ADDR_INTERVAL);this.fire("handshake",this._peer,this);this.requestAddresses()}},{key:"requestAddresses",value:function requestAddresses(){var e=this,t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:NetworkAgent.NUM_ADDR_PER_REQUEST;a.d(ur,function(){return"Requesting addresses from ".concat(e._peer.peerAddress)});this._addressRequest={maxResults:t};var n=this._networkConfig.services.accepted;this._peer.version<2&&(n&=_.ALL_LEGACY);this._channel.getAddr(this._networkConfig.protocolMask,n,t)}},{key:"_onAddr",value:function _onAddr(e){var t=this;if(this._canAcceptMessage(e)){var n=1===e.addresses.length&&this._peer.peerAddress.equals(e.addresses[0]);if(this._addressRequest||n){var r=(this._addressRequest||{}).maxResults,i=void 0===r?NetworkAgent.MAX_ADDR_PER_REQUEST:r;n||(this._addressRequest=null);if(e.addresses.length>NetworkAgent.MAX_ADDR_PER_MESSAGE){a.w(NetworkAgent,"Rejecting addr message - too many addresses");this._channel.close(Wn.ADDR_MESSAGE_TOO_LARGE,"addr message too large")}else{a.v(NetworkAgent,function(){return"[ADDR] ".concat(e.addresses.length," addresses from ").concat(t._peer.peerAddress)});var s=e.addresses.slice(0,i),o=!0,u=!1,c=undefined;try{for(var l,h=(0,_getIterator2["default"])(s);!(o=(l=h.next()).done);o=!0){var f=l.value;if(!f.verifySignature()){this._channel.close(Wn.INVALID_ADDR,"invalid addr");return}if((f.protocol===Ot.WS||f.protocol===Ot.WSS)&&!f.globallyReachable()){this._channel.close(Wn.ADDR_NOT_GLOBALLY_REACHABLE,"addr not globally reachable");return}}}catch(d){u=!0;c=d}finally{try{o||null==h["return"]||h["return"]()}finally{if(u)throw c}}this._addresses.add(this._channel,s);n&&(this._peer.peerAddress=s[0]);this.fire("addr",s,this)}}}}},{key:"_onGetAddr",value:function _onGetAddr(e){if(this._canAcceptMessage(e))if(this._getAddrLimit.note()){var t=Math.min(e.maxResults,NetworkAgent.MAX_ADDR_PER_REQUEST),n=this._addresses.query(e.protocolMask,e.serviceMask,t);this._channel.addr(n)}else a.w(NetworkAgent,"Rejecting getaddr message - rate limit exceeded")}},{key:"_checkConnectivity",value:function _checkConnectivity(){var e=this,t=Y.randomUint32();if(this._channel.ping(t)){var n=(0,_now["default"])();this._pingTimes.set(t,n);this._channel.lastMessageReceivedAt<n-NetworkAgent.CONNECTIVITY_CHECK_INTERVAL&&this._timers.setTimeout("ping_".concat(t),function(){e._timers.clearTimeout("ping_".concat(t));e._pingTimes["delete"](t);e._channel.close(Wn.PING_TIMEOUT,"ping timeout")},NetworkAgent.PING_TIMEOUT)}else this._channel.close(Wn.SENDING_PING_MESSAGE_FAILED,"sending ping message failed")}},{key:"_onPing",value:function _onPing(e){this._canAcceptMessage(e)&&this._channel.pong(e.nonce)}},{key:"_onPong",value:function _onPong(e){this._timers.clearTimeout("ping_".concat(e.nonce));var t=this._pingTimes.get(e.nonce);if(t){var n=(0,_now["default"])()-t;n>0&&this.fire("ping-pong",n);this._pingTimes["delete"](e.nonce)}}},{key:"_onClose",value:function _onClose(){this._timers.clearAll()}},{key:"_canAcceptMessage",value:function _canAcceptMessage(e){if(!this._versionReceived&&e.type!==Rt.Type.VERSION){a.w(NetworkAgent,"Discarding '".concat(Vn.Event[e.type]||e.type,"' message from ").concat(this._channel.peerAddress||this._channel.netAddress)+" - no version message received previously");return!1}if(this._versionReceived&&!this._verackReceived&&e.type!==Rt.Type.VERACK){a.w(NetworkAgent,"Discarding '".concat(Vn.Event[e.type]||e.type,"' message from ").concat(this._channel.peerAddress||this._channel.netAddress)+" - no verack message received previously");return!1}return!0}},{key:"channel",get:function get(){return this._channel}},{key:"peer",get:function get(){return this._peer}}]);return NetworkAgent}(i);Qn.HANDSHAKE_TIMEOUT=4e3;Qn.PING_TIMEOUT=1e4;Qn.CONNECTIVITY_CHECK_INTERVAL=6e4;Qn.ANNOUNCE_ADDR_INTERVAL=6e5;Qn.VERSION_ATTEMPTS_MAX=10;Qn.VERSION_RETRY_DELAY=500;Qn.GETADDR_RATE_LIMIT=3;Qn.MAX_ADDR_PER_MESSAGE=1e3;Qn.MAX_ADDR_PER_REQUEST=500;Qn.NUM_ADDR_PER_REQUEST=200;n.register(Qn);var Jn=function(){function PeerConnectionStatistics(){(0,_classCallCheck2["default"])(this,PeerConnectionStatistics);this._latencies=[];this._messages=new b}(0,_createClass2["default"])(PeerConnectionStatistics,[{key:"reset",value:function reset(){this._latencies=[];this._messages=new b}},{key:"addLatency",value:function addLatency(e){this._latencies.push(e)}},{key:"addMessage",value:function addMessage(e){this._messages.put(e.type,this._messages.contains(e.type)?this._messages.get(e.type)+1:1)}},{key:"getMessageCount",value:function getMessageCount(e){return this._messages.contains(e)?this._messages.get(e):0}},{key:"latencyMedian",get:function get(){var e=this._latencies.length;if(0===e)return 0;this._latencies.sort(function(e,t){return e-t});return e%2==0?Math.round((this._latencies[e/2-1]+this._latencies[e/2])/2):this._latencies[(e-1)/2]}}]);return PeerConnectionStatistics}();n.register(Jn);var Yn=function(){(0,_createClass2["default"])(PeerConnection,null,[{key:"getOutbound",value:function getOutbound(e){var t=new PeerConnection;t._peerAddress=e;t._state=Xn.CONNECTING;return t}},{key:"getInbound",value:function getInbound(e){var t=new PeerConnection;t._networkConnection=e;return t}}]);function PeerConnection(){(0,_classCallCheck2["default"])(this,PeerConnection);this._id=PeerConnection._instanceCount++;this._peerAddress=null;this._networkConnection=null;this._peerChannel=null;this._networkAgent=null;this._peer=null;this._state=Xn.NEW;this._score=null;this._establishedSince=null;this._statistics=new Jn}(0,_createClass2["default"])(PeerConnection,[{key:"negotiating",value:function negotiating(){R.that(this._state===Xn.CONNECTED);this._state=Xn.NEGOTIATING}},{key:"close",value:function close(){this._state=Xn.CLOSED;this._networkConnection=null;this._networkAgent=null;this._peerChannel=null;this._peer=null}},{key:"id",get:function get(){return this._id}},{key:"state",get:function get(){return this._state}},{key:"peerAddress",get:function get(){return this._peerAddress},set:function set(e){this._peerAddress=e}},{key:"networkConnection",get:function get(){return this._networkConnection},set:function set(e){this._networkConnection=e;this._state=Xn.CONNECTED}},{key:"peerChannel",get:function get(){return this._peerChannel},set:function set(e){this._peerChannel=e}},{key:"networkAgent",get:function get(){return this._networkAgent},set:function set(e){this._networkAgent=e}},{key:"peer",get:function get(){return this._peer},set:function set(e){var t=this;this._peer=e;this._state=Xn.ESTABLISHED;this._establishedSince=(0,_now["default"])();this._networkAgent.on("ping-pong",function(e){return t._statistics.addLatency(e)});this._peerChannel.on("message-log",function(e){return t._statistics.addMessage(e)})}},{key:"score",get:function get(){return this._score},set:function set(e){this._score=e}},{key:"establishedSince",get:function get(){return this._establishedSince}},{key:"ageEstablished",get:function get(){return(0,_now["default"])()-this.establishedSince}},{key:"statistics",get:function get(){return this._statistics}}]);return PeerConnection}();Yn._instanceCount=0;n.register(Yn);var Xn=function PeerConnectionState(){(0,_classCallCheck2["default"])(this,PeerConnectionState)};Xn.NEW=1;Xn.CONNECTING=2;Xn.CONNECTED=3;Xn.NEGOTIATING=4;Xn.ESTABLISHED=5;Xn.CLOSED=6;n.register(Xn);var Zn=function(){function SignalProcessor(e,t,n){(0,_classCallCheck2["default"])(this,SignalProcessor);this._addresses=e;this._networkConfig=t;this._rtcConnector=n;this._forwards=new $n}(0,_createClass2["default"])(SignalProcessor,[{key:"onSignal",value:function onSignal(e,t){if(t.ttl>ur.SIGNAL_TTL_INITIAL)e.close(Wn.INVALID_SIGNAL_TTL,"invalid signal ttl");else{var n=this._networkConfig.peerId;if(t.senderId.equals(n))a.d(SignalProcessor,function(){return"Received signal from myself to ".concat(t.recipientId," from ").concat(e.peerAddress," (myId: ").concat(n,")")});else{if(t.isUnroutable()&&this._forwards.signalForwarded(t.recipientId,t.senderId,t.nonce)){var r=this._addresses.getByPeerId(t.senderId);this._addresses.unroutable(e,r)}if(t.recipientId.equals(n)){if(this._networkConfig.protocol!==Ot.RTC)return;if(t.hasPayload()&&!t.verifySignature()){a.d(SignalProcessor,function(){return"Discarding signal from ".concat(t.senderId," received via ").concat(e.peerAddress," - invalid signature")});return}if(this._rtcConnector.isValidSignal(t)&&(t.isUnroutable()||t.isTtlExceeded())){var i=this._addresses.getByPeerId(t.senderId);this._addresses.unroutable(e,i)}this._rtcConnector.onSignal(e,t)}else if(t.ttl<=0){a.d(SignalProcessor,function(){return"Discarding signal from ".concat(t.senderId," to ").concat(t.recipientId," - TTL reached")});0===t.flags&&e.signal(t.recipientId,t.senderId,t.nonce,ur.SIGNAL_TTL_INITIAL,Xt.Flag.TTL_EXCEEDED)}else{var s=this._addresses.getChannelByPeerId(t.recipientId);if(s)if(s.peerAddress.equals(e.peerAddress)){a.d(SignalProcessor,function(){return"Discarding signal from ".concat(t.senderId," to ").concat(t.recipientId," - shortest route via sending peer")});0===t.flags&&e.signal(t.recipientId,t.senderId,t.nonce,ur.SIGNAL_TTL_INITIAL,Xt.Flag.UNROUTABLE)}else{s.signal(t.senderId,t.recipientId,t.nonce,t.ttl-1,t.flags,t.payload,t.senderPubKey,t.signature);0===t.flags&&this._forwards.add(t.senderId,t.recipientId,t.nonce)}else{a.d(SignalProcessor,function(){return"Failed to forward signal from ".concat(t.senderId," to ").concat(t.recipientId," - no route found")});0===t.flags&&e.signal(t.recipientId,t.senderId,t.nonce,ur.SIGNAL_TTL_INITIAL,Xt.Flag.UNROUTABLE)}}}}}}]);return SignalProcessor}();n.register(Zn);var $n=function(){function SignalStore(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1e3;(0,_classCallCheck2["default"])(this,SignalStore);this._maxSize=e;this._queue=new P;this._store=new b}(0,_createClass2["default"])(SignalStore,[{key:"add",value:function add(e,t,n){if(this.contains(e,t,n)){var r=new er(e,t,n);this._store.put(r,(0,_now["default"])());this._queue.requeue(r)}else{if(this.length>=this._maxSize){var a=this._queue.dequeue();this._store.remove(a)}var i=new er(e,t,n);this._queue.enqueue(i);this._store.put(i,(0,_now["default"])())}}},{key:"contains",value:function contains(e,t,n){var r=new er(e,t,n);return this._store.contains(r)}},{key:"signalForwarded",value:function signalForwarded(e,t,n){var r=new er(e,t,n),a=this._store.get(r);if(!a)return!1;var i=a+er.SIGNAL_MAX_AGE>(0,_now["default"])();if(!i){var s;do{s=this._queue.dequeue();this._store.remove(s)}while(this._queue.length>0&&!r.equals(s))}return i}},{key:"length",get:function get(){return this._queue.length}}]);return SignalStore}();$n.SIGNAL_MAX_AGE=10;n.register($n);var er=function(){function ForwardedSignal(e,t,n){(0,_classCallCheck2["default"])(this,ForwardedSignal);this._senderId=e;this._recipientId=t;this._nonce=n}(0,_createClass2["default"])(ForwardedSignal,[{key:"equals",value:function equals(e){return e instanceof ForwardedSignal&&this._senderId.equals(e._senderId)&&this._recipientId.equals(e._recipientId)&&this._nonce===e._nonce}},{key:"hashCode",value:function hashCode(){return this.toString()}},{key:"toString",value:function toString(){return"ForwardedSignal{senderId=".concat(this._senderId,", recipientId=").concat(this._recipientId,", nonce=").concat(this._nonce,"}")}}]);return ForwardedSignal}();n.register(er);var tr=function(e){(0,_inherits2["default"])(ConnectionPool,e);var t=_createSuper(ConnectionPool);function ConnectionPool(e,n,r){var a;(0,_classCallCheck2["default"])(this,ConnectionPool);(a=t.call(this))._addresses=e;a._networkConfig=n;a._blockchain=r;a._connectionsByPeerAddress=new b;a._connectionsByNetAddress=new b;a._connectionsBySubnet=new b;a._bytesSent=0;a._bytesReceived=0;a._wssConnector=new En(Ot.WSS,"wss",a._networkConfig);a._wssConnector.on("connection",function(e){return a._onConnection(e)});a._wssConnector.on("error",function(e,t){return a._onConnectError(e,t)});a._wsConnector=new En(Ot.WS,"ws",a._networkConfig);a._wsConnector.on("connection",function(e){return a._onConnection(e)});a._wsConnector.on("error",function(e,t){return a._onConnectError(e,t)});a._rtcConnector=new mn(a._networkConfig);a._rtcConnector.on("connection",function(e){return a._onConnection(e)});a._rtcConnector.on("error",function(e,t){return a._onConnectError(e,t)});a._peerCountWs=0;a._peerCountWss=0;a._peerCountRtc=0;a._peerCountDumb=0;a._peerCountFull=0;a._peerCountLight=0;a._peerCountNano=0;a._peerCountOutbound=0;a._peerCountFullWsOutbound=0;a._connectingCount=0;a._inboundCount=0;a._signalProcessor=new Zn(e,n,a._rtcConnector);a._allowInboundExchange=!1;a._allowInboundConnections=!1;a._bannedIPv4IPs=new b;a._bannedIPv6IPs=new b;setInterval(function(){return a._checkUnbanIps()},ConnectionPool.UNBAN_IPS_INTERVAL);return a}(0,_createClass2["default"])(ConnectionPool,[{key:"values",value:function values(){return(0,_from["default"])(this._connectionsByPeerAddress.values())}},{key:"valueIterator",value:function valueIterator(){return this._connectionsByPeerAddress.valueIterator()}},{key:"getConnectionByPeerAddress",value:function getConnectionByPeerAddress(e){return this._connectionsByPeerAddress.get(e)}},{key:"getConnectionsByNetAddress",value:function getConnectionsByNetAddress(e){return this._connectionsByNetAddress.get(e)||[]}},{key:"getConnectionsBySubnet",value:function getConnectionsBySubnet(e){return this._connectionsBySubnet.get(this._getSubnetAddress(e))||[]}},{key:"getOutboundConnectionsBySubnet",value:function getOutboundConnectionsBySubnet(e){return(this._connectionsBySubnet.get(this._getSubnetAddress(e))||[]).filter(function(e){return e.networkConnection.outbound})}},{key:"_getSubnetAddress",value:function _getSubnetAddress(e){return e.subnet(e.isIPv4()?ur.IPV4_SUBNET_MASK:ur.IPV6_SUBNET_MASK)}},{key:"_add",value:function _add(e){e.peerAddress&&this._connectionsByPeerAddress.put(e.peerAddress,e)}},{key:"_remove",value:function _remove(e){e.peerAddress&&this._connectionsByPeerAddress.remove(e.peerAddress);e.networkConnection&&e.networkConnection.netAddress&&this._removeNetAddress(e,e.networkConnection.netAddress)}},{key:"_addNetAddress",value:function _addNetAddress(e,t){if(!t.isPseudo()&&t.reliable){this._connectionsByNetAddress.contains(t)?this._connectionsByNetAddress.get(t).push(e):this._connectionsByNetAddress.put(t,[e]);var n=this._getSubnetAddress(t);this._connectionsBySubnet.contains(n)?this._connectionsBySubnet.get(n).push(e):this._connectionsBySubnet.put(n,[e])}}},{key:"_removeNetAddress",value:function _removeNetAddress(e,t){if(!t.isPseudo()&&t.reliable){if(this._connectionsByNetAddress.contains(t)){var n=this._connectionsByNetAddress.get(t),r=n.indexOf(e);r>=0&&n.splice(r,1);0===n.length&&this._connectionsByNetAddress.remove(t)}var a=this._getSubnetAddress(t);if(this._connectionsBySubnet.contains(a)){var i=this._connectionsBySubnet.get(a),s=i.indexOf(e);s>=0&&i.splice(s,1);0===i.length&&this._connectionsBySubnet.remove(a)}}}},{key:"_checkOutboundConnectionRequest",value:function _checkOutboundConnectionRequest(e){if(null===e)return!1;if(e.protocol!==Ot.WS&&e.protocol!==Ot.WSS&&e.protocol!==Ot.RTC){a.e(ConnectionPool,"Cannot connect to ".concat(e," - unsupported protocol"));return!1}if(this._addresses.isBanned(e)){a.e(ConnectionPool,"Connecting to banned address ".concat(e));return!1}if(this.getConnectionByPeerAddress(e)){a.e(ConnectionPool,"Duplicate connection to ".concat(e));return!1}if(e.netAddress&&e.netAddress.reliable){if(this.getConnectionsByNetAddress(e.netAddress).length>=ur.PEER_COUNT_PER_IP_MAX){a.e(ConnectionPool,"connection limit per ip (".concat(ur.PEER_COUNT_PER_IP_MAX,") reached"));return!1}if(this.getOutboundConnectionsBySubnet(e.netAddress).length>=ur.OUTBOUND_PEER_COUNT_PER_SUBNET_MAX){a.e(ConnectionPool,"connection limit per ip (".concat(ur.OUTBOUND_PEER_COUNT_PER_SUBNET_MAX,") reached"));return!1}}return!0}},{key:"connectOutbound",value:function connectOutbound(e){if(!this._checkOutboundConnectionRequest(e))return!1;var t=Yn.getOutbound(e);this._add(t);var n=!1;if(e.protocol===Ot.WSS)n=this._wssConnector.connect(e);else if(e.protocol===Ot.WS)n=this._wsConnector.connect(e);else{var r=this._addresses.getChannelByPeerId(e.peerId);n=this._rtcConnector.connect(e,r)}if(!n){this._remove(t);a.d(ur,function(){return"Outbound attempt not connecting: ".concat(e)});return!1}this._connectingCount++;return!0}},{key:"_checkConnection",value:function _checkConnection(e){var t=e.networkConnection;if(t.inbound&&!this._allowInboundConnections&&t.protocol!==Ot.RTC){t.close(Wn.INBOUND_CONNECTIONS_BLOCKED,"inbound connections are blocked temporarily");return!1}if(t.netAddress&&!t.netAddress.isPseudo()&&t.netAddress.reliable){if(this._isIpBanned(t.netAddress)){t.close(Wn.IP_BANNED,"connection with banned IP ".concat(t.netAddress));return!1}if(!t.netAddress.isPrivate()&&this.getConnectionsByNetAddress(t.netAddress).length>=ur.PEER_COUNT_PER_IP_MAX){t.close(Wn.CONNECTION_LIMIT_PER_IP,"connection limit per IP (".concat(ur.PEER_COUNT_PER_IP_MAX,") reached"));return!1}if(!t.netAddress.isPrivate()&&this.getConnectionsBySubnet(t.netAddress).length>=ur.INBOUND_PEER_COUNT_PER_SUBNET_MAX){t.close(Wn.CONNECTION_LIMIT_PER_IP,"connection limit per subnet (".concat(ur.INBOUND_PEER_COUNT_PER_SUBNET_MAX,") reached"));return!1}}if(this.peerCount>=ur.PEER_COUNT_MAX&&!t.outbound&&(!t.inbound||!this._allowInboundExchange)){t.close(Wn.MAX_PEER_COUNT_REACHED,"max peer count reached (".concat(ur.PEER_COUNT_MAX,")"));return!1}return!0}},{key:"_onConnection",value:function _onConnection(e){var t,n=this;if(e.outbound){if(!(t=this.getConnectionByPeerAddress(e.peerAddress))){e.close(Wn.INVALID_CONNECTION_STATE,"No PeerConnection present for outgoing connection (".concat(e.peerAddress,")"));return}if(t.state!==Xn.CONNECTING){e.close(Wn.INVALID_CONNECTION_STATE,"PeerConnection state not CONNECTING, but ".concat(t.state," (").concat(e.peerAddress,")"));return}this._connectingCount--;R.that(this._connectingCount>=0,"connectingCount < 0")}else{t=Yn.getInbound(e);this._inboundCount++}t.networkConnection=e;e.on("close",function(e,r){return n._onClose(t,e,r)});if(this._checkConnection(t)){e.netAddress&&!e.netAddress.isPseudo()&&this._addNetAddress(t,e.netAddress);var r=e.inbound?"inbound":"outbound";a.d(ConnectionPool,function(){return"Connection established (".concat(r,") #").concat(e.id," ").concat(e.netAddress||e.peerAddress||"<pending>")});this.fire("connection",e);var i=new Vn(e);t.peerChannel=i;var s=new Qn(this._blockchain,this._addresses,this._networkConfig,i);s.on("version",function(e){return n._checkHandshake(t,e)});s.on("handshake",function(e){return n._onHandshake(t,e)});t.networkAgent=s;s.handshake()}}},{key:"_checkHandshake",value:function _checkHandshake(e,t){if(this._addresses.isBanned(t.peerAddress)){e.peerChannel.close(Wn.PEER_BANNED,"connection with banned address ".concat(t.peerAddress," (post version)"));return!1}var n=this.getConnectionByPeerAddress(t.peerAddress);if(n&&n.id!==e.id&&n.state===Xn.ESTABLISHED){e.peerChannel.close(Wn.DUPLICATE_CONNECTION,"duplicate connection (post version)");return!1}if(t.peerAddress.protocol===Ot.DUMB&&this.peerCountDumb>=ur.PEER_COUNT_DUMB_MAX){e.peerChannel.close(Wn.CONNECTION_LIMIT_DUMB,"connection limit for dumb peers (".concat(ur.PEER_COUNT_DUMB_MAX,") reached"));return!1}e.negotiating();return!0}},{key:"_onHandshake",value:function _onHandshake(e,t){var n=this;if(e.networkConnection.inbound){if(this.peerCount>=ur.PEER_COUNT_MAX&&!this._allowInboundExchange){e.peerChannel.close(Wn.MAX_PEER_COUNT_REACHED,"max peer count reached (".concat(ur.PEER_COUNT_MAX,")"));return}var r=this.getConnectionByPeerAddress(t.peerAddress);if(r&&r.id!==e.id)switch(r.state){case Xn.CONNECTING:R.that(t.peerAddress.protocol===Ot.WSS||t.peerAddress.protocol===Ot.WS,"Duplicate connection to non-WS node");a.d(ConnectionPool,function(){return"Aborting connection attempt to ".concat(t.peerAddress,", simultaneous inbound connection succeeded")});t.peerAddress.protocol===Ot.WSS?this._wssConnector.abort(t.peerAddress):this._wsConnector.abort(t.peerAddress);R.that(!this.getConnectionByPeerAddress(t.peerAddress),"PeerConnection not removed");break;case Xn.ESTABLISHED:e.peerChannel.close(Wn.DUPLICATE_CONNECTION,"duplicate connection (post handshake)");return;case Xn.NEGOTIATING:if(!(this._networkConfig.peerAddress.peerId.compare(t.peerAddress.peerId)<0)){e.peerChannel.close(Wn.SIMULTANEOUS_CONNECTION,"simultaneous connection (post handshake) - higher peerId");return}r.peerChannel.close(Wn.SIMULTANEOUS_CONNECTION,"simultaneous connection (post handshake) - lower peerId");R.that(!this.getConnectionByPeerAddress(t.peerAddress),"PeerConnection not removed");break;default:r.peerChannel.close(Wn.SIMULTANEOUS_CONNECTION,"simultaneous connection (post handshake) - state ".concat(r.state));R.that(!this.getConnectionByPeerAddress(t.peerAddress),"PeerConnection not removed")}R.that(!this.getConnectionByPeerAddress(t.peerAddress),"PeerConnection ".concat(t.peerAddress," already exists"));e.peerAddress=t.peerAddress;this._add(e);this._inboundCount--;R.that(this._inboundCount>=0,"inboundCount < 0")}this.peerCount>=ur.PEER_COUNT_MAX&&this.fire("recycling-request");e.peer=t;t.netAddress&&!t.netAddress.isPseudo()&&this.getConnectionsByNetAddress(t.netAddress).indexOf(e)<0&&this._addNetAddress(e,t.netAddress);this._updateConnectedPeerCount(e,1);ur.SIGNALING_ENABLED&&e.peerChannel.on("signal",function(t){return n._signalProcessor.onSignal(e.peerChannel,t)});this._addresses.established(t.channel,t.peerAddress);a.d(ConnectionPool,function(){return"[PEER-JOINED] ".concat(t.peerAddress," ").concat(t.netAddress," (version=").concat(t.version,", services=").concat(t.peerAddress.services,", userAgent=").concat(t.userAgent||"<unknown>",", headHash=").concat(t.headHash.toBase64(),")")});this.fire("peer-joined",t);this.fire("peers-changed")}},{key:"_onClose",value:function _onClose(e,t,n){this._bytesSent+=e.networkConnection.bytesSent;this._bytesReceived+=e.networkConnection.bytesReceived;e.peerAddress&&this._addresses.close(e.peerChannel,e.peerAddress,t);this._remove(e);if(e.state===Xn.ESTABLISHED){Wn.isBanningType(t)&&e.peer.netAddress&&this._banIp(e.peer.netAddress);this._updateConnectedPeerCount(e,-1);var r=((e.networkConnection.bytesSent+e.networkConnection.bytesReceived)/1e3).toFixed(2);a.d(ConnectionPool,function(){return"[PEER-LEFT] ".concat(e.peerAddress," ").concat(e.peer.netAddress," ")+"(transferred=".concat(r," kB, closeType=").concat(t," ").concat(n,")")});this.fire("peer-left",e.peer);this.fire("peers-changed")}else if(e.networkConnection.inbound){this._inboundCount--;a.d(ConnectionPool,function(){return"Inbound connection #".concat(e.networkConnection.id," closed pre-handshake: ").concat(n," (").concat(t,")")})}else{a.d(ConnectionPool,function(){return"Connection #".concat(e.networkConnection.id," to ").concat(e.peerAddress," closed pre-handshake: ").concat(n," (").concat(t,")")});this.fire("connect-error",e.peerAddress,"".concat(n," (").concat(t,")"))}this.fire("close",e,t,n);e.close()}},{key:"_banIp",value:function _banIp(e){if(!e.isPseudo()&&e.reliable){a.w(ConnectionPool,"Banning IP ".concat(e));e.isIPv4()?this._bannedIPv4IPs.put(e,(0,_now["default"])()+ConnectionPool.DEFAULT_BAN_TIME):e.isIPv6()&&this._bannedIPv6IPs.put(e.ip.subarray(0,8),(0,_now["default"])()+ConnectionPool.DEFAULT_BAN_TIME)}}},{key:"_isIpBanned",value:function _isIpBanned(e){if(e.isPseudo())return!1;if(e.isIPv4())return this._bannedIPv4IPs.contains(e);if(e.isIPv6()){var t=e.ip.subarray(0,8);return this._bannedIPv6IPs.contains(t)}return!1}},{key:"_checkUnbanIps",value:function _checkUnbanIps(){var e=(0,_now["default"])(),t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._bannedIPv4IPs.keys());!(t=(a=i.next()).done);t=!0){var s=a.value;this._bannedIPv4IPs.get(s)<e&&this._bannedIPv4IPs.remove(s)}}catch(d){n=!0;r=d}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}var o=!0,u=!1,c=undefined;try{for(var l,h=(0,_getIterator2["default"])(this._bannedIPv6IPs.keys());!(o=(l=h.next()).done);o=!0){var f=l.value;this._bannedIPv6IPs.get(f)<e&&this._bannedIPv6IPs.remove(f)}}catch(d){u=!0;c=d}finally{try{o||null==h["return"]||h["return"]()}finally{if(u)throw c}}}},{key:"_onConnectError",value:function _onConnectError(e,t){a.d(ConnectionPool,function(){return"Connection to ".concat(e," failed")+("string"==typeof t?" - ".concat(t):"")});var n=this.getConnectionByPeerAddress(e);R.that(!!n,"PeerAddress not stored ".concat(e));if(n.state===Xn.CONNECTING){this._remove(n);this._connectingCount--;R.that(this._connectingCount>=0,"connectingCount < 0");this._addresses.close(null,e,Wn.CONNECTION_FAILED);this.fire("connect-error",e,t)}else a.e(ConnectionPool,"PeerConnection state not CONNECTING, but ".concat(n.state," (").concat(e,")"))}},{key:"_updateConnectedPeerCount",value:function _updateConnectedPeerCount(e,t){var n=e.peerAddress;switch(n.protocol){case Ot.WS:this._peerCountWs+=t;R.that(this._peerCountWs>=0,"peerCountWs < 0");break;case Ot.WSS:this._peerCountWss+=t;R.that(this._peerCountWss>=0,"peerCountWs < 0");break;case Ot.RTC:this._peerCountRtc+=t;R.that(this._peerCountRtc>=0,"peerCountRtc < 0");break;case Ot.DUMB:this._peerCountDumb+=t;R.that(this._peerCountDumb>=0,"peerCountDumb < 0");break;default:a.w(Kn,"Unknown protocol ".concat(n.protocol))}if(_.isFullNode(n.services)){this._peerCountFull+=t;R.that(this._peerCountFull>=0,"peerCountFull < 0")}else if(_.isLightNode(n.services)){this._peerCountLight+=t;R.that(this._peerCountLight>=0,"peerCountLight < 0")}else{this._peerCountNano+=t;R.that(this._peerCountNano>=0,"peerCountNano < 0")}if(e.networkConnection.outbound){this._peerCountOutbound+=t;!_.isFullNode(n.services)||n.protocol!==Ot.WSS&&n.protocol!==Ot.WS||(this._peerCountFullWsOutbound+=t)}}},{key:"disconnect",value:function disconnect(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this.valueIterator());!(t=(a=i.next()).done);t=!0){var s=a.value;s.peerChannel&&s.peerChannel.close(Wn.MANUAL_NETWORK_DISCONNECT,e||"manual network disconnect")}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"disconnectWebSocket",value:function disconnectWebSocket(){var e=!0,t=!1,n=undefined;try{for(var r,a=(0,_getIterator2["default"])(this.valueIterator());!(e=(r=a.next()).done);e=!0){var i=r.value;i.peerChannel&&i.peerAddress&&(i.peerAddress.protocol===Ot.WSS||i.peerAddress.protocol===Ot.WS)&&i.peerChannel.close(Wn.MANUAL_WEBSOCKET_DISCONNECT,"manual websocket disconnect")}}catch(s){t=!0;n=s}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw n}}}},{key:"peerCountWs",get:function get(){return this._peerCountWs}},{key:"peerCountWss",get:function get(){return this._peerCountWss}},{key:"peerCountRtc",get:function get(){return this._peerCountRtc}},{key:"peerCountDumb",get:function get(){return this._peerCountDumb}},{key:"peerCount",get:function get(){return this._peerCountWs+this._peerCountWss+this._peerCountRtc+this._peerCountDumb}},{key:"peerCountFull",get:function get(){return this._peerCountFull}},{key:"peerCountLight",get:function get(){return this._peerCountLight}},{key:"peerCountNano",get:function get(){return this._peerCountNano}},{key:"peerCountOutbound",get:function get(){return this._peerCountOutbound}},{key:"peerCountFullWsOutbound",get:function get(){return this._peerCountFullWsOutbound}},{key:"connectingCount",get:function get(){return this._connectingCount}},{key:"count",get:function get(){return this._connectionsByPeerAddress.length+this._inboundCount}},{key:"bytesSent",get:function get(){var e=this._bytesSent,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this.valueIterator());!(t=(a=i.next()).done);t=!0){var s=a.value;s.networkConnection&&(e+=s.networkConnection.bytesSent)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"bytesReceived",get:function get(){var e=this._bytesReceived,t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this.valueIterator());!(t=(a=i.next()).done);t=!0){var s=a.value;s.networkConnection&&(e+=s.networkConnection.bytesReceived)}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"allowInboundExchange",set:function set(e){this._allowInboundExchange=e}},{key:"allowInboundConnections",get:function get(){return this._allowInboundConnections},set:function set(e){this._allowInboundConnections=e}}]);return ConnectionPool}(i);tr.DEFAULT_BAN_TIME=6e5;tr.UNBAN_IPS_INTERVAL=6e4;n.register(tr);var nr=function(){function PeerScorer(e,t,n){(0,_classCallCheck2["default"])(this,PeerScorer);this._networkConfig=e;this._addresses=t;this._connections=n;this._connectionScores=null}(0,_createClass2["default"])(PeerScorer,[{key:"pickAddress",value:function pickAddress(){var e,t,n=this;switch(this._networkConfig.protocolMask){case Ot.WSS:e=this._addresses.wssIterator();t=this._addresses.knownWssAddressesCount;break;case Ot.WS:e=this._addresses.wsIterator();t=this._addresses.knownWsAddressesCount;break;case Ot.WS|Ot.WSS:e=k.alternate(this._addresses.wsIterator(),this._addresses.wssIterator());t=this._addresses.knownWsAddressesCount+this._addresses.knownWssAddressesCount;break;case Ot.RTC:e=this._addresses.rtcIterator();t=this._addresses.knownRtcAddressesCount;break;case Ot.RTC|Ot.WS:e=k.alternate(this._addresses.rtcIterator(),this._addresses.wsIterator());t=this._addresses.knownRtcAddressesCount+this._addresses.knownWsAddressesCount;break;case Ot.RTC|Ot.WSS:e=k.alternate(this._addresses.rtcIterator(),this._addresses.wssIterator());t=this._addresses.knownRtcAddressesCount+this._addresses.knownWssAddressesCount;break;default:e=this._addresses.iterator();t=this._addresses.knownAddressesCount}var r=function findCandidates(e,t,r){var a=arguments.length>3&&arguments[3]!==undefined&&arguments[3],i=0,s=t;t>r&&(s=((i=Math.floor(Math.random()*t))+r)%t);var o=i>s,u=[],c=-1,l=!0,h=!1,f=undefined;try{for(var d,A=(0,_getIterator2["default"])(e);!(l=(d=A.next()).done);l=!0){var _=d.value;c++;if(o||!(c<i)){if(!o&&c>=s)break;if(!(o&&c>=s&&c<i)){var p=n._scoreAddress(_,a);if(p>=0){u.push({score:p,addressState:_});if(u.length>=r)break}}}}}catch(g){h=!0;f=g}finally{try{l||null==A["return"]||A["return"]()}finally{if(h)throw f}}return u},a=r(e,t,1e3);if(0===a.length&&this.needsGoodPeers()){switch(this._networkConfig.protocolMask){case Ot.WSS:e=this._addresses.wssIterator();break;case Ot.WS:e=this._addresses.wsIterator();break;case Ot.WS|Ot.WSS:e=k.alternate(this._addresses.wsIterator(),this._addresses.wssIterator());break;case Ot.RTC:e=this._addresses.rtcIterator();break;case Ot.RTC|Ot.WS:e=k.alternate(this._addresses.rtcIterator(),this._addresses.wsIterator());break;case Ot.RTC|Ot.WSS:e=k.alternate(this._addresses.rtcIterator(),this._addresses.wssIterator());break;default:e=this._addresses.iterator()}a=r(e,t,1e3,!0)}if(0===a.length)return null;var i=a.sort(function(e,t){return t.score-e.score}).slice(0,PeerScorer.PICK_SELECTION_SIZE);return m.randomElement(i).addressState.peerAddress}},{key:"_scoreAddress",value:function _scoreAddress(e){var t=arguments.length>1&&arguments[1]!==undefined&&arguments[1],n=e.peerAddress;if(!this._networkConfig.canConnect(n.protocol))return-1;if(!_.providesServices(n.services,this._networkConfig.services.accepted))return-1;if(n.exceedsAge())return-1;if(this._connections.getConnectionByPeerAddress(n))return-1;if(this.needsGoodPeers()&&!this.isGoodPeer(n)&&!t)return-1;switch(e.state){case Dn.BANNED:return-1;case Dn.NEW:case Dn.TRIED:return 1;case Dn.FAILED:return 1*(1-(e.failedAttempts+1)/e.maxFailedAttempts);default:return-1}}},{key:"isGoodPeerSet",value:function isGoodPeerSet(){return!this.needsGoodPeers()&&!this.needsMorePeers()}},{key:"needsGoodPeers",value:function needsGoodPeers(){return this._connections.peerCountFullWsOutbound<PeerScorer.PEER_COUNT_MIN_FULL_WS_OUTBOUND}},{key:"needsMorePeers",value:function needsMorePeers(){return this._connections.peerCountOutbound<PeerScorer.PEER_COUNT_MIN_OUTBOUND}},{key:"isGoodPeer",value:function isGoodPeer(e){return _.isFullNode(e.services)&&(e.protocol===Ot.WS||e.protocol===Ot.WSS)}},{key:"scoreConnections",value:function scoreConnections(){var e=[],t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._connections.valueIterator());!(t=(a=i.next()).done);t=!0){var s=a.value;if(s.state===Xn.ESTABLISHED){if(s.ageEstablished>PeerScorer._getMinAge(s.peerAddress)){s.score=this._scoreConnection(s);e.push(s)}s.statistics.reset()}}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}this._connectionScores=e.sort(function(e,t){return t.score-e.score})}},{key:"recycleConnections",value:function recycleConnections(e,t,n){if(this._connectionScores)for(;e>0&&this._connectionScores.length>0;){var r=this._connectionScores.pop();if(r.state===Xn.ESTABLISHED){r.peerChannel.close(t,"".concat(n));e--}}}},{key:"_scoreConnection",value:function _scoreConnection(e){var t,n=this._scoreConnectionAge(e),r=e.networkConnection.inbound?0:1,a=e.peerAddress,i=_.isFullNode(a.services)?1:_.isLightNode(a.services)?.5:0;switch(a.protocol){case Ot.WS:case Ot.WSS:t=.6;break;case Ot.RTC:t=.3;break;case Ot.DUMB:default:t=0}if(a.protocol===Ot.WS||a.protocol===Ot.WSS){((this._connections.peerCountWs+this._connections.peerCountWss)/this._connections.peerCount<PeerScorer.BEST_PROTOCOL_WS_DISTRIBUTION||this._connections.peerCountFullWsOutbound<=PeerScorer.PEER_COUNT_MIN_FULL_WS_OUTBOUND)&&(t=1)}var s=e.statistics.latencyMedian,o=0;s>0&&s<Qn.PING_TIMEOUT&&(o=1-s/Qn.PING_TIMEOUT);return.15*n+.25*r+.2*i+.2*t+.2*o}},{key:"_scoreConnectionAge",value:function _scoreConnectionAge(e){var t=function score(e,t,n){return Math.max(Math.min(1-(e-t)/n,1),0)},n=e.ageEstablished,r=e.peerAddress.services;return _.isFullNode(r)?n/(2*PeerScorer.BEST_AGE_FULL)+.5:_.isLightNode(r)?t(n,PeerScorer.BEST_AGE_LIGHT,PeerScorer.MAX_AGE_LIGHT):t(n,PeerScorer.BEST_AGE_NANO,PeerScorer.MAX_AGE_NANO)}},{key:"lowestConnectionScore",get:function get(){if(!this._connectionScores)return null;for(;this._connectionScores.length>0&&this._connectionScores[this._connectionScores.length-1].state!==Xn.ESTABLISHED;)this._connectionScores.pop();return this._connectionScores.length>0?this._connectionScores[this._connectionScores.length-1].score:null}},{key:"connectionScores",get:function get(){return this._connectionScores}}],[{key:"_getMinAge",value:function _getMinAge(e){return _.isFullNode(e.services)?PeerScorer.MIN_AGE_FULL:_.isLightNode(e.services)?PeerScorer.MIN_AGE_LIGHT:PeerScorer.MIN_AGE_NANO}}]);return PeerScorer}();nr.PEER_COUNT_MIN_FULL_WS_OUTBOUND=f.isNodeJs()?12:3;nr.PEER_COUNT_MIN_OUTBOUND=f.isNodeJs()?12:6;nr.PICK_SELECTION_SIZE=100;nr.MIN_AGE_FULL=3e5;nr.BEST_AGE_FULL=864e5;nr.MIN_AGE_LIGHT=12e4;nr.BEST_AGE_LIGHT=9e5;nr.MAX_AGE_LIGHT=216e5;nr.MIN_AGE_NANO=6e4;nr.BEST_AGE_NANO=3e5;nr.MAX_AGE_NANO=18e5;nr.BEST_PROTOCOL_WS_DISTRIBUTION=.15;n.register(nr);var rr=function(){(0,_createClass2["default"])(NetworkConfig,null,[{key:"getDefault",value:function getDefault(){return f.supportsWebRTC()?new sr:new or}}]);function NetworkConfig(e){(0,_classCallCheck2["default"])(this,NetworkConfig);this._protocolMask=e;this._keyPair=null;this._peerId=null;this._services=null;this._appAgent=null}(0,_createClass2["default"])(NetworkConfig,[{key:"initPersistent",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee380(){var e;return _regenerator["default"].wrap(function _callee380$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return lr.getPersistent();case 2:e=t.sent;t.next=5;return this._init(e);case 5:case"end":return t.stop()}},_callee380,this)}));return function initPersistent(){return e.apply(this,arguments)}}()},{key:"initVolatile",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee381(){var e;return _regenerator["default"].wrap(function _callee381$(t){for(;;)switch(t.prev=t.next){case 0:e=lr.createVolatile();t.next=3;return this._init(e);case 3:case"end":return t.stop()}},_callee381,this)}));return function initVolatile(){return e.apply(this,arguments)}}()},{key:"_init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee382(e){var t;return _regenerator["default"].wrap(function _callee382$(n){for(;;)switch(n.prev=n.next){case 0:if(!this._keyPair){n.next=2;break}return n.abrupt("return");case 2:n.next=4;return e.get("keys");case 4:if(t=n.sent){n.next=9;break}t=ce.generate();n.next=9;return e.put("keys",t);case 9:this._keyPair=t;this._peerId=t.publicKey.toPeerId();case 11:case"end":return n.stop()}},_callee382,this)}));return function _init(t){return e.apply(this,arguments)}}()},{key:"canConnect",value:function canConnect(e){return 0!=(e&this._protocolMask)}},{key:"protocol",get:function get(){throw new Error("Unimplemented")}},{key:"protocolMask",get:function get(){return this._protocolMask}},{key:"keyPair",get:function get(){return this._keyPair}},{key:"publicKey",get:function get(){return this._keyPair.publicKey}},{key:"peerId",get:function get(){return this._peerId}},{key:"services",get:function get(){return this._services},set:function set(e){this._services=e}},{key:"peerAddress",get:function get(){throw new Error("Not implemented")}},{key:"appAgent",get:function get(){return this._appAgent},set:function set(e){this._appAgent=e}}]);return NetworkConfig}();n.register(rr);var ar=function(e){(0,_inherits2["default"])(WsNetworkConfig,e);var t=_createSuper(WsNetworkConfig);function WsNetworkConfig(e,n,r){var a;(0,_classCallCheck2["default"])(this,WsNetworkConfig);(a=t.call(this,Ot.WS|Ot.WSS))._host=e;a._port=n;a._reverseProxy=r;return a}(0,_createClass2["default"])(WsNetworkConfig,[{key:"protocol",get:function get(){return Ot.WS}},{key:"port",get:function get(){return this._port}},{key:"reverseProxy",get:function get(){return this._reverseProxy}},{key:"peerAddress",get:function get(){if(!this._services||!this._keyPair)throw new Error("PeerAddress is not configured.");var e=this._reverseProxy.enabled?this._reverseProxy.port:this._port,t=new Rn(this._services.provided,(0,_now["default"])(),In.UNSPECIFIED,this.publicKey,0,this._host,e);if(!t.globallyReachable())throw new Error("PeerAddress not globally reachable.");t.signature=de.create(this._keyPair.privateKey,this.publicKey,t.serializeContent());return t}},{key:"secure",get:function get(){return!1}}]);return WsNetworkConfig}(rr);n.register(ar);var ir=function(e){(0,_inherits2["default"])(WssNetworkConfig,e);var t=_createSuper(WssNetworkConfig);function WssNetworkConfig(e,n,r,a,i){var s;(0,_classCallCheck2["default"])(this,WssNetworkConfig);(s=t.call(this,e,n,i))._key=r;s._cert=a;s._ssl={key:s._key,cert:s._cert};return s}(0,_createClass2["default"])(WssNetworkConfig,[{key:"protocol",get:function get(){return Ot.WSS}},{key:"ssl",get:function get(){return this._ssl}},{key:"peerAddress",get:function get(){if(!this._services||!this._keyPair)throw new Error("PeerAddress is not configured.");var e=this._reverseProxy.enabled?this._reverseProxy.port:this._port,t=new On(this._services.provided,(0,_now["default"])(),In.UNSPECIFIED,this.publicKey,0,this._host,e);if(!t.globallyReachable())throw new Error("PeerAddress not globally reachable.");t.signature=de.create(this._keyPair.privateKey,this.publicKey,t.serializeContent());return t}},{key:"secure",get:function get(){return!0}}]);return WssNetworkConfig}(ar);n.register(ir);var sr=function(e){(0,_inherits2["default"])(RtcNetworkConfig,e);var t=_createSuper(RtcNetworkConfig);function RtcNetworkConfig(){var e;(0,_classCallCheck2["default"])(this,RtcNetworkConfig);(e=t.call(this,(f.supportsWS()?Ot.WS|Ot.WSS:Ot.WSS)|Ot.RTC))._rtcConfig={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.nimiq-network.com:19302"}]};return e}(0,_createClass2["default"])(RtcNetworkConfig,[{key:"protocol",get:function get(){return Ot.RTC}},{key:"rtcConfig",get:function get(){return this._rtcConfig}},{key:"peerAddress",get:function get(){if(!this._services||!this._keyPair)throw new Error("PeerAddress is not configured.");var e=new Mn(this._services.provided,(0,_now["default"])(),In.UNSPECIFIED,this.publicKey,0);e.signature=de.create(this._keyPair.privateKey,this.publicKey,e.serializeContent());return e}}]);return RtcNetworkConfig}(rr);n.register(sr);var or=function(e){(0,_inherits2["default"])(DumbNetworkConfig,e);var t=_createSuper(DumbNetworkConfig);function DumbNetworkConfig(){(0,_classCallCheck2["default"])(this,DumbNetworkConfig);return t.call(this,f.supportsWS()?Ot.WS|Ot.WSS:Ot.WSS)}(0,_createClass2["default"])(DumbNetworkConfig,[{key:"protocol",get:function get(){return Ot.DUMB}},{key:"peerAddress",get:function get(){if(!this._services||!this._keyPair)throw new Error("PeerAddress is not configured.");var e=new Ln(this._services.provided,(0,_now["default"])(),In.UNSPECIFIED,this.publicKey,0);e.signature=de.create(this._keyPair.privateKey,this.publicKey,e.serializeContent());return e}}]);return DumbNetworkConfig}(rr);n.register(or);var ur=function(e){(0,_inherits2["default"])(Network,e);var t=_createSuper(Network);function Network(e,n,r){var a;(0,_classCallCheck2["default"])(this,Network);(a=t.call(this))._blockchain=e;a._networkConfig=n;a._time=r;a._autoConnect=!1;a._backoff=Network.CONNECT_BACKOFF_INITIAL;a._backedOff=!1;a._addresses=new Kn(a._networkConfig);a._addresses.on("seeded",function(){return a._checkPeerCount()});a._addresses.on("added",function(){return setTimeout(a._checkPeerCount.bind((0,_assertThisInitialized2["default"])(a)),Network.CONNECT_THROTTLE)});a._connections=new tr(a._addresses,n,e);a._connections.on("peer-joined",function(e){return a._onPeerJoined(e)});a._connections.on("peer-left",function(e){return a._onPeerLeft(e)});a._connections.on("peers-changed",function(){return a._onPeersChanged()});a._connections.on("recycling-request",function(){return a._onRecyclingRequest()});a._connections.on("connect-error",function(){return setTimeout(a._checkPeerCount.bind((0,_assertThisInitialized2["default"])(a)),Network.CONNECT_THROTTLE)});a._scorer=new nr(a._networkConfig,a._addresses,a._connections);a._houseKeepingIntervalId=null;a._timers=new p;return a}(0,_createClass2["default"])(Network,[{key:"connect",value:function connect(){var e=this;this._autoConnect=!0;this._houseKeepingIntervalId=setInterval(function(){return e._housekeeping()},Network.HOUSEKEEPING_INTERVAL);this._checkPeerCount()}},{key:"disconnect",value:function disconnect(e){this._autoConnect=!1;clearInterval(this._houseKeepingIntervalId);this._connections.disconnect(e);this._connections.allowInboundConnections=!1}},{key:"disconnectWebSocket",value:function disconnectWebSocket(){this._autoConnect=!1;this._connections.disconnectWebSocket()}},{key:"_onPeerJoined",value:function _onPeerJoined(e){this._updateTimeOffset();this.fire("peer-joined",e)}},{key:"_onPeerLeft",value:function _onPeerLeft(e){this._updateTimeOffset();this.fire("peer-left",e)}},{key:"_onPeersChanged",value:function _onPeersChanged(){setTimeout(this._checkPeerCount.bind(this),Network.CONNECT_THROTTLE);this.fire("peers-changed")}},{key:"_onRecyclingRequest",value:function _onRecyclingRequest(){this._scorer.recycleConnections(1,Wn.PEER_CONNECTION_RECYCLED_INBOUND_EXCHANGE,"Peer connection recycled inbound exchange");this._connections.allowInboundExchange=null!==this._scorer.lowestConnectionScore&&this._scorer.lowestConnectionScore<Network.SCORE_INBOUND_EXCHANGE}},{key:"_checkPeerCount",value:function _checkPeerCount(){var e=this;if(this._autoConnect&&this._addresses.seeded&&!this._scorer.isGoodPeerSet()&&this._connections.connectingCount<Network.CONNECTING_COUNT_MAX){var t=this._scorer.pickAddress(),n=this._scorer.needsGoodPeers()&&!this._scorer.needsMorePeers();if(!t||n&&!this._scorer.isGoodPeer(t)){if(!this._backedOff){this._backedOff=!0;var r=this._backoff;this._backoff=Math.min(Network.CONNECT_BACKOFF_MAX,2*r);setTimeout(function(){e._backedOff=!1;e._checkPeerCount()},r);if(0===this._connections.count){this.fire("disconnected");this._connections.allowInboundConnections=!0}}return}if(!this._connections.connectOutbound(t)){this._addresses.close(null,t,Wn.CONNECTION_FAILED);setTimeout(function(){return e._checkPeerCount()},Network.CONNECT_THROTTLE)}}this._backoff=Network.CONNECT_BACKOFF_INITIAL}},{key:"_updateTimeOffset",value:function _updateTimeOffset(){var e=this._connections.values(),t=[0];e.forEach(function(e){e.state===Xn.ESTABLISHED&&t.push(e.networkAgent.peer.timeOffset)});var n,r=t.length;t.sort(function(e,t){return e-t});n=r%2==0?Math.round((t[r/2-1]+t[r/2])/2):t[(r-1)/2];this._time.offset=Math.max(Math.min(n,Network.TIME_OFFSET_MAX),-Network.TIME_OFFSET_MAX)}},{key:"_housekeeping",value:function _housekeeping(){this._scorer.scoreConnections();if(this.peerCount>Network.PEER_COUNT_RECYCLING_ACTIVE){var e=(this.peerCount-Network.PEER_COUNT_RECYCLING_ACTIVE)*(Network.RECYCLING_PERCENTAGE_MAX-Network.RECYCLING_PERCENTAGE_MIN)/(Network.PEER_COUNT_MAX-Network.PEER_COUNT_RECYCLING_ACTIVE)+Network.RECYCLING_PERCENTAGE_MIN,t=Math.ceil(this.peerCount*e);this._scorer.recycleConnections(t,Wn.PEER_CONNECTION_RECYCLED,"Peer connection recycled")}this._connections.allowInboundExchange=null!==this._scorer.lowestConnectionScore&&this._scorer.lowestConnectionScore<Network.SCORE_INBOUND_EXCHANGE;this._refreshAddresses()}},{key:"_refreshAddresses",value:function _refreshAddresses(){var e=this;if(this._scorer.connectionScores&&this._scorer.connectionScores.length>0)for(var t=Math.min(2*(this._connections.peerCountWs+this._connections.peerCountWss),Network.ADDRESS_REQUEST_CUTOFF),n=Math.min(this._scorer.connectionScores.length,t),r=function _loop17(t){var r=Math.floor(Math.random()*n),i=e._scorer.connectionScores[r];a.v(Network,function(){return"Requesting addresses from ".concat(i.peerAddress," (score idx ").concat(r,")")});i.networkAgent.requestAddresses()},i=0;i<Math.min(Network.ADDRESS_REQUEST_PEERS,this._scorer.connectionScores.length);i++)r();else{var s,o=Math.floor(Math.random()*Math.min(this._connections.count,10)),u=0,c=!0,l=!1,h=undefined;try{for(var f,d=(0,_getIterator2["default"])(this._connections.valueIterator());!(c=(f=d.next()).done);c=!0){var A=f.value;A.state===Xn.ESTABLISHED&&(s=A);if(u>=o&&s)break;u++}}catch(_){l=!0;h=_}finally{try{c||null==d["return"]||d["return"]()}finally{if(l)throw h}}if(s){a.v(Network,function(){return"Requesting addresses from ".concat(s.peerAddress," (rand idx ").concat(o,")")});s.networkAgent.requestAddresses()}}}},{key:"time",get:function get(){return this._time}},{key:"peerCount",get:function get(){return this._connections.peerCount}},{key:"peerCountWebSocket",get:function get(){return this._connections.peerCountWs}},{key:"peerCountWebSocketSecure",get:function get(){return this._connections.peerCountWss}},{key:"peerCountWebRtc",get:function get(){return this._connections.peerCountRtc}},{key:"peerCountDumb",get:function get(){return this._connections.peerCountDumb}},{key:"peerCountConnecting",get:function get(){return this._connections.connectingCount}},{key:"knownAddressesCount",get:function get(){return this._addresses.knownAddressesCount}},{key:"bytesSent",get:function get(){return this._connections.bytesSent}},{key:"bytesReceived",get:function get(){return this._connections.bytesReceived}},{key:"allowInboundConnections",get:function get(){return this._connections.allowInboundConnections},set:function set(e){this._connections.allowInboundConnections=e}},{key:"addresses",get:function get(){return this._addresses}},{key:"connections",get:function get(){return this._connections}},{key:"config",get:function get(){return this._networkConfig}}]);return Network}(i);ur.PEER_COUNT_MAX=f.isBrowser()?12:4e3;ur.INBOUND_PEER_COUNT_PER_SUBNET_MAX=f.isBrowser()?2:100;ur.OUTBOUND_PEER_COUNT_PER_SUBNET_MAX=2;ur.PEER_COUNT_PER_IP_MAX=f.isBrowser()?1:10;ur.PEER_COUNT_DUMB_MAX=1e3;ur.IPV4_SUBNET_MASK=24;ur.IPV6_SUBNET_MASK=96;ur.PEER_COUNT_RECYCLING_ACTIVE=f.isBrowser()?5:1e3;ur.RECYCLING_PERCENTAGE_MIN=.01;ur.RECYCLING_PERCENTAGE_MAX=.2;ur.CONNECTING_COUNT_MAX=2;ur.SIGNAL_TTL_INITIAL=3;ur.CONNECT_BACKOFF_INITIAL=2e3;ur.CONNECT_BACKOFF_MAX=6e5;ur.TIME_OFFSET_MAX=6e5;ur.HOUSEKEEPING_INTERVAL=3e5;ur.SCORE_INBOUND_EXCHANGE=.5;ur.CONNECT_THROTTLE=500;ur.ADDRESS_REQUEST_CUTOFF=250;ur.ADDRESS_REQUEST_PEERS=2;ur.SIGNALING_ENABLED=1;n.register(ur);var cr=function(){function NetUtils(){(0,_classCallCheck2["default"])(this,NetUtils)}(0,_createClass2["default"])(NetUtils,null,[{key:"isPrivateIP",value:function isPrivateIP(e){e instanceof Uint8Array||(e=NetUtils.ipToBytes(e));if(NetUtils.isLocalIP(e))return!0;if(NetUtils.isIPv4Address(e)){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(NetUtils.IPv4_PRIVATE_NETWORK);!(t=(a=i.next()).done);t=!0){var s=a.value;if(NetUtils.isIPv4inSubnet(e,s))return!0}}catch(o){n=!0;r=o}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return!1}if(NetUtils.isIPv6Address(e))return 252==(254&e[0])||254===e[0]&&128==(192&e[1]);throw new Error("Malformed IP address ".concat(e))}},{key:"isLocalIP",value:function isLocalIP(e){e instanceof Uint8Array||(e=NetUtils.ipToBytes(e));if(e.length===NetUtils.IPv4_LENGTH)return 127===e[0]&&0===e[1]&&0===e[2]&&1===e[3];if(e.length===NetUtils.IPv6_LENGTH){for(var t=0;t<NetUtils.IPv6_LENGTH-1;t++)if(0!==e[t])return!1;return 1===e[NetUtils.IPv6_LENGTH-1]}return!1}},{key:"isIPv4inSubnet",value:function isIPv4inSubnet(e,t){e instanceof Uint8Array||(e=NetUtils.ipToBytes(e));var n=t.split("/"),r=(0,_slicedToArray2["default"])(n,2),a=r[0],i=r[1];i=-1<<32-(0,_parseInt2["default"])(i);return(NetUtils._IPv4toLong(e)&i)===NetUtils._IPv4toLong(a)}},{key:"isIPv4Address",value:function isIPv4Address(e){if(e instanceof Uint8Array)return e.length===NetUtils.IPv4_LENGTH;var t=e.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/);return!!t&&(0,_parseInt2["default"])(t[1])<=255&&(0,_parseInt2["default"])(t[2])<=255&&(0,_parseInt2["default"])(t[3])<=255&&(0,_parseInt2["default"])(t[4])<=255}},{key:"isIPv6Address",value:function isIPv6Address(e){if(e instanceof Uint8Array)return e.length===NetUtils.IPv6_LENGTH;var t=e.toLowerCase().split(":");if(t.length>8||t.length<3)return!1;for(var n=NetUtils.isIPv4Address(t[t.length-1]),r=!1,a=0;a<t.length;++a){if(!(/^[a-f0-9]{0,4}$/.test(t[a])||a===t.length-1&&n&&t.length<8))return!1;if(0===t[a].length&&a>0&&a<t.length-1){if(r)return!1;r=!0}}if(n)for(var i=0;i<t.length-2;++i)if(!/^0{0,4}$/.test(t[i]))return!1;return 0===t[0].length?0===t[1].length:0===t[t.length-1].length?0===t[t.length-2].length:n&&t.length<7?r:!(t.length<8)||r}},{key:"hostGloballyReachable",value:function hostGloballyReachable(e){return!NetUtils.isIPv4Address(e)&&!NetUtils.isIPv6Address(e)&&!!e.match(/.+\..+$/)}},{key:"_IPv4toLong",value:function _IPv4toLong(e){e instanceof Uint8Array||(e=NetUtils.ipToBytes(e));return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]}},{key:"_IPv4toIPv6",value:function _IPv4toIPv6(e){var t=e.split(".");t=t.map(function(e){return(0,_parseInt2["default"])(e)});for(var n=[],r=0;r<4;r++)n.push(("00"+t[r].toString(16)).slice(-2));return"".concat(n[0]).concat(n[1],":").concat(n[2]).concat(n[3])}},{key:"ipToBytes",value:function ipToBytes(e){if(NetUtils.isIPv4Address(e)){var t=e.split(".");return new Uint8Array(t.map(function(e){return(0,_parseInt2["default"])(e)}))}if(NetUtils.isIPv6Address(e)){var n=e.toLowerCase().split(":");if(NetUtils.isIPv4Address(n[n.length-1]))return NetUtils.ipToBytes(n[n.length-1]);n=(n=NetUtils._extendIPv6(n)).map(function(e){return(0,_parseInt2["default"])(e,16)});for(var r=[],a=0;a<8;a++){r.push(n[a]>>8);r.push(255&n[a])}return new Uint8Array(r)}throw new Error("Malformed IP address ".concat(e))}},{key:"bytesToIp",value:function bytesToIp(e){if(NetUtils.isIPv4Address(e))return e.join(".");if(NetUtils.isIPv6Address(e)){for(var t=(0,_from["default"])(e,function(e){return("00"+e.toString(16)).slice(-2)}),n=[],r=0;r<8;r++)n.push(t[2*r]+t[2*r+1]);return n.join(":")}throw new Error("Malformed IP address ".concat(e))}},{key:"_extendIPv6",value:function _extendIPv6(e){if(NetUtils.isIPv4Address(e[e.length-1])){var t=e[e.length-1],n=NetUtils._IPv4toIPv6(t);ip=ip.replace(t,n);e=ip.toLowerCase().split(":")}var r=e.indexOf("");if(r>=0){e[r]="0";for(var a=e.length;a<8;a++)e.splice(r,0,"0")}r=e.indexOf("");for(;r>=0;){e[r]="0";r=e.indexOf("")}return e}},{key:"ipToSubnet",value:function ipToSubnet(e,t){var n=!1;if(!(e instanceof Uint8Array)){e=NetUtils.ipToBytes(e);n=!0}for(var r=[],a=0;a<e.byteLength;a++){var i=Math.min(t,8);r.push(e[a]&256-Math.pow(2,8-i));t-=i}var s=new Uint8Array(r);return n?NetUtils.bytesToIp(s):s}}]);return NetUtils}();cr.IPv4_LENGTH=4;cr.IPv6_LENGTH=16;cr.IPv4_PRIVATE_NETWORK=["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","100.64.0.0/10","169.254.0.0/16"];n.register(cr);var lr=function(){(0,_createClass2["default"])(PeerKeyStore,null,[{key:"getPersistent",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee383(){var e;return _regenerator["default"].wrap(function _callee383$(t){for(;;)switch(t.prev=t.next){case 0:if(PeerKeyStore._instance){t.next=6;break}(e=new JDB.JungleDB("peer-key",PeerKeyStore.VERSION,{maxDbSize:PeerKeyStore.INITIAL_DB_SIZE})).createObjectStore(PeerKeyStore.KEY_DATABASE,{codec:new hr});t.next=5;return e.connect();case 5:PeerKeyStore._instance=new PeerKeyStore(e.getObjectStore(PeerKeyStore.KEY_DATABASE));case 6:return t.abrupt("return",PeerKeyStore._instance);case 7:case"end":return t.stop()}},_callee383)}));return function getPersistent(){return e.apply(this,arguments)}}()},{key:"createVolatile",value:function createVolatile(){return new PeerKeyStore(JDB.JungleDB.createVolatileObjectStore())}}]);function PeerKeyStore(e){(0,_classCallCheck2["default"])(this,PeerKeyStore);this._store=e}(0,_createClass2["default"])(PeerKeyStore,[{key:"get",value:function get(e){return this._store.get(e)}},{key:"put",value:function put(e,t){return this._store.put(e,t)}}]);return PeerKeyStore}();lr._instance=null;lr.VERSION=2;lr.KEY_DATABASE="keys";lr.INITIAL_DB_SIZE=10485760;n.register(lr);var hr=function(){function PeerKeyStoreCodec(){(0,_classCallCheck2["default"])(this,PeerKeyStoreCodec)}(0,_createClass2["default"])(PeerKeyStoreCodec,[{key:"encode",value:function encode(e){return e.serialize()}},{key:"decode",value:function decode(e,t){return ce.unserialize(new U(e))}},{key:"leveldbValueEncoding",get:function get(){return"binary"}},{key:"lmdbValueEncoding",get:function get(){return JDB.JungleDB.BINARY_ENCODING}}]);return PeerKeyStoreCodec}(),fr=function(){function Peer(e,t,n,r,a){(0,_classCallCheck2["default"])(this,Peer);this._channel=e;this._version=t;this._headHash=n;this._head=null;this._timeOffset=r;this._userAgent=a;this._setNetAddress()}(0,_createClass2["default"])(Peer,[{key:"_setNetAddress",value:function _setNetAddress(){if(this.channel.netAddress){this.peerAddress.netAddress&&!this.peerAddress.netAddress.equals(this.channel.netAddress)&&a.w(Peer,"Got different netAddress ".concat(this.channel.netAddress," for ").concat(this.peerAddress," ")+"- advertised was ".concat(this.peerAddress.netAddress));this.channel.netAddress.isPrivate()||(this.peerAddress.netAddress=this.channel.netAddress)}else this.channel.peerAddress.netAddress?this.channel.netAddress=this.channel.peerAddress.netAddress:this.channel.netAddress=In.UNKNOWN}},{key:"equals",value:function equals(e){return e instanceof Peer&&this._channel.equals(e.channel)}},{key:"hashCode",value:function hashCode(){return this._channel.hashCode()}},{key:"toString",value:function toString(){return"Peer{version=".concat(this._version,", headHash=").concat(this._headHash,", ")+"peerAddress=".concat(this.peerAddress,", netAddress=").concat(this.netAddress,"}")}},{key:"channel",get:function get(){return this._channel}},{key:"version",get:function get(){return this._version}},{key:"headHash",get:function get(){return this._headHash}},{key:"head",get:function get(){return this._head},set:function set(e){this._head=e;this._headHash=e.hash()}},{key:"timeOffset",get:function get(){return this._timeOffset}},{key:"id",get:function get(){return this._channel.id}},{key:"peerAddress",get:function get(){return this._channel.peerAddress},set:function set(e){this._channel.peerAddress=e}},{key:"netAddress",get:function get(){return this._channel.netAddress}},{key:"userAgent",get:function get(){return this._userAgent}}]);return Peer}();n.register(fr);var dr=function(e){(0,_inherits2["default"])(Miner,e);var t=_createSuper(Miner);function Miner(e,n,r,a,i){var s,o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:new Uint8Array(0);(0,_classCallCheck2["default"])(this,Miner);(s=t.call(this))._blockchain=e;s._accounts=n;s._mempool=r;s._time=a;s._producer=new $e(e,n,r,a);s._address=i;s._extraData=o;s._hashCount=0;s._lastHashrate=0;s._hashrateWorker=null;s._hashrate=0;s._lastHashCounts=[];s._totalHashCount=0;s._lastElapsed=[];s._totalElapsed=0;s._workerPool=new wr;var u=f.hardwareConcurrency;s.threads=Math.ceil(u/2);1===u&&(s.throttleAfter=2);s._workerPool.on("share",function(e){return s.onWorkerShare(e)});s._workerPool.on("no-share",function(e){return s.onWorkerShare(e)});s._mempoolChanged=!1;s._restarting=!1;s._lastRestart=0;s._submittingBlock=!1;s._shareCompact=0;s._shareCompactSet=!1;s._numBlocksMined=0;s._activeConfigChanges=!1;s._pendingConfigChanges=!1;if(s._mempool){s._mempool.on("transactions-ready",function(){return s._startWork()});s._mempool.on("transaction-added",function(){return s._mempoolChanged=!0})}return s}(0,_createClass2["default"])(Miner,[{key:"startWork",value:function startWork(){var e=this;if(!this.working){this._hashCount=0;this._lastElapsed=[];this._lastHashCounts=[];this._totalHashCount=0;this._totalElapsed=0;this._lastHashrate=(0,_now["default"])();this._hashrateWorker=setInterval(function(){return e._updateHashrate()},1e3);this._retry=0;this.fire("start",this);this._startWork()["catch"](a.w.tag(Miner))}}},{key:"_startWork",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee384(){var e,t=this;return _regenerator["default"].wrap(function _callee384$(n){for(;;)switch(n.prev=n.next){case 0:if(this.working&&!this._restarting){n.next=2;break}return n.abrupt("return");case 2:n.prev=2;this._lastRestart=(0,_now["default"])();this._restarting=!0;this._mempoolChanged=!1;this._retry=0;n.next=9;return this.getNextBlock();case 9:if(null!==(e=n.sent)){n.next=13;break}this._stopWork();return n.abrupt("return");case 13:e.isFull()?a.d(Miner,"Starting work on block #".concat(e.header.height," / ").concat(e.minerAddr.toUserFriendlyAddress()," / ").concat(M.toBase64(e.body.extraData)," with ").concat(e.transactionCount," transactions (").concat(this._hashrate," H/s)")):a.d(Miner,"Starting work on block #".concat(e.header.height," from pool (").concat(this._hashrate," H/s)"));this._workerPool.startMiningOnBlock(e,this._shareCompactSet?this._shareCompact:undefined)["catch"](a.w.tag(Miner));n.next=23;break;case 17:n.prev=17;n.t0=n["catch"](2);a.e(Miner,n.t0);a.w(Miner,"Failed to start work, retrying in 100ms");this._stopWork();setTimeout(function(){return t.startWork()},100);case 23:n.prev=23;this._restarting=!1;return n.finish(23);case 26:case"end":return n.stop()}},_callee384,this,[[2,17,23,26]])}));return function _startWork(){return e.apply(this,arguments)}}()},{key:"onWorkerShare",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee385(e){var t;return _regenerator["default"].wrap(function _callee385$(n){for(;;)switch(n.prev=n.next){case 0:this._hashCount+=this._workerPool.noncesPerRun;if(!e.block||!e.block.prevHash.equals(this._blockchain.headHash)){n.next=35;break}a.d(Miner,function(){return"Received share: ".concat(e.nonce," / ").concat(e.hash.toHex())});if(this._submittingBlock){n.next=35;break}e.block.header.nonce=e.nonce;t=!1;if(!e.block.isFull()||!De.isProofOfWork(e.hash,e.block.target)){n.next=34;break}this._submittingBlock=!0;n.next=10;return e.block.header.verifyProofOfWork();case 10:if(!n.sent){n.next=26;break}this._numBlocksMined++;t=!0;this.fire("block-mined",e.block,this);n.next=16;return this._blockchain.pushBlock(e.block);case 16:n.t0=n.sent;if(!(n.t0<0)){n.next=23;break}this._submittingBlock=!1;this._startWork()["catch"](a.w.tag(Miner));return n.abrupt("return");case 23:this._submittingBlock=!1;case 24:n.next=34;break;case 26:n.t1=a;n.t2=Miner;n.t3="Ignoring invalid share: ";n.next=31;return e.block.header.pow();case 31:n.t4=n.sent;n.t5=n.t3.concat.call(n.t3,n.t4);n.t1.d.call(n.t1,n.t2,n.t5);case 34:this.fire("share",e.block,t,this);case 35:this._mempoolChanged&&this._lastRestart+Miner.MIN_TIME_ON_BLOCK<(0,_now["default"])()&&this._startWork()["catch"](a.w.tag(Miner));case 36:case"end":return n.stop()}},_callee385,this)}));return function onWorkerShare(t){return e.apply(this,arguments)}}()},{key:"getNextBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee386(){var e,t,n=arguments;return _regenerator["default"].wrap(function _callee386$(r){for(;;)switch(r.prev=r.next){case 0:e=n.length>0&&n[0]!==undefined?n[0]:this._address;t=n.length>1&&n[1]!==undefined?n[1]:this._extraData;this._retry++;r.prev=3;return r.abrupt("return",this._producer.getNextBlock(e,t));case 7:r.prev=7;r.t0=r["catch"](3);if(!(this._retry<=3)){r.next=11;break}return r.abrupt("return",this.getNextBlock(e,t));case 11:throw r.t0;case 12:case"end":return r.stop()}},_callee386,this,[[3,7]])}));return function getNextBlock(){return e.apply(this,arguments)}}()},{key:"stopWork",value:function stopWork(){this._stopWork()}},{key:"_stopWork",value:function _stopWork(){if(this.working){clearInterval(this._hashrateWorker);this._hashrateWorker=null;this._hashrate=0;this._lastElapsed=[];this._lastHashCounts=[];this._totalHashCount=0;this._totalElapsed=0;this._workerPool.stop();this.fire("stop",this);a.d(Miner,"Stopped work")}}},{key:"_updateHashrate",value:function _updateHashrate(){var e=((0,_now["default"])()-this._lastHashrate)/1e3,t=this._hashCount;this._hashCount=0;this._lastHashrate=(0,_now["default"])();this._lastElapsed.push(e);this._lastHashCounts.push(t);this._totalElapsed+=e;this._totalHashCount+=t;if(this._lastElapsed.length>Miner.MOVING_AVERAGE_MAX_SIZE){var n=this._lastElapsed.shift(),r=this._lastHashCounts.shift();this._totalElapsed-=n;this._totalHashCount-=r}this._hashrate=Math.round(this._totalHashCount/this._totalElapsed);this.fire("hashrate-changed",this._hashrate,this)}},{key:"startConfigChanges",value:function startConfigChanges(){this._activeConfigChanges=!0;this._pendingConfigChanges=!1}},{key:"finishConfigChanges",value:function finishConfigChanges(){this._pendingConfigChanges&&this._startWork()["catch"](a.w.tag(Miner));this._activeConfigChanges=!1}},{key:"address",get:function get(){return this._address},set:function set(e){if(e&&!e.equals(this._address)){this._address=e;this._activeConfigChanges?this._pendingConfigChanges=!0:this._startWork()["catch"](a.w.tag(Miner))}}},{key:"working",get:function get(){return!!this._hashrateWorker}},{key:"hashrate",get:function get(){return this._hashrate}},{key:"threads",get:function get(){return this._workerPool.poolSize},set:function set(e){this._workerPool.poolSize=e}},{key:"throttleWait",get:function get(){return this._workerPool.cycleWait},set:function set(e){this._workerPool.cycleWait=e}},{key:"throttleAfter",get:function get(){return this._workerPool.runsPerCycle},set:function set(e){this._workerPool.runsPerCycle=e}},{key:"extraData",get:function get(){return this._extraData},set:function set(e){if(!M.equals(e,this._extraData)){this._extraData=e;this._activeConfigChanges?this._pendingConfigChanges=!0:this._startWork()["catch"](a.w.tag(Miner))}}},{key:"shareCompact",get:function get(){return this._shareCompactSet?this._shareCompact:undefined},set:function set(e){if(e){this._shareCompact=e;this._shareCompactSet=!0}else this._shareCompactSet=!1}},{key:"numBlocksMined",get:function get(){return this._numBlocksMined}}]);return Miner}(i);dr.MIN_TIME_ON_BLOCK=1e4;dr.MOVING_AVERAGE_MAX_SIZE=10;n.register(dr);var Ar=function(e){(0,_inherits2["default"])(BasePoolMiner,e);var t=_createSuper(BasePoolMiner);function BasePoolMiner(e,n,r,a,i,s,o,u){var c,l=arguments.length>8&&arguments[8]!==undefined?arguments[8]:new Uint8Array(0);(0,_classCallCheck2["default"])(this,BasePoolMiner);(c=t.call(this,n,r,a,i,s,l))._ourAddress=s;c._ourExtraData=l;c._ws=null;c._deviceId=o;c._deviceData=u;c.mode=e;c.connectionState=BasePoolMiner.ConnectionState.CLOSED;c._reconnectTimeout=null;c._exponentialBackoffReconnect=BasePoolMiner.RECONNECT_TIMEOUT;return c}(0,_createClass2["default"])(BasePoolMiner,[{key:"requestPayout",value:function requestPayout(){this._send({message:"payout"})}},{key:"_send",value:function _send(e){if(this._ws)try{this._ws.send((0,_stringify["default"])(e))}catch(t){a.w(BasePoolMiner,"Error sending:",t.message||t)}}},{key:"connect",value:function connect(e,t){var n=this;if(this._ws)throw new Error("Call disconnect() first");this._host=e;this._port=t;var r=this._ws=new WebSocket("wss://".concat(e,":").concat(t));this._ws.onopen=function(){return n._onOpen(r)};this._ws.onerror=function(e){return n._onError(r,e)};this._ws.onmessage=function(e){return n._onMessage(r,e.data)};this._ws.onclose=function(e){return n._onClose(r,e)};this._changeConnectionState(BasePoolMiner.ConnectionState.CONNECTING)}},{key:"_onOpen",value:function _onOpen(e){e!==this._ws?e.close():this._register()}},{key:"_register",value:function _register(){this._send({message:"register",mode:this.mode,address:this._ourAddress.toUserFriendlyAddress(),deviceId:this._deviceId,deviceData:this._deviceData,genesisHash:M.toBase64(qn.GENESIS_HASH.serialize())})}},{key:"_onError",value:function _onError(e,t){a.d(BasePoolMiner,"WebSocket connection errored",t.message||t);e===this._ws&&this._timeoutReconnect();try{e.close()}catch(n){a.w(BasePoolMiner,n.message||n)}}},{key:"_onClose",value:function _onClose(e,t){a.d(BasePoolMiner,"WebSocket connection closed",t.message||t);if(e===this._ws){this._changeConnectionState(BasePoolMiner.ConnectionState.CLOSED);a.w(BasePoolMiner,"Disconnected from pool");this._timeoutReconnect()}}},{key:"_timeoutReconnect",value:function _timeoutReconnect(){var e=this;this.disconnect();this._reconnectTimeout=setTimeout(function(){e._ws||e.connect(e._host,e._port)},this._exponentialBackoffReconnect);this._exponentialBackoffReconnect=Math.min(2*this._exponentialBackoffReconnect,BasePoolMiner.RECONNECT_TIMEOUT_MAX)}},{key:"disconnect",value:function disconnect(){this._turnPoolOff();if(this._ws){this._changeConnectionState(BasePoolMiner.ConnectionState.CLOSED);a.w(BasePoolMiner,"Disconnected from pool");var e=this._ws;this._ws=null;try{e.close()}catch(t){a.w(BasePoolMiner,t.message||t)}}clearTimeout(this._reconnectTimeout)}},{key:"_onMessage",value:function _onMessage(e,t){if(e===this._ws)try{var n=JSON.parse(t);if(n&&n.message)switch(n.message){case"settings":if(n.address&&n.extraData){this._onNewPoolSettings(ge.fromUserFriendlyAddress(n.address),M.fromBase64(n.extraData),n.targetCompact||De.targetToCompact(new J(n.target)),n.nonce);a.d(BasePoolMiner,"Received settings from pool: address ".concat(n.address,", target ").concat(n.target,", extraData ").concat(n.extraData))}else{this._turnPoolOff();this._ws.close()}break;case"balance":if(n.balance===undefined||n.confirmedBalance===undefined){this._turnPoolOff();this._ws.close()}else{this._onBalance(n.balance,n.confirmedBalance,n.payoutRequestActive);a.d(BasePoolMiner,"Received balance from pool: ".concat(n.balance," (").concat(n.confirmedBalance," confirmed), payout request active: ").concat(n.payoutRequestActive))}break;case"registered":this._changeConnectionState(BasePoolMiner.ConnectionState.CONNECTED);this._exponentialBackoffReconnect=BasePoolMiner.RECONNECT_TIMEOUT;a.i(BasePoolMiner,"Connected to pool");break;case"error":a.w(BasePoolMiner,"Error from pool:",n.reason)}else{a.w(BasePoolMiner,"Received unknown message from pool server:",(0,_stringify["default"])(n));this._ws.close()}}catch(r){this._onError(e,r)}}},{key:"_onBalance",value:function _onBalance(e,t,n){var r=this.balance,i=this.confirmedBalance;this.balance=e;this.confirmedBalance=t;this.payoutRequestActive=n;e===r&&t===i||a.i(BasePoolMiner,"Pool balance: ".concat(re.lunasToCoins(e)," NIM (confirmed ").concat(re.lunasToCoins(t)," NIM)"));e!==r&&this.fire("balance",e);t!==i&&this.fire("confirmed-balance",t)}},{key:"_turnPoolOff",value:function _turnPoolOff(){this.startConfigChanges();(0,_set4["default"])((0,_getPrototypeOf2["default"])(BasePoolMiner.prototype),"address",this._ourAddress,this,!0);(0,_set4["default"])((0,_getPrototypeOf2["default"])(BasePoolMiner.prototype),"extraData",this._ourExtraData,this,!0);(0,_set4["default"])((0,_getPrototypeOf2["default"])(BasePoolMiner.prototype),"shareCompact",null,this,!0);this.finishConfigChanges()}},{key:"_onNewPoolSettings",value:function _onNewPoolSettings(e,t,n,r){this.startConfigChanges();(0,_set4["default"])((0,_getPrototypeOf2["default"])(BasePoolMiner.prototype),"address",e,this,!0);(0,_set4["default"])((0,_getPrototypeOf2["default"])(BasePoolMiner.prototype),"extraData",t,this,!0);(0,_set4["default"])((0,_getPrototypeOf2["default"])(BasePoolMiner.prototype),"shareCompact",n,this,!0);(0,_set4["default"])((0,_getPrototypeOf2["default"])(BasePoolMiner.prototype),"nonce",r,this,!0);this.finishConfigChanges()}},{key:"_changeConnectionState",value:function _changeConnectionState(e){this.connectionState=e;this.fire("connection-state",e)}},{key:"isConnected",value:function isConnected(){return this.connectionState===BasePoolMiner.ConnectionState.CONNECTED}},{key:"isDisconnected",value:function isDisconnected(){return this.connectionState===BasePoolMiner.ConnectionState.CLOSED}},{key:"host",get:function get(){return this._host}},{key:"port",get:function get(){return this._port}},{key:"address",get:function get(){return this._ourAddress},set:function set(e){this._ourAddress=e;if(this.isConnected()){this.disconnect();this.connect(this._host,this._port)}else(0,_set4["default"])((0,_getPrototypeOf2["default"])(BasePoolMiner.prototype),"address",e,this,!0)}}],[{key:"generateDeviceId",value:function generateDeviceId(e){return ie.blake2b([M.fromAscii("pool_device_id"),e.keyPair.privateKey.serialize()].reduce(M.concatTypedArrays)).serialize().readUint32()}}]);return BasePoolMiner}(dr);Ar.PAYOUT_NONCE_PREFIX="POOL_PAYOUT";Ar.RECONNECT_TIMEOUT=3e3;Ar.RECONNECT_TIMEOUT_MAX=3e4;Ar.ConnectionState={CONNECTED:0,CONNECTING:1,CLOSED:2};Ar.Mode={NANO:"nano",SMART:"smart"};n.register(Ar);var _r=function(e){(0,_inherits2["default"])(SmartPoolMiner,e);var t=_createSuper(SmartPoolMiner);function SmartPoolMiner(e,n,r,a,i,s,o){var u,c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:new Uint8Array(0);(0,_classCallCheck2["default"])(this,SmartPoolMiner);(u=t.call(this,Ar.Mode.SMART,e,n,r,a,i,s,o,c)).on("share",function(e,t){return u._onBlockMined(e,t)});return u}(0,_createClass2["default"])(SmartPoolMiner,[{key:"_onBlockMined",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee387(e,t){return _regenerator["default"].wrap(function _callee387$(n){for(;;)switch(n.prev=n.next){case 0:n.t0=this;n.t1=M.toBase64(e.header.serialize());n.t2=M;n.next=5;return Z.compute(e.body.getMerkleLeafs(),e.minerAddr);case 5:n.t3=n.sent.serialize();n.t4=n.t2.toBase64.call(n.t2,n.t3);n.t5=M;n.next=10;return Z.compute(e.body.getMerkleLeafs(),e.body.extraData);case 10:n.t6=n.sent.serialize();n.t7=n.t5.toBase64.call(n.t5,n.t6);n.t8=t?M.toBase64(e.serialize()):undefined;n.t9={message:"share",blockHeader:n.t1,minerAddrProof:n.t4,extraDataProof:n.t7,block:n.t8};n.t0._send.call(n.t0,n.t9);case 15:case"end":return n.stop()}},_callee387,this)}));return function _onBlockMined(t,n){return e.apply(this,arguments)}}()}]);return SmartPoolMiner}(Ar);n.register(_r);var pr=function(e){(0,_inherits2["default"])(NanoPoolMiner,e);var t=_createSuper(NanoPoolMiner);function NanoPoolMiner(e,n,r,a,i){var s;(0,_classCallCheck2["default"])(this,NanoPoolMiner);(s=t.call(this,Ar.Mode.NANO,e,null,null,n,r,a,i)).on("share",function(e){return s._onBlockMined(e)});s._shouldWork=!1;return s}(0,_createClass2["default"])(NanoPoolMiner,[{key:"startWork",value:function startWork(){this._shouldWork=!0;(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"startWork",this).call(this)}},{key:"stopWork",value:function stopWork(){this._shouldWork=!1;(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"stopWork",this).call(this)}},{key:"_onBlockMined",value:function _onBlockMined(e){this._send({message:"share",block:M.toBase64(e.serialize())})}},{key:"_onMessage",value:function _onMessage(e,t){if(this._ws===e)try{var n=JSON.parse(t);n&&"new-block"===n.message?this._handleNewBlock(n):(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"_onMessage",this).call(this,e,t)}catch(r){this._onError(e,r)}}},{key:"_handleNewBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee388(e){var t,n;return _regenerator["default"].wrap(function _callee388$(r){for(;;)switch(r.prev=r.next){case 0:t=Je.unserialize(M.fromBase64(e.previousBlock));a.d(NanoPoolMiner,"New base block from pool server, on top of ".concat(t.hash()));if(!this._blockchain.headHash.equals(t.hash())){r.next=8;break}r.next=5;return this._blockchain.getNextTarget();case 5:this._poolNextTarget=r.sent;r.next=50;break;case 8:if(!this._blockchain.headHash.equals(t.prevHash)){r.next=20;break}r.next=11;return t.isImmediateSuccessorOf(this._blockchain.head);case 11:if(r.sent){r.next=15;break}a.w(NanoPoolMiner,"".concat(t.hash()," (from pool) is not an immediate successor of ").concat(this._blockchain.headHash,", but is announced as such."));(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"stopWork",this).call(this);return r.abrupt("return");case 15:r.next=17;return this._blockchain.getNextTarget(this._blockchain.head,t);case 17:this._poolNextTarget=r.sent;r.next=50;break;case 20:if(!this._blockchain.head.prevHash.equals(t.hash())){r.next=25;break}(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"stopWork",this).call(this);return r.abrupt("return");case 25:r.t0=this._blockchain.height===t.height;if(!r.t0){r.next=30;break}r.next=29;return this._blockchain.getBlock(t.prevHash);case 29:r.t0=n=r.sent;case 30:if(!r.t0){r.next=39;break}r.next=33;return t.isImmediateSuccessorOf(n);case 33:if(r.sent){r.next=37;break}a.w(NanoPoolMiner,"".concat(t.hash()," (from pool) is not an immediate successor of ").concat(n,", but is announced as such."));(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"stopWork",this).call(this);return r.abrupt("return");case 37:r.next=50;break;case 39:r.next=41;return this._blockchain.getBlock(t.prevHash,!0);case 41:if(!(n=r.sent)){r.next=47;break}a.w(NanoPoolMiner,"".concat(t.hash()," (from pool) is a known fork, we don't mine on forks."));(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"stopWork",this).call(this);return r.abrupt("return");case 47:a.w(NanoPoolMiner,"".concat(t.hash()," (from pool) is unknown and not a successor of the head"));(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"stopWork",this).call(this);return r.abrupt("return");case 50:r.next=52;return t.getNextInterlink(this._poolNextTarget);case 52:this._poolNextInterlink=r.sent;this._poolPrevBlock=t;this._poolAccountsHash=ie.unserialize(M.fromBase64(e.accountsHash));this._poolBodyHash=ie.unserialize(M.fromBase64(e.bodyHash));this.working?this._startWork()["catch"](a.w.tag(dr)):this._shouldWork&&(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"startWork",this).call(this);case 57:case"end":return r.stop()}},_callee388,this)}));return function _handleNewBlock(t){return e.apply(this,arguments)}}()},{key:"getNextBlock",value:function getNextBlock(){return this._poolPrevBlock?new Je(new Re(this._poolPrevBlock.hash(),this._poolNextInterlink.hash(),this._poolBodyHash,this._poolAccountsHash,De.targetToCompact(this._poolNextTarget),this._poolPrevBlock.height+1,Math.max(this._producer._getNextTimestamp(),this._poolPrevBlock.timestamp+1),0),this._poolNextInterlink):null}},{key:"_turnPoolOff",value:function _turnPoolOff(){this.stopWork();(0,_get10["default"])((0,_getPrototypeOf2["default"])(NanoPoolMiner.prototype),"_turnPoolOff",this).call(this)}}]);return NanoPoolMiner}(Ar);n.register(pr);var gr=function(){(0,_createClass2["default"])(Wallet,null,[{key:"generate",value:function generate(){return new Wallet(ce.generate())}},{key:"loadPlain",value:function loadPlain(e){"string"==typeof e&&(e=M.fromHex(e));if(!e||0===e.byteLength)throw new Error("Invalid wallet seed");return new Wallet(ce.unserialize(new U(e)))}},{key:"loadEncrypted",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee389(e,t){return _regenerator["default"].wrap(function _callee389$(n){for(;;)switch(n.prev=n.next){case 0:"string"==typeof e&&(e=M.fromHex(e));"string"==typeof t&&(t=M.fromUtf8(t));n.t0=Wallet;n.next=5;return ce.fromEncrypted(new U(e),t);case 5:n.t1=n.sent;return n.abrupt("return",new n.t0(n.t1));case 7:case"end":return n.stop()}},_callee389)}));return function loadEncrypted(t,n){return e.apply(this,arguments)}}()}]);function Wallet(e){(0,_classCallCheck2["default"])(this,Wallet);this._keyPair=e;this._address=this._keyPair.publicKey.toAddress()}(0,_createClass2["default"])(Wallet,[{key:"createTransaction",value:function createTransaction(e,t,n,r){var a=new Ge(this._keyPair.publicKey,e,t,n,r);a.signature=de.create(this._keyPair.privateKey,this._keyPair.publicKey,a.serializeContent());return a}},{key:"signTransaction",value:function signTransaction(e){var t=de.create(this._keyPair.privateKey,this._keyPair.publicKey,e.serializeContent());return He.singleSig(this._keyPair.publicKey,t)}},{key:"exportPlain",value:function exportPlain(){return this._keyPair.serialize()}},{key:"exportEncrypted",value:function exportEncrypted(e){"string"==typeof e&&(e=M.fromUtf8(e));return this._keyPair.exportEncrypted(e)}},{key:"lock",value:function lock(e){"string"==typeof e&&(e=M.fromUtf8(e));return this.keyPair.lock(e)}},{key:"relock",value:function relock(){this.keyPair.relock()}},{key:"unlock",value:function unlock(e){"string"==typeof e&&(e=M.fromUtf8(e));return this.keyPair.unlock(e)}},{key:"equals",value:function equals(e){return e instanceof Wallet&&this.keyPair.equals(e.keyPair)&&this.address.equals(e.address)}},{key:"isLocked",get:function get(){return this.keyPair.isLocked}},{key:"address",get:function get(){return this._address}},{key:"publicKey",get:function get(){return this._keyPair.publicKey}},{key:"keyPair",get:function get(){return this._keyPair}}]);return Wallet}();n.register(gr);var yr=function(e){(0,_inherits2["default"])(MultiSigWallet,e);var t=_createSuper(MultiSigWallet);(0,_createClass2["default"])(MultiSigWallet,null,[{key:"fromPublicKeys",value:function fromPublicKeys(e,t,n){if(0===n.length)throw new Error("publicKeys may not be empty");if(t<=0)throw new Error("minSignatures must be greater than 0");if(!n.some(function(t){return t.equals(e.publicKey)}))throw new Error("Own publicKey must be part of publicKeys");(n=n.slice()).sort(function(e,t){return e.compare(t)});var r=(0,_toConsumableArray2["default"])(m.k_combinations(n,t)).map(function(e){return ue.sum(e)});return new MultiSigWallet(e,t,r)}},{key:"_loadMultiSig",value:function _loadMultiSig(e,t){for(var n=t.readUint8(),r=t.readUint8(),a=[],i=0;i<r;++i)a.push(ue.unserialize(t));return new MultiSigWallet(e,n,a)}},{key:"loadPlain",value:function loadPlain(e){"string"==typeof e&&(e=M.fromHex(e));if(!e||0===e.byteLength)throw new Error("Invalid wallet seed");var t=new U(e),n=ce.unserialize(t);return MultiSigWallet._loadMultiSig(n,t)}},{key:"loadEncrypted",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee390(e,t){var n,r;return _regenerator["default"].wrap(function _callee390$(a){for(;;)switch(a.prev=a.next){case 0:"string"==typeof e&&(e=M.fromHex(e));"string"==typeof t&&(t=M.fromUtf8(t));n=new U(e);a.next=5;return ce.fromEncrypted(n,t);case 5:r=a.sent;return a.abrupt("return",MultiSigWallet._loadMultiSig(r,n));case 7:case"end":return a.stop()}},_callee390)}));return function loadEncrypted(t,n){return e.apply(this,arguments)}}()}]);function MultiSigWallet(e,n,r){var a;(0,_classCallCheck2["default"])(this,MultiSigWallet);(a=t.call(this,e))._minSignatures=n;a._publicKeys=r;a._publicKeys.sort(function(e,t){return e.compare(t)});var i=X.computeRoot(a._publicKeys);a._address=ge.fromHash(i);return a}(0,_createClass2["default"])(MultiSigWallet,[{key:"exportPlain",value:function exportPlain(){var e=new U(this.exportedSize);this._keyPair.serialize(e);e.writeUint8(this._minSignatures);e.writeUint8(this._publicKeys.length);var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._publicKeys);!(t=(a=i.next()).done);t=!0){a.value.serialize(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}return e}},{key:"exportEncrypted",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee391(e){var t,n,r,a,i,s;return _regenerator["default"].wrap(function _callee391$(o){for(;;)switch(o.prev=o.next){case 0:"string"==typeof e&&(e=M.fromUtf8(e));t=new U(this.encryptedSize);o.t0=t;o.next=5;return this._keyPair.exportEncrypted(e);case 5:o.t1=o.sent;o.t0.write.call(o.t0,o.t1);t.writeUint8(this._minSignatures);t.writeUint8(this._publicKeys.length);n=!0;r=!1;a=undefined;o.prev=12;for(i=(0,_getIterator2["default"])(this._publicKeys);!(n=(s=i.next()).done);n=!0)s.value.serialize(t);o.next=20;break;case 16:o.prev=16;o.t2=o["catch"](12);r=!0;a=o.t2;case 20:o.prev=20;o.prev=21;n||null==i["return"]||i["return"]();case 23:o.prev=23;if(!r){o.next=26;break}throw a;case 26:return o.finish(23);case 27:return o.finish(20);case 28:return o.abrupt("return",t);case 29:case"end":return o.stop()}},_callee391,this,[[12,16,20,28],[21,,23,27]])}));return function exportEncrypted(t){return e.apply(this,arguments)}}()},{key:"createTransaction",value:function createTransaction(e,t,n,r){return new Fe(this._address,ye.Type.BASIC,e,ye.Type.BASIC,t,n,r,ze.Flag.NONE,new Uint8Array(0))}},{key:"createCommitment",value:function createCommitment(){return _e.generate()}},{key:"partiallySignTransaction",value:function partiallySignTransaction(e,t,n,r){(t=t.slice()).sort(function(e,t){return e.compare(t)});return pe.create(this._keyPair.privateKey,this._keyPair.publicKey,t,r,n,e.serializeContent())}},{key:"signTransaction",value:function signTransaction(e,t,n,r){if(r.length!==this._minSignatures)throw new Error("Not enough signatures to complete this transaction");var a=de.fromPartialSignatures(n,r);return He.multiSig(t,this._publicKeys,a)}},{key:"completeTransaction",value:function completeTransaction(e,t,n,r){var a=this.signTransaction(e,t,n,r);e.proof=a.serialize();return e}},{key:"exportedSize",get:function get(){return this._keyPair.serializedSize+1+1+this._publicKeys.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"encryptedSize",get:function get(){return this._keyPair.encryptedSize+1+1+this._publicKeys.reduce(function(e,t){return e+t.serializedSize},0)}},{key:"minSignatures",get:function get(){return this._minSignatures}},{key:"publicKeys",get:function get(){return this._publicKeys}}]);return MultiSigWallet}(gr);n.register(yr);var vr=function(){function WalletStore(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"wallet";(0,_classCallCheck2["default"])(this,WalletStore);this._jdb=new JDB.JungleDB(e,WalletStore.VERSION,{maxDbSize:WalletStore.INITIAL_DB_SIZE,autoResize:!0,minResize:WalletStore.MIN_RESIZE});this._walletStore=null;this._multiSigStore=null;return this._init()}(0,_createClass2["default"])(WalletStore,[{key:"_init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee392(){return _regenerator["default"].wrap(function _callee392$(e){for(;;)switch(e.prev=e.next){case 0:this._walletStore=this._jdb.createObjectStore(WalletStore.WALLET_DATABASE,{codec:new kr});this._multiSigStore=this._jdb.createObjectStore(WalletStore.MULTISIG_WALLET_DATABASE,{codec:new kr});e.next=4;return this._jdb.connect();case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},_callee392,this)}));return function _init(){return e.apply(this,arguments)}}()},{key:"hasDefault",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee393(){var e;return _regenerator["default"].wrap(function _callee393$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._walletStore.get("default");case 2:e=t.sent;return t.abrupt("return",!!e);case 4:case"end":return t.stop()}},_callee393,this)}));return function hasDefault(){return e.apply(this,arguments)}}()},{key:"getDefault",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee394(e){var t,n,r;return _regenerator["default"].wrap(function _callee394$(a){for(;;)switch(a.prev=a.next){case 0:a.next=2;return this._walletStore.get("default");case 2:if(t=a.sent){a.next=10;break}n=gr.generate();a.next=7;return this.put(n);case 7:a.next=9;return this.setDefault(n.address);case 9:return a.abrupt("return",n);case 10:r=new ge(t);return a.abrupt("return",this.get(r,e));case 12:case"end":return a.stop()}},_callee394,this)}));return function getDefault(t){return e.apply(this,arguments)}}()},{key:"setDefault",value:function setDefault(e){var t=e.serialize();return this._walletStore.put("default",t)}},{key:"get",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee395(e,t){var n,r;return _regenerator["default"].wrap(function _callee395$(a){for(;;)switch(a.prev=a.next){case 0:n=e.toBase64();a.next=3;return this._walletStore.get(n);case 3:if(r=a.sent){a.next=6;break}return a.abrupt("return",null);case 6:if(!t){a.next=8;break}return a.abrupt("return",gr.loadEncrypted(r,t));case 8:a.prev=8;return a.abrupt("return",gr.loadPlain(r));case 12:a.prev=12;a.t0=a["catch"](8);return a.abrupt("return",null);case 15:case"end":return a.stop()}},_callee395,this,[[8,12]])}));return function get(t,n){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee396(e,t,n){var r,a;return _regenerator["default"].wrap(function _callee396$(i){for(;;)switch(i.prev=i.next){case 0:r=e.address.toBase64();a=null;if(!t){i.next=8;break}i.next=5;return e.exportEncrypted(t,n);case 5:a=i.sent;i.next=9;break;case 8:a=e.exportPlain();case 9:return i.abrupt("return",this._walletStore.put(r,a));case 10:case"end":return i.stop()}},_callee396,this)}));return function put(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee397(e){var t,n,r;return _regenerator["default"].wrap(function _callee397$(a){for(;;)switch(a.prev=a.next){case 0:t=e.toBase64();(n=this._walletStore.transaction()).removeSync(t);a.next=5;return this._walletStore.get("default");case 5:if(r=a.sent){r=new ge(r);e.equals(r)&&n.removeSync("default")}return a.abrupt("return",n.commit());case 8:case"end":return a.stop()}},_callee397,this)}));return function remove(t){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee398(){var e;return _regenerator["default"].wrap(function _callee398$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._walletStore.keys();case 2:e=t.sent;return t.abrupt("return",(0,_from["default"])(e).filter(function(e){return"default"!==e}).map(function(e){return ge.fromBase64(e)}));case 4:case"end":return t.stop()}},_callee398,this)}));return function list(){return e.apply(this,arguments)}}()},{key:"getMultiSig",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee399(e,t){var n,r;return _regenerator["default"].wrap(function _callee399$(a){for(;;)switch(a.prev=a.next){case 0:n=e.toBase64();a.next=3;return this._multiSigStore.get(n);case 3:if(r=a.sent){a.next=6;break}return a.abrupt("return",null);case 6:if(!t){a.next=8;break}return a.abrupt("return",yr.loadEncrypted(r,t));case 8:return a.abrupt("return",yr.loadPlain(r));case 9:case"end":return a.stop()}},_callee399,this)}));return function getMultiSig(t,n){return e.apply(this,arguments)}}()},{key:"putMultiSig",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee400(e,t,n){var r,a;return _regenerator["default"].wrap(function _callee400$(i){for(;;)switch(i.prev=i.next){case 0:r=e.address.toBase64();a=null;if(!t){i.next=8;break}i.next=5;return e.exportEncrypted(t,n);case 5:a=i.sent;i.next=9;break;case 8:a=e.exportPlain();case 9:return i.abrupt("return",this._multiSigStore.put(r,a));case 10:case"end":return i.stop()}},_callee400,this)}));return function putMultiSig(t,n,r){return e.apply(this,arguments)}}()},{key:"removeMultiSig",value:function removeMultiSig(e){var t=e.toBase64();return this._multiSigStore.remove(t)}},{key:"listMultiSig",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee401(){var e;return _regenerator["default"].wrap(function _callee401$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._multiSigStore.keys();case 2:e=t.sent;return t.abrupt("return",(0,_from["default"])(e).map(function(e){return ge.fromBase64(e)}));case 4:case"end":return t.stop()}},_callee401,this)}));return function listMultiSig(){return e.apply(this,arguments)}}()},{key:"close",value:function close(){return this._jdb.close()}}]);return WalletStore}();n.register(vr);vr._instance=null;vr.VERSION=1;vr.INITIAL_DB_SIZE=10485760;vr.MIN_RESIZE=10485760;vr.WALLET_DATABASE="wallets";vr.MULTISIG_WALLET_DATABASE="multisig-wallets";var kr=function(){function WalletStoreCodec(){(0,_classCallCheck2["default"])(this,WalletStoreCodec)}(0,_createClass2["default"])(WalletStoreCodec,[{key:"encode",value:function encode(e){return e}},{key:"decode",value:function decode(e,t){return new Uint8Array(e)}},{key:"leveldbValueEncoding",get:function get(){return"binary"}},{key:"lmdbValueEncoding",get:function get(){return JDB.JungleDB.BINARY_ENCODING}}]);return WalletStoreCodec}(),mr=function(){function MinerWorker(){(0,_classCallCheck2["default"])(this,MinerWorker)}(0,_createClass2["default"])(MinerWorker,[{key:"multiMine",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee402(e,t,n,r){return _regenerator["default"].wrap(function _callee402$(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},_callee402)}));return function multiMine(t,n,r,a){return e.apply(this,arguments)}}()}]);return MinerWorker}();n.register(mr);var br=function(e){(0,_inherits2["default"])(MinerWorkerImpl,e);var t=_createSuper(MinerWorkerImpl);function MinerWorkerImpl(){var e,n;(0,_classCallCheck2["default"])(this,MinerWorkerImpl);(n=t.call(this))._superInit=(0,_get10["default"])((e=(0,_assertThisInitialized2["default"])(n),(0,_getPrototypeOf2["default"])(MinerWorkerImpl.prototype)),"init",e);return n}(0,_createClass2["default"])(MinerWorkerImpl,[{key:"init",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee403(e){return _regenerator["default"].wrap(function _callee403$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._superInit.call(this,e);case 2:if(!f.isBrowser()){t.next=5;break}t.next=5;return d.doImportBrowser();case 5:case"end":return t.stop()}},_callee403,this)}));return function init(t){return e.apply(this,arguments)}}()},{key:"multiMine",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee404(e,t,n,r){var i,s,o,u;return _regenerator["default"].wrap(function _callee404$(c){for(;;)switch(c.prev=c.next){case 0:i=new Uint8Array(32);c.prev=1;s=Module._malloc(i.length);o=Module._malloc(e.length);Module.HEAPU8.set(e,o);if((u=Module._nimiq_argon2_target(s,o,e.length,t,n,r,512))!==r){c.next=8;break}return c.abrupt("return",!1);case 8:i.set(new Uint8Array(Module.HEAPU8.buffer,s,i.length));return c.abrupt("return",{hash:i,nonce:u});case 12:c.prev=12;c.t0=c["catch"](1);a.w(MinerWorkerImpl,c.t0);throw c.t0;case 16:c.prev=16;s!==undefined&&Module._free(s);o!==undefined&&Module._free(o);return c.finish(16);case 20:case"end":return c.stop()}},_callee404,null,[[1,12,16,20]])}));return function multiMine(t,n,r,a){return e.apply(this,arguments)}}()}]);return MinerWorkerImpl}(K.Stub(mr));K.prepareForWorkerUse(mr,new br);var wr=function(e){(0,_inherits2["default"])(MinerWorkerPool,e);var t=_createSuper(MinerWorkerPool);function MinerWorkerPool(){var e,n,r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;(0,_classCallCheck2["default"])(this,MinerWorkerPool);(n=t.call(this,function(e){return K.startWorkerForProxy(mr,e)},"miner",r))._miningEnabled=!1;n._activeNonces=[];n._block=null;n._noncesPerRun=256;n._observable=new i;n._shareCompact=re.BLOCK_TARGET_MAX;n._runsPerCycle=Infinity;n._cycleWait=100;n._superUpdateToSize=(0,_get10["default"])((e=(0,_assertThisInitialized2["default"])(n),(0,_getPrototypeOf2["default"])(MinerWorkerPool.prototype)),"_updateToSize",e);if(f.isNodeJs()){a.i(MinerWorkerPool,"Using add-on optimized for instruction set: ".concat(cpuSupport));n.multiMine=function(e,t,n,r){return new _promise["default"](function(a,i){NodeNative.node_argon2_target_async(function(){var t=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee405(t){var n;return _regenerator["default"].wrap(function _callee405$(s){for(;;)switch(s.prev=s.next){case 0:s.prev=0;if(t!==r){s.next=5;break}a(!1);s.next=13;break;case 5:e.writePos-=4;e.writeUint32(t);s.next=9;return q.getInstanceAsync();case 9:s.next=11;return s.sent.computeArgon2d(e);case 11:n=s.sent;a({hash:n,nonce:t});case 13:s.next=18;break;case 15:s.prev=15;s.t0=s["catch"](0);i(s.t0);case 18:case"end":return s.stop()}},_callee405,null,[[0,15]])}));return function(e){return t.apply(this,arguments)}}(),e,t,n,r,512)})}}return n}(0,_createClass2["default"])(MinerWorkerPool,[{key:"on",value:function on(e,t){return this._observable.on(e,t)}},{key:"off",value:function off(e,t){this._observable.off(e,t)}},{key:"startMiningOnBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee406(e,t){var n;return _regenerator["default"].wrap(function _callee406$(r){for(;;)switch(r.prev=r.next){case 0:this._block=e;this._shareCompact=t||e.nBits;if(this._miningEnabled){r.next=10;break}r.next=5;return this._updateToSize();case 5:this._activeNonces=[];this._miningEnabled=!0;for(n=0;n<this.poolSize;++n)this._startMiner();r.next=11;break;case 10:this._activeNonces=[{minNonce:0,maxNonce:0}];case 11:case"end":return r.stop()}},_callee406,this)}));return function startMiningOnBlock(t,n){return e.apply(this,arguments)}}()},{key:"stop",value:function stop(){this._miningEnabled=!1}},{key:"_updateToSize",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee407(){return _regenerator["default"].wrap(function _callee407$(e){for(;;)switch(e.prev=e.next){case 0:if(f.isNodeJs()){e.next=3;break}e.next=3;return this._superUpdateToSize.call(this);case 3:for(;this._miningEnabled&&this._activeNonces.length<this.poolSize;)this._startMiner();case 4:case"end":return e.stop()}},_callee407,this)}));return function _updateToSize(){return e.apply(this,arguments)}}()},{key:"_startMiner",value:function _startMiner(){if(!(this._activeNonces.length>=this.poolSize)){var e=0===this._activeNonces.length?0:Math.max.apply(null,this._activeNonces.map(function(e){return e.maxNonce})),t={minNonce:e,maxNonce:e+this._noncesPerRun};this._activeNonces.push(t);this._singleMiner(t)["catch"](function(e){return a.e(MinerWorkerPool,e)})}}},{key:"_singleMiner",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee408(e){var t,n,r,a,i,s,o=this;return _regenerator["default"].wrap(function _callee408$(u){for(;;)switch(u.prev=u.next){case 0:t=0;case 1:if(!(this._miningEnabled&&(K.areWorkersAsync||f.isNodeJs()||0===t)&&t<this._runsPerCycle)){u.next=19;break}t++;n=this._block;u.next=6;return this.multiMine(n.header.serialize(),this._shareCompact,e.minNonce,e.maxNonce);case 6:if(r=u.sent){a=new ie(r.hash);this._observable.fire("share",{block:n,nonce:r.nonce,hash:a})}else this._observable.fire("no-share",{nonce:e.maxNonce});if(!(this._activeNonces.length>this.poolSize)){u.next=13;break}this._activeNonces.splice(this._activeNonces.indexOf(e),1);return u.abrupt("return");case 13:i=Math.max.apply(null,this._activeNonces.map(function(e){return e.maxNonce}));s={minNonce:i,maxNonce:i+this._noncesPerRun};this._activeNonces.splice(this._activeNonces.indexOf(e),1,s);e=s;case 17:u.next=1;break;case 19:this._miningEnabled&&setTimeout(function(){return o._singleMiner(e)},this._cycleWait);case 20:case"end":return u.stop()}},_callee408,this)}));return function _singleMiner(t){return e.apply(this,arguments)}}()},{key:"noncesPerRun",get:function get(){return this._noncesPerRun},set:function set(e){this._noncesPerRun=e}},{key:"runsPerCycle",get:function get(){return this._runsPerCycle},set:function set(e){this._runsPerCycle=e}},{key:"cycleWait",get:function get(){return this._cycleWait},set:function set(e){this._cycleWait=e}}]);return MinerWorkerPool}(K.Pool(mr));n.register(wr);var Cr=function(){function Client(e,t){var n=this;(0,_classCallCheck2["default"])(this,Client);this._consensus=t||e.createConsensus();this._consensusListenerIds=[];this._consensusSynchronizer=new z;this._subscribedAddresses=new w;this._config=e;this._consensusChangedListeners=new b;this._blockListeners=new b;this._headChangedListeners=new b;this._transactionListeners=new b;this._listenerId=0;this._consensusState=Client.ConsensusState.CONNECTING;this._headHash=null;this._transactionConfirmWaiting=new b;this._transactionExpireWaiting=new b;this._transactionSynchronizer=new z;this._network=new Client.Network(this);this._mempool=new Client.Mempool(this);this._consensusSynchronizer.push(function(){return n._setupConsensus()["catch"](a.w.tag(Client))})["catch"](a.w.tag(Client))}(0,_createClass2["default"])(Client,[{key:"resetConsensus",value:function resetConsensus(){var e=this;return this._consensusSynchronizer.push(function(){return e._replaceConsensus(e._config.createConsensus())})}},{key:"_setupConsensus",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee409(){var e,t=this;return _regenerator["default"].wrap(function _callee409$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this._consensus;case 2:e=n.sent;this._consensusOn(e,"block",function(e){return t._onBlock(e)});this._consensusOn(e,"established",function(){return t._onConsensusChanged(Client.ConsensusState.ESTABLISHED)});this._consensusOn(e,"waiting",function(){return t._onConsensusChanged(Client.ConsensusState.CONNECTING)});this._consensusOn(e,"syncing",function(){return t._onConsensusChanged(Client.ConsensusState.SYNCING)});this._consensusOn(e,"head-changed",function(e,n,r,a){return t._onHeadChanged(e,n,r,a)});this._consensusOn(e,"transaction-added",function(e){return t._onPendingTransaction(e)});this._consensusOn(e,"transaction-added",function(e){return t._mempool._onTransactionAdded(e)});this._consensusOn(e,"transaction-removed",function(e){return t._mempool._onTransactionRemoved(e)});this._consensusOn(e,"transaction-mined",function(e,n,r){return t._onMinedTransaction(n,e,r)});this._consensusOn(e,"consensus-failed",function(){return t._onConsensusFailed()});this._onConsensusChanged(e.established?Client.ConsensusState.ESTABLISHED:Client.ConsensusState.CONNECTING);this._config.hasFeature(Client.Feature.PASSIVE)?e.network.allowInboundConnections=!0:e.network.connect();case 15:case"end":return n.stop()}},_callee409,this)}));return function _setupConsensus(){return e.apply(this,arguments)}}()},{key:"_consensusOn",value:function _consensusOn(e,t,n){this._consensusListenerIds.push({type:t,id:e.on(t,n)})}},{key:"_replaceConsensus",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee410(e){var t,n,r,a,i,s,o,u,c,l;return _regenerator["default"].wrap(function _callee410$(h){for(;;)switch(h.prev=h.next){case 0:h.next=2;return this._consensus;case 2:t=h.sent;n=!0;r=!1;a=undefined;h.prev=6;for(i=(0,_getIterator2["default"])(this._consensusListenerIds);!(n=(s=i.next()).done);n=!0){o=s.value,u=o.type,c=o.id;t.off(u,c)}h.next=14;break;case 10:h.prev=10;h.t0=h["catch"](6);r=!0;a=h.t0;case 14:h.prev=14;h.prev=15;n||null==i["return"]||i["return"]();case 17:h.prev=17;if(!r){h.next=20;break}throw a;case 20:return h.finish(17);case 21:return h.finish(14);case 22:this._consensusListenerIds=[];this._consensus=e;h.next=26;return this._consensus;case 26:l=h.sent;t.handoverTo(l);return h.abrupt("return",this._setupConsensus());case 29:case"end":return h.stop()}},_callee410,this,[[6,10,14,22],[15,,17,21]])}));return function _replaceConsensus(t){return e.apply(this,arguments)}}()},{key:"_txExpiresAt",value:function _txExpiresAt(e){return e.validityStartHeight+re.TRANSACTION_VALIDITY_WINDOW+this._config.requiredBlockConfirmations-1}},{key:"_txWaitForExpire",value:function _txWaitForExpire(e){var t=this._transactionExpireWaiting.get(this._txExpiresAt(e))||new w;t.add(e);this._transactionExpireWaiting.put(this._txExpiresAt(e),t)}},{key:"_txClearFromExpire",value:function _txClearFromExpire(e){if(this._transactionExpireWaiting.contains(this._txExpiresAt(e))){var t=this._transactionExpireWaiting.get(this._txExpiresAt(e));t.remove(e);0===t.length&&this._transactionExpireWaiting.remove(this._txExpiresAt(e))}}},{key:"_txConfirmsAt",value:function _txConfirmsAt(e){return e+this._config.requiredBlockConfirmations-1}},{key:"_txWaitForConfirm",value:function _txWaitForConfirm(e,t){var n=this._transactionConfirmWaiting.get(this._txConfirmsAt(t))||new w;n.add(e);this._transactionConfirmWaiting.put(this._txConfirmsAt(t),n)}},{key:"_txClearFromConfirm",value:function _txClearFromConfirm(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._transactionConfirmWaiting.entryIterator());!(t=(a=i.next()).done);t=!0){var s=(0,_slicedToArray2["default"])(a.value,2),o=s[0],u=s[1];if(u.contains(e)){u.remove(e);if(0===u.length){this._transactionConfirmWaiting.remove(o);break}}}}catch(c){n=!0;r=c}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"_onBlock",value:function _onBlock(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._blockListeners.values());!(t=(a=i.next()).done);t=!0){(0,a.value)(e)}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"_onConsensusChanged",value:function _onConsensusChanged(e){var t=this;this._consensusSynchronizer.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee411(){var n,r,i,s,o,u,c,l,h,f,d,A,_,p;return _regenerator["default"].wrap(function _callee411$(g){for(;;)switch(g.prev=g.next){case 0:g.next=2;return t._consensus;case 2:n=g.sent;if(e!==t._consensusState){g.next=5;break}return g.abrupt("return");case 5:n.established&&n.getSubscription().type===Ue.Type.ADDRESSES&&n.subscribe(Ue.fromAddresses(t._subscribedAddresses.values()));t._consensusState=e;r=!0;i=!1;s=undefined;g.prev=10;o=(0,_getIterator2["default"])(t._consensusChangedListeners.values());case 12:if(r=(u=o.next()).done){g.next=25;break}c=u.value;g.prev=14;g.next=17;return c(e);case 17:g.next=22;break;case 19:g.prev=19;g.t0=g["catch"](14);a.e(Client,"Error in listener: ".concat(g.t0));case 22:r=!0;g.next=12;break;case 25:g.next=31;break;case 27:g.prev=27;g.t1=g["catch"](10);i=!0;s=g.t1;case 31:g.prev=31;g.prev=32;r||null==o["return"]||o["return"]();case 34:g.prev=34;if(!i){g.next=37;break}throw s;case 37:return g.finish(34);case 38:return g.finish(31);case 39:if(!n.established){g.next=78;break}g.next=42;return n.getHeadHash();case 42:if(!(l=g.sent).equals(t._headHash)){g.next=45;break}return g.abrupt("return");case 45:t._headHash=l;h=!0;f=!1;d=undefined;g.prev=49;A=(0,_getIterator2["default"])(t._headChangedListeners.values());case 51:if(h=(_=A.next()).done){g.next=64;break}p=_.value;g.prev=53;g.next=56;return p(l,"established",[],[l]);case 56:g.next=61;break;case 58:g.prev=58;g.t2=g["catch"](53);a.e(Client,"Error in listener: ".concat(g.t2));case 61:h=!0;g.next=51;break;case 64:g.next=70;break;case 66:g.prev=66;g.t3=g["catch"](49);f=!0;d=g.t3;case 70:g.prev=70;g.prev=71;h||null==A["return"]||A["return"]();case 73:g.prev=73;if(!f){g.next=76;break}throw d;case 76:return g.finish(73);case 77:return g.finish(70);case 78:case"end":return g.stop()}},_callee411,null,[[10,27,31,39],[14,19],[32,,34,38],[49,66,70,78],[53,58],[71,,73,77]])})))["catch"](a.e.tag(Client))}},{key:"_onConsensusFailed",value:function _onConsensusFailed(){var e=this;this._consensusSynchronizer.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee412(){var t,n;return _regenerator["default"].wrap(function _callee412$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return e._consensus;case 2:if(!((t=r.sent)instanceof It)){r.next=14;break}a.w(Client,"Pico consensus failed, automatically upgrading to nano consensus");r.t0=St;r.next=8;return new wt(t.network.time);case 8:r.t1=r.sent;r.t2=t.mempool;r.t3=t.network;n=new r.t0(r.t1,r.t2,r.t3);r.next=14;return e._replaceConsensus(_promise["default"].resolve(n));case 14:case"end":return r.stop()}},_callee412)})))["catch"](a.e.tag(Client))}},{key:"_onHeadChanged",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee414(e,t,n,r){var i=this;return _regenerator["default"].wrap(function _callee414$(s){for(;;)switch(s.prev=s.next){case 0:this._consensusSynchronizer.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee413(){var s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,b,C,S,T,E,x,I,B,P,N,O,R,M,L,D,U,z,H,G,F,K,q,W,j,V,Q,J,Y,X,Z,$,ee,te,ne,re,ae,ie,se,oe,ue,ce,le,he,fe,de,Ae,_e,pe,ge,ye,ve,ke,me,be,we,Ce,Se,Te;return _regenerator["default"].wrap(function _callee413$(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:if(i._consensusState!==Client.ConsensusState.ESTABLISHED||e.equals(i._headHash)){Ee.next=34;break}i._headHash=e;s=!0;o=!1;u=undefined;Ee.prev=5;c=(0,_getIterator2["default"])(i._headChangedListeners.values());case 7:if(s=(l=c.next()).done){Ee.next=20;break}h=l.value;Ee.prev=9;Ee.next=12;return h(e,t,n.map(function(e){return e.hash()}),r.map(function(e){return e.hash()}));case 12:Ee.next=17;break;case 14:Ee.prev=14;Ee.t0=Ee["catch"](9);a.e(Client,"Error in listener: ".concat(Ee.t0));case 17:s=!0;Ee.next=7;break;case 20:Ee.next=26;break;case 22:Ee.prev=22;Ee.t1=Ee["catch"](5);o=!0;u=Ee.t1;case 26:Ee.prev=26;Ee.prev=27;s||null==c["return"]||c["return"]();case 29:Ee.prev=29;if(!o){Ee.next=32;break}throw u;case 32:return Ee.finish(29);case 33:return Ee.finish(26);case 34:if(!(i._transactionListeners.length>0)){Ee.next=261;break}f=new w;d=new w(function(e){return e.tx instanceof ze?e.tx.hash().hashCode():e.hash().hashCode()});Ee.next=39;return i._consensus;case 39:A=Ee.sent;_=!0;p=!1;g=undefined;Ee.prev=43;y=(0,_getIterator2["default"])(n);case 45:if(_=(v=y.next()).done){Ee.next=73;break}!(k=v.value).isFull()||A instanceof It||f.addAll(k.transactions);if(!(m=i._transactionConfirmWaiting.get(i._txConfirmsAt(k.height)))){Ee.next=70;break}b=!0;C=!1;S=undefined;Ee.prev=53;for(T=(0,_getIterator2["default"])(m.valueIterator());!(b=(E=T.next()).done);b=!0){x=E.value;f.add(x)}Ee.next=61;break;case 57:Ee.prev=57;Ee.t2=Ee["catch"](53);C=!0;S=Ee.t2;case 61:Ee.prev=61;Ee.prev=62;b||null==T["return"]||T["return"]();case 64:Ee.prev=64;if(!C){Ee.next=67;break}throw S;case 67:return Ee.finish(64);case 68:return Ee.finish(61);case 69:i._transactionConfirmWaiting.remove(i._txConfirmsAt(k.height));case 70:_=!0;Ee.next=45;break;case 73:Ee.next=79;break;case 75:Ee.prev=75;Ee.t3=Ee["catch"](43);p=!0;g=Ee.t3;case 79:Ee.prev=79;Ee.prev=80;_||null==y["return"]||y["return"]();case 82:Ee.prev=82;if(!p){Ee.next=85;break}throw g;case 85:return Ee.finish(82);case 86:return Ee.finish(79);case 87:I=!0;B=!1;P=undefined;Ee.prev=90;N=(0,_getIterator2["default"])(r);case 92:if(I=(O=N.next()).done){Ee.next=117;break}if(!(R=O.value).isFull()||A instanceof It){Ee.next=114;break}M=!0;L=!1;D=undefined;Ee.prev=98;for(U=(0,_getIterator2["default"])(R.transactions);!(M=(z=U.next()).done);M=!0){H=z.value;f.contains(H)&&f.remove(H);d.add({tx:H,block:R})}Ee.next=106;break;case 102:Ee.prev=102;Ee.t4=Ee["catch"](98);L=!0;D=Ee.t4;case 106:Ee.prev=106;Ee.prev=107;M||null==U["return"]||U["return"]();case 109:Ee.prev=109;if(!L){Ee.next=112;break}throw D;case 112:return Ee.finish(109);case 113:return Ee.finish(106);case 114:I=!0;Ee.next=92;break;case 117:Ee.next=123;break;case 119:Ee.prev=119;Ee.t5=Ee["catch"](90);B=!0;P=Ee.t5;case 123:Ee.prev=123;Ee.prev=124;I||null==N["return"]||N["return"]();case 126:Ee.prev=126;if(!B){Ee.next=129;break}throw P;case 129:return Ee.finish(126);case 130:return Ee.finish(123);case 131:G=!0;F=!1;K=undefined;Ee.prev=134;for(q=(0,_getIterator2["default"])(f.valueIterator());!(G=(W=q.next()).done);G=!0){j=W.value;i._onPendingTransaction(j,r[r.length-1])}Ee.next=142;break;case 138:Ee.prev=138;Ee.t6=Ee["catch"](134);F=!0;K=Ee.t6;case 142:Ee.prev=142;Ee.prev=143;G||null==q["return"]||q["return"]();case 145:Ee.prev=145;if(!F){Ee.next=148;break}throw K;case 148:return Ee.finish(145);case 149:return Ee.finish(142);case 150:V=!0;Q=!1;J=undefined;Ee.prev=153;Y=(0,_getIterator2["default"])(r);case 155:if(V=(X=Y.next()).done){Ee.next=182;break}Z=X.value;if(!($=i._transactionConfirmWaiting.get(Z.height))){Ee.next=179;break}ee=!0;te=!1;ne=undefined;Ee.prev=162;for(re=(0,_getIterator2["default"])($.valueIterator());!(ee=(ae=re.next()).done);ee=!0){ie=ae.value;i._onConfirmedTransaction(Z,ie,r[r.length-1])}Ee.next=170;break;case 166:Ee.prev=166;Ee.t7=Ee["catch"](162);te=!0;ne=Ee.t7;case 170:Ee.prev=170;Ee.prev=171;ee||null==re["return"]||re["return"]();case 173:Ee.prev=173;if(!te){Ee.next=176;break}throw ne;case 176:return Ee.finish(173);case 177:return Ee.finish(170);case 178:i._transactionConfirmWaiting.remove(Z.height);case 179:V=!0;Ee.next=155;break;case 182:Ee.next=188;break;case 184:Ee.prev=184;Ee.t8=Ee["catch"](153);Q=!0;J=Ee.t8;case 188:Ee.prev=188;Ee.prev=189;V||null==Y["return"]||Y["return"]();case 191:Ee.prev=191;if(!Q){Ee.next=194;break}throw J;case 194:return Ee.finish(191);case 195:return Ee.finish(188);case 196:se=!0;oe=!1;ue=undefined;Ee.prev=199;for(ce=(0,_getIterator2["default"])(d.valueIterator());!(se=(le=ce.next()).done);se=!0){he=le.value,fe=he.tx,de=he.block;i._onMinedTransaction(de,fe,r[r.length-1])}Ee.next=207;break;case 203:Ee.prev=203;Ee.t9=Ee["catch"](199);oe=!0;ue=Ee.t9;case 207:Ee.prev=207;Ee.prev=208;se||null==ce["return"]||ce["return"]();case 210:Ee.prev=210;if(!oe){Ee.next=213;break}throw ue;case 213:return Ee.finish(210);case 214:return Ee.finish(207);case 215:Ae=!0;_e=!1;pe=undefined;Ee.prev=218;ge=(0,_getIterator2["default"])(r);case 220:if(Ae=(ye=ge.next()).done){Ee.next=247;break}ve=ye.value;if(!(ke=i._transactionExpireWaiting.get(ve.height))){Ee.next=244;break}me=!0;be=!1;we=undefined;Ee.prev=227;for(Ce=(0,_getIterator2["default"])(ke.valueIterator());!(me=(Se=Ce.next()).done);me=!0){Te=Se.value;i._onExpiredTransaction(ve,Te)}Ee.next=235;break;case 231:Ee.prev=231;Ee.t10=Ee["catch"](227);be=!0;we=Ee.t10;case 235:Ee.prev=235;Ee.prev=236;me||null==Ce["return"]||Ce["return"]();case 238:Ee.prev=238;if(!be){Ee.next=241;break}throw we;case 241:return Ee.finish(238);case 242:return Ee.finish(235);case 243:i._transactionExpireWaiting.remove(ve.height);case 244:Ae=!0;Ee.next=220;break;case 247:Ee.next=253;break;case 249:Ee.prev=249;Ee.t11=Ee["catch"](218);_e=!0;pe=Ee.t11;case 253:Ee.prev=253;Ee.prev=254;Ae||null==ge["return"]||ge["return"]();case 256:Ee.prev=256;if(!_e){Ee.next=259;break}throw pe;case 259:return Ee.finish(256);case 260:return Ee.finish(253);case 261:case"end":return Ee.stop()}},_callee413,null,[[5,22,26,34],[9,14],[27,,29,33],[43,75,79,87],[53,57,61,69],[62,,64,68],[80,,82,86],[90,119,123,131],[98,102,106,114],[107,,109,113],[124,,126,130],[134,138,142,150],[143,,145,149],[153,184,188,196],[162,166,170,178],[171,,173,177],[189,,191,195],[199,203,207,215],[208,,210,214],[218,249,253,261],[227,231,235,243],[236,,238,242],[254,,256,260]])})))["catch"](a.e.tag(Client));case 1:case"end":return s.stop()}},_callee414,this)}));return function _onHeadChanged(t,n,r,a){return e.apply(this,arguments)}}()},{key:"_onPendingTransaction",value:function _onPendingTransaction(e,t){var n,r=this,i=[],s=!0,o=!1,u=undefined;try{for(var c,l=function _loop18(){var s=c.value,o=s.listener,u=s.addresses;if(u.contains(e.sender)||u.contains(e.recipient)){n=t&&t.height>=r._txExpiresAt(e)?n||new Client.TransactionDetails(e,Client.TransactionState.EXPIRED):n||new Client.TransactionDetails(e,Client.TransactionState.PENDING);i.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee415(){return _regenerator["default"].wrap(function _callee415$(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;e.next=3;return o(n);case 3:e.next=8;break;case 5:e.prev=5;e.t0=e["catch"](0);a.e(Client,"Error in listener: ".concat(e.t0));case 8:case"end":return e.stop()}},_callee415,null,[[0,5]])})))}},h=(0,_getIterator2["default"])(this._transactionListeners.values());!(s=(c=h.next()).done);s=!0)l()}catch(f){o=!0;u=f}finally{try{s||null==h["return"]||h["return"]()}finally{if(o)throw u}}this._txClearFromConfirm(e);n&&n.state===Client.TransactionState.PENDING&&this._txWaitForExpire(e);i.length>0&&this._transactionSynchronizer.push(function(){return i.forEach(function(e){return e()})})["catch"](a.e.tag(Client))}},{key:"_onMinedTransaction",value:function _onMinedTransaction(e,t,n){var r,i=this,s=[],o=!0,u=!1,c=undefined;try{for(var l,h=function _loop19(){var o=l.value,u=o.listener,c=o.addresses;if(c.contains(t.sender)||c.contains(t.recipient)){var h=Client.TransactionState.MINED,f=1;n&&(h=(f=n.height-e.height+1)>=i._config.requiredBlockConfirmations?Client.TransactionState.CONFIRMED:Client.TransactionState.MINED);r=r||new Client.TransactionDetails(t,h,e.hash(),e.height,f,e.timestamp);s.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee416(){return _regenerator["default"].wrap(function _callee416$(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;e.next=3;return u(r);case 3:e.next=8;break;case 5:e.prev=5;e.t0=e["catch"](0);a.e(Client,"Error in listener: ".concat(e.t0));case 8:case"end":return e.stop()}},_callee416,null,[[0,5]])})))}},f=(0,_getIterator2["default"])(this._transactionListeners.values());!(o=(l=f.next()).done);o=!0)h()}catch(d){u=!0;c=d}finally{try{o||null==f["return"]||f["return"]()}finally{if(u)throw c}}this._txClearFromExpire(t);r&&r.state===Client.TransactionState.MINED&&this._txWaitForConfirm(t,e.height);s.length>0&&this._transactionSynchronizer.push(function(){return s.forEach(function(e){return e()})})["catch"](a.e.tag(Client))}},{key:"_onConfirmedTransaction",value:function _onConfirmedTransaction(e,t,n){var r,i=this,s=[],o=!0,u=!1,c=undefined;try{for(var l,h=function _loop20(){var o=l.value,u=o.listener,c=o.addresses;if(c.contains(t.sender)||c.contains(t.recipient)){r=r||new Client.TransactionDetails(t,Client.TransactionState.CONFIRMED,e.hash(),e.height,n.height-e.height+i._config.requiredBlockConfirmations,e.timestamp);s.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee417(){return _regenerator["default"].wrap(function _callee417$(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;e.next=3;return u(r);case 3:e.next=8;break;case 5:e.prev=5;e.t0=e["catch"](0);a.e(Client,"Error in listener: ".concat(e.t0));case 8:case"end":return e.stop()}},_callee417,null,[[0,5]])})))}},f=(0,_getIterator2["default"])(this._transactionListeners.values());!(o=(l=f.next()).done);o=!0)h()}catch(d){u=!0;c=d}finally{try{o||null==f["return"]||f["return"]()}finally{if(u)throw c}}s.length>0&&this._transactionSynchronizer.push(function(){return s.forEach(function(e){return e()})})["catch"](a.e.tag(Client))}},{key:"_onExpiredTransaction",value:function _onExpiredTransaction(e,t){var n,r=[],i=!0,s=!1,o=undefined;try{for(var u,c=function _loop21(){var e=u.value,i=e.listener,s=e.addresses;if(s.contains(t.sender)||s.contains(t.recipient)){n=n||new Client.TransactionDetails(t,Client.TransactionState.EXPIRED);r.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee418(){return _regenerator["default"].wrap(function _callee418$(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;e.next=3;return i(n);case 3:e.next=8;break;case 5:e.prev=5;e.t0=e["catch"](0);a.e(Client,"Error in listener: ".concat(e.t0));case 8:case"end":return e.stop()}},_callee418,null,[[0,5]])})))}},l=(0,_getIterator2["default"])(this._transactionListeners.values());!(i=(u=l.next()).done);i=!0)c()}catch(h){s=!0;o=h}finally{try{i||null==l["return"]||l["return"]()}finally{if(s)throw o}}r.length>0&&this._transactionSynchronizer.push(function(){return r.forEach(function(e){return e()})})["catch"](a.e.tag(Client))}},{key:"getHeadHash",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee419(){var e;return _regenerator["default"].wrap(function _callee419$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._consensus;case 2:e=t.sent;return t.abrupt("return",e.getHeadHash());case 4:case"end":return t.stop()}},_callee419,this)}));return function getHeadHash(){return e.apply(this,arguments)}}()},{key:"getHeadHeight",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee420(){var e;return _regenerator["default"].wrap(function _callee420$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._consensus;case 2:e=t.sent;return t.abrupt("return",e.getHeadHeight());case 4:case"end":return t.stop()}},_callee420,this)}));return function getHeadHeight(){return e.apply(this,arguments)}}()},{key:"getHeadBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee421(){var e,t,n,r=arguments;return _regenerator["default"].wrap(function _callee421$(a){for(;;)switch(a.prev=a.next){case 0:e=!(r.length>0&&r[0]!==undefined)||r[0];a.next=3;return this._consensus;case 3:t=a.sent;a.next=6;return t.getHeadHash();case 6:n=a.sent;return a.abrupt("return",t.getBlock(n,e));case 8:case"end":return a.stop()}},_callee421,this)}));return function getHeadBlock(){return e.apply(this,arguments)}}()},{key:"getBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee422(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee422$(a){for(;;)switch(a.prev=a.next){case 0:t=!(r.length>1&&r[1]!==undefined)||r[1];e=ie.fromAny(e);a.next=4;return this._consensus;case 4:n=a.sent;return a.abrupt("return",n.getBlock(e,t));case 6:case"end":return a.stop()}},_callee422,this)}));return function getBlock(t){return e.apply(this,arguments)}}()},{key:"getBlockAt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee423(e,t){var n;return _regenerator["default"].wrap(function _callee423$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._consensus;case 2:n=r.sent;return r.abrupt("return",n.getBlockAt(e,t));case 4:case"end":return r.stop()}},_callee423,this)}));return function getBlockAt(t,n){return e.apply(this,arguments)}}()},{key:"getBlockTemplate",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee424(e,t){var n;return _regenerator["default"].wrap(function _callee424$(r){for(;;)switch(r.prev=r.next){case 0:this._config.requireFeatures(Client.Feature.MINING,Client.Feature.MEMPOOL);e=ge.fromAny(e);if("string"!=typeof t){r.next=6;break}t=M.fromHex(t);r.next=8;break;case 6:if(!t||t instanceof Uint8Array){r.next=8;break}throw new Error("Invalid extra data");case 8:r.next=10;return this._consensus;case 10:n=r.sent;return r.abrupt("return",n.getBlockTemplate(e,t));case 12:case"end":return r.stop()}},_callee424,this)}));return function getBlockTemplate(t,n){return e.apply(this,arguments)}}()},{key:"submitBlock",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee425(e){var t;return _regenerator["default"].wrap(function _callee425$(n){for(;;)switch(n.prev=n.next){case 0:this._config.requireFeatures(Client.Feature.MINING);e=Je.fromAny(e);n.next=4;return this._consensus;case 4:t=n.sent;return n.abrupt("return",t.submitBlock(e));case 6:case"end":return n.stop()}},_callee425,this)}));return function submitBlock(t){return e.apply(this,arguments)}}()},{key:"getAccount",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee426(e){return _regenerator["default"].wrap(function _callee426$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this.getAccounts([e]);case 2:return t.abrupt("return",t.sent[0]);case 3:case"end":return t.stop()}},_callee426,this)}));return function getAccount(t){return e.apply(this,arguments)}}()},{key:"getAccounts",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee427(e){var t;return _regenerator["default"].wrap(function _callee427$(n){for(;;)switch(n.prev=n.next){case 0:e=e.map(function(e){return ge.fromAny(e)});n.next=3;return this._consensus;case 3:t=n.sent;return n.abrupt("return",t.getAccounts(e));case 5:case"end":return n.stop()}},_callee427,this)}));return function getAccounts(t){return e.apply(this,arguments)}}()},{key:"getTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee428(e,t,n){var r,a,i,s,o,u,c,l,h;return _regenerator["default"].wrap(function _callee428$(f){for(;;)switch(f.prev=f.next){case 0:e=ie.fromAny(e);t&&(t=ie.fromAny(t));f.next=4;return this._consensus;case 4:r=f.sent;if(t){f.next=10;break}f.next=8;return r.getTransactionReceiptsByHashes([e]);case 8:if((a=f.sent)&&1===a.length&&a[0]){t=a[0].blockHash;n=a[0].blockHeight}case 10:if(t){f.next=20;break}f.next=13;return r.getPendingTransactions([e]);case 13:if(!(i=f.sent)||!i[0]){f.next=19;break}this._txWaitForExpire(i[0]);return f.abrupt("return",new Client.TransactionDetails(i[0],Client.TransactionState.PENDING));case 19:throw new Error("Unknown transaction hash");case 20:f.next=22;return r.getBlock(t,!1,!0,n);case 22:if(!(s=f.sent)){f.next=27;break}n=s.height;f.next=28;break;case 27:throw new Error("Unknown block hash");case 28:f.next=30;return r.getTransactionsFromBlock([e],t,n,s);case 30:if(!(o=f.sent)||!o[0]){f.next=40;break}u=o[0];f.next=35;return r.getHeadHeight();case 35:c=f.sent;(h=(l=c-n+1)>=this._config.requiredBlockConfirmations)||this._txWaitForConfirm(u,n);return f.abrupt("return",new Client.TransactionDetails(u,h?Client.TransactionState.CONFIRMED:Client.TransactionState.MINED,t,n,l,s.timestamp));case 40:throw new Error("Unknown transaction hash");case 41:case"end":return f.stop()}},_callee428,this)}));return function getTransaction(t,n,r){return e.apply(this,arguments)}}()},{key:"getTransactionReceipt",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee429(e){return _regenerator["default"].wrap(function _callee429$(t){for(;;)switch(t.prev=t.next){case 0:e=ie.fromAny(e);t.next=3;return this.getTransactionReceiptsByHashes([e]);case 3:return t.abrupt("return",t.sent[0]);case 4:case"end":return t.stop()}},_callee429,this)}));return function getTransactionReceipt(t){return e.apply(this,arguments)}}()},{key:"getTransactionReceiptsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee430(e){var t,n,r=arguments;return _regenerator["default"].wrap(function _callee430$(a){for(;;)switch(a.prev=a.next){case 0:t=r.length>1&&r[1]!==undefined?r[1]:Infinity;e=ge.fromAny(e);a.next=4;return this._consensus;case 4:n=a.sent;return a.abrupt("return",n.getTransactionReceiptsByAddress(e,t));case 6:case"end":return a.stop()}},_callee430,this)}));return function getTransactionReceiptsByAddress(t){return e.apply(this,arguments)}}()},{key:"getTransactionReceiptsByHashes",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee431(e){var t;return _regenerator["default"].wrap(function _callee431$(n){for(;;)switch(n.prev=n.next){case 0:e=e.map(function(e){return ie.fromAny(e)});n.next=3;return this._consensus;case 3:t=n.sent;return n.abrupt("return",t.getTransactionReceiptsByHashes(e));case 5:case"end":return n.stop()}},_callee431,this)}));return function getTransactionReceiptsByHashes(t){return e.apply(this,arguments)}}()},{key:"getTransactionsByAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee432(e){var t,n,r,a,i,s,o,u,c,l,h,f,d,A,_,p,g,y,v,k,m,C,S,T,E,x,I,B,P,N,O,R,M,L,D,U,z,H,G,F,K,q,W,j,V,Q,J,Y,X,Z,$,ee,te,ne,re,ae,se,oe,ue,ce,le,he,fe,de,Ae=arguments;return _regenerator["default"].wrap(function _callee432$(_e){for(;;)switch(_e.prev=_e.next){case 0:t=Ae.length>1&&Ae[1]!==undefined?Ae[1]:0;n=Ae.length>2?Ae[2]:undefined;r=Ae.length>3&&Ae[3]!==undefined?Ae[3]:Infinity;e=ge.fromAny(e);a=new b;if(!n){_e.next=26;break}n=n.map(function(e){return Client.TransactionDetails.fromPlain(e)});i=!0;s=!1;o=undefined;_e.prev=10;for(u=(0,_getIterator2["default"])(n);!(i=(c=u.next()).done);i=!0){l=c.value;a.put(l.transactionHash,l)}_e.next=18;break;case 14:_e.prev=14;_e.t0=_e["catch"](10);s=!0;o=_e.t0;case 18:_e.prev=18;_e.prev=19;i||null==u["return"]||u["return"]();case 21:_e.prev=21;if(!s){_e.next=24;break}throw o;case 24:return _e.finish(21);case 25:return _e.finish(18);case 26:_e.next=28;return this._consensus;case 28:h=_e.sent;f=new w(function(e){return e instanceof ie?e.hashCode():e.transactionHash.hashCode()});_e.prev=30;_e.next=33;return h.getPendingTransactionsByAddress(e,r);case 33:d=_e.sent;A=!0;_=!1;p=undefined;_e.prev=37;for(g=(0,_getIterator2["default"])(d);!(A=(y=g.next()).done);A=!0){v=y.value;this._txWaitForExpire(v);f.add(new Client.TransactionDetails(v,Client.TransactionState.PENDING))}_e.next=45;break;case 41:_e.prev=41;_e.t1=_e["catch"](37);_=!0;p=_e.t1;case 45:_e.prev=45;_e.prev=46;A||null==g["return"]||g["return"]();case 48:_e.prev=48;if(!_){_e.next=51;break}throw p;case 51:return _e.finish(48);case 52:return _e.finish(45);case 53:_e.next=57;break;case 55:_e.prev=55;_e.t2=_e["catch"](30);case 57:k=new w(function(e){return e.transactionHash.hashCode()});if(!(f.length<r)){_e.next=64;break}_e.t3=k;_e.next=62;return h.getTransactionReceiptsByAddress(e,r-f.length);case 62:_e.t4=_e.sent;_e.t3.addAll.call(_e.t3,_e.t4);case 64:m=new b;C=new b;S=!0;T=!1;E=undefined;_e.prev=69;x=(0,_getIterator2["default"])(k.valueIterator());case 71:if(S=(I=x.next()).done){_e.next=80;break}B=I.value;if(!(P=a.get(B.transactionHash))||P.state!==Client.TransactionState.CONFIRMED||!B.blockHash.equals(P.blockHash)){_e.next=76;break}return _e.abrupt("continue",77);case 76:if(B.blockHeight>=t){(N=m.get(B.blockHash.toBase64())||new w).add(B.transactionHash);m.put(B.blockHash.toBase64(),N);C.put(B.blockHash.toBase64(),B.blockHeight)}case 77:S=!0;_e.next=71;break;case 80:_e.next=86;break;case 82:_e.prev=82;_e.t5=_e["catch"](69);T=!0;E=_e.t5;case 86:_e.prev=86;_e.prev=87;S||null==x["return"]||x["return"]();case 89:_e.prev=89;if(!T){_e.next=92;break}throw E;case 92:return _e.finish(89);case 93:return _e.finish(86);case 94:O=!0;R=!1;M=undefined;_e.prev=97;for(L=(0,_getIterator2["default"])(a.valueIterator());!(O=(D=L.next()).done);O=!0)if(((U=D.value).state===Client.TransactionState.MINED||U.state===Client.TransactionState.CONFIRMED)&&U.blockHeight>=t&&!k.contains(U)){(z=m.get(U.blockHash.toBase64())||new w).add(U.transactionHash);m.put(U.blockHash.toBase64(),z);C.put(U.blockHash.toBase64(),U.blockHeight)}_e.next=105;break;case 101:_e.prev=101;_e.t6=_e["catch"](97);R=!0;M=_e.t6;case 105:_e.prev=105;_e.prev=106;O||null==L["return"]||L["return"]();case 108:_e.prev=108;if(!R){_e.next=111;break}throw M;case 111:return _e.finish(108);case 112:return _e.finish(105);case 113:_e.next=115;return h.getHeadHeight();case 115:H=_e.sent;G=!0;F=!1;K=undefined;_e.prev=119;q=(0,_getIterator2["default"])(m.entryIterator());case 121:if(G=(W=q.next()).done){_e.next=157;break}j=(0,_slicedToArray2["default"])(W.value,2),V=j[0],Q=j[1];if(!(J=ie.fromBase64(V)).equals(ie.NULL)){_e.next=126;break}throw new Error("Illegal request for ".concat(V," vs ").concat(J));case 126:Y=C.get(V);_e.next=129;return h.getBlock(J,!1,!0,Y);case 129:X=_e.sent;_e.next=132;return h.getTransactionsFromBlock(Q.values(),J,Y,X);case 132:Z=_e.sent;ee=($=H-Y+1)>=this._config.requiredBlockConfirmations;te=!0;ne=!1;re=undefined;_e.prev=138;for(ae=(0,_getIterator2["default"])(Z);!(te=(se=ae.next()).done);te=!0){oe=se.value;ee||this._txWaitForConfirm(oe,Y);f.add(new Client.TransactionDetails(oe,ee?Client.TransactionState.CONFIRMED:Client.TransactionState.MINED,J,Y,$,X.timestamp))}_e.next=146;break;case 142:_e.prev=142;_e.t7=_e["catch"](138);ne=!0;re=_e.t7;case 146:_e.prev=146;_e.prev=147;te||null==ae["return"]||ae["return"]();case 149:_e.prev=149;if(!ne){_e.next=152;break}throw re;case 152:return _e.finish(149);case 153:return _e.finish(146);case 154:G=!0;_e.next=121;break;case 157:_e.next=163;break;case 159:_e.prev=159;_e.t8=_e["catch"](119);F=!0;K=_e.t8;case 163:_e.prev=163;_e.prev=164;G||null==q["return"]||q["return"]();case 166:_e.prev=166;if(!F){_e.next=169;break}throw K;case 169:return _e.finish(166);case 170:return _e.finish(163);case 171:ue=!0;ce=!1;le=undefined;_e.prev=174;he=(0,_getIterator2["default"])(a.valueIterator());case 176:if(ue=(fe=he.next()).done){_e.next=191;break}if((de=fe.value).state!==Client.TransactionState.NEW&&de.state!==Client.TransactionState.PENDING||f.contains(de)){_e.next=188;break}if(!(this._txExpiresAt(de)<=H)){_e.next=183;break}f.add(new Client.TransactionDetails(de.transaction,Client.TransactionState.EXPIRED));_e.next=188;break;case 183:_e.t9=f;_e.next=186;return this.sendTransaction(de.transaction);case 186:_e.t10=_e.sent;_e.t9.add.call(_e.t9,_e.t10);case 188:ue=!0;_e.next=176;break;case 191:_e.next=197;break;case 193:_e.prev=193;_e.t11=_e["catch"](174);ce=!0;le=_e.t11;case 197:_e.prev=197;_e.prev=198;ue||null==he["return"]||he["return"]();case 200:_e.prev=200;if(!ce){_e.next=203;break}throw le;case 203:return _e.finish(200);case 204:return _e.finish(197);case 205:return _e.abrupt("return",f.values());case 206:case"end":return _e.stop()}},_callee432,this,[[10,14,18,26],[19,,21,25],[30,55],[37,41,45,53],[46,,48,52],[69,82,86,94],[87,,89,93],[97,101,105,113],[106,,108,112],[119,159,163,171],[138,142,146,154],[147,,149,153],[164,,166,170],[174,193,197,205],[198,,200,204]])}));return function getTransactionsByAddress(t){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee433(e){var t;return _regenerator["default"].wrap(function _callee433$(n){for(;;)switch(n.prev=n.next){case 0:e=ze.fromAny(e);n.next=3;return this._consensus;case 3:t=n.sent;n.next=6;return t.sendTransaction(e);case 6:n.t0=n.sent;n.next=n.t0===dt.SendTransactionResult.EXPIRED?9:n.t0===dt.SendTransactionResult.INVALID?10:n.t0===dt.SendTransactionResult.KNOWN?11:n.t0===dt.SendTransactionResult.RELAYED?11:n.t0===dt.SendTransactionResult.ALREADY_MINED?12:13;break;case 9:return n.abrupt("return",new Client.TransactionDetails(e,Client.TransactionState.EXPIRED));case 10:return n.abrupt("return",new Client.TransactionDetails(e,Client.TransactionState.INVALIDATED));case 11:return n.abrupt("return",new Client.TransactionDetails(e,Client.TransactionState.PENDING));case 12:return n.abrupt("return",this.getTransaction(e.hash()));case 13:return n.abrupt("return",new Client.TransactionDetails(e,Client.TransactionState.NEW));case 14:case"end":return n.stop()}},_callee433,this)}));return function sendTransaction(t){return e.apply(this,arguments)}}()},{key:"addBlockListener",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee434(e){var t;return _regenerator["default"].wrap(function _callee434$(n){for(;;)switch(n.prev=n.next){case 0:t=this._listenerId++;this._blockListeners.put(t,e);return n.abrupt("return",t);case 3:case"end":return n.stop()}},_callee434,this)}));return function addBlockListener(t){return e.apply(this,arguments)}}()},{key:"addConsensusChangedListener",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee435(e){var t;return _regenerator["default"].wrap(function _callee435$(n){for(;;)switch(n.prev=n.next){case 0:t=this._listenerId++;this._consensusChangedListeners.put(t,e);return n.abrupt("return",t);case 3:case"end":return n.stop()}},_callee435,this)}));return function addConsensusChangedListener(t){return e.apply(this,arguments)}}()},{key:"addHeadChangedListener",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee436(e){var t;return _regenerator["default"].wrap(function _callee436$(n){for(;;)switch(n.prev=n.next){case 0:t=this._listenerId++;this._headChangedListeners.put(t,e);return n.abrupt("return",t);case 3:case"end":return n.stop()}},_callee436,this)}));return function addHeadChangedListener(t){return e.apply(this,arguments)}}()},{key:"addTransactionListener",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee438(e,t){var n,r,a=this;return _regenerator["default"].wrap(function _callee438$(i){for(;;)switch(i.prev=i.next){case 0:t=t.map(function(e){return ge.fromAny(e)});(n=new w).addAll(t);this._subscribedAddresses.addAll(n);i.next=6;return this._consensusSynchronizer.push((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee437(){var e;return _regenerator["default"].wrap(function _callee437$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return a._consensus;case 2:(e=t.sent).established&&e.getSubscription().type===Ue.Type.ADDRESSES&&e.subscribe(Ue.fromAddresses(a._subscribedAddresses.values()));case 4:case"end":return t.stop()}},_callee437)})));case 6:r=this._listenerId++;this._transactionListeners.put(r,{listener:e,addresses:n});return i.abrupt("return",r);case 9:case"end":return i.stop()}},_callee438,this)}));return function addTransactionListener(t,n){return e.apply(this,arguments)}}()},{key:"removeListener",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee439(e){return _regenerator["default"].wrap(function _callee439$(t){for(;;)switch(t.prev=t.next){case 0:this._blockListeners.remove(e);this._consensusChangedListeners.remove(e);this._headChangedListeners.remove(e);this._transactionListeners.remove(e);if(0===this._transactionListeners.length){this._transactionConfirmWaiting.clear();this._transactionExpireWaiting.clear()}case 5:case"end":return t.stop()}},_callee439,this)}));return function removeListener(t){return e.apply(this,arguments)}}()},{key:"waitForConsensusEstablished",value:function waitForConsensusEstablished(){var e=this;return new _promise["default"](function(t){if(e._consensusState===Client.ConsensusState.ESTABLISHED)t();else{var n;n=e.addConsensusChangedListener(function(){var r=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee440(r){return _regenerator["default"].wrap(function _callee440$(a){for(;;)switch(a.prev=a.next){case 0:if(r!==Client.ConsensusState.ESTABLISHED){a.next=4;break}a.next=3;return e.removeListener(n);case 3:t();case 4:case"end":return a.stop()}},_callee440)}));return function(e){return r.apply(this,arguments)}}())}})}},{key:"network",get:function get(){return this._network}},{key:"mempool",get:function get(){this._config.requireFeatures(Client.Feature.MEMPOOL);return this._mempool}}]);return Client}();Cr.ConsensusState={CONNECTING:"connecting",SYNCING:"syncing",ESTABLISHED:"established"};n.register(Cr);Cr.Configuration=function(){function Configuration(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[],n=arguments.length>2&&arguments[2]!==undefined&&arguments[2],r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:10;(0,_classCallCheck2["default"])(this,Configuration);this._networkConfig=e;this._features=t;this._useVolatileStorage=n;this._requiredBlockConfirmations=r}(0,_createClass2["default"])(Configuration,[{key:"createConsensus",value:function createConsensus(){return this._useVolatileStorage?this._features.includes(Cr.Feature.MEMPOOL)||this._features.includes(Cr.Feature.MINING)?Nt.volatileLight(this._networkConfig):Nt.volatilePico(this._networkConfig):this._features.includes(Cr.Feature.LOCAL_HISTORY)?Nt.full(this._networkConfig):this._features.includes(Cr.Feature.MEMPOOL)||this._features.includes(Cr.Feature.MINING)?Nt.light(this._networkConfig):Nt.pico(this._networkConfig)}},{key:"hasFeature",value:function hasFeature(e){return this._features.includes(e)}},{key:"requireFeatures",value:function requireFeatures(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,a=t;r<a.length;r++){var i=a[r];if(!this.hasFeature(i))throw new Error("Missing required client feature: ".concat(i))}}},{key:"instantiateClient",value:function instantiateClient(){return new Cr(this)}},{key:"features",get:function get(){return this._features}},{key:"requiredBlockConfirmations",get:function get(){return this._requiredBlockConfirmations}},{key:"networkConfig",get:function get(){return this._networkConfig}}],[{key:"builder",value:function builder(){return new Cr.ConfigurationBuilder}}]);return Configuration}();Cr.ConfigurationBuilder=function(){function ConfigurationBuilder(){(0,_classCallCheck2["default"])(this,ConfigurationBuilder);this._features=new w}(0,_createClass2["default"])(ConfigurationBuilder,[{key:"dumb",value:function dumb(){return this.protocol("dumb")}},{key:"rtc",value:function rtc(){return this.protocol("rtc")}},{key:"ws",value:function ws(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8443;return this.protocol("ws",e,t)}},{key:"wss",value:function wss(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8443,n=arguments.length>2?arguments[2]:undefined,r=arguments.length>3?arguments[3]:undefined;return this.protocol("wss",e,t,n,r)}},{key:"protocol",value:function protocol(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:8443,r=arguments.length>3?arguments[3]:undefined,a=arguments.length>4?arguments[4]:undefined;if(this._protocol)throw new Error("Protocol already configured");this._protocol=this._requiredSet(e,"protocol","dumb","rtc","ws","wss");if("ws"===this._protocol||"wss"===this._protocol){this._host=this._requiredType(t,"host","string");this._port=this._requiredType(n,"port","number")}if("wss"===this._protocol){this._tlsKey=this._requiredType(r,"tlsKey","string");this._tlsCert=this._requiredType(a,"tlsCert","string")}return this}},{key:"volatile",value:function volatile(){var e=!(arguments.length>0&&arguments[0]!==undefined)||arguments[0];if("undefined"!=typeof this._volatile)throw new Error("volatile already set");this._volatile=this._requiredType(e,"volatile","boolean");return this}},{key:"blockConfirmations",value:function blockConfirmations(e){if("undefined"!=typeof this._blockConfirmations)throw new Error("blockConfirmations already set.");this._blockConfirmations=this._requiredType(e,"confirmations","number");return this}},{key:"feature",value:function feature(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._features.addAll(t);return this}},{key:"reverseProxy",value:function reverseProxy(e,t){if("ws"!==this._protocol&&"wss"!==this._protocol)throw new Error("Protocol must be ws or wss for reverse proxy.");for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];this._reverseProxy={enabled:!0,port:this._requiredType(e,"port","number"),header:this._requiredType(t,"header","string"),addresses:r};return this}},{key:"build",value:function build(){if(this._volatile&&this._features.contains(Cr.Feature.LOCAL_HISTORY))throw new Error("Local history is not available with volatile storage");this._protocol||(f.supportsWebRTC()?this._protocol="rtc":this._protocol="dumb");this._reverseProxy||(this._reverseProxy={enabled:!1});"number"!=typeof this._blockConfirmations&&(this._blockConfirmations=10);var e;switch(this._protocol){case"dumb":e=new or;break;case"rtc":if(!f.supportsWebRTC())throw new Error("WebRTC not supported on this platform");e=new sr;break;case"ws":e=new ar(this._host,this._port,this._reverseProxy);break;case"wss":e=new ir(this._host,this._port,this._tlsKey,this._tlsCert,this._reverseProxy)}return new Cr.Configuration(e,this._features.values(),!!this._volatile,this._blockConfirmations)}},{key:"instantiateClient",value:function instantiateClient(){return this.build().instantiateClient()}},{key:"_requiredType",value:function _requiredType(e,t,n){if((0,_typeof2["default"])(e)!==n)throw new Error("Type of ".concat(t," must be ").concat(n,", but is ").concat((0,_typeof2["default"])(e)));return e}},{key:"_requiredSet",value:function _requiredSet(e,t){if(!e)throw new Error("".concat(t," is required"));for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(!r.includes(e))throw new Error("".concat(t," must be one of: ").concat(r.join(", ")));return e}}]);return ConfigurationBuilder}();Cr.Feature={MINING:"MINING",LOCAL_HISTORY:"LOCAL_HISTORY",MEMPOOL:"MEMPOOL",PASSIVE:"PASSIVE"};Cr.Mempool=function(){function Mempool(e){(0,_classCallCheck2["default"])(this,Mempool);this._client=e;this._transactionAddedListeners=new b;this._transactionRemovedListeners=new b;this._listenerId=0}(0,_createClass2["default"])(Mempool,[{key:"_onTransactionAdded",value:function _onTransactionAdded(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._transactionAddedListeners.valueIterator());!(t=(a=i.next()).done);t=!0){(0,a.value)(e.hash())}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"_onTransactionRemoved",value:function _onTransactionRemoved(e){var t=!0,n=!1,r=undefined;try{for(var a,i=(0,_getIterator2["default"])(this._transactionRemovedListeners.valueIterator());!(t=(a=i.next()).done);t=!0){(0,a.value)(e.hash())}}catch(s){n=!0;r=s}finally{try{t||null==i["return"]||i["return"]()}finally{if(n)throw r}}}},{key:"getTransactions",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee441(){var e;return _regenerator["default"].wrap(function _callee441$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._client._consensus;case 2:e=t.sent;return t.abrupt("return",e.getMempoolContents().map(function(e){return e.hash()}));case 4:case"end":return t.stop()}},_callee441,this)}));return function getTransactions(){return e.apply(this,arguments)}}()},{key:"getStatistics",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee442(){var e;return _regenerator["default"].wrap(function _callee442$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._client._consensus;case 2:e=t.sent;return t.abrupt("return",new Cr.MempoolStatistics(e.getMempoolContents()));case 4:case"end":return t.stop()}},_callee442,this)}));return function getStatistics(){return e.apply(this,arguments)}}()},{key:"addTransactionAddedListener",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee443(e){var t;return _regenerator["default"].wrap(function _callee443$(n){for(;;)switch(n.prev=n.next){case 0:t=this._listenerId++;this._transactionAddedListeners.put(t,e);return n.abrupt("return",t);case 3:case"end":return n.stop()}},_callee443,this)}));return function addTransactionAddedListener(t){return e.apply(this,arguments)}}()},{key:"addTransactionRemovedListener",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee444(e){var t;return _regenerator["default"].wrap(function _callee444$(n){for(;;)switch(n.prev=n.next){case 0:t=this._listenerId++;this._transactionRemovedListeners.put(t,e);return n.abrupt("return",t);case 3:case"end":return n.stop()}},_callee444,this)}));return function addTransactionRemovedListener(t){return e.apply(this,arguments)}}()},{key:"removeListener",value:function removeListener(e){this._transactionAddedListeners.remove(e);this._transactionRemovedListeners.remove(e)}}]);return Mempool}();Cr.MempoolStatistics=function(){function MempoolStatistics(e){(0,_classCallCheck2["default"])(this,MempoolStatistics);var t=[1e4,5e3,2e3,1e3,500,200,100,50,20,10,5,2,1,0];this._countPerBucket={buckets:[]};this._sizePerBucket={buckets:[]};this._totalCount=e.length;this._totalSize=0;this._requiredFeePerByte=0;var n=!0,r=!1,a=undefined;try{for(var i,s=(0,_getIterator2["default"])(e);!(n=(i=s.next()).done);n=!0){for(var o=i.value,u=0;u<t.length&&o.feePerByte<t[u];)u++;var c=t[u];if(c!==undefined){if(!this._countPerBucket[c]){this._countPerBucket[c]=0;this._countPerBucket.buckets.push(c);this._sizePerBucket[c]=0;this._sizePerBucket.buckets.push(c)}this._countPerBucket[c]++;this._sizePerBucket[c]+=o.serializedSize}this._totalSize+=o.serializedSize;this._totalSize<re.BLOCK_SIZE_MAX&&(this._requiredFeePerByte=o.feePerByte)}}catch(l){r=!0;a=l}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}this._totalSize<re.BLOCK_SIZE_MAX&&(this._requiredFeePerByte=0)}(0,_createClass2["default"])(MempoolStatistics,[{key:"count",get:function get(){return this._totalCount}},{key:"size",get:function get(){return this._totalSize}},{key:"requiredFeePerByte",get:function get(){return this._requiredFeePerByte}},{key:"countInBuckets",get:function get(){return this._countPerBucket}},{key:"sizeInBuckets",get:function get(){return this._sizePerBucket}}]);return MempoolStatistics}();Cr.Network=function(){function Network(e){(0,_classCallCheck2["default"])(this,Network);this._client=e}(0,_createClass2["default"])(Network,[{key:"getPeers",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee445(){var e,t,n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee445$(u){for(;;)switch(u.prev=u.next){case 0:u.next=2;return this._client._consensus;case 2:e=u.sent;t=[];n=!0;r=!1;a=undefined;u.prev=7;for(i=(0,_getIterator2["default"])(e.network.connections.valueIterator());!(n=(s=i.next()).done);n=!0){o=s.value;t.push(new Cr.PeerInfo(o))}u.next=15;break;case 11:u.prev=11;u.t0=u["catch"](7);r=!0;a=u.t0;case 15:u.prev=15;u.prev=16;n||null==i["return"]||i["return"]();case 18:u.prev=18;if(!r){u.next=21;break}throw a;case 21:return u.finish(18);case 22:return u.finish(15);case 23:return u.abrupt("return",t);case 24:case"end":return u.stop()}},_callee445,this,[[7,11,15,23],[16,,18,22]])}));return function getPeers(){return e.apply(this,arguments)}}()},{key:"getPeer",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee446(e){var t,n;return _regenerator["default"].wrap(function _callee446$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._client._consensus;case 2:t=r.sent;r.t0=t.network.connections;r.next=6;return this._toPeerAddress(e);case 6:r.t1=r.sent;if(!(n=r.t0.getConnectionByPeerAddress.call(r.t0,r.t1))){r.next=10;break}return r.abrupt("return",new Cr.PeerInfo(n));case 10:return r.abrupt("return",null);case 11:case"end":return r.stop()}},_callee446,this)}));return function getPeer(t){return e.apply(this,arguments)}}()},{key:"getAddresses",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee447(){var e,t,n,r,a,i,s,o;return _regenerator["default"].wrap(function _callee447$(u){for(;;)switch(u.prev=u.next){case 0:u.next=2;return this._client._consensus;case 2:e=u.sent;t=[];n=!0;r=!1;a=undefined;u.prev=7;for(i=(0,_getIterator2["default"])(e.network.addresses.iterator());!(n=(s=i.next()).done);n=!0){o=s.value;t.push(new Cr.AddressInfo(o))}u.next=15;break;case 11:u.prev=11;u.t0=u["catch"](7);r=!0;a=u.t0;case 15:u.prev=15;u.prev=16;n||null==i["return"]||i["return"]();case 18:u.prev=18;if(!r){u.next=21;break}throw a;case 21:return u.finish(18);case 22:return u.finish(15);case 23:return u.abrupt("return",t);case 24:case"end":return u.stop()}},_callee447,this,[[7,11,15,23],[16,,18,22]])}));return function getAddresses(){return e.apply(this,arguments)}}()},{key:"getAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee448(e){var t,n;return _regenerator["default"].wrap(function _callee448$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._client._consensus;case 2:t=r.sent;r.t0=t.network.addresses;r.next=6;return this._toPeerAddress(e);case 6:r.t1=r.sent;if(!(n=r.t0.getState.call(r.t0,r.t1))){r.next=10;break}return r.abrupt("return",new Cr.AddressInfo(n));case 10:return r.abrupt("return",null);case 11:case"end":return r.stop()}},_callee448,this)}));return function getAddress(t){return e.apply(this,arguments)}}()},{key:"getOwnAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee449(){var e;return _regenerator["default"].wrap(function _callee449$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._client._consensus;case 2:e=t.sent;return t.abrupt("return",new Cr.BasicAddress(e.network.config.peerAddress));case 4:case"end":return t.stop()}},_callee449,this)}));return function getOwnAddress(){return e.apply(this,arguments)}}()},{key:"getStatistics",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee450(){var e;return _regenerator["default"].wrap(function _callee450$(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;return this._client._consensus;case 2:e=t.sent;return t.abrupt("return",new Cr.NetworkStatistics(e.network));case 4:case"end":return t.stop()}},_callee450,this)}));return function getStatistics(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee451(e){var t;return _regenerator["default"].wrap(function _callee451$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this._client._consensus;case 2:t=n.sent;n.t0=t.network.connections;n.next=6;return this._toPeerAddress(e);case 6:n.t1=n.sent;n.t0.connectOutbound.call(n.t0,n.t1);case 8:case"end":return n.stop()}},_callee451,this)}));return function connect(t){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee452(e){var t,n;return _regenerator["default"].wrap(function _callee452$(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return this._client._consensus;case 2:t=r.sent;r.t0=t.network.connections;r.next=6;return this._toPeerAddress(e);case 6:r.t1=r.sent;(n=r.t0.getConnectionByPeerAddress.call(r.t0,r.t1))&&n.peerChannel.close(Wn.MANUAL_PEER_DISCONNECT);case 9:case"end":return r.stop()}},_callee452,this)}));return function disconnect(t){return e.apply(this,arguments)}}()},{key:"ban",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee453(e){var t,n,r;return _regenerator["default"].wrap(function _callee453$(a){for(;;)switch(a.prev=a.next){case 0:a.next=2;return this._client._consensus;case 2:t=a.sent;a.next=5;return this._toPeerAddress(e);case 5:n=a.sent;(r=t.network.connections.getConnectionByPeerAddress(n))?r.peerChannel.close(Wn.MANUAL_PEER_BAN):t.network.addresses.getState(n).state=Dn.BANNED;case 8:case"end":return a.stop()}},_callee453,this)}));return function ban(t){return e.apply(this,arguments)}}()},{key:"unban",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee454(e){var t;return _regenerator["default"].wrap(function _callee454$(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;return this._client._consensus;case 2:t=n.sent;n.t0=t.network.addresses;n.next=6;return this._toPeerAddress(e);case 6:n.t1=n.sent;n.t0.getState.call(n.t0,n.t1).state=Dn.TRIED;case 9:case"end":return n.stop()}},_callee454,this)}));return function unban(t){return e.apply(this,arguments)}}()},{key:"_toPeerAddress",value:function(){var e=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee455(e){var t,n,r,a,i,s,o,u;return _regenerator["default"].wrap(function _callee455$(c){for(;;)switch(c.prev=c.next){case 0:c.next=2;return this._client._consensus;case 2:t=c.sent;if(!(e instanceof Pn)){c.next=7;break}n=t.network.addresses.get(e);c.next=39;break;case 7:if(!(e instanceof Cr.BasicAddress)){c.next=11;break}n=t.network.addresses.get(e.peerAddress);c.next=39;break;case 11:if("string"!=typeof e){c.next=39;break}r=!0;a=!1;i=undefined;c.prev=15;s=(0,_getIterator2["default"])(t.network.addresses.iterator());case 17:if(r=(o=s.next()).done){c.next=25;break}if((u=o.value).peerAddress.toString()!==e){c.next=22;break}n=u.peerAddress;return c.abrupt("break",25);case 22:r=!0;c.next=17;break;case 25:c.next=31;break;case 27:c.prev=27;c.t0=c["catch"](15);a=!0;i=c.t0;case 31:c.prev=31;c.prev=32;r||null==s["return"]||s["return"]();case 34:c.prev=34;if(!a){c.next=37;break}throw i;case 37:return c.finish(34);case 38:return c.finish(31);case 39:if(n){c.next=41;break}throw new Error("Invalid or unknown peer address");case 41:return c.abrupt("return",n);case 42:case"end":return c.stop()}},_callee455,this,[[15,27,31,39],[32,,34,38]])}));return function _toPeerAddress(t){return e.apply(this,arguments)}}()}]);return Network}();Cr.BasicAddress=function(){function BasicAddress(e){(0,_classCallCheck2["default"])(this,BasicAddress);this._address=e}(0,_createClass2["default"])(BasicAddress,[{key:"toPlain",value:function toPlain(){return{peerAddress:this.peerAddress.toString(),peerId:this.peerId.toString(),services:this.services,netAddress:this.netAddress?{ip:this.netAddress.ip,reliable:this.netAddress.reliable}:null}}},{key:"peerAddress",get:function get(){return this._address}},{key:"peerId",get:function get(){return this._address.peerId}},{key:"services",get:function get(){return _.toNameArray(_.legacyProvideToCurrent(this._address.services))}},{key:"netAddress",get:function get(){return this._address.netAddress}}]);return BasicAddress}();Cr.AddressInfo=function(e){(0,_inherits2["default"])(AddressInfo,e);var t=_createSuper(AddressInfo);function AddressInfo(e){var n;(0,_classCallCheck2["default"])(this,AddressInfo);(n=t.call(this,e.peerAddress))._state=e.state;return n}(0,_createClass2["default"])(AddressInfo,[{key:"toPlain",value:function toPlain(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(AddressInfo.prototype),"toPlain",this).call(this);e.banned=this.banned;e.connected=this.connected;return e}},{key:"banned",get:function get(){return this._state===Dn.BANNED}},{key:"connected",get:function get(){return this._state===Dn.ESTABLISHED}},{key:"state",get:function get(){return this._state}}]);return AddressInfo}(Cr.BasicAddress);Cr.PeerInfo=function(e){(0,_inherits2["default"])(PeerInfo,e);var t=_createSuper(PeerInfo);function PeerInfo(e){var n;(0,_classCallCheck2["default"])(this,PeerInfo);(n=t.call(this,e.peerAddress))._connection=e;var r=n._connection.networkConnection,a=n._connection.peer;n._bytesReceived=r?r.bytesReceived:0;n._bytesSent=r?r.bytesSent:0;n._latency=n._connection.statistics.latencyMedian;n._state=n._connection.state;n._version=a?a.version:undefined;n._timeOffset=a?a.timeOffset:undefined;n._headHash=a?a.headHash:undefined;n._userAgent=a?a.userAgent:undefined;return n}(0,_createClass2["default"])(PeerInfo,[{key:"toPlain",value:function toPlain(){var e=(0,_get10["default"])((0,_getPrototypeOf2["default"])(PeerInfo.prototype),"toPlain",this).call(this);e.connectionSince=this.connectionSince;e.bytesReceived=this.bytesReceived;e.bytesSent=this.bytesSent;e.latency=this.latency;e.version=this.version;e.state=this.state;e.timeOffset=this.timeOffset;e.headHash=this.headHash.toPlain();e.userAgent=this.userAgent;return e}},{key:"connectionSince",get:function get(){return this._connection.establishedSince}},{key:"netAddress",get:function get(){return this._connection.networkConnection.netAddress}},{key:"bytesReceived",get:function get(){return this._bytesReceived}},{key:"bytesSent",get:function get(){return this._bytesSent}},{key:"latency",get:function get(){return this._latency}},{key:"version",get:function get(){return this._version}},{key:"state",get:function get(){return this._state}},{key:"timeOffset",get:function get(){return this._timeOffset}},{key:"headHash",get:function get(){return this._headHash}},{key:"userAgent",get:function get(){return this._userAgent}}]);return PeerInfo}(Cr.BasicAddress);Cr.NetworkStatistics=function(){function NetworkStatistics(e){(0,_classCallCheck2["default"])(this,NetworkStatistics);this._bytesReceived=e.bytesReceived;this._bytesSent=e.bytesSent;this._peerCounts={total:e.peerCount,connecting:e.peerCountConnecting,dumb:e.peerCountDumb,rtc:e.peerCountWebRtc,ws:e.peerCountWebSocket,wss:e.peerCountWebSocketSecure};this._knownAddressesCounts={total:e.knownAddressesCount,rtc:e.addresses.knownRtcAddressesCount,ws:e.addresses.knownWsAddressesCount,wss:e.addresses.knownWssAddressesCount};this._timeOffset=e.time.offset}(0,_createClass2["default"])(NetworkStatistics,[{key:"toPlain",value:function toPlain(){return{bytesReceived:this.bytesReceived,bytesSent:this.bytesSent,totalPeerCount:this.totalPeerCount,peerCountsByType:this.peerCountsByType,totalKnownAddresses:this.totalKnownAddresses,knownAddressesByType:this.knownAddressesByType,timeOffset:this.timeOffset}}},{key:"bytesReceived",get:function get(){return this._bytesReceived}},{key:"bytesSent",get:function get(){return this._bytesSent}},{key:"totalPeerCount",get:function get(){return this._peerCounts.total}},{key:"peerCountsByType",get:function get(){return this._peerCounts}},{key:"totalKnownAddresses",get:function get(){return this._knownAddressesCounts.total}},{key:"knownAddressesByType",get:function get(){return this._knownAddressesCounts}},{key:"timeOffset",get:function get(){return this._timeOffset}}]);return NetworkStatistics}();Cr.TransactionDetails=function(){function TransactionDetails(e,t,n,r,a,i){(0,_classCallCheck2["default"])(this,TransactionDetails);this._transaction=e;this._state=t;this._blockHash=n;this._blockHeight=r;this._confirmations=a;this._timestamp=i}(0,_createClass2["default"])(TransactionDetails,[{key:"toPlain",value:function toPlain(){var e=this._transaction.toPlain();e.state=this._state;e.blockHash=this._blockHash?this._blockHash.toPlain():null;e.blockHeight=this._blockHeight;e.confirmations=this._confirmations;e.timestamp=this._timestamp;return e}},{key:"transactionHash",get:function get(){return this._transaction.hash()}},{key:"format",get:function get(){return this._transaction.format}},{key:"sender",get:function get(){return this._transaction.sender}},{key:"senderType",get:function get(){return this._transaction.senderType}},{key:"recipient",get:function get(){return this._transaction.recipient}},{key:"recipientType",get:function get(){return this._transaction.recipientType}},{key:"value",get:function get(){return this._transaction.value}},{key:"fee",get:function get(){return this._transaction.fee}},{key:"feePerByte",get:function get(){return this._transaction.feePerByte}},{key:"validityStartHeight",get:function get(){return this._transaction.validityStartHeight}},{key:"network",get:function get(){return this._transaction.networkId}},{key:"flags",get:function get(){return this._transaction.flags}},{key:"data",get:function get(){var e=ye.TYPE_MAP.get(this.recipientType).dataToPlain(this._transaction.data);e.raw=this._transaction.data;return e}},{key:"proof",get:function get(){var e=ye.TYPE_MAP.get(this.senderType).proofToPlain(this._transaction.proof);e.raw=this._transaction.proof;return e}},{key:"size",get:function get(){return this._transaction.serializedSize}},{key:"valid",get:function get(){return this._transaction.verify()}},{key:"transaction",get:function get(){return this._transaction}},{key:"state",get:function get(){return this._state}},{key:"blockHash",get:function get(){return this._blockHash}},{key:"blockHeight",get:function get(){return this._blockHeight}},{key:"confirmations",get:function get(){return this._confirmations}},{key:"timestamp",get:function get(){return this._timestamp}}],[{key:"fromPlain",value:function fromPlain(e){return new Cr.TransactionDetails(ze.fromPlain(e),e.state||Cr.TransactionState.NEW,e.blockHash?ie.fromAny(e.blockHash):undefined,e.blockHeight||undefined,e.confirmations||undefined,e.timestamp||undefined)}}]);return TransactionDetails}();Cr.TransactionState={NEW:"new",PENDING:"pending",MINED:"mined",INVALIDATED:"invalidated",EXPIRED:"expired",CONFIRMED:"confirmed"};e._loaded=!0;"function"==typeof e._onload&&e._onload()}(Nimiq);
//# sourceMappingURL=web-babel.js.map
